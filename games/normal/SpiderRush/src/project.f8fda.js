window.__require=function e(t,o,n){function i(a,s){if(!o[a]){if(!t[a]){var c=a.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+a+"'")}}var p=o[a]={exports:{}};t[a][0].call(p.exports,function(e){return i(t[a][1][e]||e)},p,p.exports,e,t,o,n)}return o[a].exports}for(var r="function"==typeof __require&&__require,a=0;a<n.length;a++)i(n[a]);return i}({AudioController:[function(e,t,o){"use strict";cc._RF.push(t,"1d6d0OoirhGUovLXt4pSNNX","AudioController"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../utils/HashMap"),i=e("./EventManager"),r=e("./EventName"),a=e("./Game"),s="sounds/";window.oncanplay&&(window.oncanplay=function(){c.canPlay=!0});var c=function(){function e(){this.audioID={},this.clips=new n.HashMap}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.init=function(e){console.warn(" start load AudioClip ");var t=this;cc.loader.loadResDir(s,cc.AudioClip,function(o,n,i){if(o)console.error(o);else{for(var r=0,a=n;r<a.length;r++){var s=a[r];0,t.clips.add(s.name,s)}t.initEvent(),e&&e()}})},e.prototype.initEvent=function(){var e=this;i.gEventMgr.targetOff(this),this.playMusic("bgm"),i.gEventMgr.on(r.GlobalEvent.PLAY_RECYCLE_POKERS,function(){e.playEffect("recyclePoker")},this),i.gEventMgr.on(r.GlobalEvent.DEV_POKERS,function(){e.playEffect("devPoker")},this),i.gEventMgr.on(r.GlobalEvent.PLAY_POKER_PLACE,function(){e.playEffect("pokerPlace")},this),i.gEventMgr.on(r.GlobalEvent.PLAY_RECYCLE,function(){e.playEffect("recycle"+a.Game.getCombo())},this),i.gEventMgr.on(r.GlobalEvent.PLAY_POKER_FLY,function(){e.playEffect("pokerFly")},this),i.gEventMgr.on(r.GlobalEvent.PLAY_OVER_1,function(){e.playEffect("result_flip")},this),i.gEventMgr.on(r.GlobalEvent.PLAY_OVER_2,function(){e.playEffect("result_dev")},this),i.gEventMgr.on(r.GlobalEvent.PLAY_PAUSE,function(){e.playEffect("pause")},this),i.gEventMgr.on(r.GlobalEvent.PLAY_SHAKE,function(){e.playEffect("shake")},this),i.gEventMgr.on(r.GlobalEvent.PLAY_START,function(){e.playEffect("start_count")},this)},e.prototype.playEffect=function(t,o){var n=this;if(void 0===o&&(o=!1),e.canPlay){if(!(cc.audioEngine.getEffectsVolume()<=.05)){var i=this.clips.get(t);i?this.audioID[t]=cc.audioEngine.playEffect(i,o):cc.loader.loadRes(s+t,cc.AudioClip,function(e,i){e?console.error(e):(n.clips.add(i.name,i),n.audioID[t]=cc.audioEngine.playEffect(i,o))})}}else this.bindTouch()},e.prototype.playMusic=function(t,o){var n=this;if(void 0===o&&(o=!0),!e.canPlay)return this.bindTouch(),void e.PlayedList.push({loop:!0,volume:1,clipName:t,supTime:Date.now(),skip:!1,isBgm:!0});var i=this.clips.get(t);i?cc.audioEngine.playMusic(i,o):cc.loader.loadRes(s+t,cc.AudioClip,function(e,t){e?console.error(e):("string"==typeof t._audio&&cc.loader._cache&&cc.loader._cache[t._audio]&&cc.loader._cache[t._audio].buffer&&(t._audio=cc.loader._cache[t._audio].buffer),n.clips.add(t.name,t),cc.audioEngine.playMusic(t,o))})},e.prototype.bindTouch=function(){if(!e.hasBindTouch){var t=this,o=function(){var n;for(cc.game.canvas.removeEventListener("touchstart",o),e.canPlay=!0;(n=e.PlayedList.pop())&&t.clips.get(n.clipName)&&!n.skip;)cc.audioEngine.playMusic(t.clips.get(n.clipName),n.loop)};e.hasBindTouch=!0,cc.game.canvas.addEventListener("touchstart",o)}},e.PlayedList=[],e.canPlay=!1,e.hasBindTouch=!1,e}();o.gAudio=c.inst,cc._RF.pop()},{"../utils/HashMap":"HashMap","./EventManager":"EventManager","./EventName":"EventName","./Game":"Game"}],EventManager:[function(e,t,o){"use strict";cc._RF.push(t,"15a47pj/bZLz4bw5c1lt4L9","EventManager"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){this.eventTarget=new cc.EventTarget}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.emit=function(e,t,o,n,i,r){this.eventTarget.emit(e.toString(),t,o,n,i,r)},e.prototype.on=function(e,t,o,n){return this.eventTarget.on(e.toString(),t,o,n)},e.prototype.once=function(e,t,o){this.eventTarget.once(e.toString(),t,o)},e.prototype.dispatchEvent=function(e){this.eventTarget.dispatchEvent(e)},e.prototype.off=function(e,t,o){this.eventTarget.off(e.toString(),t,o)},e.prototype.hasEventListener=function(e){return this.eventTarget.hasEventListener(e.toString())},e.prototype.targetOff=function(e){this.eventTarget.targetOff(e)},e}();o.gEventMgr=n.inst,cc._RF.pop()},{}],EventName:[function(e,t,o){"use strict";cc._RF.push(t,"bf67a7QRNNGpo1qJkcJdq4+","EventName"),Object.defineProperty(o,"__esModule",{value:!0}),function(e){e[e.UPDATE_DRAW_ICON=0]="UPDATE_DRAW_ICON",e[e.UPDATE_SCORE=1]="UPDATE_SCORE",e[e.UPDATE_BACK_BTN_ICON=2]="UPDATE_BACK_BTN_ICON",e[e.UPDATE_RECYCLE_POKER=3]="UPDATE_RECYCLE_POKER",e[e.OPEN_RESULT=4]="OPEN_RESULT",e[e.RESTART=5]="RESTART",e[e.COMPLETE=6]="COMPLETE",e[e.AUTO_COMPLETE_DONE=7]="AUTO_COMPLETE_DONE",e[e.PLAY_RECYCLE_POKERS=8]="PLAY_RECYCLE_POKERS",e[e.DEV_POKERS=9]="DEV_POKERS",e[e.PLAY_POKER_PLACE=10]="PLAY_POKER_PLACE",e[e.PLAY_POKER_FLY=11]="PLAY_POKER_FLY",e[e.PLAY_OVER_1=12]="PLAY_OVER_1",e[e.PLAY_OVER_2=13]="PLAY_OVER_2",e[e.PLAY_PAUSE=14]="PLAY_PAUSE",e[e.HIDE_HELP=15]="HIDE_HELP",e[e.PLAY_START=16]="PLAY_START",e[e.PLAY_SHAKE=17]="PLAY_SHAKE",e[e.SMALL_BGM=18]="SMALL_BGM",e[e.NORMAL_BGM=19]="NORMAL_BGM",e[e.PLAY_RECYCLE=20]="PLAY_RECYCLE",e[e.ON_SHOW=21]="ON_SHOW",e[e.ON_HIDE=22]="ON_HIDE"}(o.GlobalEvent||(o.GlobalEvent={})),cc._RF.pop()},{}],GameFactory:[function(e,t,o){"use strict";cc._RF.push(t,"44968IEriNJurc3wbMrKqft","GameFactory"),Object.defineProperty(o,"__esModule",{value:!0});var n,i=e("../utils/HashMap"),r=function(){function e(e,t,o){this._pool=[],this.totalSize=0,this.initTime=[],this.completeHandler=o,this.template=e,this.totalSize=t,this.hashKey="ObjPool:"+this.template.name+" - "+this.totalSize,this.initPool(t)}return e.prototype.initPool=function(e,t){var o=this;if(void 0===t&&(t=!1),t)for(var n=0;n<e;++n){this.initTime.push(Date.now());var i=cc.instantiate(this.template);this.put(i)}else for(n=0;n<e;++n)this.initTime.push(Date.now()),setTimeout(function(){var e=cc.instantiate(o.template);o.put(e)},n)},e.prototype.size=function(){return this._pool.length},e.prototype.clear=function(){for(var e=this._pool.length,t=0;t<e;++t)this._pool[t].destroy&&this._pool[t].destroy();this._pool.length=0},e.prototype.put=function(e){if(e&&-1===this._pool.indexOf(e)){e.removeFromParent(!1);for(var t=0,o=e.getComponents(cc.Component);t<o.length;t++){var n=o[t];n&&n.unuse&&n.unuse.apply(n)}this._pool.push(e),this.completeHandler&&this.totalSize<=this._pool.length&&(this.completeHandler(),this.completeHandler=null)}},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=this._pool.length-1;o<0&&(console.warn(" last < 0 "),this.initPool(1,!0)),o=this._pool.length-1;var n=this._pool[o];this._pool.length=o;for(var i=0,r=n.getComponents(cc.Component);i<r.length;i++){var a=r[i];a&&a.reuse&&a.reuse.apply(a,arguments)}return n},e}();(function(e){e[e.INIT=0]="INIT",e[e.POKER=4]="POKER",e[e.AddScore=8]="AddScore",e[e.SubScore=16]="SubScore",e[e.DONE=28]="DONE"})(n||(n={}));var a=function(){function e(){this.step=n.INIT,this.PokerPool=new i.HashMap,this.addScorePool=new i.HashMap,this.subScorePool=new i.HashMap}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.init=function(e,t,o,n){var i=this;this.doneCallback=e,setTimeout(function(){i.initPoker(52,t)},0),setTimeout(function(){i.initAddScore(10,o)},10),setTimeout(function(){i.initSubScore(10,n)},20)},e.prototype.nextStep=function(e){this.step|=e,this.step>=n.DONE&&this.doneCallback&&this.doneCallback()},e.prototype.initPoker=function(e,t){var o=this;t?o.PokerPool.add("Poker",new r(t,e,function(){o.nextStep(n.POKER)})):cc.loader.loadRes("prefabs/poker",cc.Prefab,function(t,i){t?console.error(t):o.PokerPool.add("Poker",new r(i,e,function(){o.nextStep(n.POKER)}))})},e.prototype.getPoker=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.PokerPool.get("Poker").get(e)},e.prototype.putPoker=function(e){this.PokerPool.get("Poker").put(e)},e.prototype.initAddScore=function(e,t){var o=this;t?o.addScorePool.add("AddScore",new r(t,e,function(){o.nextStep(n.AddScore)})):cc.loader.loadRes("prefabs/AddScoreLabel",cc.Prefab,function(t,i){t?console.error(t):o.addScorePool.add("AddScore",new r(i,e,function(){o.nextStep(n.AddScore)}))})},e.prototype.getAddScore=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.addScorePool.get("AddScore").get(e)},e.prototype.putAddScore=function(e){this.addScorePool.get("AddScore").put(e)},e.prototype.initSubScore=function(e,t){var o=this;t?o.subScorePool.add("SubScore",new r(t,e,function(){o.nextStep(n.SubScore)})):cc.loader.loadRes("prefabs/SubScoreLabel",cc.Prefab,function(t,i){t?console.error(t):o.subScorePool.add("SubScore",new r(i,e,function(){o.nextStep(n.SubScore)}))})},e.prototype.getSubScore=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.subScorePool.get("SubScore").get(e)},e.prototype.putSubScore=function(e){this.subScorePool.get("SubScore").put(e)},e}();o.gFactory=a.inst,cc._RF.pop()},{"../utils/HashMap":"HashMap"}],GameScene:[function(e,t,o){"use strict";cc._RF.push(t,"e1b90/rohdEk4SdmmEZANaD","GameScene");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,o,a):i(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var r,a=e("./controller/GameFactory"),s=e("./controller/Game"),c=e("./Poker"),l=e("./Pokers"),p=e("./controller/EventManager"),u=e("./controller/EventName"),h=e("./Stop"),d=e("./controller/AudioController"),f=e("./Guide"),m=e("./utils/LogHandler"),g=cc._decorator,y=g.ccclass,v=g.property;(function(e){e[e.READY=0]="READY",e[e.PREFABS=2]="PREFABS",e[e.AUDIO=16]="AUDIO",e[e.CELER=32]="CELER",e[e.GUIDE=64]="GUIDE",e[e.CELER_READY=18]="CELER_READY",e[e.DONE=114]="DONE"})(r=o.LOAD_STEP||(o.LOAD_STEP={}));var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.Poker=null,t.PokerClip=null,t.PlaceRoot=null,t.PokerDevl=null,t.RemoveNode=null,t.BackButton=null,t.PauseButton=null,t.BackButtonAtlas=null,t.DrawButtonAtlas=null,t.TimeLabel=null,t.TimeIcon=null,t.TimeIconAtlas=null,t.ScoreLabel=null,t.SmallOrg=null,t.SubScoreLabel=null,t.AddScoreLabel=null,t.TimeAnimation=null,t.Stop=null,t.Guide=null,t.Complete=null,t.SubmitButton=null,t.CheatToggle=null,t.RecyclePokerLabel=null,t.step=r.READY,t.canDispatchPoker=!1,t.dispatchCardCount=38,t.devTime=10,t.backTime=10,t.score=0,t.showScore=0,t.scoreStep=0,t.isStart=!1,t.isEnd=!1,t.isCelerReady=!1,t}return n(t,e),t.prototype.init=function(){this.Stop.hide(),this.Complete.node.active=!1,this.TimeLabel.string=CMath.TimeFormat(s.Game.getGameTime()),this.ScoreLabel.string="0",this.TimeAnimation.node.active=!1,this.TimeIcon.spriteFrame=this.TimeIconAtlas.getSpriteFrame("icon_time"),s.Game.getCycledPokerRoot().clear(),s.Game.getPlacePokerRoot().clear();for(var e=0,t=this.PlaceRoot.children;e<t.length;e++){var o=t[e];o.getComponent(cc.Sprite)&&o.getComponent(cc.Sprite).enabled&&(o.getComponent(cc.Sprite).enabled=!1),s.Game.addPlacePokerRoot(parseInt(o.name),o)}},t.prototype.onLoad=function(){var e=this;CELER_X&&m.LogHandler.inst.initLog(celerSDK.log),m.LogHandler.inst.log(" game scene on load"),s.Game.removeNode=this.RemoveNode,s.Game.pokerClip=this.PokerClip;var t=this;CELER_X&&celerSDK.onStart(function(){t.celerStart()}.bind(this)),CELER_X&&celerSDK.provideScore(function(){return parseInt(s.Game.getScore().toString())}),this.CheatToggle.node.active=!1,this.CheatToggle.isChecked=!1,window.CheatOpen=!1,this.CheatToggle.node.on("toggle",function(){e.CheatToggle.isChecked?window.noTime=window.CheatOpen=!0:window.noTime=window.CheatOpen=!1},this),this.init(),setTimeout(function(){a.gFactory.init(function(){this.nextStep(r.PREFABS)}.bind(e),e.Poker,e.AddScoreLabel,e.SubScoreLabel)},0),this.nextStep(r.AUDIO),d.gAudio.init(function(){}),this.PokerClip.on(cc.Node.EventType.TOUCH_START,function(e){},this),this.PokerClip.on(cc.Node.EventType.TOUCH_END,function(t){s.Game.isTimeOver()||s.Game.isComplete()||e.devTime>=.3&&(e.dispatchPoker(),e.devTime=0)},this),this.PokerClip.on(cc.Node.EventType.TOUCH_CANCEL,function(t){s.Game.isTimeOver()||s.Game.isComplete()||e.devTime>=.3&&(e.dispatchPoker(),e.devTime=0)},this),this.PauseButton.node.on(cc.Node.EventType.TOUCH_END,function(){s.Game.isComplete()||(e.Stop.show(1),s.Game.setPause(!0))},this),this.SubmitButton.node.on(cc.Node.EventType.TOUCH_END,function(){s.Game.isComplete()||(e.Stop.show(-1),s.Game.setPause(!0))},this),this.PokerDevl.on(cc.Node.EventType.CHILD_ADDED,function(e){var t=e.getComponent(c.default);t&&t.setRecycle(!1)},this),p.gEventMgr.on(u.GlobalEvent.COMPLETE,function(){e.Complete.node.active=!0,e.Complete.play()},this),p.gEventMgr.on(u.GlobalEvent.UPDATE_RECYCLE_POKER,function(t){e.RecyclePokerLabel.string=t.toString()},this),this.BackButton.node.getChildByName("Background").getComponent(cc.Sprite).spriteFrame=this.BackButtonAtlas.getSpriteFrame("btn_backgray"),this.BackButton.interactable=!1,this.BackButton.node.on(cc.Node.EventType.TOUCH_START,function(){s.Game.isTimeOver()||e.backTime<.5||s.Game.isComplete()||(e.backTime=0,s.Game.backStep()&&s.Game.addScore(-l.BACK_STEP_SCORE,CMath.ConvertToNodeSpaceAR(e.BackButton.node,s.Game.removeNode)))},s.Game),p.gEventMgr.on(u.GlobalEvent.UPDATE_BACK_BTN_ICON,function(){e.BackButton.interactable=s.Game.canBackStep(),e.BackButton.interactable?e.BackButton.node.getChildByName("Background").getComponent(cc.Sprite).spriteFrame=e.BackButtonAtlas.getSpriteFrame("btn_back"):e.BackButton.node.getChildByName("Background").getComponent(cc.Sprite).spriteFrame=e.BackButtonAtlas.getSpriteFrame("btn_backgray")},this),p.gEventMgr.on(u.GlobalEvent.UPDATE_DRAW_ICON,function(){switch(s.Game.getFreeDrawTimes()){case 1:e.PokerDevl.getComponent(cc.Sprite).spriteFrame=e.DrawButtonAtlas.getSpriteFrame("free_draw_1");break;case 2:e.PokerDevl.getComponent(cc.Sprite).spriteFrame=e.DrawButtonAtlas.getSpriteFrame("free_draw_2");break;case 3:e.PokerDevl.getComponent(cc.Sprite).spriteFrame=e.DrawButtonAtlas.getSpriteFrame("free_draw_3");break;default:e.PokerDevl.getComponent(cc.Sprite).spriteFrame=e.DrawButtonAtlas.getSpriteFrame("draw_20")}},this),p.gEventMgr.on(u.GlobalEvent.UPDATE_SCORE,function(t,o){e.scoreStep=Math.ceil(Math.max(t/20,e.scoreStep));var n=CMath.ConvertToNodeSpaceAR(e.ScoreLabel.node,e.RemoveNode);if(t>0){var i=a.gFactory.getAddScore("/"+t.toString());i.setParent(e.RemoveNode),i.setPosition(o),i.runAction(cc.sequence(cc.scaleTo(0,0),cc.scaleTo(.15,1.5),cc.delayTime(.25),cc.scaleTo(.1,1),cc.moveTo(.25,n.x,n.y),cc.callFunc(function(){e.showScore=s.Game.getScore(),a.gFactory.putAddScore(i)})))}else{var r=a.gFactory.getSubScore("/"+Math.abs(t).toString());r.setParent(e.RemoveNode),r.setPosition(o),r.runAction(cc.sequence(cc.scaleTo(0,0),cc.scaleTo(.15,1.5),cc.delayTime(.25),cc.scaleTo(.1,1),cc.moveTo(.25,n.x,n.y),cc.callFunc(function(){e.showScore=s.Game.getScore(),a.gFactory.putSubScore(r)})))}},this),p.gEventMgr.once(u.GlobalEvent.OPEN_RESULT,this.openResult,this),setTimeout(function(){cc.loader.loadRes("prefabs/Result")},20)},t.prototype.openResult=function(){var e=this;this.isEnd=!0,this.Stop.hide(!1),this.node.getChildByName("Result")||(console.log(" load result layer"),cc.loader.loadRes("prefabs/Result",cc.Prefab,function(t,o){if(t)console.error(" submit score by load err:",t," matchid:",s.Game.MatchInfo.matchId),CELER_X&&celerSDK.submitScore(s.Game.getScore());else{var n=cc.instantiate(o);n.name="Result",e.node.addChild(n)}}))},t.prototype.celerStart=function(){var e=this;s.Game.MatchInfo=CELER_X?celerSDK.getMatch():{sharedRandomSeed:Math.random(),shouldLaunchTutorial:!0,matchId:"",difficultyLevel:1},s.Game.MatchInfo&&s.Game.MatchInfo.sharedRandomSeed?(CMath.randomSeed=s.Game.MatchInfo.sharedRandomSeed,CMath.sharedSeed=s.Game.MatchInfo.sharedRandomSeed):(CMath.randomSeed=Math.random(),CMath.sharedSeed=CMath.randomSeed),this.nextStep(r.CELER),m.LogHandler.inst.log(" CELER_X && celerSDK.onStart call, matchid:",s.Game.MatchInfo.matchId,", seed:",s.Game.MatchInfo.sharedRandomSeed),s.Game.MatchInfo&&s.Game.MatchInfo.shouldLaunchTutorial?this.Guide.show(function(){e.nextStep(r.GUIDE)}):(this.Guide.hide(),this.nextStep(r.GUIDE))},t.prototype.nextStep=function(e){this.step|=e,console.log("loadStep Step:"+r[e]),this.step>=r.DONE&&!this.isStart?(console.log("  startGame ---------------------- "),this.isStart=!0,this.startGame()):this.step>=r.CELER_READY&&!this.isCelerReady&&(m.LogHandler.inst.log(" invoke CELER_X && celerSDK.ready"),CELER_X&&celerSDK.ready(),this.isCelerReady=!0)},t.prototype.startGame=function(){var e=this;cc.Node.maxTouchNum=1,cc.Node.touchNum=0;var t=l.Pokers.concat([]).reverse();for(console.log(t);t.length>0;){var o=t.length-1,n=t.length,i=CMath.getRandom(0,1),r=Math.floor(i*n),h=t.splice(r,1),d=a.gFactory.getPoker(h);d.name=o.toString(),d.x=0,d.y=0,this.PokerDevl.addChild(d)}var f=0,m=this.PokerDevl.childrenCount,g=function(){var t=e.PokerDevl.getChildByName((m-f++).toString());if(!t)return e.canDispatchPoker=!0,void console.log(" \u53d1\u724c\u7ed3\u675f");var o=cc.v2(0,0);if(e.PokerClip.childrenCount>0){var n=e.PokerClip.children[e.PokerClip.childrenCount-1];o=cc.v2(n.x-20,n.y)}var i=CMath.ConvertToNodeSpaceAR(t,e.PokerClip),r=t.getComponent(c.default);r.setLastPosition(o),t.setParent(e.PokerClip),t.setPosition(i),t.group="top",p.gEventMgr.emit(u.GlobalEvent.DEV_POKERS),t.runAction(cc.sequence(cc.moveTo(.05,o.x,o.y),cc.callFunc(function(){t.group="default",r.setLastPosition(),g()},e)))},y=function(){if(f++>=e.dispatchCardCount)g();else{var t=e.PokerDevl.getChildByName((m-f).toString());if(t){var o=(f-1)%8,n=s.Game.getPlacePokerRoot().get(o);if(n){var i=CMath.ConvertToNodeSpaceAR(t,n),r=l.OFFSET_Y/3;n.getComponent(c.default)||(s.Game.addPlacePokerRoot(o,t),r=0),t.setParent(n);var a=t.getComponent(c.default);t.setPosition(i),t.group="top",f>30&&(a.flipCard(.1),a.setNormal()),p.gEventMgr.emit(u.GlobalEvent.DEV_POKERS),t.runAction(cc.sequence(cc.moveTo(.05,0,r),cc.callFunc(function(){t.group="default",a.setDefaultPosition(),y()},e)))}}else console.error(" poker node invaild!")}};y(),CELER_X?(celerSDK.onPause(function(){e.isEnd||(console.log(" game on background"),e.Stop.show(0,!1))}),celerSDK.onResume(function(){e.isEnd||(console.log(" game on forground"),p.gEventMgr.emit(u.GlobalEvent.ON_SHOW))})):(cc.game.on(cc.game.EVENT_HIDE,function(){e.isEnd||(console.log(" game on background"),e.Stop.show(0,!1))},this),cc.game.on(cc.game.EVENT_SHOW,function(){e.isEnd||(console.log(" game on forground"),p.gEventMgr.emit(u.GlobalEvent.ON_SHOW))},this))},t.prototype.recyclePoker=function(){},t.prototype.devPoker=function(){},t.prototype.dispatchPoker=function(){var e=this;if(s.Game.isTimeOver()||s.Game.isComplete())console.log(" cant dispatch poker ,  game is complete");else if(this.PokerClip.childrenCount<=0||!this.canDispatchPoker)console.log(" cant dispatch poker , child count:",this.PokerClip.childrenCount,", this.canDispatchPoker:",this.canDispatchPoker);else{s.Game.isGameStarted()||s.Game.start();var t=[],o=[],n=[],i=[],r=!0;s.Game.getPlacePokerRoot().forEach(function(t,o){e.PokerClip.childrenCount<=0||(e.PokerClip.children[e.PokerClip.childrenCount-1].getNumberOfRunningActions()>0?r=!1:(o.getNumberOfRunningActions()>0||o.getComponent(c.default)&&o.getComponent(c.default).isCycled())&&(r=!1))}),r?(s.Game.getPlacePokerRoot().forEach(function(r,a){if(!(e.PokerClip.childrenCount<=0)){var p=e.PokerClip.children[e.PokerClip.childrenCount-1],u=CMath.ConvertToNodeSpaceAR(p,a),h=p.getComponent(c.default);t.push(p),o.push(p.getParent()),n.push(p.position.clone()),i.push({callback:h.flipCard,args:[.1],target:h}),p.setParent(a),p.setPosition(u);var d=l.OFFSET_Y;a.getComponent(c.default)?a.getComponent(c.default).getCardState()==c.CardState.Back&&(d=l.OFFSET_Y/3):(s.Game.addPlacePokerRoot(r,p),d=0),h.flipCard(.1),h.setNormal(),p.group="top",e.canDispatchPoker=!1,p.runAction(cc.sequence(cc.moveTo(.3,0,d),cc.callFunc(function(){h.setDefaultPosition(),p.group="default",h.checkPos(),h.check(1),e.canDispatchPoker=!0},e)))}}),p.gEventMgr.emit(u.GlobalEvent.DEV_POKERS),s.Game.addStep(t,o,n,i)):console.log(" targetnode is recycled or has runing actions ,cant dispatchPoker!")}},t.prototype.start=function(){},t.prototype.update=function(e){if(this.devTime+=e,this.backTime+=e,s.Game.isGameStarted()){s.Game.addGameTime(-e);var t=s.Game.getGameTime();this.TimeLabel.string=CMath.TimeFormat(t),t<=60&&(this.TimeLabel.font=this.SmallOrg,this.TimeAnimation.node.active||(p.gEventMgr.emit(u.GlobalEvent.PLAY_SHAKE),this.TimeAnimation.node.active=!0,this.TimeAnimation.play(),this.TimeIcon.spriteFrame=this.TimeIconAtlas.getSpriteFrame("icon_time_2"))),this.score<this.showScore?(this.score+=this.scoreStep,this.score=Math.min(this.score,this.showScore),this.ScoreLabel.string=this.score.toString()):this.score>this.showScore&&(this.score-=this.scoreStep,this.score=Math.max(this.score,this.showScore),this.ScoreLabel.string=this.score.toString())}},i([v(cc.Prefab)],t.prototype,"Poker",void 0),i([v(cc.Node)],t.prototype,"PokerClip",void 0),i([v(cc.Node)],t.prototype,"PlaceRoot",void 0),i([v(cc.Node)],t.prototype,"PokerDevl",void 0),i([v(cc.Node)],t.prototype,"RemoveNode",void 0),i([v(cc.Button)],t.prototype,"BackButton",void 0),i([v(cc.Button)],t.prototype,"PauseButton",void 0),i([v(cc.SpriteAtlas)],t.prototype,"BackButtonAtlas",void 0),i([v(cc.SpriteAtlas)],t.prototype,"DrawButtonAtlas",void 0),i([v(cc.Label)],t.prototype,"TimeLabel",void 0),i([v(cc.Sprite)],t.prototype,"TimeIcon",void 0),i([v(cc.SpriteAtlas)],t.prototype,"TimeIconAtlas",void 0),i([v(cc.Label)],t.prototype,"ScoreLabel",void 0),i([v(cc.Font)],t.prototype,"SmallOrg",void 0),i([v(cc.Prefab)],t.prototype,"SubScoreLabel",void 0),i([v(cc.Prefab)],t.prototype,"AddScoreLabel",void 0),i([v(cc.Animation)],t.prototype,"TimeAnimation",void 0),i([v(h.default)],t.prototype,"Stop",void 0),i([v(f.default)],t.prototype,"Guide",void 0),i([v(cc.Animation)],t.prototype,"Complete",void 0),i([v(cc.Button)],t.prototype,"SubmitButton",void 0),i([v(cc.Toggle)],t.prototype,"CheatToggle",void 0),i([v(cc.Label)],t.prototype,"RecyclePokerLabel",void 0),t=i([y],t)}(cc.Component);o.default=_,cc._RF.pop()},{"./Guide":"Guide","./Poker":"Poker","./Pokers":"Pokers","./Stop":"Stop","./controller/AudioController":"AudioController","./controller/EventManager":"EventManager","./controller/EventName":"EventName","./controller/Game":"Game","./controller/GameFactory":"GameFactory","./utils/LogHandler":"LogHandler"}],Game:[function(e,t,o){"use strict";cc._RF.push(t,"40425qmjHtE2rUaEpFgHzOS","Game"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../utils/HashMap"),i=e("../Poker"),r=e("../Pokers"),a=e("./EventManager"),s=e("./EventName"),c=function(){function e(){this.placePokerRoot=new n.HashMap,this.cyclePokerRoot=new n.HashMap,this.posOffsetCal=new n.HashMap,this.stepInfoArray=[],this.score=0,this.timeBonus=0,this.freeDrawTimes=3,this.flipCounts=0,this.pokerClip=null,this.gameStart=!1,this.gameTime=300,this.removePokerCount=0,this.recycleCount=0,this.pokerFlipRoot=null,this.combo=-1,this.recyclePoker=0,this.pauseCount=0}return e.prototype.GameMgr=function(){},Object.defineProperty(e,"inst",{get:function(){return this._inst?this._inst:this._inst=new e},enumerable:!0,configurable:!0}),e.prototype.addRecyclePoker=function(e){this.recyclePoker+=e,this.recyclePoker>6&&console.error(" recycle poker error!!!!"),a.gEventMgr.emit(s.GlobalEvent.UPDATE_RECYCLE_POKER,this.recyclePoker)},e.prototype.addPosOffset=function(e,t){var o=this.posOffsetCal.get(e);if(o){Math.max(0,o+t);this.posOffsetCal.add(e,o+t)}else this.posOffsetCal.add(e,t)},e.prototype.getPosOffset=function(e){var t=this.posOffsetCal.get(e);return null==t?0:t},e.prototype.getCombo=function(){return this.combo},e.prototype.resetCombo=function(){this.combo=-1},e.prototype.addCombo=function(e){this.combo+=e,this.combo=Math.max(0,this.combo%13)},e.prototype.getGameTime=function(){return this.gameTime},e.prototype.addRecycleCount=function(e){this.recycleCount+=e,console.log(" ---------------------recycle count :",this.recycleCount),(this.recycleCount>78||this.recycleCount<0)&&(console.error(" recycle count error! ",this.recycleCount),this.recycleCount=CMath.Clamp(this.recycleCount,78,0))},e.prototype.addGameTime=function(e){window.noTime||o.Game.isComplete()||(this.gameTime+=e,this.gameTime=Math.max(this.gameTime,0),this.gameTime<=0&&(this.gameStart=!1,a.gEventMgr.emit(s.GlobalEvent.OPEN_RESULT)))},e.prototype.calTimeBonus=function(){this.gameTime>=300||this.gameTime<=0||this.flipCounts<=0||(this.timeBonus=(this.flipCounts/45*2.4+.3)*this.gameTime,this.timeBonus=Math.floor(this.timeBonus),console.log("this.flipCounts: ",this.flipCounts,", this.gameTime:",this.gameTime,",this.timbonus:",this.timeBonus),this.gameTime=0,o.Game.addScore(this.timeBonus))},e.prototype.getTimeBonus=function(){return this.timeBonus},e.prototype.isTimeOver=function(){return this.gameTime<=0},e.prototype.start=function(){this.gameStart=!0,a.gEventMgr.emit(s.GlobalEvent.PLAY_START)},e.prototype.isComplete=function(){return this.flipCounts>=45},e.prototype.checkIsRecycleComplete=function(){var e=78==this.recycleCount;return e&&(console.log(" isComplete isComplete "),a.gEventMgr.emit(s.GlobalEvent.AUTO_COMPLETE_DONE)),e},e.prototype.restart=function(){this.gameTime=300,this.score=0,this.flipCounts=0,this.stepInfoArray=[],this.timeBonus=0,this.cyclePokerRoot.clear(),this.placePokerRoot.clear(),this.gameStart=!1,this.removePokerCount=0},e.prototype.addRemovePokerCount=function(e){var t=this;this.removePokerCount=78,o.Game.getPlacePokerRoot().forEach(function(e,o){o.getComponent(i.default)&&(t.removePokerCount=0)}),78==this.removePokerCount&&this.removeNode.childrenCount<=0&&(this.calTimeBonus(),a.gEventMgr.emit(s.GlobalEvent.OPEN_RESULT))},e.prototype.setPause=function(e){this.gameStart=!e},e.prototype.isGameStarted=function(){return this.gameStart},e.prototype.addScore=function(e,t){void 0===t&&(t=cc.v2(-200,700)),0!=e&&(e=Math.floor(e),this.score+=e,this.score=Math.max(this.score,0),console.log("------------------- score:",this.score,e),a.gEventMgr.emit(s.GlobalEvent.UPDATE_SCORE,e,t))},e.prototype.getScore=function(){return this.score},e.prototype.addFreeDrawTimes=function(e){this.freeDrawTimes+=e,this.freeDrawTimes=Math.max(this.freeDrawTimes,0),a.gEventMgr.emit(s.GlobalEvent.UPDATE_DRAW_ICON)},e.prototype.getFreeDrawTimes=function(){return this.freeDrawTimes},e.prototype.addFlipCounts=function(e){this.isGameStarted()&&(this.flipCounts+=e,this.flipCounts=Math.max(this.flipCounts,0),console.log("-----------------------------------flipCounts:",this.flipCounts),this.isComplete()&&(console.log("-------------emit Complete!!!----------------------flipCounts:",this.flipCounts),a.gEventMgr.emit(s.GlobalEvent.COMPLETE)))},e.prototype.getFlipCounts=function(){return this.flipCounts},e.prototype.addStep=function(e,t,o,n,i,r){this.stepInfoArray.length=0,this.stepInfoArray.push({node:e,lastParent:t,lastPos:o,func:n,scores:i,scoresPos:r}),a.gEventMgr.emit(s.GlobalEvent.UPDATE_BACK_BTN_ICON)},e.prototype.getPlacePokerRoot=function(){return this.placePokerRoot},e.prototype.getCycledPokerRoot=function(){return this.cyclePokerRoot},e.prototype.addPlacePokerRoot=function(e,t){if(!this.isComplete()){var o=t.getComponent(i.default);if(e<0||e>7||null===e)return console.error(" add to poker root error, key invaild:",e),void(o&&console.error(" poker val:",o.getValue(),", poker key:",o.getKey()));o&&console.log(" add to place root:",e," , val:",o.getValue(),", type:",i.PokerType[o.getPokerType()]),this.placePokerRoot.add(e,t),this.placePokerRoot.length>8&&console.error(" place Poker Root over size!!!!!:",this.placePokerRoot.length)}},e.prototype.addCycledPokerRoot=function(e,t){if(e<0||e>3||null===e){console.error(" add to poker cycle error, key invaild:",e);var o=t.getComponent(i.default);o&&console.error(" poker val:",o.getValue(),", poker key:",o.getKey(),", type:",i.PokerType[o.getPokerType()])}else this.cyclePokerRoot.add(e,t),this.cyclePokerRoot.length>4&&console.error(" cycled Poker root over size!!!!!:",this.cyclePokerRoot.length)},e.prototype.clearStep=function(){this.stepInfoArray.length=0,a.gEventMgr.emit(s.GlobalEvent.UPDATE_BACK_BTN_ICON)},e.prototype.backStep=function(){if(this.stepInfoArray.length<=0)return console.log(" no cache step!"),!1;for(var e=!1,t=0,n=this.stepInfoArray[this.stepInfoArray.length-1].node;t<n.length;t++){if(n[t].getNumberOfRunningActions()>0){e=!0;break}}if(!e){o.Game.resetCombo();var c=this.stepInfoArray.pop();a.gEventMgr.emit(s.GlobalEvent.UPDATE_BACK_BTN_ICON);for(var l=0,p=function(){l++;var e=c.node.pop(),t=c.lastParent.pop(),n=c.lastPos.pop(),a=c.func?c.func.pop():null,s=c.scores&&c.scores.length>0?c.scores.pop():0,p=c.scoresPos&&c.scoresPos.length>0?c.scoresPos.pop():null;if(p?o.Game.addScore(s,p):o.Game.addScore(s),"PokerClip"==t.name||"PokerFlipRoot"==t.name){var h=CMath.ConvertToNodeSpaceAR(e,t);e.setPosition(h)}else e.setPosition(n);a&&a.callback&&a.target&&a.callback.apply(a.target,a.args);var d=e.getComponent(i.default);if(d.setPosState(i.POS_STATE.NORMAL,!1),e.setParent(t),e.group="top",d){var f=void 0;"PokerClip"==t.name?f=d.getLastPosition():(f="PokerFlipRoot"==t.name?d.getFlipPos():d.getDefaultPosition(),t.getComponent(i.default)?t.getComponent(i.default).isCycled()?(f.x=0,f.y=0):a&&a.callback&&a.callback==t.getComponent(i.default).flipCard?f.y=r.OFFSET_Y/3:f.y=r.OFFSET_Y:"PokerFlipRoot"!=t.name&&(f.x=0,f.y=0));var m=cc.sequence(cc.delayTime(l/500),cc.callFunc(function(){d.node.stopActionByTag(r.ACTION_TAG.FLIP_CARD_REPOS_ON_REMOVE),d.node.stopActionByTag(r.ACTION_TAG.FLIP_CARD_REPOS_ON_ADD),d.node.stopActionByTag(r.ACTION_TAG.SHAKE)},u),cc.moveTo(.1,f.x,f.y),cc.callFunc(function(){e.group="default",d.setDefaultPosition(),t.getComponent(i.default)&&d.checkPos()},u));m.setTag(r.ACTION_TAG.BACK_STEP),d.node.runAction(m)}},u=this;c.node.length>0;)p();return a.gEventMgr.emit(s.GlobalEvent.DEV_POKERS),l>0}console.log(" click back step ! but has running action! shengqi!")},e.prototype.canBackStep=function(){return this.stepInfoArray.length>0},Object.defineProperty(e.prototype,"PauseCount",{get:function(){return this.pauseCount},set:function(e){this.pauseCount=e,this.pauseCount>2&&o.Game.addScore(-1e3)},enumerable:!0,configurable:!0}),e}();o.Game=c.inst,cc._RF.pop()},{"../Poker":"Poker","../Pokers":"Pokers","../utils/HashMap":"HashMap","./EventManager":"EventManager","./EventName":"EventName"}],Guide:[function(e,t,o){"use strict";cc._RF.push(t,"b35055BqMpN/5j/PIM39A+p","Guide");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,o,a):i(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var r=e("./controller/EventManager"),a=e("./controller/EventName"),s=cc._decorator,c=s.ccclass,l=s.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ButtonAtlas=null,t.Next=null,t.Forward=null,t.GuideView=null,t.callback=null,t}return n(t,e),t.prototype.onLoad=function(){this.Next.node.on(cc.Node.EventType.TOUCH_END,this.nextPage,this),this.Forward.node.on(cc.Node.EventType.TOUCH_END,this.forwardPage,this),this.GuideView.node.on("scroll-ended",this.updateButton,this),r.gEventMgr.on(a.GlobalEvent.HIDE_HELP,this.hide,this)},t.prototype.start=function(){},t.prototype.hide=function(){this.node.active=!1,this.callback&&this.callback(),cc.Node.maxTouchNum=1,cc.Node.touchNum=0},t.prototype.show=function(e){console.log(" show guide"),this.node.active=!0,this.callback=e,this.GuideView.scrollToPage(0,0),this.Forward.node.active=!1,this.Next.node.getChildByName("Background").getComponent(cc.Sprite).spriteFrame=this.ButtonAtlas.getSpriteFrame("btn_new")},t.prototype.nextPage=function(){if(this.GuideView.getCurrentPageIndex()>=this.GuideView.content.childrenCount-1)this.hide();else{var e=(this.GuideView.getCurrentPageIndex()+1)%this.GuideView.content.childrenCount;this.GuideView.setCurrentPageIndex(e),this.updateButton()}},t.prototype.forwardPage=function(){if(this.GuideView.getCurrentPageIndex()<=0);else{var e=(this.GuideView.getCurrentPageIndex()-1)%this.GuideView.content.childrenCount;this.GuideView.setCurrentPageIndex(e),this.updateButton()}},t.prototype.updateButton=function(){this.GuideView.getCurrentPageIndex()>=this.GuideView.content.childrenCount-1?this.Next.node.getChildByName("Background").getComponent(cc.Sprite).spriteFrame=this.ButtonAtlas.getSpriteFrame("new_close"):this.Next.node.getChildByName("Background").getComponent(cc.Sprite).spriteFrame=this.ButtonAtlas.getSpriteFrame("btn_new"),this.Forward.node.active=0!=this.GuideView.getCurrentPageIndex()},i([l(cc.SpriteAtlas)],t.prototype,"ButtonAtlas",void 0),i([l(cc.Button)],t.prototype,"Next",void 0),i([l(cc.Button)],t.prototype,"Forward",void 0),i([l(cc.PageView)],t.prototype,"GuideView",void 0),t=i([c],t)}(cc.Component);o.default=p,cc._RF.pop()},{"./controller/EventManager":"EventManager","./controller/EventName":"EventName"}],HashMap:[function(e,t,o){"use strict";cc._RF.push(t,"07791aKdvNDo7wFtZ+VAQS2","HashMap"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){this._list=new Array,this.clear()}return e.prototype.getIndexByKey=function(e){for(var t=this._list.length,o=0;o<t;o++){if(this._list[o].key==e)return o}return-1},e.prototype.keyOf=function(e){for(var t=this._list.length,o=0;o<t;o++){var n=this._list[o];if(n.value==e)return n.key}return null},Object.defineProperty(e.prototype,"keys",{get:function(){for(var e=new Array,t=0,o=this._list;t<o.length;t++){var n=o[t];n&&e.push(n.key)}return e},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){var o={key:e,value:t},n=this.getIndexByKey(e);-1!=n?this._list[n]=o:this._list.push(o)},Object.defineProperty(e.prototype,"values",{get:function(){return this._list},enumerable:!0,configurable:!0}),e.prototype.remove=function(e){var t=this.getIndexByKey(e);if(-1!=t){var o=this._list[t];return this._list.splice(t,1),o}return null},e.prototype.has=function(e){return-1!=this.getIndexByKey(e)},e.prototype.get=function(e){var t=this.getIndexByKey(e);return-1!=t?this._list[t].value:null},Object.defineProperty(e.prototype,"length",{get:function(){return this._list.length},enumerable:!0,configurable:!0}),e.prototype.sort=function(e){this._list.sort(e)},e.prototype.forEachKeyValue=function(e){for(var t=this._list.length,o=0;o<t;o++){e(this._list[o])}},e.prototype.forEach=function(e){for(var t=this._list.length,o=0;o<t;o++){var n=this._list[o];e(n.key,n.value)}},e.prototype.clear=function(){this._list=[]},e}();o.HashMap=n,cc._RF.pop()},{}],LogHandler:[function(e,t,o){"use strict";cc._RF.push(t,"4a682UCuFVOMpQvNRzyu0e4","LogHandler"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){if(this.logFunc=console.log,this.logMsg=null,this.frameTimes=0,this.now=0,this.Frame=20,this.totalFrames=0,this.startTime=0,window.addEventListener)for(var t=0,o=e.LISTENNING_EVENTS;t<o.length;t++){var n=o[t],i="trigger"+n.charAt(0).toLocaleUpperCase()+n.substring(1);this[i]&&"function"==typeof this[i]&&window.addEventListener(n,this[i].bind(this))}}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.dumpFrameInfo=function(){var e=(Date.now()-this.startTime)/1e3,t=e/this.totalFrames;this.addLog(" total frames:",this.totalFrames," ,total cost time:",e+"s"," , per frame cost time ave:"+t+"s"),this.sendLog()},e.prototype.initLog=function(t){var o=this;cc.director.once(cc.Director.EVENT_AFTER_SCENE_LAUNCH,function(){o.frameTimes=0,o.now=Date.now(),o.startTime=Date.now()},this),cc.director.on(cc.Director.EVENT_AFTER_DRAW,function(){o.frameTimes++,o.totalFrames++,o.frameTimes>=o.Frame&&(o.frameTimes=0,o.now=Date.now())},this),this.logFunc=t,console.error=function(){for(var t,o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];(t=e.inst).log.apply(t,["[ERROR]"].concat(o))},console.warn=function(){for(var t,o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];(t=e.inst).log.apply(t,["[WARN]"].concat(o))},console.log=function(){for(var t,o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];(t=e.inst).log.apply(t,["[INFO]"].concat(o))}},e.prototype.formatLogArguments=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var o="",n=0;n<arguments.length;n++){var i=typeof arguments[n];"string"==i||"number"==i?o+=" "+arguments[n]:"object"==i?o+=" "+JSON.stringify(arguments[n]):"boolean"==i&&arguments[n].toString&&(o+=arguments[n].toString())}return o},e.prototype.addLog=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];null==this.logMsg&&(this.logMsg={});var n=this.formatLogArguments.apply(this,t),i=this.getFullTime(new Date);this.logMsg[i]=e.VERSION+n},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.addLog.apply(this,e),this.sendLog()},e.prototype.getFullTime=function(e){var t="";t+=e.getFullYear();var o=e.getMonth()+1;t+="-"+(o>=10?o:"0"+o);var n=e.getDate();t+="-"+(n>=10?n:"0"+n);var i=e.getHours();t+="  "+(i>=10?i:"0"+i);var r=e.getMinutes();t+=":"+(r>=10?r:"0"+r);var a=e.getSeconds();return t+=":"+(a>=10?a:"0"+a)},e.prototype.sendLog=function(){this.logFunc&&null!=this.logMsg&&(this.logFunc(JSON.stringify(this.logMsg)),this.logMsg=null)},e.prototype.triggerClose=function(e){this.addLog("triggerClose"),this.sendLog()},e.prototype.triggerLoad=function(e){this.addLog("triggerLoad"),this.sendLog()},e.prototype.triggerUnload=function(e){this.addLog("triggerUnload"),this.sendLog()},e.prototype.triggerOnunload=function(e){this.addLog("triggerUnload"),this.sendLog()},e.prototype.triggerError=function(e){this.addLog("triggerError"),this.addLog(e.message),this.sendLog()},e.prototype.triggerFocus=function(e){this.addLog("triggerFocus"),this.sendLog()},e.prototype.triggerBlur=function(e){this.addLog("triggerBlur"),this.sendLog()},e.prototype.triggerAbort=function(e){this.addLog("triggerAbort"),this.sendLog()},e.prototype.triggerSuspend=function(e){this.addLog("triggerSuspend"),this.sendLog()},e.prototype.beforeunload=function(e){this.addLog("beforeunload"),this.sendLog()},e.VERSION="SpiderRush version 79 : ",e.LISTENNING_EVENTS=["error"],e}();o.LogHandler=n,cc._RF.pop()},{}],PokerRoot:[function(e,t,o){"use strict";cc._RF.push(t,"11cba6M6B9Awbm3ikseAzvv","PokerRoot");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,o,a):i(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var r=e("./controller/Game"),a=e("./Poker"),s=cc._decorator,c=s.ccclass,l=(s.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.onLoad=function(){this.node.on(cc.Node.EventType.CHILD_ADDED,this.onAddChild,this),this.node.on(cc.Node.EventType.CHILD_REMOVED,this.onChildRemove,this)},t.prototype.start=function(){},t.prototype.onChildRemove=function(e){if(r.Game.isGameStarted()){if(this.node.childrenCount>0&&this.next&&!this.next.isCycled())return void console.error(" root already has a poker");this.next=null,r.Game.addPlacePokerRoot(parseInt(this.node.name),this.node)}},t.prototype.onAddChild=function(e){var t=e.getComponent(a.default);t?(this.setNewRoot(t),this.next=t,t.setRecycle(!1)):console.error(" \u6ca1\u6709 Poker\u7c7b")},t.prototype.setNewRoot=function(e){e.getNext()?this.setNewRoot(e.getNext()):(r.Game.addPlacePokerRoot(parseInt(this.node.name),e.node),e.setNormal())},t.prototype.update=function(e){},t=i([c],t)}(cc.Component));o.default=l,cc._RF.pop()},{"./Poker":"Poker","./controller/Game":"Game"}],Pokers:[function(e,t,o){"use strict";cc._RF.push(t,"d504dBfU4JI0K2nPtJ3w844","Pokers"),Object.defineProperty(o,"__esModule",{value:!0}),o.SpadeStartIndex=0,o.HeartStartIndex=1,o.ClubStartIndex=2,o.DiamondStartIndex=3,o.PokerTypes={spade_:3,club_:10,diamond_:5,heart_:12},o.Pokers=["spade_,1","spade_,1","spade_,1","spade_,1","spade_,1","spade_,1","spade_,2","spade_,2","spade_,2","spade_,2","spade_,2","spade_,2","spade_,3","spade_,3","spade_,3","spade_,3","spade_,3","spade_,3","spade_,4","spade_,4","spade_,4","spade_,4","spade_,4","spade_,4","spade_,5","spade_,5","spade_,5","spade_,5","spade_,5","spade_,5","spade_,6","spade_,6","spade_,6","spade_,6","spade_,6","spade_,6","spade_,7","spade_,7","spade_,7","spade_,7","spade_,7","spade_,7","spade_,8","spade_,8","spade_,8","spade_,8","spade_,8","spade_,8","spade_,9","spade_,9","spade_,9","spade_,9","spade_,9","spade_,9","spade_,10","spade_,10","spade_,10","spade_,10","spade_,10","spade_,10","spade_,11","spade_,11","spade_,11","spade_,11","spade_,11","spade_,11","spade_,12","spade_,12","spade_,12","spade_,12","spade_,12","spade_,12","spade_,13","spade_,13","spade_,13","spade_,13","spade_,13","spade_,13"],o.PokerIndex=[6,5,4,3,2,1,0,12,11,10,9,8,7,17,16,15,14,13,21,20,19,18,24,23,22,26,25,27,28,29,50,49,46,43,40,37,34,31,30,33,36,39,42,45,48,51],function(e){e[e.FLIP_CARD_REPOS_ON_ADD=0]="FLIP_CARD_REPOS_ON_ADD",e[e.FLIP_CARD_REPOS_ON_REMOVE=1]="FLIP_CARD_REPOS_ON_REMOVE",e[e.BACK_STEP=2]="BACK_STEP",e[e.DEV_POKER=3]="DEV_POKER",e[e.RE_DEV_POKER=4]="RE_DEV_POKER",e[e.SHAKE=5]="SHAKE",e[e.RECYCLE=6]="RECYCLE",e[e.POS_SCALE=7]="POS_SCALE",e[e.POS_NORMAL=8]="POS_NORMAL"}(o.ACTION_TAG||(o.ACTION_TAG={})),o.COLOR_GRAY=cc.color(238,218,166),o.OFFSET_Y=-70,o.OFFSET_X=0,o.OFFSET_SCALE=15,o.FLIP_SCORE=50,o.BACK_STEP_SCORE=20,cc._RF.pop()},{}],Poker:[function(e,t,o){"use strict";cc._RF.push(t,"19c3a5acP5K/YiwGw559yBs","Poker");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,o,a):i(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var r,a,s,c,l=e("./controller/Game"),p=e("./controller/GameFactory"),u=e("./Pokers"),h=e("./controller/EventManager"),d=e("./controller/EventName"),f=cc._decorator,m=f.ccclass,g=f.property;(function(e){e[e.Front=0]="Front",e[e.Back=1]="Back"})(r=o.CardState||(o.CardState={})),function(e){e[e.Red=0]="Red",e[e.Black=1]="Black"}(a=o.PokerColor||(o.PokerColor={})),function(e){e[e.Club=0]="Club",e[e.Spade=1]="Spade",e[e.Heart=2]="Heart",e[e.Diamond=3]="Diamond"}(s=o.PokerType||(o.PokerType={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.SCALE=1]="SCALE"}(c=o.POS_STATE||(o.POS_STATE={}));var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.frontCard=null,t.backCard=null,t.pokerAtlas=null,t.RecycleAnimation=null,t.flips=[],t.value=0,t.posState=c.NORMAL,t.hasMove=!1,t.canMove=!1,t.key=-1,t._next=null,t._forward=null,t.defualtChildCount=0,t.isCheck=!1,t.cycled=!1,t.placeLimit=cc.size(0,0),t.isReadyAutoComplete=!1,t.recycleActionInfo={startTime:0,duration:0},t}var o;return n(t,e),o=t,Object.defineProperty(t.prototype,"next",{get:function(){for(var e=0,t=this.node.children;e<t.length;e++){var n=t[e];if(n.getComponent(o)&&0==n.getComponent(o).isCycled())return n.getComponent(o)}return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"forward",{get:function(){return this.node.getParent()?this.node.getParent().getComponent(o):null},set:function(e){},enumerable:!0,configurable:!0}),t.prototype.reuse=function(){this.node._onSetParent=this.onSetParent.bind(this),this.posState=c.NORMAL,this.hasMove=!1,this.isReadyAutoComplete=!1;var e=arguments[0][0][0];this.value=parseInt(e.split(",")[1]);var t=e.split(",")[0];switch(this.pokerColer="spade_"==t||"club_"==t?a.Black:a.Red,t){case"spade_":this.pokerType=s.Spade;break;case"club_":this.pokerType=s.Club;break;case"heart_":this.pokerType=s.Heart;break;case"diamond_":this.pokerType=s.Diamond}this.frontCard.spriteFrame=this.pokerAtlas.getSpriteFrame(e.split(",")[0]+this.value),this.frontCard.spriteFrame||console.error(e.split(",")[0]+this.value),this.setCardState(r.Back),this.initEvent()},t.prototype.getPokerColor=function(){return this.pokerColer},t.prototype.getPokerType=function(){return this.pokerType},t.prototype.unuse=function(){this.node.targetOff(this),h.gEventMgr.targetOff(this),this.cycled=!1},t.prototype.getNext=function(){return this.next},t.prototype.getForward=function(){return this.forward},t.prototype.setNext=function(e){this.next=e,this.node.getChildByName("Label").getComponent(cc.Label).string="next:"+(this.next?this.next.getValue():"null")+", key:"+this.key},t.prototype.setForward=function(e){this.forward=e},t.prototype.setRecycle=function(e){this.cycled!=e&&(this.cycled=e,this.cycled?l.Game.addRecycleCount(1):l.Game.addRecycleCount(-1))},t.prototype.getValue=function(){return this.value},t.prototype.getCardState=function(){return this.carState},t.prototype.onLoad=function(){this.RecycleAnimation.node.opacity=0,this.placeLimit.width=this.node.width/2,this.placeLimit.height=.75*this.node.height,this.node.getChildByName("Label").active=!1,this.defualtChildCount=this.node.childrenCount,this.setCardState(r.Back)},t.prototype.initEvent=function(){var e=this;this.node.on(cc.Node.EventType.CHILD_ADDED,this.onAddChild,this),this.node.on(cc.Node.EventType.CHILD_REMOVED,this.onChildRemove,this),this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onMove,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onMoveEnd,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onMoveEnd,this),this.node.on("check-done",this.onCheckDone,this),this.node.on("pos-scale",function(t){t!=e.key||e.isCycled()||e.posState==c.SCALE||e.carState==r.Back||e.setPosState(c.SCALE)},this),this.node.on("pos-normal",function(t){t!=e.key||e.isCycled()||e.posState==c.NORMAL||e.carState==r.Back||e.setPosState(c.NORMAL)},this),h.gEventMgr.once(d.GlobalEvent.COMPLETE,this.autoComplete,this),h.gEventMgr.once(d.GlobalEvent.AUTO_COMPLETE_DONE,function(){},this)},t.prototype.autoCompleteDone=function(){var e=this,t=.05+this.value/200,n=(13-this.value)/500;this.hasMove&&(console.log(" has move key :",this.key,", value:",this.value),l.Game.addPosOffset(this.key,u.OFFSET_SCALE)),this.scheduleOnce(function(){var t=CMath.ConvertToNodeSpaceAR(e.node,l.Game.removeNode);e.node.setParent(l.Game.removeNode),e.node.setPosition(t),e.node.zIndex=13-e.value},t*this.value),this.scheduleOnce(function(){var t=e.value%2==1?-1:1,n=CMath.getRandom(0,2)*t;e.canMove=!1,e.node.runAction(cc.sequence(cc.delayTime(e.value/8),cc.callFunc(function(){var t=10*(13-e.value),o=CMath.ConvertToNodeSpaceAR(e.node,l.Game.removeNode);l.Game.addScore(t,o),e.frontCard.node.opacity=255,e.node.group="top",e.node.zIndex=e.value,l.Game.addCombo(1),h.gEventMgr.emit(d.GlobalEvent.PLAY_POKER_FLY),h.gEventMgr.emit(d.GlobalEvent.PLAY_RECYCLE)},e),cc.sequence(cc.repeat(cc.spawn(cc.moveBy(.01,1.5*t+n,25).easing(cc.easeQuinticActionOut()),cc.rotateBy(.01,20*t).easing(cc.easeQuadraticActionIn())),30),cc.repeat(cc.spawn(cc.moveBy(.01,2*t+n,-25).easing(cc.easeQuinticActionIn()),cc.rotateBy(.01,20*t).easing(cc.easeQuadraticActionIn())),180),cc.callFunc(function(){if(console.log("done:",e.value),13==e.value&&l.Game.addRecyclePoker(1),e.node.childrenCount>e.defualtChildCount){console.error(" \u53ef\u80fd\u9020\u6210\u4e22\u724c");var t=e.node.children[e.node.childrenCount-1],n=t.getComponent(o);if(n&&!n.isCycled()){t.stopAllActions(),t.rotation=0,t.setParent(l.Game.pokerClip);var i=l.Game.pokerClip.children[l.Game.pokerClip.childrenCount-1];t.setPosition(cc.v2(i.x-20,i.y)),n.flipCard(0)}}p.gFactory.putPoker(e.node),l.Game.addRemovePokerCount(1+e.node.childrenCount-e.defualtChildCount)},e))))},n+t)},t.prototype.autoComplete=function(){!this.next&&"PokerFlipRoot"!=this.node.getParent().name||this.isCycled()?(this.isReadyAutoComplete=!0,console.log(" isAutoComplete:",this.isReadyAutoComplete)):this.isReadyAutoComplete=!1},t.prototype.onCheckDone=function(e){console.log(" check done: ",e,":",this.key,this.value),this.key==e&&this.isCheck&&(this.setRecycle(!0),this.autoCompleteDone(),13==this.value&&(e<=7&&e>=0&&null!==e?l.Game.addPlacePokerRoot(this.key,this.node.getParent()):console.error(" onCheckDone, key invaild:",e,", val:",this.value," type:",s[this.pokerType])))},t.prototype.setDefaultPosition=function(e){e?this.defaultPos?(this.defaultPos.x=e.x,this.defaultPos.y=e.y):this.defaultPos=e.clone():this.defaultPos=this.node.position.clone()},t.prototype.setLastPosition=function(e){this.lastPos=e||this.node.position.clone()},t.prototype.setFlipPos=function(e){this.flipPos=e||this.node.position.clone()},t.prototype.getFlipPos=function(){return this.flipPos?this.flipPos.clone():this.node.position.clone()},t.prototype.getDefaultPosition=function(){return this.defaultPos?this.defaultPos.clone():this.node.position.clone()},t.prototype.getLastPosition=function(){return this.lastPos?this.lastPos.clone():this.node.position.clone()},t.prototype.setKey=function(e){this.key=e,e&&"NaN"==e.toString()?this.node.getChildByName("Label").getComponent(cc.Label).string+="value:"+this.value.toString():this.node.getChildByName("Label").getComponent(cc.Label).string="next:"+(this.next?this.next.getValue():"null")+", key:"+this.key,this.next&&this.next.getKey()!=this.key&&this.next.setKey(e)},t.prototype.getKey=function(){return this.key},t.prototype.onTouchStart=function(e){this.carState!=r.Back?(e.bubbles=!this.isNormal(),this.node.stopActionByTag(u.ACTION_TAG.SHAKE),l.Game.isTimeOver()||l.Game.isComplete()?console.log(" on touch start , game is over"):(l.Game.isGameStarted()||(l.Game.start(),console.log(" start game ")),h.gEventMgr.emit(d.GlobalEvent.PLAY_POKER_PLACE))):console.log(" on touch start , card is back")},t.prototype.checkAutoRecycle=function(){return!1},t.prototype.onMove=function(e){if(this.carState!=r.Back&&(e.bubbles=!1,!l.Game.isTimeOver()&&!l.Game.isComplete()&&this.canMove&&(!this.isCycled()||!this.next))){var t=this.node.getActionByTag(u.ACTION_TAG.RECYCLE);if(!t||t.isDone()){this.node.group="top";var o=e.getDelta();this.node.x+=o.x,this.node.y+=o.y}}},t.prototype.setCanMove=function(e){this.canMove=e},t.prototype.onMoveEnd=function(e){var t=this;if(this.carState!=r.Back)if(e.bubbles=!1,l.Game.isTimeOver()||l.Game.isComplete())console.log("on move end ,game is over");else{var o=this.node.getActionByTag(u.ACTION_TAG.RECYCLE);if(!o||o.isDone())if(this.defaultPos&&this.canMove){var n=this.checkCanPlace();if(n>=0&&null!=n&&n<=7)this.placeToNewRoot(n);else this.checkCanRecycled()>=0||this.checkAutoRecycle()||(CMath.Distance(this.node.position,this.defaultPos)<5?(this.node.group="default",this.node.setPosition(this.defaultPos),this.next||this.shake()):(h.gEventMgr.emit(d.GlobalEvent.DEV_POKERS),this.node.runAction(cc.sequence(cc.moveTo(.1,this.defaultPos.x,this.defaultPos.y),cc.callFunc(function(){t.node.group="default"},this)))))}else console.error(" on move end ,cant move");else console.log(" on move end , running action")}else console.log("on move end, card is back")},t.prototype.checkCanPlace=function(){var e=this,t=-1;return l.Game.getPlacePokerRoot().forEach(function(n,i){var r=i.getComponent(o);if((e.node.name!=i.name||!r)&&(!r||r.getKey()!=e.getKey())&&(r&&o.checkBeNext(r,e)||!r)){var a=CMath.ConvertToNodeSpaceAR(i,e.node.parent);Math.abs(a.x-e.node.position.x)<=e.placeLimit.width&&Math.abs(a.y-e.node.position.y)<=e.placeLimit.height&&(t=n)}}),t},t.prototype.checkCanRecycled=function(){return-1},t.prototype.updateRootNode=function(e){if(!this.cycled&&null!=this.key&&null!=e)if(this.node.childrenCount<=this.defualtChildCount)this.key>=0&&this.key<=7&&null!==this.key?l.Game.addPlacePokerRoot(e,this.node):console.error(" updateRootNode, key invaild:",this.key,", value:",this.value,"type:",s[this.pokerType]),this.check(1);else{if(!this.next)return void console.log("no next, value:",this.value,", key:",this.key);this.next.updateRootNode.call(this.next,e)}},t.prototype.checkPos=function(){if("default"==this.node.group&&!this.isCycled()){var e=l.Game.getPlacePokerRoot().get(this.key);if(e){var t=e.getComponent(o);if(t){var n=CMath.ConvertToNodeSpaceAR(e,l.Game.removeNode),i=l.Game.getPosOffset(this.key);n.y-this.node.height+i<=l.Game.pokerClip.y?t.emitNodeEventToForward("pos-scale"):t.emitNodeEventToForward("pos-normal")}}}},t.prototype.setPosState=function(e,t){if(void 0===t&&(t=!0),this.posState!=e)if(this.posState=e,this.posState==c.NORMAL){if(this.hasMove){t&&this.node.runAction(cc.moveBy(.01,0,-u.OFFSET_SCALE));var o=this.getDefaultPosition();this.setDefaultPosition(cc.v2(o.x,o.y-u.OFFSET_SCALE)),l.Game.addPosOffset(this.key,u.OFFSET_SCALE),this.hasMove=!1}this.next&&this.next.setPosState.call(this.next,c.NORMAL)}else if(t&&this.forward&&this.forward.carState!=r.Back){this.hasMove=!0,this.node.runAction(cc.moveBy(.01,0,u.OFFSET_SCALE));o=this.getDefaultPosition();this.setDefaultPosition(cc.v2(o.x,o.y+u.OFFSET_SCALE)),l.Game.addPosOffset(this.key,-u.OFFSET_SCALE)}},t.prototype.placeToNewRoot=function(e){var t=this,n=l.Game.getPlacePokerRoot().get(e),i=CMath.ConvertToNodeSpaceAR(this.node,n),a=0;this.isCycled()&&(a=10*-(13-this.value));var s=0,p="PokerFlipRoot"==this.node.getParent().name;p&&(s=u.FLIP_SCORE),l.Game.resetCombo();var f=CMath.ConvertToNodeSpaceAR(this.node,l.Game.removeNode);if(l.Game.addScore(a,f),l.Game.addScore(s,CMath.ConvertToNodeSpaceAR(this.node.getParent(),l.Game.removeNode)),this.forward&&this.forward.carState==r.Back)l.Game.addStep([this.node],[this.forward.node],[this.node.position.clone()],[{callback:this.forward.flipCard,args:[.1,!1,function(){l.Game.addFlipCounts(-1)}],target:this.forward}],[-u.FLIP_SCORE-a-s],[f]);else{var m=[];p&&(m=[{callback:l.Game.addFlipCounts,args:[-1],target:l.Game}]),l.Game.addStep([this.node],[this.node.getParent()],[this.node.position.clone()],m,[-a-s],[f])}this.setPosState(c.NORMAL,!1),console.log(" set pos normal ------------"),this.node.setParent(n),this.node.setPosition(i);var g=0;n.getComponent(o)&&(g=u.OFFSET_Y),this.setDefaultPosition(cc.v2(0,g)),h.gEventMgr.emit(d.GlobalEvent.DEV_POKERS),this.node.runAction(cc.sequence(cc.moveTo(.1,0,g),cc.callFunc(function(){p&&l.Game.addFlipCounts(1),t.node.group="default",t.checkPos()},this)))},t.prototype.isCycled=function(){return this.cycled},t.prototype.check=function(e){this.carState!=r.Back?(console.log(" check :",e,this.value),this.value==e?(this.isCheck=!0,13==e?(this.emitNodeEventToNext("check-done"),l.Game.clearStep()):this.forward?this.forward.check.call(this.forward,e+1):console.log(" has no forward card:",this.value,e)):this.isCheck=!1):console.log(" cardState is back while check")},t.prototype.shake=function(){if(!this.isCycled()){this.node.group="default";var e=this.getDefaultPosition(),t=cc.sequence(cc.repeat(cc.sequence(cc.moveTo(.02,e.x-10,e.y),cc.moveTo(.04,e.x+20,e.y),cc.moveTo(.02,e.x-10,e.y)),5),cc.moveTo(.01,e.x,e.y));t.setTag(u.ACTION_TAG.SHAKE),this.node.stopActionByTag(u.ACTION_TAG.SHAKE),this.node.runAction(t),h.gEventMgr.emit(d.GlobalEvent.PLAY_SHAKE)}},t.prototype.emitNodeEventToNext=function(e){this.node.emit(e,this.key),this.next&&this.next.emitNodeEventToNext.call(this.next,e)},t.prototype.emitNodeEventToForward=function(e){this.node.emit(e,this.key),this.forward&&this.forward.emitNodeEventToForward.call(this.forward,e)},t.prototype.onAddChild=function(e){var t=e.getComponent(o);t?(this.setNext(t),this.cycled||(t.setRecycle(!1),o.checkBeNext(this,this.next)?this.setNormal():this.setAllGray(),t.setNormal(),this.updateRootNode(this.key))):console.error(" \u6ca1\u6709 Poker\u7c7b")},t.checkBeNext=function(e,t){return!(!t||!e)&&(!!window.CheatOpen||e.getValue()-t.getValue()==1&&e.getPokerColor()==t.getPokerColor())},t.checkRecycled=function(e,t){return!1},t.prototype.onChildRemove=function(e){this.setNext(null),l.Game.isGameStarted()&&!l.Game.isComplete()&&(this.cycled||this.node.childrenCount<=this.defualtChildCount&&(this.key>=0&&this.key<=7&&null!==this.key?l.Game.addPlacePokerRoot(this.key,this.node):console.error(" on child remove, key invaild:",this.key,", val:",this.value,"type:",s[this.pokerType]),this.setNormal(),this.checkPos(),this.carState==r.Back?(this.flipCard(.1),l.Game.addFlipCounts(1),l.Game.addScore(u.FLIP_SCORE,CMath.ConvertToNodeSpaceAR(this.node,l.Game.removeNode))):this.forward&&this.forward.updateState.call(this.forward)))},t.prototype.updateState=function(){this.next?(o.checkBeNext(this,this.next)&&this.next.isNormal()?this.setNormal():(this.frontCard.node.color=u.COLOR_GRAY.clone(),this.canMove=!1),this.forward&&this.forward.updateState.call(this.forward)):this.setNormal()},t.prototype.setAllGray=function(){this.node.parent&&(this.frontCard.node.color=u.COLOR_GRAY.clone(),this.canMove=!1,this.forward&&this.forward.setAllGray.call(this.forward))},t.prototype.setNormal=function(){console.log("setNormal:",this.value,", setNormal key:",this.key),this.frontCard.node.color=cc.Color.WHITE,this.canMove=this.carState==r.Front},t.prototype.isGray=function(){return this.frontCard.node.color==u.COLOR_GRAY&&0==this.canMove},t.prototype.setCardState=function(e,t){void 0===t&&(t=!0),this.carState=e,this.frontCard.node.scaleX=this.carState==r.Front?1:0,this.backCard.node.scaleX=this.carState==r.Back?1:0,this.canMove=this.carState==r.Front&&t,this.canMove&&this.next&&!o.checkBeNext(this,this.next)&&(this.canMove=!1),this.canMove?(this.frontCard.node.color=cc.Color.WHITE,this.setDefaultPosition()):this.forward&&(this.frontCard.node.color=u.COLOR_GRAY)},t.prototype.isNormal=function(){return this.carState==r.Front&&this.canMove},t.prototype.isFront=function(){return this.carState==r.Front},t.prototype.flipCard=function(e,t,o){var n=this;if(void 0===e&&(e=1),void 0===t&&(t=!0),this.frontCard.node.getNumberOfRunningActions()>0||this.backCard.node.getNumberOfRunningActions()>0)return console.log("\u7ffb\u9762\u672a\u5b8c\u6210"),void this.flips.push(e);this.carState==r.Back?(this.frontCard.node.runAction(cc.sequence(cc.delayTime(e),cc.scaleTo(e,1,1),cc.callFunc(function(){n.setCardState(r.Front,t),o&&o(),n.flips.length>0&&(n.frontCard.node.stopAllActions(),n.flipCard.call(n,n.flips.pop()))},this))),this.backCard.node.runAction(cc.scaleTo(e,0,1))):(this.backCard.node.runAction(cc.sequence(cc.delayTime(e),cc.scaleTo(e,1,1),cc.callFunc(function(){n.setCardState(r.Back,!1),o&&o(),n.flips.length>0&&(n.backCard.node.stopAllActions(),n.flipCard.call(n,n.flips.pop()))},this))),this.frontCard.node.runAction(cc.scaleTo(e,0,1)))},t.prototype.start=function(){},t.prototype.update=function(e){this.isCycled()||this.isReadyAutoComplete&&(this.isReadyAutoComplete=!this.checkAutoRecycle())},t.prototype.onSetParent=function(e){if(e){var t=e.getComponent(o);t?(this.setForward(t),this.setKey(t.getKey())):(this.setForward(null),this.setKey(parseInt(e.name)))}else this.setForward(null)},t.DebugRecycIndex=0,i([g(cc.Sprite)],t.prototype,"frontCard",void 0),i([g(cc.Sprite)],t.prototype,"backCard",void 0),i([g(cc.SpriteAtlas)],t.prototype,"pokerAtlas",void 0),i([g(cc.Animation)],t.prototype,"RecycleAnimation",void 0),t=o=i([m],t)}(cc.Component);o.default=y,cc._RF.pop()},{"./Pokers":"Pokers","./controller/EventManager":"EventManager","./controller/EventName":"EventName","./controller/Game":"Game","./controller/GameFactory":"GameFactory"}],RecycleRoot:[function(e,t,o){"use strict";cc._RF.push(t,"bc8dfsy/SxCYZDWNhC7pOvt","RecycleRoot"),cc._RF.pop()},{}],Result:[function(e,t,o){"use strict";cc._RF.push(t,"3d3e694EHtE55kWvZJIadml","Result");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,o,a):i(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var r=e("./controller/Game"),a=e("./controller/EventManager"),s=e("./controller/EventName"),c=cc._decorator,l=c.ccclass,p=c.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.Score=null,t.TimeBonus=null,t.FinalScore=null,t.ConfirmButton=null,t.Title=null,t.TitleAtlas=null,t.Result=null,t.Light=null,t.Stars=null,t.score=0,t.timeBonus=0,t.finalScore=0,t.scoreStep=0,t.timeBonusStep=0,t.finalScoreStep=0,t.showScore=0,t.hasSubmit=!1,t.scoreComplete=!1,t.timeBonusComplete=!1,t.finalScoreComplete=!1,t.sumbit=!1,t}return n(t,e),t.prototype.onLoad=function(){var e=this;a.gEventMgr.emit(s.GlobalEvent.SMALL_BGM);for(var t=function(e){var t=cc.repeatForever(cc.sequence(cc.fadeIn(CMath.getRandom(.5,1.5)).easing(cc.easeQuadraticActionInOut()),cc.fadeOut(CMath.getRandom(.4,.8)).easing(cc.easeQuadraticActionInOut())));e.opacity=0,setTimeout(function(){e.runAction(t)},1e3*CMath.getRandom(0,.5))},o=0,n=this.Stars.children;o<n.length;o++){t(n[o])}this.Light.active=!1,this.Score.string="0",this.TimeBonus.string="0",this.FinalScore.string="0",r.Game.getTimeBonus()>0?r.Game.isComplete()?this.Title.spriteFrame=this.TitleAtlas.getSpriteFrame("bg_complete"):this.Title.spriteFrame=this.TitleAtlas.getSpriteFrame("bg_font02"):r.Game.isComplete()?this.Title.spriteFrame=this.TitleAtlas.getSpriteFrame("bg_complete"):this.Title.spriteFrame=this.TitleAtlas.getSpriteFrame("bg_font03"),this.Result.setEventListener(this.eventListener.bind(this)),this.showScore=Math.max(0,r.Game.getScore()-r.Game.getTimeBonus()),console.log(" result:",r.Game.getScore(),", timeBonus:",r.Game.getTimeBonus(),",showScore:",this.showScore),this.scoreStep=Math.ceil(this.showScore/30),this.timeBonusStep=Math.ceil(r.Game.getTimeBonus()/30),this.finalScoreStep=Math.ceil(r.Game.getScore()/30),this.ConfirmButton.node.on(cc.Node.EventType.TOUCH_END,function(){e.hasSubmit||(e.hasSubmit=!0,console.log("submit score by click, matchid:",r.Game.MatchInfo.matchId,", seed:",r.Game.MatchInfo.sharedRandomSeed),CELER_X&&celerSDK.submitScore(r.Game.getScore()))},this),a.gEventMgr.on(s.GlobalEvent.RESTART,function(){e.node.removeFromParent()},this)},t.prototype.eventListener=function(e,t){switch(t.stringValue){case"light":this.Light.active=!0,this.Light.runAction(cc.repeatForever(cc.rotateBy(5,360)));break;case"music1":a.gEventMgr.emit(s.GlobalEvent.PLAY_OVER_1);break;case"music2":a.gEventMgr.emit(s.GlobalEvent.PLAY_OVER_2)}},t.prototype.start=function(){},t.prototype.check=function(){var e=this;this.sumbit||this.scoreComplete&&this.timeBonusComplete&&this.finalScoreComplete&&(this.sumbit=!0,console.log("submit"),this.scheduleOnce(function(){e.hasSubmit||(e.hasSubmit=!0,console.log("submit score by scheduleOnce, matchid:",r.Game.MatchInfo.matchId,", seed:",r.Game.MatchInfo.sharedRandomSeed),CELER_X&&celerSDK.submitScore(r.Game.getScore()))},2))},t.prototype.update=function(e){this.showScore=Math.max(0,r.Game.getScore()-r.Game.getTimeBonus()),this.score<this.showScore?(this.score+=this.scoreStep,this.score=Math.min(this.score,this.showScore),this.Score.string=this.score.toString()):(this.scoreComplete=!0,this.check()),this.timeBonus<r.Game.getTimeBonus()?(this.timeBonus+=this.timeBonusStep,this.timeBonus=Math.min(this.timeBonus,r.Game.getTimeBonus()),this.TimeBonus.string=this.timeBonus.toString()):(this.timeBonusComplete=!0,this.check()),this.finalScore<r.Game.getScore()?(this.finalScore+=this.finalScoreStep,this.finalScore=Math.min(this.finalScore,r.Game.getScore()),this.FinalScore.string=this.finalScore.toString()):(this.finalScoreComplete=!0,this.check())},i([p(cc.Label)],t.prototype,"Score",void 0),i([p(cc.Label)],t.prototype,"TimeBonus",void 0),i([p(cc.Label)],t.prototype,"FinalScore",void 0),i([p(cc.Button)],t.prototype,"ConfirmButton",void 0),i([p(cc.Sprite)],t.prototype,"Title",void 0),i([p(cc.SpriteAtlas)],t.prototype,"TitleAtlas",void 0),i([p(sp.Skeleton)],t.prototype,"Result",void 0),i([p(cc.Node)],t.prototype,"Light",void 0),i([p(cc.Node)],t.prototype,"Stars",void 0),t=i([l],t)}(cc.Component);o.default=u,cc._RF.pop()},{"./controller/EventManager":"EventManager","./controller/EventName":"EventName","./controller/Game":"Game"}],ScoreLabel:[function(e,t,o){"use strict";cc._RF.push(t,"63782W3hqJOj5tpO+PG+bef","ScoreLabel");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,o,a):i(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,a=r.ccclass,s=r.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.Score=null,t}return n(t,e),t.prototype.reuse=function(){this.node.scale=0,this.Score.string=arguments[0][0]},t.prototype.unuse=function(){},t.prototype.onLoad=function(){},t.prototype.start=function(){},i([s(cc.Label)],t.prototype,"Score",void 0),t=i([a],t)}(cc.Component);o.default=c,cc._RF.pop()},{}],SkipButton:[function(e,t,o){"use strict";cc._RF.push(t,"e12b2wfpiROKq1cv9zEZn5g","SkipButton");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,o,a):i(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var r=e("./Controller/EventManager"),a=e("./Controller/EventName"),s=cc._decorator,c=s.ccclass,l=(s.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_END,function(){r.gEventMgr.emit(a.GlobalEvent.HIDE_HELP)},this)},t.prototype.start=function(){},t.prototype.update=function(e){},t=i([c],t)}(cc.Component));o.default=l,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName"}],Stop:[function(e,t,o){"use strict";cc._RF.push(t,"8765cbDuHdBm6FKOUQ5ug79","Stop");var n=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,o,a):i(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var r=e("./controller/Game"),a=e("./controller/EventManager"),s=e("./controller/EventName"),c=e("./Guide"),l=cc._decorator,p=l.ccclass,u=l.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.EndButton=null,t.ResumeButton=null,t.Help=null,t.Content=null,t.TitleAtlas=null,t.Title=null,t.Warning=null,t.Guide=null,t.effect=!1,t}return n(t,e),Object.defineProperty(t.prototype,"WarningTitle",{get:function(){return this.node.getChildByName("bg_pause_font").getComponent(cc.Sprite)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"VolumeSlider",{get:function(){return this.node.getChildByName("VolumeSlider").getComponent(cc.Slider)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Mask",{get:function(){return this.VolumeSlider.node.getChildByName("Mask")},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){this.EndButton.node.on(cc.Node.EventType.TOUCH_END,this.endNow,this),this.ResumeButton.node.on(cc.Node.EventType.TOUCH_END,this.Resume,this),this.Help.node.on(cc.Node.EventType.TOUCH_END,this.ShowHelp,this),this.VolumeSlider.node.on("slide",this.onSlider,this),this.Content._enableBold(!0)},t.prototype.onSlider=function(){cc.audioEngine.setEffectsVolume(this.VolumeSlider.progress),cc.audioEngine.setMusicVolume(this.VolumeSlider.progress),this.updateMask()},t.prototype.updateMask=function(){this.Mask.width=440*this.VolumeSlider.progress},t.prototype.endNow=function(){console.log(" end game manualy"),r.Game.calTimeBonus(),a.gEventMgr.emit(s.GlobalEvent.OPEN_RESULT)},t.prototype.hide=function(e){void 0===e&&(e=!0),0!=this.node.active&&(e&&r.Game.PauseCount++,this.node.active=!1,this.effect&&a.gEventMgr.emit(s.GlobalEvent.NORMAL_BGM))},t.prototype.show=function(e,t){if(void 0===t&&(t=!0),1!=this.node.active){switch(this.node.active=!0,this.effect=t,r.Game.PauseCount){case 0:this.WarningTitle.spriteFrame=this.Warning.getSpriteFrame("bg_pause_font2");break;case 1:this.WarningTitle.spriteFrame=this.Warning.getSpriteFrame("bg_pause_font1");break;default:this.WarningTitle.spriteFrame=this.Warning.getSpriteFrame("bg_pause_fontnone")}this.effect&&(a.gEventMgr.emit(s.GlobalEvent.PLAY_PAUSE),a.gEventMgr.emit(s.GlobalEvent.SMALL_BGM)),this.VolumeSlider.progress=cc.audioEngine.getEffectsVolume(),this.updateMask(),this.VolumeSlider.node.active=e>0,e>0?(this.Content.node.y=-33,this.EndButton.node.active=!1,this.ResumeButton.node.x=0,this.Content.string="The game has been paused, please resume.",this.Title.spriteFrame=this.TitleAtlas.getSpriteFrame("bg_font06")):(this.Content.node.y=37,this.EndButton.node.active=!0,this.ResumeButton.node.x=-215,this.Content.string="Do you want to stop now with the current score?",this.Title.spriteFrame=this.TitleAtlas.getSpriteFrame("bg_font01"))}},t.prototype.ShowHelp=function(){this.Guide.show(function(){})},t.prototype.Resume=function(){this.hide(),r.Game.setPause(!1)},t.prototype.start=function(){},i([u(cc.Button)],t.prototype,"EndButton",void 0),i([u(cc.Button)],t.prototype,"ResumeButton",void 0),i([u(cc.Button)],t.prototype,"Help",void 0),i([u(cc.Label)],t.prototype,"Content",void 0),i([u(cc.SpriteAtlas)],t.prototype,"TitleAtlas",void 0),i([u(cc.Sprite)],t.prototype,"Title",void 0),i([u(cc.SpriteAtlas)],t.prototype,"Warning",void 0),i([u(c.default)],t.prototype,"Guide",void 0),t=i([p],t)}(cc.Component);o.default=h,cc._RF.pop()},{"./Guide":"Guide","./controller/EventManager":"EventManager","./controller/EventName":"EventName","./controller/Game":"Game"}]},{},["GameScene","Guide","Poker","PokerRoot","Pokers","RecycleRoot","Result","ScoreLabel","SkipButton","Stop","AudioController","EventManager","EventName","Game","GameFactory","HashMap","LogHandler"]);