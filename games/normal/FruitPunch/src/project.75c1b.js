window.__require=function t(e,o,i){function n(r,s){if(!o[r]){if(!e[r]){var c=r.split("/");if(c=c[c.length-1],!e[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+r+"'")}}var h=o[r]={exports:{}};e[r][0].call(h.exports,function(t){return n(e[r][1][t]||t)},h,h.exports,t,e,o,i)}return o[r].exports}for(var a="function"==typeof __require&&__require,r=0;r<i.length;r++)n(i[r]);return n}({AudioController:[function(t,e,o){"use strict";cc._RF.push(e,"76488zQCU1KqLU6loyhNNZ5","AudioController"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../exts/HashMap"),n=t("./EventManager"),a=t("./EventName"),r=t("../Game/GameMgr"),s="sounds/";window.oncanplay&&(window.oncanplay=function(){c.canPlay=!0});var c=function(){function t(){this.audioID={},this.clips=new i.HashMap}return Object.defineProperty(t,"inst",{get:function(){return this.ins?this.ins:this.ins=new t},enumerable:!0,configurable:!0}),t.prototype.init=function(t){console.warn(" start load AudioClip ");var e=this;cc.loader.loadResDir("preLoadSounds",cc.AudioClip,function(o,i,n){if(o)console.error(o);else{for(var a=0,r=i;a<r.length;a++){var s=r[a];e.clips.add(s.name,s)}e.initEvent(),t&&t()}})},t.prototype.initEvent=function(){var t=this;n.gEventMgr.targetOff(this),this.playMusic("normal_bgm"),n.gEventMgr.on(a.GlobalEvent.PLAY_KILL_EFFECT,function(){t.playEffect("fruit_break")},this),n.gEventMgr.on(a.GlobalEvent.PLAY_30_BGM,function(){t.playEffect("time_counting",!0),null==t.audioID.SpecialA_bgm&&null==t.audioID.SpecialB_bgm&&t.playMusic("bgm_30secs")},this),n.gEventMgr.on(a.GlobalEvent.GAME_RESTART,function(){null!=t.audioID.time_counting&&t.stop(t.audioID.time_counting),t.playMusic("normal_bgm")},this),n.gEventMgr.on(a.GlobalEvent.PLAY_LETSGO,function(){t.playEffect("letsgo")},this),n.gEventMgr.on(a.GlobalEvent.PLAY_BIU,function(){t.playEffect("biu")},this),n.gEventMgr.on(a.GlobalEvent.PLAY_TOUCH,function(){t.playEffect("touch")},this),n.gEventMgr.on(a.GlobalEvent.PLAY_PLACE,function(){t.playEffect("lay")},this),n.gEventMgr.on(a.GlobalEvent.PLAY_TEXT,function(e){t.playEffect(e)},this),n.gEventMgr.on(a.GlobalEvent.PLAY_SPECIAL_A_BGM,function(e){e?t.playMusic("SpecialA_bgm"):r.Game.getTime()<=30?t.playMusic("bgm_30secs"):t.playMusic("normal_bgm")},this),n.gEventMgr.on(a.GlobalEvent.PLAY_SPECIAL_B_BGM,function(e){e?t.playMusic("SpecialB_bgm"):r.Game.getTime()<=30?t.playMusic("bgm_30secs"):t.playMusic("normal_bgm")},this),n.gEventMgr.on(a.GlobalEvent.PLAY_OVER,function(){null!=t.audioID.time_counting&&t.stop(t.audioID.time_counting),t.playEffect("over")},this),n.gEventMgr.on(a.GlobalEvent.PLAY_OVER_NO_PLACE,function(){t.playEffect("over_no_place"),cc.audioEngine.setFinishCallback(t.audioID.over_no_place,function(){this.audioID.over_no_place=null}.bind(t))},this),n.gEventMgr.on(a.GlobalEvent.PLAY_LAY_FAIL,function(){t.playEffect("lay_fail"),cc.audioEngine.setFinishCallback(t.audioID.lay_fail,function(){this.audioID.lay_fail=null}.bind(t))},this),n.gEventMgr.on(a.GlobalEvent.PLAY_OVER_TIME_UP,function(){t.playEffect("frezon"),cc.audioEngine.setFinishCallback(t.audioID.frezon,function(){this.audioID.frezon=null}.bind(t))},this),n.gEventMgr.on(a.GlobalEvent.PLAY_OVER_TAB,function(){t.playEffect("over_biu"),cc.audioEngine.setFinishCallback(t.audioID.over_biu,function(){this.audioID.over_biu=null}.bind(t))},this),n.gEventMgr.on(a.GlobalEvent.PLAY_SCORE,function(e){e?t.playEffect("score"):null!=t.audioID.score&&(t.stop(t.audioID.score),t.audioID.score=null)},this),n.gEventMgr.on(a.GlobalEvent.PLAY_SPECIAL_A,function(){t.playEffect("specialA"),cc.audioEngine.setFinishCallback(t.audioID.specialA,function(){this.audioID.specialA=null}.bind(t))},this),n.gEventMgr.on(a.GlobalEvent.PLAY_SPECIAL_B,function(){t.playEffect("specialB"),cc.audioEngine.setFinishCallback(t.audioID.specialB,function(){this.audioID.specialB=null}.bind(t))},this)},t.prototype.stop=function(e,o){if(t.canPlay)cc.audioEngine.stop(e);else for(var i=0,n=t.PlayedList;i<n.length;i++){var a=n[i];a.skip=a.clipName==o}},t.prototype.playEffect=function(e,o){var i=this;if(void 0===o&&(o=!1),t.canPlay){if(!(cc.audioEngine.getEffectsVolume()<=.05)){var n=this.clips.get(e);n?(this.audioID[e]=cc.audioEngine.playEffect(n,o),cc.audioEngine.setFinishCallback(this.audioID[e],function(){i.audioID[e]=null})):cc.loader.loadRes(s+e,cc.AudioClip,function(t,n){t?console.error(t):(i.clips.add(n.name,n),i.audioID[e]=cc.audioEngine.playEffect(n,o),cc.audioEngine.setFinishCallback(i.audioID[e],function(){i.audioID[e]=null}))})}}else this.bindTouch()},t.prototype.playMusic=function(e,o){var i=this;if(void 0===o&&(o=!0),!t.canPlay)return this.bindTouch(),void t.PlayedList.push({loop:!0,volume:1,clipName:e,supTime:Date.now(),skip:!1,isBgm:!0});this.audioID.normal_bgm=null,this.audioID.SpecialB_bgm=null,this.audioID.SpecialA_bgm=null,this.audioID.bgm_30secs=null;var n=this.clips.get(e);n?this.audioID[e]=cc.audioEngine.playMusic(n,o):cc.loader.loadRes(s+e,cc.AudioClip,function(t,n){t?console.error(t):("string"==typeof n._audio&&cc.loader._cache&&cc.loader._cache[n._audio]&&cc.loader._cache[n._audio].buffer&&(n._audio=cc.loader._cache[n._audio].buffer),i.clips.add(n.name,n),i.audioID[e]=cc.audioEngine.playMusic(n,o))})},t.prototype.bindTouch=function(){if(!t.hasBindTouch){var e=this,o=function(){var i;for(cc.game.canvas.removeEventListener("touchstart",o),t.canPlay=!0;(i=t.PlayedList.pop())&&e.clips.get(i.clipName)&&!i.skip;)cc.audioEngine.playMusic(e.clips.get(i.clipName),i.loop)};t.hasBindTouch=!0,cc.game.canvas.addEventListener("touchstart",o)}},t.PlayedList=[],t.canPlay=!1,t.hasBindTouch=!1,t}();o.gAudio=c.inst,cc._RF.pop()},{"../Game/GameMgr":"GameMgr","../exts/HashMap":"HashMap","./EventManager":"EventManager","./EventName":"EventName"}],Config:[function(t,e,o){"use strict";cc._RF.push(e,"7419cx/DDRG86x2LiwgMtL9","Config"),Object.defineProperty(o,"__esModule",{value:!0}),o.Config={FPS:60,WinSize:cc.size(1080,1920),Grid:cc.v2(8,8),GameTime:180},cc._RF.pop()},{}],CubeBg:[function(t,e,o){"use strict";cc._RF.push(e,"c1d5137ZNhJsZAlX67esxnT","CubeBg"),Object.defineProperty(o,"__esModule",{value:!0});var i,n=t("../Controller/EventManager"),a=t("../Controller/EventName"),r=t("./GameMgr"),s=t("../Config/Config"),c=t("../table"),l=t("../TableMgr"),h=cc._decorator,u=h.ccclass,d=h.property;(function(t){t[t.Shake=0]="Shake",t[t.Idle=1]="Idle"})(i||(i={}));var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cube=null,e.yingtao=null,e.pingguo=null,e.fanqie=null,e.mihoutao=null,e.boluo=null,e.chengzi=null,e.icon_daoju_B=null,e.icon_daoju_A=null,e.index=0,e.OldFruitID=2e4,e.available=!1,e.preRowFlag=!1,e.preColFlag=!1,e.isPlaying=!1,e.isDirectlyKill=!1,e.isPlaySpecial=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.initEvent()},e.prototype.update=function(t){},e.prototype.reuse=function(){this.OldFruitID=2e4,this.fruitData=l.TableMgr.inst.getFruits(this.OldFruitID),this.isPlaying=!1,this.index=parseInt(this.node.name),this.setCubeActive(!1),this.cube.node.opacity=255,this.node.scale=0,this.node.runAction(cc.sequence(cc.delayTime(this.index/60),cc.scaleTo(0,.9),cc.scaleTo(.1,1.1),cc.scaleTo(.2,1),cc.callFunc(this.ready.bind(this),this))),this.initEvent()},e.prototype.ready=function(){n.gEventMgr.emit(a.GlobalEvent.PLAY_BIU),r.Game.getCubeIndex()[this.index]>0?(this.available=!0,this.setAvailable(!1,!0)):(this.available=!1,this.setAvailable(!0))},e.prototype.unuse=function(){this.available=!1,n.gEventMgr.targetOff(this)},e.prototype.initEvent=function(){var t=this;n.gEventMgr.targetOff(this),n.gEventMgr.on(a.GlobalEvent.PREPARE_CUBE_BG,this.reuse,this),n.gEventMgr.on(a.GlobalEvent.CUBE_BOX_DRAG_CANCEL,this.onDragCancel,this),n.gEventMgr.on(a.GlobalEvent.CUBE_BOX_DRAG_INDEX,this.onDragIndex,this),n.gEventMgr.on(a.GlobalEvent.CUBE_BOX_PLACE_DONE,this.placeDone,this),n.gEventMgr.on(a.GlobalEvent.EAT_COL,this.eatCol,this),n.gEventMgr.on(a.GlobalEvent.EAT_ROW,this.eatRow,this),n.gEventMgr.on(a.GlobalEvent.KILL_DIRECTLY,this.killDirectly,this),n.gEventMgr.on(a.GlobalEvent.GAME_OVER,this.onGameOver,this),n.gEventMgr.on(a.GlobalEvent.CLEAR_CUBE_ROOT,this.clear,this),this.cube.getComponent(cc.Animation).on(cc.Animation.EventType.FINISHED,this.onKillFinished,this),this.cube.getComponent(cc.Animation).on(cc.Animation.EventType.STOP,function(){t.cube.node.scale=1},this),this.cube.getComponent(cc.Animation).on(cc.Animation.EventType.PLAY,function(){t.cube.node.stopAllActions(),"Effect"!=t.cube.node.group&&(t.cube.node.group="Effect"),t.cube.node.scale=t.fruitData?t.fruitData.Scale:2},this),this.cube.getComponent(cc.Animation).on(cc.Animation.EventType.RESUME,function(){t.cube.node.scale=t.fruitData?t.fruitData.Scale:2},this),this.cube.getComponent(cc.Animation).on(cc.Animation.EventType.PAUSE,function(){t.cube.node.scale=1},this)},e.prototype.clear=function(){this.setCubeActive(!1),this.node.scale=0},e.prototype.onGameOver=function(t){var e=this,o=t==r.OverType.NO_PLACE?this.fruitData.FailedIcon:this.fruitData.FrozenIcon;cc.loader.loadRes("Textures/Fruits/"+o,cc.SpriteFrame,function(t,o){t?console.error(" load fail icon failed:",t):setTimeout(function(){e.cube.node.stopAllActions(),e.cube.node.scale=1,e.cube.spriteFrame=o,r.Game.addOverCount()},e.index/60*1e3)})},e.prototype.eatCol=function(t){if(!this.isAvailable())for(var e=0,o=t;e<o.length;e++){var i=o[e];if(this.index%s.Config.Grid.x==i){this.onKill(Math.floor(this.index/8)*this.fruitData.Delay);break}}},e.prototype.killDirectly=function(){this.isAvailable()||this.isDirectlyKill&&(this.isDirectlyKill=!1,this.onKill(this.index%8*this.fruitData.Delay))},e.prototype.eatRow=function(t){if(!this.isAvailable())for(var e=0,o=t;e<o.length;e++){var i=o[e];if(this.index>=i*s.Config.Grid.x&&this.index<(i+1)*s.Config.Grid.x){this.onKill(this.index%8*this.fruitData.Delay);break}}},e.prototype.onKill=function(t){void 0===t&&(t=0),this.isPlaying=!0,r.Game.addScore(this.fruitData.Score),r.Game.addFruitKill(this.fruitData.ID),r.Game.addFruitScore(this.fruitData.ID,this.fruitData.Score);var e=this.fruitData.KillAni;n.gEventMgr.emit(a.GlobalEvent.ON_KILL),this.fruitData.Type==c.Fruits_Type.DaoJu&&console.log(" this.fruitData :",this.fruitData.Name,r.Game.isEmitRainbowEvent),this.fruitData.Type!=c.Fruits_Type.DaoJu||r.Game.isEmitRainbowEvent||(r.Game.isEmitRainbowEvent=!0,n.gEventMgr.emit(a.GlobalEvent.PLAY_RAINBOW_EFFECT,20006==this.fruitData.ID?"rainbow":"hourse")),this.isPlaySpecial&&(this.isPlaySpecial=!1,10032==this.fruitData.ID?n.gEventMgr.emit(a.GlobalEvent.PLAY_SPECIAL_A):n.gEventMgr.emit(a.GlobalEvent.PLAY_SPECIAL_B));var o=this.fruitData?this.fruitData.Speed:1,i=this.fruitData?this.fruitData.Scale:2;setTimeout(function(){this.isPlaying&&(this.cube.node.stopAllActions(),this.cube.node.scale=i,this.cube.getComponent(cc.Animation).play(e,0).speed=o)}.bind(this),t),this.setAvailable(!0)},e.prototype.onKillFinished=function(){this.cube.node.scale=1,"default"!=this.cube.node.group&&(this.cube.node.group="default"),this.isPlaying=!1,this.isAvailable()&&(this.cube.node.active&&this.cube.node.opacity<255||(this.setCubeActive(!1),this.cube.node.opacity=255))},e.prototype.preCol=function(t){for(var e=0,o=t;e<o.length;e++){var i=o[e];if(this.index%s.Config.Grid.x==i){this.preColFlag=!0;break}this.preColFlag=!1}},e.prototype.preRow=function(t){for(var e=0,o=t;e<o.length;e++){var i=o[e];if(this.index>=i*s.Config.Grid.x&&this.index<(i+1)*s.Config.Grid.x){this.preRowFlag=!0;break}this.preRowFlag=!1}},e.prototype.setCubeActive=function(t){this.cube.node.active=t,this.cube.node.active||(this.cube.node.stopAllActions(),this.cube.node.scale=1)},e.prototype.onDragIndex=function(t,e,o,i){if(r.Game.isStart){if(r.Game.killDirectlyCount=0,o&&o.length>0?(this.isDirectlyKill=o.indexOf(this.index)>=0,r.Game.killDirectlyCount++):(this.isDirectlyKill=!1,r.Game.killDirectlyCount--),i&&i.length>0?this.isPlaySpecial=i.indexOf(this.index)>=0:this.isPlaySpecial=!1,this.available){var n=t.indexOf(this.index)>=0;this.setCubeActive(n||this.isPlaying),n&&(this.cube.node.opacity=150),this.cube.node.active&&this.cube.node.opacity<255?(r.Game.setPreCubeIndex(this.index,this.fruitData.Score),this.isPlaying&&(this.cube.getComponent(cc.Animation).stop(),this.isPlaying=!1),this.OldFruitID=r.Game.curSelectFruitID,this.updateFruitData(r.Game.curSelectFruitID)):r.Game.resetPreCubeIndex(this.index)}else t.indexOf(this.index)>=0&&r.Game.dragCount--,r.Game.setPreCubeIndex(this.index,this.fruitData.Score);this.preCheck()}},e.prototype.updateFruitData=function(t){this.fruitData=null,this.fruitData=l.TableMgr.inst.getFruits(t),this.isPlaying||(this.cube.spriteFrame=this[this.fruitData.Icon])},e.prototype.preCheck=function(){var t=r.Game.checkRowCol(r.Game.getPreCubeIndex()),e=t[0],o=t[1];this.preRowFlag=!1,this.preColFlag=!1,o.length>0?this.preCol(o):this.preColFlag=!1,e.length>0?this.preRow(e):this.preRowFlag=!1;var i=l.TableMgr.inst.getFruits(r.Game.curSelectFruitID);i&&this.cube.node.active&&this.cube.node.opacity<255&&r.Game.addPreScore(i.BaseScore),(this.preRowFlag||this.preColFlag||this.isDirectlyKill)&&r.Game.addPreScore(i.Score),20006!=r.Game.curSelectFruitID&&20007!=r.Game.curSelectFruitID||(r.Game.isEmitRainbowEvent=!1,n.gEventMgr.emit(a.GlobalEvent.UPDATE_RAINBOW_SCORE,r.Game.getPreScore().toString())),this.preRowFlag||this.preColFlag||this.isDirectlyKill?this.shake(!0):this.shake(!1)},e.prototype.shake=function(t){if(t){this.updateFruitData(r.Game.curSelectFruitID);var e=this.cube.node.getActionByTag(i.Shake);if(e&&!e.isDone())return;var o=cc.repeatForever(cc.sequence(cc.rotateTo(.03,-4),cc.rotateTo(.03,0),cc.rotateBy(.03,4),cc.rotateTo(.03,0)));this.cube.node.stopActionByTag(i.Idle),this.cube.node.scale=1,o.setTag(i.Shake),this.cube.node.runAction(o)}else this.cube.node.stopActionByTag(i.Shake),this.updateFruitData(this.OldFruitID),this.cube.node.rotation=0},e.prototype.getIndex=function(){return this.index},e.prototype.isAvailable=function(){return this.available},e.prototype.setAvailable=function(t,e){void 0===e&&(e=!1),this.available!=t&&(this.available=t,this.available?(r.Game.resetCubeIndex(this.index),r.Game.resetPreCubeIndex(this.index),r.Game.addAvailableCount(1),this.setCubeActive(this.isPlaying)):(r.Game.setCubeIndex(this.index,this.fruitData.Score),r.Game.setPreCubeIndex(this.index,this.fruitData.Score),e||r.Game.addAvailableCount(-1),this.cube.node.opacity=255,this.setCubeActive(!0),this.cube.getComponent(cc.Animation).stop(),this.isPlaying=!1,this.updateFruitData(r.Game.curSelectFruitID)),this.shake(!1))},e.prototype.placeDone=function(){if(r.Game.canPlace=!1,r.Game.resetPreScore(),this.available){if(this.cube.node.active&&this.cube.node.opacity<255){this.setAvailable(!1);var t=cc.sequence(cc.scaleTo(.1,1.2,.8),cc.scaleTo(.1,.8,1.2),cc.scaleTo(.1,1.1,.9),cc.scaleTo(.1,1,1));t.setTag(i.Idle),this.cube.node.runAction(t),r.Game.curPlaceCount++,r.Game.addScore(this.fruitData.BaseScore),r.Game.addFruitScore(this.fruitData.ID,this.fruitData.BaseScore)}else this.setAvailable(!0);console.log(r.Game.curPlaceCount,r.Game.dragCount),r.Game.curPlaceCount>=r.Game.dragCount&&r.Game.curPlaceCount>0?(console.warn("place:",r.Game.curPlaceCount,r.Game.dragCount),r.Game.curPlaceCount=0,r.Game.dragCount=0,n.gEventMgr.emit(a.GlobalEvent.PLAY_PLACE),n.gEventMgr.emit(a.GlobalEvent.CUBE_BOX_SET_STATE_DONE)):console.log(" curPlaceCount :",r.Game.curPlaceCount,", dragCount:",r.Game.dragCount)}else console.error(" place done",this.available)},e.prototype.onDragCancel=function(){r.Game.resetPreScore(),this.available?(this.isPlaying||(this.setCubeActive(!1),this.cube.node.opacity=255),r.Game.dragCount=0):this.shake(!1)},e.prototype.start=function(){},__decorate([d(cc.Sprite)],e.prototype,"cube",void 0),__decorate([d({type:cc.SpriteFrame,displayName:"\u6a31\u6843"})],e.prototype,"yingtao",void 0),__decorate([d({type:cc.SpriteFrame,displayName:"\u82f9\u679c"})],e.prototype,"pingguo",void 0),__decorate([d({type:cc.SpriteFrame,displayName:"\u756a\u8304"})],e.prototype,"fanqie",void 0),__decorate([d({type:cc.SpriteFrame,displayName:"\u7315\u7334\u6843"})],e.prototype,"mihoutao",void 0),__decorate([d({type:cc.SpriteFrame,displayName:"\u83e0\u841d"})],e.prototype,"boluo",void 0),__decorate([d({type:cc.SpriteFrame,displayName:"\u6a59\u5b50"})],e.prototype,"chengzi",void 0),__decorate([d({type:cc.SpriteFrame,displayName:"\u4e5d\u5bab\u683c"})],e.prototype,"icon_daoju_B",void 0),__decorate([d({type:cc.SpriteFrame,displayName:"\u6a2a\u7ad6"})],e.prototype,"icon_daoju_A",void 0),e=__decorate([u],e)}(cc.Component);o.default=p,cc._RF.pop()},{"../Config/Config":"Config","../Controller/EventManager":"EventManager","../Controller/EventName":"EventName","../TableMgr":"TableMgr","../table":"table","./GameMgr":"GameMgr"}],CubeRoot:[function(t,e,o){"use strict";cc._RF.push(e,"b6abe/Y9ElKYballHwIR463","CubeRoot"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Controller/GameFactory"),n=t("../Controller/EventManager"),a=t("../Controller/EventName"),r=t("../Config/Config"),s=t("./GameMgr"),c=t("../TableMgr"),l=cc._decorator,h=l.ccclass,u=l.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.maxSize=cc.size(450,450),e.moveDetalTime=.1,e.layDetalTime=.02,e.dragSense=cc.v2(2.8,2.5),e.popOffset=cc.v2(100,50),e.popBaseY=500,e.scale=1,e.posRestored=cc.v2(0,0),e.isReady=!1,e.shapeData=null,e.fruitID=0,e.maxHorIndex=0,e.maxRow=0,e.endIndex=0,e.DragNode=null,e.PlaceNode=null,e.preReady=!1,e}var o;return __extends(e,t),o=e,e.prototype.reuse=function(){this.node.opacity=255,this.shapeData=arguments[0][0],this.node.width=0,this.node.height=0,this.node.zIndex=0,this.PlaceNode.width=0,this.PlaceNode.height=0,this.node.active=!1,this.shapeData.shape.sort(function(t,e){return t-e});for(var t=r.Config.Grid.x,e=Math.floor(this.shapeData.shape[0]/t),o=0;o<this.shapeData.shape.length;o++)this.shapeData.shape[o]=this.shapeData.shape[o]%t+Math.max(Math.floor(this.shapeData.shape[o]/t-e),0)*t,this.maxHorIndex=Math.max(this.maxHorIndex,this.shapeData.shape[o]%r.Config.Grid.x);var n=this.shapeData.shape[this.shapeData.shape.length-1];this.maxRow=Math.max(1,Math.ceil(n/r.Config.Grid.x)),this.endIndex=(n-(this.maxRow-1)*r.Config.Grid.x)%r.Config.Grid.x,this.endIndex=this.maxHorIndex-this.endIndex,this.setFruit(),this.PlaceNode.removeAllChildren();for(var a=0,s=this.shapeData.shape;a<s.length;a++){var c=s[a];this.PlaceNode.addChild(i.gFactory.getCube(c,this.fruitID))}this.initEvent(),this.scheduleOnce(this.adjustPos.bind(this),0)},e.prototype.setFruit=function(){this.shapeStaticData=c.TableMgr.inst.getShape(this.shapeData.shapeID);for(var t=0,e=[],o=0,i=this.shapeStaticData.Fruit;o<i.length;o++){var n=i[o],a=parseInt(n.split("|")[0]),r=parseInt(n.split("|")[1]);t+=a,e.push({id:r,weight:t})}for(var s=CMath.getRandom()*t,l=0,h=e;l<h.length;l++){if((n=h[l]).weight>=s){this.fruitID=n.id;break}}},e.prototype.unuse=function(){this.node.opacity=0,this.node.scale=1,n.gEventMgr.targetOff(this),this.node.targetOff(this),this.posRestored=cc.v2(0,0),this.node.x=0,this.node.y=0,this.scale=1,this.isReady=!1,this.preReady=!1,this.maxHorIndex=0,cc.Node.touchNum=0},e.prototype.initEvent=function(){n.gEventMgr.targetOff(this),n.gEventMgr.on(a.GlobalEvent.DRAG_ADJUST_DONE,this.restorePos,this),n.gEventMgr.on(a.GlobalEvent.GAME_OVER,this.gameOver,this),n.gEventMgr.on(a.GlobalEvent.CLEAR_CUBE_ROOT,this.clear,this)},e.prototype.clear=function(){if(!s.Game.isStart){for(this.node.opacity=0;this.PlaceNode.children.length>0;)i.gFactory.putCube(this.PlaceNode.children[0]);i.gFactory.putCubeRoot(this.node)}},e.prototype.gameOver=function(){s.Game.canPlace=!1,this.back()},e.prototype.restorePos=function(){this.posRestored.addSelf(this.node.position)},e.prototype.adjustPos=function(){for(var t=0,e=this.PlaceNode.children;t<e.length;t++){var o=e[t];this.PlaceNode.width=Math.max(this.PlaceNode.width,o.x),this.PlaceNode.height=Math.max(this.PlaceNode.height,Math.abs(o.y))}this.PlaceNode.width+=this.PlaceNode.children[0].width,this.PlaceNode.height+=this.PlaceNode.children[0].height,this.node.width=this.PlaceNode.width,this.node.height=this.PlaceNode.height,this.scale=Math.min(1,this.maxSize.width/this.node.width,this.maxSize.height/this.node.height),this.node.scale=this.scale,this.DragNode.scale=1/this.scale;for(var i=0,r=this.PlaceNode.children;i<r.length;i++){(o=r[i]).x-=this.PlaceNode.width/2-o.width/2,o.y+=this.PlaceNode.height/2-o.height/2}this.node.y=0,this.boxSize=cc.size(this.node.width,this.node.height),this.cellSize=cc.size(this.PlaceNode.children[0].width,this.PlaceNode.children[0].height),this.node.active=!0,this.DragNode.targetOff(this),this.DragNode.on(cc.Node.EventType.TOUCH_MOVE,this.onDrag,this),this.DragNode.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.DragNode.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.DragNode.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),n.gEventMgr.emit(a.GlobalEvent.Cube_ADJUST_DONE)},e.prototype.checkCanTouch=function(){var t=!0,e=this.node.getParent();if(e){console.log(" cube root count:",e.childrenCount);for(var i=0,n=e.children;i<n.length;i++){if(n[i].getComponent(o).preReady){t=!1;break}}}return t},e.prototype.onTouchStart=function(t){if(this.checkCanTouch())if(this.preReady=!0,this.isReady)console.log(" on touch start , is ready");else if(s.Game.canDrag)if(s.Game.isStart){n.gEventMgr.emit(a.GlobalEvent.PLAY_TOUCH),10033==this.shapeData.shapeID?n.gEventMgr.emit(a.GlobalEvent.PLAY_SPECIAL_B_BGM,!0):10032==this.shapeData.shapeID&&n.gEventMgr.emit(a.GlobalEvent.PLAY_SPECIAL_A_BGM,!0),s.Game.resetPreScore();var e=this.DragNode.convertToNodeSpaceAR(t.getLocation()),o=cc.v2(e.x/this.DragNode.width*2,e.y/this.DragNode.height*2),i=cc.v2(this.node.x+this.popOffset.x*o.x,this.node.y+this.popBaseY+o.y*this.popOffset.y),r=1/this.node.parent.scale,c=cc.sequence(cc.spawn(cc.moveTo(this.moveDetalTime,i),cc.scaleTo(this.moveDetalTime,r)),cc.callFunc(this.ready.bind(this),this));this.node.stopAllActions(),this.node.zIndex=3,this.node.runAction(c),s.Game.curSelectFruitID=this.fruitID}else console.log(" on touch start, game is not start");else console.log(" on touch start, game canDrag is false");else console.log(" on touch start ,canTouch is false ")},e.prototype.ready=function(){this.isReady=!0},e.prototype.reset=function(){this.isReady=!1,this.node.zIndex=1,s.Game.canDrag=!0},e.prototype.onTouchEnd=function(){if(this.preReady=!1,!this.isReady)return this.node.scale>1&&this.back(),void console.log(" on touchend , is ready is fasle");if(s.Game.isStart)if(console.log(" end :",s.Game.canPlace),s.Game.canPlace){10033==this.shapeData.shapeID?n.gEventMgr.emit(a.GlobalEvent.PLAY_SPECIAL_B_BGM,!1):10032==this.shapeData.shapeID&&n.gEventMgr.emit(a.GlobalEvent.PLAY_SPECIAL_A_BGM,!1),this.node.stopAllActions();var t=this.node.parent.convertToNodeSpaceAR(s.Game.placePos);this.node.runAction(cc.sequence(cc.moveTo(this.layDetalTime,t),cc.callFunc(this.placeDoneRoot.bind(this),this)))}else this.back(),n.gEventMgr.emit(a.GlobalEvent.PLAY_LAY_FAIL);else console.log(" on touchend , is start is false")},e.prototype.back=function(){10033==this.shapeData.shapeID?n.gEventMgr.emit(a.GlobalEvent.PLAY_SPECIAL_B_BGM,!1):10032==this.shapeData.shapeID&&n.gEventMgr.emit(a.GlobalEvent.PLAY_SPECIAL_A_BGM,!1);var t=cc.sequence(cc.spawn(cc.moveTo(this.moveDetalTime,this.posRestored),cc.scaleTo(this.moveDetalTime,this.scale)),cc.callFunc(this.reset.bind(this),this));this.node.stopAllActions(),this.node.runAction(t),n.gEventMgr.emit(a.GlobalEvent.CUBE_BOX_DRAG_CANCEL)},e.prototype.placeDoneRoot=function(){for(s.Game.canDrag=!0,this.node.opacity=0;this.PlaceNode.children.length>0;)i.gFactory.putCube(this.PlaceNode.children[0]);i.gFactory.putCubeRoot(this.node),console.log(" Cube Root Place done !!!!!!"),n.gEventMgr.emit(a.GlobalEvent.CUBE_BOX_PLACE_DONE)},e.prototype.onDrag=function(t){if(s.Game.canDrag&&s.Game.isStart)if(this.isReady){s.Game.resetPreScore(),this.node.x+=t.getDeltaX()*this.dragSense.x,this.node.y+=t.getDeltaY()*this.dragSense.y;var e=s.Game.gamePanel.convertToNodeSpaceAR(this.node.parent.convertToWorldSpaceAR(this.node.position));n.gEventMgr.emit(a.GlobalEvent.CUBE_BOX_DRAGING,e,[this.boxSize,this.cellSize],this.shapeData.shape,[this.endIndex,this.maxRow,this.maxHorIndex],this.shapeStaticData.ID)}else console.log(" on drag, is ready is false");else s.Game.canDrag?console.log(" on drag, is start is falsle"):console.log(" on drag, can drag is false")},e.prototype.getInfo=function(){return[this.endIndex,this.maxRow,this.maxHorIndex]},e.prototype.getShape=function(){return this.shapeData.shape},e.prototype.getBoxSize=function(){return this.boxSize},e.prototype.getCellSize=function(){return this.cellSize},e.prototype.getShapeID=function(){return this.shapeStaticData.ID},e.prototype.onLoad=function(){},e.prototype.start=function(){},__decorate([u(cc.Node)],e.prototype,"DragNode",void 0),__decorate([u(cc.Node)],e.prototype,"PlaceNode",void 0),e=o=__decorate([h],e)}(cc.Component);o.default=d,cc._RF.pop()},{"../Config/Config":"Config","../Controller/EventManager":"EventManager","../Controller/EventName":"EventName","../Controller/GameFactory":"GameFactory","../TableMgr":"TableMgr","./GameMgr":"GameMgr"}],Cube:[function(t,e,o){"use strict";cc._RF.push(e,"2cc1c9ARLVAs4tu9Y4hLOzZ","Cube"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../Config/Config"),n=t("../TableMgr"),a=cc._decorator,r=a.ccclass,s=(a.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.posIndex=0,e.fruitID=0,e}return __extends(e,t),e.prototype.reuse=function(){var t=this;this.posIndex=arguments[0][0],this.fruitID=arguments[0][1],this.node.active=!1;var e=n.TableMgr.inst.getFruits(this.fruitID).Icon;cc.loader.loadRes("Textures/Fruits/"+e,cc.SpriteFrame,function(e,o){e?console.error("load fruit icon err:",e):(t.getComponent(cc.Sprite).spriteFrame=o,t.node.active=!0)});var o=cc.v2(this.posIndex%i.Config.Grid.x*this.node.width,-Math.floor(this.posIndex/i.Config.Grid.y)*this.node.height);this.node.setPosition(o)},e.prototype.getIndex=function(){return this.posIndex},e.prototype.unuse=function(){this.posIndex=0,this.node.x=0,this.node.y=0,this.node.scale=1},e.prototype.onLoad=function(){},e.prototype.start=function(){},e.prototype.update=function(t){},e=__decorate([r],e)}(cc.Component));o.default=s,cc._RF.pop()},{"../Config/Config":"Config","../TableMgr":"TableMgr"}],EventManager:[function(t,e,o){"use strict";cc._RF.push(e,"3c384HeRO5DCL/qOmRM/SNf","EventManager"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){this.eventTarget=new cc.EventTarget}return Object.defineProperty(t,"inst",{get:function(){return this.ins?this.ins:this.ins=new t},enumerable:!0,configurable:!0}),t.prototype.emit=function(t,e,o,i,n,a){this.eventTarget.emit(t.toString(),e,o,i,n,a)},t.prototype.on=function(t,e,o,i){return this.eventTarget.on(t.toString(),e,o,i)},t.prototype.once=function(t,e,o){this.eventTarget.once(t.toString(),e,o)},t.prototype.dispatchEvent=function(t){this.eventTarget.dispatchEvent(t)},t.prototype.off=function(t,e,o){this.eventTarget.off(t.toString(),e,o)},t.prototype.hasEventListener=function(t){return this.eventTarget.hasEventListener(t.toString())},t.prototype.targetOff=function(t){this.eventTarget.targetOff(t)},t}();o.gEventMgr=i.inst,cc._RF.pop()},{}],EventName:[function(t,e,o){"use strict";cc._RF.push(e,"cbeb5B1/2hLsYY0DvZwARsp","EventName"),Object.defineProperty(o,"__esModule",{value:!0}),function(t){t[t.Cube_ADJUST_DONE=0]="Cube_ADJUST_DONE",t[t.DRAG_ADJUST_DONE=1]="DRAG_ADJUST_DONE",t[t.CUBE_BOX_DRAGING=2]="CUBE_BOX_DRAGING",t[t.CUBE_BOX_DRAG_INDEX=3]="CUBE_BOX_DRAG_INDEX",t[t.CUBE_BOX_DRAG_CANCEL=4]="CUBE_BOX_DRAG_CANCEL",t[t.CUBE_BOX_PLACE_DONE=5]="CUBE_BOX_PLACE_DONE",t[t.CUBE_BOX_SET_STATE_DONE=6]="CUBE_BOX_SET_STATE_DONE",t[t.GAME_START=7]="GAME_START",t[t.GAME_RESTART=8]="GAME_RESTART",t[t.EAT_COL=9]="EAT_COL",t[t.EAT_ROW=10]="EAT_ROW",t[t.KILL_DIRECTLY=11]="KILL_DIRECTLY",t[t.UPDATE_SCORE=12]="UPDATE_SCORE",t[t.UPDATE_COMBO=13]="UPDATE_COMBO",t[t.GAME_OVER=14]="GAME_OVER",t[t.ON_KILL=15]="ON_KILL",t[t.ROW_EFFECT=16]="ROW_EFFECT",t[t.COL_EFFECT=17]="COL_EFFECT",t[t.SHOW_TEXT=18]="SHOW_TEXT",t[t.UPDATE_PRE_SCORE=19]="UPDATE_PRE_SCORE",t[t.SHOW_OVER_LAYER=20]="SHOW_OVER_LAYER",t[t.CLEAR_CUBE_ROOT=21]="CLEAR_CUBE_ROOT",t[t.PREPARE_CUBE_BG=22]="PREPARE_CUBE_BG",t[t.PLAY_RAINBOW_EFFECT=23]="PLAY_RAINBOW_EFFECT",t[t.HIDE_HELP=24]="HIDE_HELP",t[t.UPDATE_RAINBOW_SCORE=25]="UPDATE_RAINBOW_SCORE",t[t.PLAY_KILL_EFFECT=26]="PLAY_KILL_EFFECT",t[t.PLAY_30_BGM=27]="PLAY_30_BGM",t[t.PLAY_LETSGO=28]="PLAY_LETSGO",t[t.PLAY_BIU=29]="PLAY_BIU",t[t.PLAY_TOUCH=30]="PLAY_TOUCH",t[t.PLAY_PLACE=31]="PLAY_PLACE",t[t.PLAY_TEXT=32]="PLAY_TEXT",t[t.PLAY_SCORE=33]="PLAY_SCORE",t[t.PLAY_OVER=34]="PLAY_OVER",t[t.PLAY_SPECIAL_A=35]="PLAY_SPECIAL_A",t[t.PLAY_SPECIAL_B=36]="PLAY_SPECIAL_B",t[t.PLAY_OVER_NO_PLACE=37]="PLAY_OVER_NO_PLACE",t[t.PLAY_OVER_TIME_UP=38]="PLAY_OVER_TIME_UP",t[t.PLAY_OVER_TAB=39]="PLAY_OVER_TAB",t[t.PLAY_LAY_FAIL=40]="PLAY_LAY_FAIL",t[t.PLAY_SPECIAL_B_BGM=41]="PLAY_SPECIAL_B_BGM",t[t.PLAY_SPECIAL_A_BGM=42]="PLAY_SPECIAL_A_BGM"}(o.GlobalEvent||(o.GlobalEvent={})),cc._RF.pop()},{}],GameFactory:[function(t,e,o){"use strict";cc._RF.push(e,"e1ae9PPwO5MhJFqc7MS46ep","GameFactory"),Object.defineProperty(o,"__esModule",{value:!0});var i,n=t("../exts/HashMap"),a=function(){function t(t,e,o){this._pool=[],this.poolHandlerComps=[],this.poolHandlerComps=o,this.template=t,this.initPool(e)}return t.prototype.initPool=function(t){for(var e=0;e<t;++e){var o=cc.instantiate(this.template);this.put(o)}},t.prototype.size=function(){return this._pool.length},t.prototype.clear=function(){for(var t=this._pool.length,e=0;e<t;++e)this._pool[e].destroy&&this._pool[e].destroy();this._pool.length=0},t.prototype.put=function(t){if(t&&-1===this._pool.indexOf(t)){if(t.removeFromParent(!1),this.poolHandlerComps)for(var e=0,o=this.poolHandlerComps;e<o.length;e++){var i=o[e],n=t.getComponent(i);n&&n.unuse&&n.unuse.apply(n)}else for(var a=0,r=t.getComponents(cc.Component);a<r.length;a++){(i=r[a])&&i.unuse&&i.unuse.apply(i)}this._pool.push(t)}},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=this._pool.length-1;o<0&&this.initPool(1),o=this._pool.length-1;var i=this._pool[o];if(this._pool.length=o,this.poolHandlerComps)for(var n=0,a=this.poolHandlerComps;n<a.length;n++){var r=a[n],s=i.getComponent(r);s&&s.reuse&&s.reuse.apply(s,arguments)}else for(var c=0,l=i.getComponents(cc.Component);c<l.length;c++){(r=l[c])&&r.reuse&&r.reuse.apply(r,arguments)}return i},t}();(function(t){t[t.INIT=0]="INIT",t[t.CUBE=4]="CUBE",t[t.CUBE_ROOT=8]="CUBE_ROOT",t[t.CUBE_BG=16]="CUBE_BG",t[t.DONE=28]="DONE"})(i||(i={}));var r=function(){function t(){this.step=i.INIT,this.CubeBgPool=new n.HashMap,this.CubePool=new n.HashMap,this.CubeRootPool=new n.HashMap}return Object.defineProperty(t,"inst",{get:function(){return this.ins?this.ins:this.ins=new t},enumerable:!0,configurable:!0}),t.prototype.init=function(t,e,o){this.doneCallback=t,this.nextStep(i.CUBE_BG),this.initCube(1,e),this.initCubeRoot(1,o)},t.prototype.nextStep=function(t){this.step|=t,console.log("Factory Step:"+i[t]),this.step>=i.DONE&&this.doneCallback&&this.doneCallback()},t.prototype.initCubeBg=function(t,e){var o=this;e?(o.CubeBgPool.add("CubeBg",new a(e,t)),o.nextStep(i.CUBE_BG)):cc.loader.loadRes("prefabs/CubeBg",cc.Prefab,function(e,n){e?console.error(e):(o.CubeBgPool.add("CubeBg",new a(n,t)),o.nextStep(i.CUBE_BG))})},t.prototype.getCubeBg=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.CubeBgPool.get("CubeBg").get(t)},t.prototype.putCubeBg=function(t){this.CubeBgPool.get("CubeBg").put(t)},t.prototype.initCube=function(t,e){var o=this;e?(o.CubePool.add("Cube",new a(e,t)),o.nextStep(i.CUBE)):cc.loader.loadRes("prefabs/Cube",cc.Prefab,function(e,n){e?console.error(e):(o.CubePool.add("Cube",new a(n,t)),o.nextStep(i.CUBE))})},t.prototype.getCube=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.CubePool.get("Cube").get(t)},t.prototype.putCube=function(t){this.CubePool.get("Cube").put(t)},t.prototype.initCubeRoot=function(t,e){var o=this;e?(o.CubeRootPool.add("CubeRoot",new a(e,t)),o.nextStep(i.CUBE_ROOT)):cc.loader.loadRes("prefabs/CubeRoot",cc.Prefab,function(e,n){e?console.error(e):(o.CubeRootPool.add("CubeRoot",new a(n,t)),o.nextStep(i.CUBE_ROOT))})},t.prototype.getCubeRoot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.CubeRootPool.get("CubeRoot").get(t)},t.prototype.putCubeRoot=function(t){this.CubeRootPool.get("CubeRoot").put(t)},t}();o.gFactory=r.inst,cc._RF.pop()},{"../exts/HashMap":"HashMap"}],GameMgr:[function(t,e,o){"use strict";cc._RF.push(e,"004c8nxswRJr5F7AfDn0nPo","GameMgr"),Object.defineProperty(o,"__esModule",{value:!0});var i,n=t("../Config/Config"),a=t("../Controller/EventManager"),r=t("../Controller/EventName"),s=t("../exts/HashMap"),c=t("../TableMgr"),l=t("../table");(function(t){t[t.TIME_OUT=0]="TIME_OUT",t[t.NO_PLACE=1]="NO_PLACE"})(i=o.OverType||(o.OverType={}));var h=function(){function t(){this.gamePanel=null,this.dragPanel=null,this.isEmitRainbowEvent=!1,this.data={totalScore:0,killCol:0,killRow:0,maxCombo:0,wildScore:0,fruitKill:{},fruitScore:{},comboScore:0,mostFruitID:0,bestFruitID:0,Wild_A:!1,Wild_B:!1},this.combo=0,this.time=n.Config.GameTime,this.canPlace=!1,this.placePos=cc.v2(0,0),this.canDrag=!0,this.isStart=!1,this.dragCount=0,this.curPlaceCount=0,this.availableCount=0,this.initAvailableCountInit=64,this.cubeCount=64,this.testCubeIndex=[],this.cubeIndex=[],this.preCubeIndex=[],this.curSelectFruitID=2e4,this.killDirectlyCount=0,this.shapeWeight=new s.HashMap,this.shapeTotalWeight=0,this.preScore=0,this.callShapeCount=0}return Object.defineProperty(t,"inst",{get:function(){return this.ins?this.ins:this.ins=new t},enumerable:!0,configurable:!0}),t.prototype.start=function(){var t=this;this.time=n.Config.GameTime,this.cubeCount=64,this.callShapeCount=0,this.availableCount=0,this.addPreScore(-this.preScore),this.initData();for(var e=0,o=this.testCubeIndex;e<o.length;e++){o[e]>0&&this.initAvailableCountInit--}for(var i=0;i<64;i++)this.testCubeIndex[i]>0?this.cubeIndex[i]=100:this.cubeIndex[i]=-1e4;this.preCubeIndex=this.cubeIndex.concat();var a=c.TableMgr.inst.getAll_ShapeWeight_Data();for(var r in a){var s=a[r];this.shapeWeight.add(parseInt(r),s.Weight)}this.shapeWeight.sort(function(t,e){return e.value-t.value}),this.shapeTotalWeight=0,this.shapeWeight.forEach(function(e,o){t.shapeTotalWeight+=o,t.shapeWeight.add(e,t.shapeTotalWeight)})},t.prototype.restart=function(){CMath.randomSeed=Math.random(),this.start(),a.gEventMgr.emit(r.GlobalEvent.GAME_RESTART)},t.prototype.getResultData=function(){return this.data},t.prototype.initData=function(){this.data.fruitKill={},this.data.fruitScore={},this.data.killCol=0,this.data.killRow=0,this.data.maxCombo=0,this.data.wildScore=0,this.data.comboScore=0,this.data.bestFruitID=0,this.data.mostFruitID=0,this.addScore(-this.data.totalScore)},t.prototype.addFruitKill=function(t){this.data.fruitKill[t]?this.data.fruitKill[t]++:this.data.fruitKill[t]=1},t.prototype.addFruitScore=function(t,e){var o=c.TableMgr.inst.getFruits(t);o?(this.data.fruitScore[t]?this.data.fruitScore[t]+=e:this.data.fruitScore[t]=e,o.Type!=l.Fruits_Type.ShuiGuo&&(this.data.wildScore+=e)):console.error(" error fruitID: "+t)},t.prototype.addOverCount=function(){this.cubeCount--,this.cubeCount<=0&&a.gEventMgr.emit(r.GlobalEvent.SHOW_OVER_LAYER)},t.prototype.addScore=function(t){this.data.totalScore+=t,this.combo>=2&&(this.data.comboScore+=t),a.gEventMgr.emit(r.GlobalEvent.UPDATE_SCORE)},t.prototype.getScore=function(){return parseInt(this.data.totalScore.toString())},t.prototype.addKillCol=function(t){this.data.killCol+=t},t.prototype.addKillRow=function(t){this.data.killRow+=t},t.prototype.addCombo=function(t){this.combo+=t,this.combo>this.data.maxCombo&&(this.data.maxCombo=this.combo),this.combo>0&&a.gEventMgr.emit(r.GlobalEvent.UPDATE_COMBO)},t.prototype.getCombo=function(){return this.combo},t.prototype.getShapes=function(){for(var t=[],e={},o=0;o<3;o++)for(var i={shape:[],shapeID:0},n=CMath.getRandom(0,1)*this.shapeTotalWeight,a=0,r=this.shapeWeight.values;a<r.length;a++){var s=r[a];if(n<=s.value){var h=c.TableMgr.inst.getShapeWeight(s.key).ShapeList.concat();if(this.callShapeCount<3)for(var u=0;u<h.length;u++)[1e4,10001,10002,10032,10033].indexOf(h[u])>=0&&(h.splice(u,1),u--);if(h.length<=0)continue;var d=CMath.getRandom(0,1)*(h.length-1);i.shapeID=h[Math.round(d)];var p=c.TableMgr.inst.getShape(i.shapeID);if(p.Type!=l.Shape_Type.PuTongFangKuai&&e[p.Type]){CMath.randomSeed=CMath.sharedSeed;continue}p.Type!=l.Shape_Type.PuTongFangKuai&&(e[p.Type]=!0),i.shape=p.Shape,!this.data.Wild_A&&(this.data.Wild_A=10032==p.ID),!this.data.Wild_B&&(this.data.Wild_B=10033==p.ID),t.push(i);break}}return this.callShapeCount++,t},t.prototype.getPreCubeIndex=function(){return this.preCubeIndex},t.prototype.getCubeIndex=function(){return this.cubeIndex},t.prototype.setCubeIndex=function(t,e){this.cubeIndex[t]=e},t.prototype.resetCubeIndex=function(t){this.testCubeIndex[t]>0?this.cubeIndex[t]=100:this.cubeIndex[t]=-1e4},t.prototype.setPreCubeIndex=function(t,e){this.preCubeIndex[t]=e},t.prototype.resetPreCubeIndex=function(t){this.preCubeIndex[t]=-1e4},t.prototype.check=function(){var t=this.checkRowCol(this.cubeIndex),e=t[0],o=t[1],i=c.TableMgr.inst.getFruits(this.curSelectFruitID)||{Name:"\u8fa3\u9e21",Type:100};if(console.log("colIndex:",o,", rowIndex:",e," curFruit:",i.Name),a.gEventMgr.emit(r.GlobalEvent.EAT_COL,o),a.gEventMgr.emit(r.GlobalEvent.EAT_ROW,e),this.addKillRow(e.length),this.addKillCol(o.length),e.length>0||o.length>0||this.killDirectlyCount>0?this.addCombo(1):this.addCombo(-this.combo),i&&i.Type==l.Fruits_Type.ShuiGuo&&(e.length>0||o.length>0)&&(a.gEventMgr.emit(r.GlobalEvent.COL_EFFECT,o),a.gEventMgr.emit(r.GlobalEvent.ROW_EFFECT,e)),e.length>0||o.length>0||this.combo>0){var n="good";n=this.combo>=3?"unbelievable":this.combo>1?e.length+o.length<2?"combo":"unbelievable":e.length+o.length<2?"good":e.length+o.length<3?"great":e.length+o.length<4?"amazing":"unbelievable",a.gEventMgr.emit(r.GlobalEvent.SHOW_TEXT,n)}a.gEventMgr.emit(r.GlobalEvent.KILL_DIRECTLY)},t.prototype.checkRowCol=function(t){for(var e=[],o=[],i=0;i<n.Config.Grid.x;i++){for(var a=0,r=0,s=0;s<n.Config.Grid.y;s++)a+=t[s+i*n.Config.Grid.x],r+=t[i+s*n.Config.Grid.y];r>0&&e.push(i),a>0&&o.push(i)}return[o,e]},t.prototype.bindGamePanel=function(t){this.gamePanel=t},t.prototype.gameOver=function(t){console.log("game over:",i[t]),this.isStart=!1;var e=0;for(var o in this.data.fruitScore)e<=this.data.fruitScore[o]&&(e=this.data.fruitScore[o],this.data.mostFruitID=parseInt(o));var n=0;for(var o in this.data.fruitKill)n<=this.data.fruitKill[o]&&(n=this.data.fruitKill[o],this.data.bestFruitID=parseInt(o));a.gEventMgr.emit(r.GlobalEvent.GAME_OVER,t)},t.prototype.addAvailableCount=function(t){this.availableCount+=t,0==this.isStart&&this.availableCount>=this.initAvailableCountInit&&a.gEventMgr.emit(r.GlobalEvent.GAME_START)},t.prototype.getAvailableCount=function(){return this.availableCount},t.prototype.update=function(t){this.isStart&&(this.time>30&&this.time-t<=30&&a.gEventMgr.emit(r.GlobalEvent.PLAY_30_BGM),this.time-=t,this.time<=0&&(this.time=0,this.isStart=!1,this.gameOver(i.TIME_OUT),a.gEventMgr.emit(r.GlobalEvent.PLAY_OVER_TIME_UP)))},t.prototype.getTime=function(){return this.time},t.prototype.addPreScore=function(t){this.preScore+=t,a.gEventMgr.emit(r.GlobalEvent.UPDATE_PRE_SCORE)},t.prototype.resetPreScore=function(){this.preScore=0,a.gEventMgr.emit(r.GlobalEvent.UPDATE_PRE_SCORE)},t.prototype.getPreScore=function(){return this.preScore},t}();o.Game=h.inst,cc._RF.pop()},{"../Config/Config":"Config","../Controller/EventManager":"EventManager","../Controller/EventName":"EventName","../TableMgr":"TableMgr","../exts/HashMap":"HashMap","../table":"table"}],GameScene:[function(t,e,o){"use strict";cc._RF.push(e,"e4483cGN9dC8JpeMWEDWaJe","GameScene"),Object.defineProperty(o,"__esModule",{value:!0});var i,n=t("../Controller/GameFactory"),a=t("../Controller/EventManager"),r=t("../Controller/EventName"),s=t("../Controller/AudioController"),c=t("./GameMgr"),l=t("./CubeBg"),h=t("../Config/Config"),u=t("./CubeRoot"),d=t("../TableMgr"),p=t("../table"),g=t("../Controller/LogHandler"),f=t("../exts/GameSignal"),v=cc._decorator,E=v.ccclass,_=v.property;(function(t){t[t.READY=0]="READY",t[t.PREFABS=2]="PREFABS",t[t.AUDIO=16]="AUDIO",t[t.CELER=32]="CELER",t[t.GUIDE=64]="GUIDE",t[t.DONE=98]="DONE"})(i=o.LOAD_STEP||(o.LOAD_STEP={}));var b=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.GamePanel=null,e.DragPanel=null,e.Score=null,e.TimeLabel=null,e.TimeProgress=null,e.ShowText=null,e.FloatScore=null,e.Cube=null,e.CubeRoot=null,e.RainbowEffect=null,e.RainbowScore=null,e.RainbowScoreBg=null,e.Next=null,e.Skip=null,e.ButtonNode=null,e.Close=null,e.NextSprite=null,e._step=i.READY,e.Tip=null,e.Lodinging=null,e.GuidePage=null,e.HelpButton=null,e.VolumeButton=null,e.MenuButton=null,e.PauseLayer=null,e.ButtonsAtlas=null,e.adjustCount=0,e.floatScoreMoveSpeed=600,e.scorePos=cc.v2(350,95),e.score=0,e.canUpdateScore=!1,e.rainbowEffectArray=[],e.rainbowScoreArray=[],e.isStart=!1,e}return __extends(e,t),e.prototype.onLoad=function(){var t=this;CELER_X&&g.LogHandler.inst.initLog(celerSDK.log.bind(celerSDK)),g.LogHandler.inst.log(" game scene on load"),this.RainbowEffect.node.opacity=0,this.RainbowScore.string="",this.RainbowScoreBg.string="",cc.Node.maxTouchNum=100,cc.Node.touchNum=0,c.Game.dragPanel=this.DragPanel,this.updateSoundButton(),this.VolumeButton.on(cc.Node.EventType.TOUCH_END,function(){cc.audioEngine.getEffectsVolume()>0?(cc.audioEngine.setEffectsVolume(0),cc.audioEngine.setMusicVolume(0)):(cc.audioEngine.setEffectsVolume(1),cc.audioEngine.setMusicVolume(1)),t.updateSoundButton()},this),this.ButtonNode.getChildByName("btn_skip").active=!0,this.HelpButton.on(cc.Node.EventType.TOUCH_END,function(){console.log(" show guide page"),t.GuidePage.node.active=!0,t.GuidePage.node.runAction(cc.scaleTo(.1,1)),t.ButtonNode.active=!0,t.GuidePage.scrollToPage(0,0)},this),this.Next.node.on(cc.Node.EventType.TOUCH_START,this.nextPage,this),this.MenuButton.on(cc.Node.EventType.TOUCH_END,function(){f.ShowPauseLayerSignal.inst.dispatchOne(!0)},this),this.GuidePage.node.active=!1,this.ButtonNode.active=!1,this.GuidePage.node.on("scroll-ended",this.updateButton,this),this.updateButton(),CELER_X&&celerSDK.ready(),CMath.randomSeed=Math.random();var e=this;CELER_X&&celerSDK.onStart(function(){e.celerStart()}.bind(this)),CELER_X&&celerSDK.provideScore(function(){return c.Game.getScore()}),!CELER_X&&this.celerStart(),cc.game.setFrameRate(h.Config.FPS),cc.loader.loadResDir("Textures/Fruits/"),cc.loader.loadResDir("sounds"),cc.loader.loadRes("prefabs/OverLayer"),this.Score.string="0",this.FloatScore.string="",this.Tip.node.active=!1,s.gAudio.init(function(){}.bind(this)),d.TableMgr.inst.startLoad("json/",function(){n.gFactory.init(function(){this.nextStep(i.PREFABS)}.bind(t),t.Cube,t.CubeRoot)}),this.initEvent(),c.Game.bindGamePanel(this.GamePanel),this.Score.string="0",this.TimeLabel.string="3/00",this.DragPanel.removeAllChildren()},e.prototype.hideHelp=function(){0!=this.GuidePage.node.active&&(this.GuidePage.node.active=!1,this.ButtonNode.active=!1)},e.prototype.showHelp=function(){f.ShowPauseLayerSignal.inst.dispatchOne(!0),this.GuidePage.scrollToPage(0,0),this.updateButton()},e.prototype.updateSoundButton=function(){cc.audioEngine.getEffectsVolume()>0?this.VolumeButton.getComponent(cc.Sprite).spriteFrame=this.ButtonsAtlas.getSpriteFrame("btn_sound"):this.VolumeButton.getComponent(cc.Sprite).spriteFrame=this.ButtonsAtlas.getSpriteFrame("btn_soundclose")},e.prototype.nextPage=function(){var t=this;if(this.GuidePage.getCurrentPageIndex()>=this.GuidePage.content.childrenCount-1)this.GuidePage.node.runAction(cc.sequence(cc.scaleTo(.2,0),cc.callFunc(function(){t.GuidePage.node.active=!1,t.ButtonNode.active=!1,cc.Node.maxTouchNum=1,cc.Node.touchNum=0},this))),this.nextStep(i.GUIDE);else{var e=(this.GuidePage.getCurrentPageIndex()+1)%this.GuidePage.content.childrenCount;this.GuidePage.setCurrentPageIndex(e),this.updateButton()}},e.prototype.forwardPage=function(){if(this.GuidePage.getCurrentPageIndex()<=0);else{var t=(this.GuidePage.getCurrentPageIndex()-1)%this.GuidePage.content.childrenCount;this.GuidePage.setCurrentPageIndex(t),this.updateButton()}},e.prototype.updateButton=function(){this.GuidePage.getCurrentPageIndex()>=this.GuidePage.content.childrenCount-1?(this.Skip.node.active=!0,this.Next.node.active=!1):(this.Skip.node.active=!1,this.Next.node.active=!0)},e.prototype.celerStart=function(){var t=CELER_X?celerSDK.getMatch():{matchId:"string",sharedRandomSeed:1,difficultyLevel:1,shouldLaunchTutorial:!0};c.Game.MatchInfo=t,t&&t.sharedRandomSeed?(CMath.randomSeed=t.sharedRandomSeed,CMath.sharedSeed=t.sharedRandomSeed):CMath.randomSeed=Math.random(),g.LogHandler.inst.log(" celerx.onStart invoked "," matchid:",c.Game.MatchInfo.matchId,", seed:",c.Game.MatchInfo.sharedRandomSeed),this.nextStep(i.CELER),t&&t.shouldLaunchTutorial?(this.GuidePage.node.active=!0,this.ButtonNode.active=!0):(cc.Node.maxTouchNum=1,cc.Node.touchNum=0,this.GuidePage.node.active=!1,this.ButtonNode.active=!1,this.nextStep(i.GUIDE))},e.prototype.nextStep=function(t){this._step|=t,console.log("CUR STEP:"+i[t]+", total: "+this._step),this._step>=i.DONE&&!this.isStart&&(this.Lodinging.node.active=!1,this.GamePanel.scale=1,c.Game.start(),a.gEventMgr.emit(r.GlobalEvent.PREPARE_CUBE_BG),this.isStart=!0)},e.prototype.initGamePanel=function(){console.log("   gEventMgr.emit(GlobalEvent.PREPARE_CUBE_BG)  "),a.gEventMgr.emit(r.GlobalEvent.PREPARE_CUBE_BG)},e.prototype.initEvent=function(){var t=this;a.gEventMgr.targetOff(this),a.gEventMgr.on(r.GlobalEvent.Cube_ADJUST_DONE,this.adjustDragPanel,this),a.gEventMgr.on(r.GlobalEvent.CUBE_BOX_DRAGING,this.onBoxDrag,this),a.gEventMgr.on(r.GlobalEvent.CUBE_BOX_SET_STATE_DONE,this.onCubePlaceDone,this),a.gEventMgr.on(r.GlobalEvent.HIDE_HELP,function(){t.GuidePage.node.runAction(cc.sequence(cc.scaleTo(.2,0),cc.callFunc(function(){t.GuidePage.node.active=!1,t.ButtonNode.active=!1,cc.Node.maxTouchNum=1,cc.Node.touchNum=0},t))),t.nextStep(i.GUIDE)},this),a.gEventMgr.on(r.GlobalEvent.UPDATE_SCORE,this.updateScore,this),a.gEventMgr.once(r.GlobalEvent.ON_KILL,this.onKill,this),a.gEventMgr.on(r.GlobalEvent.COL_EFFECT,this.colEffect,this),a.gEventMgr.on(r.GlobalEvent.ROW_EFFECT,this.rowEffect,this),a.gEventMgr.on(r.GlobalEvent.SHOW_TEXT,this.showText,this),a.gEventMgr.on(r.GlobalEvent.GAME_START,this.gameStart,this),a.gEventMgr.once(r.GlobalEvent.SHOW_OVER_LAYER,this.gameOver,this),a.gEventMgr.on(r.GlobalEvent.GAME_RESTART,this.initGamePanel,this),a.gEventMgr.on(r.GlobalEvent.PLAY_RAINBOW_EFFECT,function(e){var o=t.RainbowEffect.getAnimationState("rainbow"),i=t.RainbowEffect.getAnimationState("hourse");o.isPlaying||i.isPlaying?t.rainbowEffectArray.push(e):t.RainbowEffect.play(e)},this),a.gEventMgr.on(r.GlobalEvent.UPDATE_RAINBOW_SCORE,function(e){var o=t.RainbowEffect.getAnimationState("rainbow"),i=t.RainbowEffect.getAnimationState("hourse");o.isPlaying||i.isPlaying?t.rainbowScoreArray[Math.max(t.rainbowEffectArray.length-1,0)]=e:(t.RainbowScoreBg.string=e,t.RainbowScore.string=t.RainbowScoreBg.string)},this),this.RainbowEffect.on(cc.Animation.EventType.FINISHED,this.onShowTextFinish,this),this.ShowText.on(cc.Animation.EventType.FINISHED,this.onShowTextFinish,this)},e.prototype.onShowTextFinish=function(t,e){if(e&&("letsgo"==e.name&&(c.Game.isStart=!0),("rainbow"==e.name||"hourse"==e.name)&&(this.RainbowScoreBg.string="",this.RainbowScore.string=this.RainbowScoreBg.string,this.rainbowEffectArray.length>0))){var o=this.rainbowEffectArray.shift(),i=this.rainbowScoreArray.shift();this.RainbowScore.string=i||"",this.RainbowScoreBg.string=this.RainbowScore.string,this.RainbowEffect.play(o)}},e.prototype.gameOver=function(){var t=this;this.FloatScore.string="",f.ShowPauseLayerSignal.inst.dispatchTwo(!1,!0),console.log(" star load result layer.."),cc.loader.loadRes("prefabs/OverLayer",cc.Prefab,function(e,o){if(e)console.error(" submit score load over layer failed:",e),CELER_X&&celerSDK.submitScore(c.Game.getResultData().totalScore);else{if(t.Tip.node.active=!1,t.Tip.node.runAction(cc.repeatForever(cc.sequence(cc.fadeTo(.1,0),cc.fadeTo(.2,255)))),t.node.getChildByName("OverLayer"))return;t.node.addChild(cc.instantiate(o))}})},e.prototype.showText=function(t){a.gEventMgr.emit(r.GlobalEvent.PLAY_TEXT,t),this.ShowText.play(t)},e.prototype.rowEffect=function(t){t.length>0&&a.gEventMgr.emit(r.GlobalEvent.PLAY_KILL_EFFECT)},e.prototype.colEffect=function(t){t.length>0&&a.gEventMgr.emit(r.GlobalEvent.PLAY_KILL_EFFECT)},e.prototype.onKill=function(){},e.prototype.onAnimationFinish=function(t,e){},e.prototype.updateScore=function(){},e.prototype.onBoxDrag=function(t,e,o,i,n){var s=e[0],l=e[1],h=t.add(cc.v2(-s.width/2+l.width/2,s.height/2-l.height/2));this.floatScorePos=cc.v2(t.x,t.y+80),c.Game.canPlace=this.checkCanPlace(t,h,o,i,n,!0),c.Game.canPlace?this.updateFloatScore():(this.FloatScore.string="",a.gEventMgr.emit(r.GlobalEvent.CUBE_BOX_DRAG_CANCEL))},e.prototype.updateFloatScore=function(){c.Game.getPreScore()<=0?this.FloatScore.string="":(this.FloatScore.node.scale=1,this.FloatScore.string=c.Game.getPreScore().toString())},e.prototype.checkCanPlace=function(t,e,o,i,n,s){void 0===s&&(s=!1);for(var u=i[0],g=i[1],f=i[2],v=null,E=null,_=0,b=this.GamePanel.children;_<b.length;_++){var m=b[_];v?CMath.Distance(v.position,e)>=CMath.Distance(m.position,e)&&(v=m):CMath.Distance(m.position,e)<=m.width/2*Math.SQRT2&&(v=m)}if(!v)return!1;var y=v.getComponent(l.default).getIndex(),S=y+(g-1)*h.Config.Grid.x+f;if(S%h.Config.Grid.x>=y%h.Config.Grid.x&&(E=this.GamePanel.children[S]),E){var C=v.getComponent(l.default);if(C){for(var P=[],D=0,A=o;D<A.length;D++){var T=A[D],G=C.getIndex()+T;G<0||G>63||P.push(G)}if(P.length>0&&o.length==P.length){for(var M=null,L=0,R=this.GamePanel.children;L<R.length;L++){if((m=R[L]).getComponent(l.default).getIndex()==P[P.length-1]&&(M=m),!m.getComponent(l.default).isAvailable()&&P.indexOf(m.getComponent(l.default).getIndex())>=0)return!1}if(M&&E.getComponent(l.default).getIndex()%h.Config.Grid.x-M.getComponent(l.default).getIndex()%h.Config.Grid.x==u){if(s){var I=d.TableMgr.inst.getShape(n),O=[],F=[];if(I&&I.Type==p.Shape_Type.TeShuDaoJu){var x=P.length;if(I.RowKillNumber&&I.RowKillNumber>0)for(var B=0;B<x;B++)for(var N=P[B]-P[B]%8,w=N+7,U=N;U<=w;U++)P.indexOf(U)<0&&P.push(U);if(I.ColKillNumber&&I.ColKillNumber>0)for(B=0;B<x;B++){for(var Y=P[B]+8;Y<=63;)P.indexOf(Y)<0&&P.push(Y),Y+=8;for(var k=P[B]-8;k>=0;)P.indexOf(k)<0&&P.push(k),k-=8}if(I.GridKill&&I.GridKill.length>0)for(var H=0,W=I.GridKill;H<W.length;H++){var K=W[H].split(","),j=parseInt(K[0]),V=parseInt(K[1]);for(B=0;B<x;B++){O.indexOf(P[B])<0&&O.push(P[B]),F.indexOf(P[B])<0&&F.push(P[B]),(T=P[B]+8*V+j)%8-P[B]%8==j&&(T>63||T<0||(P.indexOf(T)<0&&P.push(T),O.indexOf(T)<0&&O.push(T)))}}}c.Game.dragCount=P.length,a.gEventMgr.emit(r.GlobalEvent.CUBE_BOX_DRAG_INDEX,P,n,O,F),c.Game.canPlace=!0,c.Game.placePos=this.GamePanel.convertToWorldSpaceAR(v.position.sub(e).add(t))}return!0}return!1}return!1}return!1}return!1},e.prototype.adjustDragPanel=function(){if(this.adjustCount++,this.adjustCount>=3){this.adjustCount=0;var t=this.DragPanel.children[1],e=this.DragPanel.children[0],o=this.DragPanel.children[2];t.x=0;var i=this.DragPanel.width/2;e.x=.6*i,o.x=.6*-i,a.gEventMgr.emit(r.GlobalEvent.DRAG_ADJUST_DONE),this.checkIsGameOver()}},e.prototype.genNewDragShape=function(t){t.length<3&&console.error(" \u65b9\u5757\u751f\u6210\u4e2a\u6570\u4e0d\u8db3!!!!!!!!!!!!!!!!!!!");for(var e=0,o=t;e<o.length;e++){var i=o[e];this.DragPanel.addChild(n.gFactory.getCubeRoot(i))}},e.prototype.onCubePlaceDone=function(){this.FloatScore.node.runAction(cc.sequence(cc.scaleTo(.1,1.5),cc.moveTo(.2,this.scorePos),cc.callFunc(this.startUpdateScore.bind(this),this))),c.Game.check(),this.DragPanel.childrenCount<=0?this.genNewDragShape(c.Game.getShapes()):this.checkIsGameOver()},e.prototype.checkIsGameOver=function(){for(var t=!0,e=0,o=this.DragPanel.children;e<o.length;e++)for(var i=o[e].getComponent(u.default),n=0,s=this.GamePanel.children;n<s.length;n++){var l=s[n];if(!t)break;if(this.checkCanPlace(l.position,l.position,i.getShape(),i.getInfo(),i.getShapeID())){t=!1;break}}t&&(c.Game.gameOver(c.OverType.NO_PLACE),a.gEventMgr.emit(r.GlobalEvent.PLAY_OVER_NO_PLACE))},e.prototype.gameStart=function(){var t=this;this.ShowText.play("letsgo"),a.gEventMgr.emit(r.GlobalEvent.PLAY_LETSGO),this.onCubePlaceDone(),CELER_X?(celerSDK.onPause(function(){0!=c.Game.isStart&&(console.log(" game on background"),t.showHelp())}),celerSDK.onResume(function(){console.log(" game on forground")})):(cc.game.on(cc.game.EVENT_HIDE,function(){0!=c.Game.isStart&&(console.log(" game on background"),t.showHelp())},this),cc.game.on(cc.game.EVENT_SHOW,function(){console.log(" game on forground")},this))},e.prototype.startUpdateScore=function(){this.canUpdateScore=!0,this.FloatScore.string="",this.FloatScore.node.scale=1,this.updateFloatScore()},e.prototype.update=function(t){if(this.ButtonNode.active&&this.updateButton(),0==this.PauseLayer.active&&0==this.GuidePage.node.active&&(c.Game.update(t),this.updateTime()),this.floatScorePos&&this.FloatScore.node.getNumberOfRunningActions()<=0){var e=this.floatScoreMoveSpeed*t;CMath.Distance(this.floatScorePos,this.FloatScore.node.position)>200&&(this.FloatScore.node.x=this.floatScorePos.x,this.FloatScore.node.y=this.floatScorePos.y),this.FloatScore.node.x>this.floatScorePos.x?this.FloatScore.node.x-=e:this.FloatScore.node.x<this.floatScorePos.x&&(this.FloatScore.node.x+=e),this.FloatScore.node.y>this.floatScorePos.y?this.FloatScore.node.y-=e:this.FloatScore.node.y<this.floatScorePos.y&&(this.FloatScore.node.y+=e),Math.abs(this.FloatScore.node.x-this.floatScorePos.x)<10&&(this.FloatScore.node.x=this.floatScorePos.x),Math.abs(this.FloatScore.node.y-this.floatScorePos.y)<10&&(this.FloatScore.node.y=this.floatScorePos.y)}this.canUpdateScore&&(this.score<c.Game.getScore()?this.score+=3:(this.canUpdateScore=!1,this.score=c.Game.getScore()),this.Score.string=this.score.toString())},e.prototype.updateTime=function(){this.TimeLabel.string=CMath.TimeFormat(c.Game.getTime()),this.TimeProgress.progress=c.Game.getTime()/h.Config.GameTime},__decorate([_(cc.Node)],e.prototype,"GamePanel",void 0),__decorate([_(cc.Node)],e.prototype,"DragPanel",void 0),__decorate([_(cc.Label)],e.prototype,"Score",void 0),__decorate([_(cc.Label)],e.prototype,"TimeLabel",void 0),__decorate([_(cc.ProgressBar)],e.prototype,"TimeProgress",void 0),__decorate([_(cc.Animation)],e.prototype,"ShowText",void 0),__decorate([_(cc.Label)],e.prototype,"FloatScore",void 0),__decorate([_(cc.Prefab)],e.prototype,"Cube",void 0),__decorate([_(cc.Prefab)],e.prototype,"CubeRoot",void 0),__decorate([_(cc.Animation)],e.prototype,"RainbowEffect",void 0),__decorate([_(cc.Label)],e.prototype,"RainbowScore",void 0),__decorate([_(cc.Label)],e.prototype,"RainbowScoreBg",void 0),__decorate([_(cc.Button)],e.prototype,"Next",void 0),__decorate([_(cc.Button)],e.prototype,"Skip",void 0),__decorate([_(cc.Node)],e.prototype,"ButtonNode",void 0),__decorate([_(cc.SpriteFrame)],e.prototype,"Close",void 0),__decorate([_(cc.SpriteFrame)],e.prototype,"NextSprite",void 0),__decorate([_(cc.Label)],e.prototype,"Tip",void 0),__decorate([_(cc.Animation)],e.prototype,"Lodinging",void 0),__decorate([_(cc.PageView)],e.prototype,"GuidePage",void 0),__decorate([_(cc.Node)],e.prototype,"HelpButton",void 0),__decorate([_(cc.Node)],e.prototype,"VolumeButton",void 0),__decorate([_(cc.Node)],e.prototype,"MenuButton",void 0),__decorate([_(cc.Node)],e.prototype,"PauseLayer",void 0),__decorate([_(cc.SpriteAtlas)],e.prototype,"ButtonsAtlas",void 0),e=__decorate([E],e)}(cc.Component);o.default=b,cc._RF.pop()},{"../Config/Config":"Config","../Controller/AudioController":"AudioController","../Controller/EventManager":"EventManager","../Controller/EventName":"EventName","../Controller/GameFactory":"GameFactory","../Controller/LogHandler":"LogHandler","../TableMgr":"TableMgr","../exts/GameSignal":"GameSignal","../table":"table","./CubeBg":"CubeBg","./CubeRoot":"CubeRoot","./GameMgr":"GameMgr"}],GameSignal:[function(t,e,o){"use strict";cc._RF.push(e,"2dafeG5k3pBqLjot2HjWBbA","GameSignal"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(t("./Signal").BaseSignal);o.ShowPauseLayerSignal=i,cc._RF.pop()},{"./Signal":"Signal"}],HashMap:[function(t,e,o){"use strict";cc._RF.push(e,"65ec9+rOt5Kur9SeJbgRgUM","HashMap"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){this._list=new Array,this.clear()}return t.prototype.getIndexByKey=function(t){for(var e=this._list.length,o=0;o<e;o++){if(this._list[o].key==t)return o}return-1},Object.defineProperty(t.prototype,"keys",{get:function(){for(var t=new Array,e=0,o=this._list;e<o.length;e++){var i=o[e];i&&t.push(i.key)}return t},enumerable:!0,configurable:!0}),t.prototype.add=function(t,e){var o={key:t,value:e},i=this.getIndexByKey(t);-1!=i?this._list[i]=o:this._list.push(o)},Object.defineProperty(t.prototype,"values",{get:function(){return this._list},enumerable:!0,configurable:!0}),t.prototype.remove=function(t){var e=this.getIndexByKey(t);if(-1!=e){var o=this._list[e];return this._list.splice(e,1),o}return null},t.prototype.has=function(t){return-1!=this.getIndexByKey(t)},t.prototype.get=function(t){var e=this.getIndexByKey(t);return-1!=e?this._list[e].value:null},Object.defineProperty(t.prototype,"length",{get:function(){return this._list.length},enumerable:!0,configurable:!0}),t.prototype.sort=function(t){this._list.sort(t)},t.prototype.forEachKeyValue=function(t){for(var e=this._list.length,o=0;o<e;o++){t(this._list[o])}},t.prototype.forEach=function(t){for(var e=this._list.length,o=0;o<e;o++){var i=this._list[o];t(i.key,i.value)}},t.prototype.clear=function(){this._list=[]},t}();o.HashMap=i,cc._RF.pop()},{}],LogHandler:[function(t,e,o){"use strict";cc._RF.push(e,"0eba8qm4JpC2rooxLsPFZIk","LogHandler"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){if(this.logMsg=null,this.frameTimes=0,this.now=0,this.Frame=20,this.totalFrames=0,this.startTime=0,window.addEventListener)for(var e=0,o=t.LISTENNING_EVENTS;e<o.length;e++){var i=o[e],n="trigger"+i.charAt(0).toLocaleUpperCase()+i.substring(1);this[n]&&"function"==typeof this[n]&&window.addEventListener(i,this[n].bind(this))}}return Object.defineProperty(t,"inst",{get:function(){return this.ins?this.ins:this.ins=new t},enumerable:!0,configurable:!0}),t.prototype.dumpFrameInfo=function(){var t=(Date.now()-this.startTime)/1e3,e=t/this.totalFrames;this.addLog(" total frames:",this.totalFrames," ,total cost time:",t+"s"," , per frame cost time ave:"+e+"s"),this.sendLog()},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addLog.apply(this,t),this.sendLog()},t.prototype.initLog=function(e){var o=this;cc.director.once(cc.Director.EVENT_AFTER_SCENE_LAUNCH,function(){o.frameTimes=0,o.now=Date.now(),o.startTime=Date.now()},this),cc.director.on(cc.Director.EVENT_AFTER_DRAW,function(){o.frameTimes++,o.totalFrames++,o.frameTimes>=o.Frame&&(o.frameTimes=0,o.now=Date.now())},this),this.logFunc=e,console.error=function(){for(var e,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];(e=t.inst).log.apply(e,["[ERROR]"].concat(o))},console.warn=function(){for(var e,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];(e=t.inst).log.apply(e,["[WARN]"].concat(o))},console.log=function(){for(var e,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];(e=t.inst).log.apply(e,["[INFO]"].concat(o))}},t.prototype.formatLogArguments=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var o="",i=0;i<arguments.length;i++){var n=typeof arguments[i];"string"==n||"number"==n?o+=" "+arguments[i]:"object"==n?o+=" "+JSON.stringify(arguments[i]):"boolean"==n&&arguments[i].toString&&(o+=arguments[i].toString())}return o},t.prototype.addLog=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];null==this.logMsg&&(this.logMsg={});var i=this.formatLogArguments(e),n=this.getFullTime(new Date);this.logMsg[n]=t.VERSION+i},t.prototype.getFullTime=function(t){var e="";e+=t.getFullYear();var o=t.getMonth()+1;e+="-"+(o>=10?o:"0"+o);var i=t.getDate();e+="-"+(i>=10?i:"0"+i);var n=t.getHours();e+="  "+(n>=10?n:"0"+n);var a=t.getMinutes();e+=":"+(a>=10?a:"0"+a);var r=t.getSeconds();return e+=":"+(r>=10?r:"0"+r)},t.prototype.sendLog=function(){this.logFunc&&null!=this.logMsg&&(this.logFunc(JSON.stringify(this.logMsg)),this.logMsg=null)},t.prototype.triggerClose=function(t){this.addLog("triggerClose"),this.sendLog()},t.prototype.triggerLoad=function(t){this.addLog("triggerLoad"),this.sendLog()},t.prototype.triggerUnload=function(t){this.addLog("triggerUnload"),this.sendLog()},t.prototype.triggerOnunload=function(t){this.addLog("triggerUnload"),this.sendLog()},t.prototype.triggerError=function(t){this.addLog("triggerError"),this.addLog(t.message),this.sendLog()},t.prototype.triggerFocus=function(t){this.addLog("triggerFocus"),this.sendLog()},t.prototype.triggerBlur=function(t){this.addLog("triggerBlur"),this.sendLog()},t.prototype.triggerAbort=function(t){this.addLog("triggerAbort"),this.sendLog()},t.prototype.triggerSuspend=function(t){this.addLog("triggerSuspend"),this.sendLog()},t.prototype.beforeunload=function(t){this.addLog("beforeunload"),this.sendLog()},t.VERSION="Fruit Punch version 84: ",t.LISTENNING_EVENTS=["error"],t}();o.LogHandler=i,cc._RF.pop()},{}],OverLayer:[function(t,e,o){"use strict";cc._RF.push(e,"8f707WQwS1B94AJLjJYdvIF","OverLayer"),Object.defineProperty(o,"__esModule",{value:!0});var i,n=t("./GameMgr"),a=t("../TableMgr"),r=t("../Controller/EventManager"),s=t("../Controller/EventName"),c=cc._decorator,l=c.ccclass,h=c.property;(function(t){t[t.ready=0]="ready",t[t.total=2]="total",t[t.line=4]="line",t[t.combo=8]="combo",t[t.best=16]="best",t[t.wild=32]="wild",t[t.most=64]="most",t[t.done=124]="done",t[t.submit=126]="submit"})(i||(i={}));var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.TotalScoreLabel=null,e.totalScore=0,e.showTotal=!1,e.LineScoreLabel=null,e.lineScore=0,e.showLine=!1,e.ComboScoreLabel=null,e.comboScore=0,e.showCombo=!1,e.BestScoreLabel=null,e.bestScore=0,e.showBest=!1,e.WildScoreLabel=null,e.wildScore=0,e.showWild=!1,e.MostScoreLabel=null,e.mostScore=0,e.showMost=!1,e.BestIcon=null,e.Wild_A=null,e.Wild_B=null,e.MostIcon=null,e.Submit=null,e.step=i.ready,e.scoreAdd=10,e.alreadySumbit=!1,e.done=!1,e}return __extends(e,t),e.prototype.onLoad=function(){var t=this;this.totalScore=0,this.TotalScoreLabel.string="0",this.lineScore=0,this.LineScoreLabel.string="0",this.comboScore=0,this.ComboScoreLabel.string="0",this.wildScore=0,this.WildScoreLabel.string="0",this.bestScore=0,this.BestScoreLabel.string="0",this.mostScore=0,this.MostScoreLabel.string="0",this.BestIcon.node.active=!1,this.Wild_A.node.active=!1,this.Wild_B.node.active=!1,this.MostIcon.node.active=!1,this.showBest=!1,this.showCombo=!1,this.showLine=!1,this.showMost=!1,this.showWild=!1,this.showTotal=!1,this.resultData=n.Game.getResultData(),this.scoreAdd=Math.max(10,Math.floor(this.resultData.totalScore/100)),this.Submit.node.scale=0,this.step=i.ready,this.Submit.node.on(cc.Node.EventType.TOUCH_END,function(){t.alreadySumbit||(t.alreadySumbit=!0,console.error(" submit score by click, matchid:",n.Game.MatchInfo.matchId,",seed:",n.Game.MatchInfo.sharedRandomSeed),CELER_X&&celerSDK.submitScore(t.resultData.totalScore))},this),r.gEventMgr.emit(s.GlobalEvent.CLEAR_CUBE_ROOT),r.gEventMgr.emit(s.GlobalEvent.PLAY_OVER)},e.prototype.start=function(){},e.prototype.update=function(t){this.showLine&&(this.lineScore<this.resultData.killCol+this.resultData.killRow?this.lineScore+=this.scoreAdd:(this.lineScore=this.resultData.killCol+this.resultData.killRow,this.next(i.line),this.showLine=!1),this.LineScoreLabel.string=this.lineScore.toString()),this.showCombo&&(this.comboScore<this.resultData.comboScore?this.comboScore+=this.scoreAdd:(this.comboScore=this.resultData.comboScore,this.next(i.combo),this.showCombo=!1),this.ComboScoreLabel.string=this.comboScore.toString()),this.showBest&&(0!=this.resultData.bestFruitID&&this.resultData.fruitScore[this.resultData.bestFruitID]&&this.bestScore<this.resultData.fruitScore[this.resultData.bestFruitID]?this.bestScore+=this.scoreAdd:(this.bestScore=this.resultData.fruitScore[this.resultData.bestFruitID]||0,this.next(i.best),this.showBest=!1),this.BestScoreLabel.string=this.bestScore.toString()),this.showWild&&(this.wildScore<this.resultData.wildScore?this.wildScore+=this.scoreAdd:(this.wildScore=this.resultData.wildScore,this.next(i.wild),this.showWild=!1),this.WildScoreLabel.string=this.wildScore.toString()),this.showMost&&(0!=this.resultData.mostFruitID&&this.resultData.fruitScore[this.resultData.mostFruitID]&&this.mostScore<this.resultData.fruitScore[this.resultData.mostFruitID]?this.mostScore+=this.scoreAdd:(this.mostScore=this.resultData.fruitScore[this.resultData.mostFruitID]||0,this.next(i.most),this.showMost=!1),this.MostScoreLabel.string=this.mostScore.toString()),this.showTotal&&(this.totalScore<this.resultData.totalScore?this.totalScore+=this.scoreAdd:(this.totalScore=this.resultData.totalScore,this.next(i.total),this.showTotal=!1,r.gEventMgr.emit(s.GlobalEvent.PLAY_SCORE,!1)),this.TotalScoreLabel.string=this.totalScore.toString())},e.prototype.next=function(t){var e=this;this.step|=t,this.step>=i.done&&this.step<i.submit&&(this.showTotal=!0,this.resultData.totalScore>0&&r.gEventMgr.emit(s.GlobalEvent.PLAY_SCORE,!0)),this.step>=i.submit&&!this.done&&(this.done=!0,this.Submit.node.runAction(cc.sequence(cc.scaleTo(.1,1.2),cc.scaleTo(.1,1),cc.scaleTo(.1,1.1),cc.scaleTo(.1,1))),setTimeout(function(){e.alreadySumbit||(e.alreadySumbit=!0,console.log(" submit score by setTimeout, matchid:",n.Game.MatchInfo.matchId,",seed:",n.Game.MatchInfo.sharedRandomSeed),CELER_X&&celerSDK.submitScore(e.resultData.totalScore))},3e3))},e.prototype.showLineScore=function(){this.showLine=!0},e.prototype.playOverTab=function(){r.gEventMgr.emit(s.GlobalEvent.PLAY_OVER_TAB)},e.prototype.showComboScore=function(){this.showCombo=!0},e.prototype.showBestScore=function(){var t,e=this;this.showBest=!0,0!=this.resultData.bestFruitID&&(t=a.TableMgr.inst.getFruits(this.resultData.bestFruitID)),t&&cc.loader.loadRes("Textures/Fruits/"+t.Icon,cc.SpriteFrame,function(t,o){t?console.error(t):(e.BestIcon.node.active=!0,e.BestIcon.spriteFrame=o)})},e.prototype.showWildScore=function(){this.showWild=!0,this.Wild_A.node.active=this.resultData.Wild_A,this.Wild_B.node.active=this.resultData.Wild_B,this.Wild_A.node.active&&!this.Wild_B.node.active&&(this.Wild_A.node.x=this.Wild_B.node.x)},e.prototype.showMostScore=function(){var t=this;if(this.showMost=!0,0!=this.resultData.mostFruitID){var e=a.TableMgr.inst.getFruits(this.resultData.mostFruitID);e&&cc.loader.loadRes("Textures/Fruits/"+e.Icon,cc.SpriteFrame,function(e,o){e?console.error(e):(t.MostIcon.node.active=!0,t.MostIcon.spriteFrame=o)})}},__decorate([h(cc.Label)],e.prototype,"TotalScoreLabel",void 0),__decorate([h(cc.Label)],e.prototype,"LineScoreLabel",void 0),__decorate([h(cc.Label)],e.prototype,"ComboScoreLabel",void 0),__decorate([h(cc.Label)],e.prototype,"BestScoreLabel",void 0),__decorate([h(cc.Label)],e.prototype,"WildScoreLabel",void 0),__decorate([h(cc.Label)],e.prototype,"MostScoreLabel",void 0),__decorate([h(cc.Sprite)],e.prototype,"BestIcon",void 0),__decorate([h(cc.Sprite)],e.prototype,"Wild_A",void 0),__decorate([h(cc.Sprite)],e.prototype,"Wild_B",void 0),__decorate([h(cc.Sprite)],e.prototype,"MostIcon",void 0),__decorate([h(cc.Button)],e.prototype,"Submit",void 0),e=__decorate([l],e)}(cc.Component);o.default=u,cc._RF.pop()},{"../Controller/EventManager":"EventManager","../Controller/EventName":"EventName","../TableMgr":"TableMgr","./GameMgr":"GameMgr"}],PauseLayer:[function(t,e,o){"use strict";cc._RF.push(e,"ff7abK+6gVPQJ0jzaOh6XWC","PauseLayer"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../exts/GameSignal"),n=t("./GameMgr"),a=cc._decorator,r=a.ccclass,s=a.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.GuidePage=null,e}return __extends(e,t),Object.defineProperty(e.prototype,"EndNow",{get:function(){return this.node.getChildByName("btn_pause_end")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Resume",{get:function(){return this.node.getChildByName("btn_pause_resume")},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){var t=this;this.EndNow.on(cc.Node.EventType.TOUCH_END,function(){n.Game.gameOver(n.OverType.TIME_OUT)},this),this.Resume.on(cc.Node.EventType.TOUCH_END,function(){t.hide()},this),i.ShowPauseLayerSignal.inst.addListenerTwo(function(e,o){e?t.show():t.hide(),o&&i.ShowPauseLayerSignal.inst.removeTarget(t)},this),this.node.active=!1},e.prototype.start=function(){},e.prototype.show=function(){this.node.active||(this.node.active=!0,this.GuidePage.scrollToPage(0,0))},e.prototype.hide=function(){var t=this;0!=this.node.active&&setTimeout(function(){t.node.active=!1,t.GuidePage.node.active=!1},0)},__decorate([s(cc.PageView)],e.prototype,"GuidePage",void 0),e=__decorate([r],e)}(cc.Component);o.default=c,cc._RF.pop()},{"../exts/GameSignal":"GameSignal","./GameMgr":"GameMgr"}],Signal:[function(t,e,o){"use strict";cc._RF.push(e,"645a0itzgpBnbtkjYmVpX09","Signal"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.listenerMap=[],e.onceListenerMap=[],e}return __extends(e,t),e.prototype.doDispatch=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.excuteListener.apply(this,t),this.excuteOnce.apply(this,t)},e.prototype.excuteListener=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.listenerMap&&this.listenerMap.length>0)for(var o=0,i=this.listenerMap;o<i.length;o++){var n=i[o];n.callback.apply(n.target,t)}},e.prototype.excuteOnce=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.onceListenerMap&&this.onceListenerMap.length>0){for(var o=0,i=this.onceListenerMap;o<i.length;o++){var n=i[o];n.callback.apply(n.target,t)}this.onceListenerMap.length=0}},e.prototype.listen=function(t,e){this.listenerMap.push({callback:t,target:e})},e.prototype.listenOnce=function(t,e){this.onceListenerMap.push({callback:t,target:e})},e.prototype.removeListener=function(t,e){if(this.listenerMap&&this.listenerMap.length>0)for(var o=0;o<this.listenerMap.length;++o){var i=this.listenerMap[o];i.callback==t&&i.target==e&&(this.listenerMap.splice(o,1),--o)}},e.prototype.removeTarget=function(t){if(this.listenerMap&&this.listenerMap.length>0)for(var e=0;e<this.listenerMap.length;++e){this.listenerMap[e].target==t&&(this.listenerMap.splice(e,1),--e)}},e.prototype.dispatch=function(){this.doDispatch(null)},e.prototype.dispatchOne=function(t){this.doDispatch(t)},e.prototype.dispatchTwo=function(t,e){this.doDispatch(t,e)},e.prototype.dispatchThree=function(t,e,o){this.doDispatch(t,e,o)},e.prototype.dispatchFour=function(t,e,o,i){this.doDispatch(t,e,o,i)},e.prototype.dispatchFive=function(t,e,o,i,n){this.doDispatch(t,e,o,i,n)},e.prototype.addListener=function(t,e){this.listen(t,e)},e.prototype.addOnce=function(t,e){this.listenOnce(t,e)},e.prototype.addListenerOne=function(t,e){this.listen(t,e)},e.prototype.addListenerTwo=function(t,e){this.listen(t,e)},e.prototype.addListenerThree=function(t,e){this.listen(t,e)},e.prototype.addListenerFour=function(t,e){this.listen(t,e)},e.prototype.addListenerFive=function(t,e){this.listen(t,e)},e.prototype.addOnceOne=function(t,e){this.listenOnce(t,e)},e.prototype.addOnceTwo=function(t,e){this.listenOnce(t,e)},e.prototype.addOnceThree=function(t,e){this.listenOnce(t,e)},e.prototype.addOnceFour=function(t,e){this.listenOnce(t,e)},e.prototype.addOnceFive=function(t,e){this.listenOnce(t,e)},e}(t("./ToSingleton").SingleTon());o.BaseSignal=i,cc._RF.pop()},{"./ToSingleton":"ToSingleton"}],SkipButton:[function(t,e,o){"use strict";cc._RF.push(e,"cf160T0JbFLkJiQQ+edjbra","SkipButton"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./Controller/EventManager"),n=t("./Controller/EventName"),a=cc._decorator,r=a.ccclass,s=(a.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_END,function(){console.log(" skip touche"),i.gEventMgr.emit(n.GlobalEvent.HIDE_HELP)},this)},e.prototype.start=function(){},e.prototype.update=function(t){},e=__decorate([r],e)}(cc.Component));o.default=s,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName"}],TableMgr:[function(t,e,o){"use strict";cc._RF.push(e,"33c73L3v+BDpLtcNY7gOVEB","TableMgr"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){this.load=t.JSON_URL&&""!=t.JSON_URL?cc.loader.load.bind(cc.loader):cc.loader.loadRes.bind(cc.loader),this.fileFormat=t.JSON_URL&&""!=t.JSON_URL?".json?time="+Date.now():"",this.total=0,this.complete=0,this.Fruits={},this.Shape={},this.ShapeWeight={}}return Object.defineProperty(t,"inst",{get:function(){return this.ins?this.ins:this.ins=new t},enumerable:!0,configurable:!0}),t.prototype.startLoad=function(e,o,i){this.completeCallback=o,this.progressCallback=i;var n=this;console.log("Base URL:",t.JSON_URL),this.load(t.JSON_URL+e.trim().split("/").join("")+"/file_list"+this.fileFormat,function(t,o){if(t)console.error(t.errorMessage);else{var i="Array"==o.constructor.name?o:o.json;this.total=i.length;for(var a=0,r=i;a<r.length;a++){var s=r[a];n.loadJson(e.trim().split("/").join("")+"/"+s.replace(".json",""))}}}.bind(this))},t.prototype.loadJson=function(e){console.log("start load:"+e);var o=this,i=e.split("/")[1];i=i.charAt(0).toUpperCase()+i.slice(1,i.length),this.load(t.JSON_URL+e+this.fileFormat,function(t,e){if(t)console.error(t.errorMessage);else{for(var n=0,a="Array"==e.constructor.name?e:e.json;n<a.length;n++){var r=a[n];o[i][r.ID]=r}o.completeLoad()}}.bind(this))},t.prototype.completeLoad=function(){this.complete++,this.complete>=this.total&&this.completeCallback&&this.completeCallback()},t.prototype.getFruits=function(t){return this.Fruits[t]?this.Fruits[t]:(console.error("Fruits \u4e0d\u5b58key\uff1a"+t),null)},t.prototype.getAll_Fruits_Data=function(){return this.Fruits},t.prototype.getShape=function(t){return this.Shape[t]?this.Shape[t]:(console.error("Shape \u4e0d\u5b58key\uff1a"+t),null)},t.prototype.getAll_Shape_Data=function(){return this.Shape},t.prototype.getShapeWeight=function(t){return this.ShapeWeight[t]?this.ShapeWeight[t]:(console.error("ShapeWeight \u4e0d\u5b58key\uff1a"+t),null)},t.prototype.getAll_ShapeWeight_Data=function(){return this.ShapeWeight},t.JSON_URL="",t}();o.TableMgr=i,cc._RF.pop()},{}],ToSingleton:[function(t,e,o){"use strict";cc._RF.push(e,"5cbb9dwn8lHI6oXXQMOooD9","ToSingleton"),Object.defineProperty(o,"__esModule",{value:!0}),o.SingleTon=function(){return function(){function t(){}return Object.defineProperty(t,"inst",{get:function(){return this.ins?this.ins:this.ins=new this},enumerable:!0,configurable:!0}),t}()},cc._RF.pop()},{}],table:[function(t,e,o){"use strict";cc._RF.push(e,"adcebipSrZMgb1UHOlwts9Z","table"),Object.defineProperty(o,"__esModule",{value:!0}),function(t){t[t.ShuiGuo=1]="ShuiGuo",t[t.DaoJu=2]="DaoJu"}(o.Fruits_Type||(o.Fruits_Type={})),function(t){t[t.PuTongFangKuai=1]="PuTongFangKuai",t[t.TeShuDaoJu=2]="TeShuDaoJu"}(o.Shape_Type||(o.Shape_Type={})),cc._RF.pop()},{}]},{},["Config","AudioController","EventManager","EventName","GameFactory","LogHandler","Cube","CubeBg","CubeRoot","GameMgr","GameScene","OverLayer","PauseLayer","SkipButton","TableMgr","GameSignal","HashMap","Signal","ToSingleton","table"]);