window.__require=function e(t,o,n){function r(a,c){if(!o[a]){if(!t[a]){var l=a.split("/");if(l=l[l.length-1],!t[l]){var s="function"==typeof __require&&__require;if(!c&&s)return s(l,!0);if(i)return i(l,!0);throw new Error("Cannot find module '"+a+"'")}}var u=o[a]={exports:{}};t[a][0].call(u.exports,function(e){return r(t[a][1][e]||e)},u,u.exports,e,t,o,n)}return o[a].exports}for(var i="function"==typeof __require&&__require,a=0;a<n.length;a++)r(n[a]);return r}({AudioController:[function(e,t,o){"use strict";cc._RF.push(t,"c3611jDu5hL7auVf9iIBCz5","AudioController"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../Utils/HashMap"),r=e("./EventManager"),i=e("./EventName"),a="sounds/";window.oncanplay&&(window.oncanplay=function(){c.canPlay=!0});var c=function(){function e(){this.audioID={},this.clips=new n.HashMap}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.init=function(e){console.warn(" start load AudioClip ");var t=this;cc.loader.loadResDir(a,cc.AudioClip,function(o,n,r){if(o)console.error(o);else{for(var i=0,a=n;i<a.length;i++){var c=a[i];0,t.clips.add(c.name,c)}t.initEvent(),e&&e()}})},e.prototype.initEvent=function(){var e=this;r.gEventMgr.targetOff(this),this.playMusic("bgm"),r.gEventMgr.on(i.GlobalEvent.CHANGE_BGM,function(t){e.playMusic(t)},this),r.gEventMgr.on(i.GlobalEvent.PLAY_EFFECT,function(t){e.playEffect(t)},this)},e.prototype.playEffect=function(t,o){var n=this;if(void 0===o&&(o=!1),e.canPlay){if(!(cc.audioEngine.getEffectsVolume()<=.05)){var r=this.clips.get(t);r?this.audioID[t]=cc.audioEngine.playEffect(r,o):cc.loader.loadRes(a+t,cc.AudioClip,function(e,r){e?console.error(e):(n.clips.add(r.name,r),n.audioID[t]=cc.audioEngine.playEffect(r,o))})}}else this.bindTouch()},e.prototype.playMusic=function(t,o){var n=this;if(void 0===o&&(o=!0),!e.canPlay)return this.bindTouch(),void e.PlayedList.push({loop:!0,volume:1,clipName:t,supTime:Date.now(),skip:!1,isBgm:!0});var r=this.clips.get(t);r?cc.audioEngine.playMusic(r,o):cc.loader.loadRes(a+t,cc.AudioClip,function(e,t){e?console.error(e):("string"==typeof t._audio&&cc.loader._cache&&cc.loader._cache[t._audio]&&cc.loader._cache[t._audio].buffer&&(t._audio=cc.loader._cache[t._audio].buffer),n.clips.add(t.name,t),cc.audioEngine.playMusic(t,o))})},e.prototype.bindTouch=function(){if(!e.hasBindTouch){var t=this,o=function(){var n;for(cc.game.canvas.removeEventListener("touchstart",o),cc.sys.platform==cc.sys.DESKTOP_BROWSER&&cc.game.canvas.removeEventListener("click",o),e.canPlay=!0;(n=e.PlayedList.pop())&&t.clips.get(n.clipName)&&!n.skip;)cc.audioEngine.playMusic(t.clips.get(n.clipName),n.loop)};e.hasBindTouch=!0,cc.game.canvas.addEventListener("touchstart",o),cc.sys.platform==cc.sys.DESKTOP_BROWSER&&cc.game.canvas.addEventListener("click",o)}},e.PlayedList=[],e.canPlay=!1,e.hasBindTouch=!1,e}();o.gAudio=c.inst,cc._RF.pop()},{"../Utils/HashMap":"HashMap","./EventManager":"EventManager","./EventName":"EventName"}],Bird:[function(e,t,o){"use strict";cc._RF.push(t,"ae760SeGw5Fo6VvYIpO18qP","Bird");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("./Controller/Game"),a=e("./Const"),c=e("./Controller/EventManager"),l=e("./Controller/EventName"),s=e("./BubbleMove"),u=cc._decorator,h=u.ccclass,p=(u.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.acceleration=cc.v2(0,0),t.velocity=cc.v2(0,0),t.Speed=cc.v2(400,800),t.score=0,t.Scale=1.2,t.fly=!1,t}return n(t,e),Object.defineProperty(t.prototype,"Spine",{get:function(){return this.getComponent(sp.Skeleton)},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){},t.prototype.start=function(){},t.prototype.reuse=function(e,t){var o=this;this.score=e,this.Spine.setCompleteListener(this.onAnimationComplete.bind(this)),this.node.setPosition(t),this.node.scale=0;var n=cc.v2(this.node.x>0?1:-1,1).mul(this.Scale);this.node.runAction(cc.sequence(cc.scaleTo(.2,1.2*n.x,1.2*n.y),cc.scaleTo(.1,n.x,n.y),cc.callFunc(function(){o.startFly()}))),c.gEventMgr.once(l.GlobalEvent.GAME_OVER,function(){o.flyDone(1e3,!1),i.Game.addScore(o.score,o.score,1.5,CMath.ConvertToNodeSpaceAR(o.node,i.Game.TopNode).add(cc.v2(.5*a.BubbleSize.width,.5*a.BubbleSize.height)))},this)},t.prototype.startFly=function(){c.gEventMgr.emit(l.GlobalEvent.PLAY_EFFECT,"chackn"),this.Spine.loop=!0,this.Spine.animation="fly",this.velocity.y=this.Speed.y,this.velocity.x=this.node.scaleX>0?-this.Speed.x:this.Speed.x,this.fly=!0},t.prototype.onAnimationComplete=function(e){var t=this;switch(e.animation.name){case"get":break;case"fly":this.velocity.y=.3*-this.Speed.y,this.acceleration.y=this.Speed.y;break;case"idle":setTimeout(function(){t.Spine.loop=!1,t.Spine.animation="idle"},700*CMath.getRandom())}},t.prototype.update=function(e){this.fly&&(this.node.scaleX=this.velocity.x>=0?-1:1,this.node.scaleX*=this.Scale,this.velocity.addSelf(this.acceleration.mul(e)),this.velocity.y>=this.Speed.y&&(this.acceleration.y=0),this.node.setPosition(this.node.position.add(this.velocity.mul(e))),Math.abs(CMath.ConvertToNodeSpaceAR(this.node,i.Game.TopNode).x)>=s.BorderX&&(this.velocity.x=-this.velocity.x,this.velocity.y=.2*-this.Speed.y,this.acceleration.y=this.Speed.y),(CMath.Distance(this.node.position,cc.v2(0,0))<=200||this.node.y>=-100)&&this.flyDone())},t.prototype.flyDone=function(e,t){var o=this;void 0===e&&(e=500),void 0===t&&(t=!0),this.fly=!1,this.acceleration=cc.v2(0,0),this.velocity=cc.v2(0,0);var n=CMath.Distance(this.node.position,cc.v2(0,0));this.node.scaleX=this.node.x>0?1:-1,this.node.scaleX*=this.Scale,0==t&&(this.node.group="default"),this.node.runAction(cc.sequence(cc.moveTo(n/e,cc.v2(0,0)),cc.callFunc(function(){c.gEventMgr.targetOff(o),o.node.scaleX=1*o.Scale,o.node.runAction(cc.scaleTo(.1,1)),o.Spine.loop=!1,o.Spine.animation="idle",o.node.getParent().getChildByName("Score").runAction(cc.fadeIn(.1)),o.node.getParent().getChildByName("back").runAction(cc.fadeOut(.1)),o.node.group="default",t&&i.Game.addScore(o.score,o.score,1.5,CMath.ConvertToNodeSpaceAR(o.node,i.Game.TopNode).add(cc.v2(.5*a.BubbleSize.width,.5*a.BubbleSize.height)))})))},t=r([h],t)}(cc.Component));o.default=p,cc._RF.pop()},{"./BubbleMove":"BubbleMove","./Const":"Const","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game"}],BlueIdle:[function(e,t,o){"use strict";cc._RF.push(t,"20036nLdjNApYvTy8Xi4ECH","BlueIdle");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../../FrameAniBase"),a=cc._decorator,c=a.ccclass,l=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.onLoad=function(){e.prototype.onLoad.call(this)},t.aniName="BlueIdle",t=r([c],t)}(i.default));o.default=l,cc._RF.pop()},{"../../FrameAniBase":"FrameAniBase"}],BlueLoad:[function(e,t,o){"use strict";cc._RF.push(t,"08214k9+Y1NIr0C3aDpVb67","BlueLoad");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../../FrameAniBase"),a=e("../../Controller/EventManager"),c=e("../../Controller/EventName"),l=cc._decorator,s=l.ccclass,u=(l.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),a.gEventMgr.on(c.GlobalEvent.PLAY_LOAD,function(){t.play()},this)},t.prototype.onKeyFrame=function(e){8==e&&a.gEventMgr.emit(c.GlobalEvent.BUBBLE_LOAD)},t.prototype.start=function(){},t.aniName="BlueLoad",t=r([s],t)}(i.default));o.default=u,cc._RF.pop()},{"../../Controller/EventManager":"EventManager","../../Controller/EventName":"EventName","../../FrameAniBase":"FrameAniBase"}],BubbleBurst:[function(e,t,o){"use strict";cc._RF.push(t,"2a3f2DDgVZNpIG4fasOghMK","BubbleBurst");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../FrameAniBase"),a=cc._decorator,c=a.ccclass,l=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.play=function(){e.prototype.play.call(this)},t.aniName="BubbleBurst",t=r([c],t)}(i.default));o.default=l,cc._RF.pop()},{"../FrameAniBase":"FrameAniBase"}],BubbleChange:[function(e,t,o){"use strict";cc._RF.push(t,"3a817znFDhDCaEwLpCddbyw","BubbleChange");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../FrameAniBase"),a=cc._decorator,c=a.ccclass,l=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.play=function(){e.prototype.play.call(this)},t.aniName="BubbleChange",t=r([c],t)}(i.default));o.default=l,cc._RF.pop()},{"../FrameAniBase":"FrameAniBase"}],BubbleDrop:[function(e,t,o){"use strict";cc._RF.push(t,"623af7xlK1EQ4Szsrycvrsz","BubbleDrop");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../FrameAniBase"),a=cc._decorator,c=a.ccclass,l=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.play=function(){e.prototype.play.call(this)},t.aniName="BubbleDrop",t=r([c],t)}(i.default));o.default=l,cc._RF.pop()},{"../FrameAniBase":"FrameAniBase"}],BubbleHorce:[function(e,t,o){"use strict";cc._RF.push(t,"dc741sapJBNlKYdfySF/Y71","BubbleHorce");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../FrameAniBase"),a=cc._decorator,c=a.ccclass,l=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.play=function(){e.prototype.play.call(this)},t.aniName="BubbleHorce",t=r([c],t)}(i.default));o.default=l,cc._RF.pop()},{"../FrameAniBase":"FrameAniBase"}],BubbleIdle:[function(e,t,o){"use strict";cc._RF.push(t,"97381k3pDhIrLdCJF11xOn7","BubbleIdle");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../FrameAniBase"),a=cc._decorator,c=a.ccclass,l=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.play=function(){e.prototype.play.call(this)},t.aniName="BubbleIdle",t=r([c],t)}(i.default));o.default=l,cc._RF.pop()},{"../FrameAniBase":"FrameAniBase"}],BubbleMatrix:[function(e,t,o){"use strict";cc._RF.push(t,"3fc87k3ArdNNIwVYgSiAJGh","BubbleMatrix"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../Const"),r=e("../Controller/Game");o.MatrixSize=15,o.UseSize=11,o.IndexJStart=(o.MatrixSize-o.UseSize)/2,o.IndexJEnd=o.UseSize+1;var i=function(){function e(){this.matrixData=[],this.addRowTotalCount=0,this.firstRow=0;for(var e=0;e<o.MatrixSize*o.MatrixSize;e++)this.matrixData[e]={color:n.BubbleType.Blank,bubble:null,type:n.SpecialType.Normal}}return Object.defineProperty(e.prototype,"data",{get:function(){return this.matrixData},enumerable:!0,configurable:!0}),e.prototype.addRow=function(e){var t=this.matrixData.length;this.matrixData.length+=e*o.MatrixSize;for(var r=t;r<this.matrixData.length;r++)this.matrixData[r]={color:n.BubbleType.Blank,bubble:null,type:n.SpecialType.Normal}},e.prototype.getRestRowCount=function(){return this.addRowTotalCount},e.prototype.getFirstRow=function(){return this.firstRow},e.prototype.moveRow=function(e){if(this.addRowTotalCount<=e){this.addRow(6),this.firstRow+=5,r.Game.startIndex+=5*o.MatrixSize,this.addRowTotalCount+=6;var t=6*o.MatrixSize;console.log(" \u65b0\u589e6\u884c\uff1a ",t,", total length:",this.data.length);for(var i=this.matrixData.length-1;i>=t;i--)this.matrixData[i-t]||(this.matrixData[i-t]={color:n.BubbleType.Blank,bubble:null,type:n.SpecialType.Normal}),this.matrixData[i].color=this.matrixData[i-t].color,this.matrixData[i].type=this.matrixData[i-t].type,this.matrixData[i].bubble=this.matrixData[i-t].bubble,this.matrixData[i-t]={color:n.BubbleType.Blank,bubble:null,type:n.SpecialType.Normal},this.matrixData[i].bubble&&this.matrixData[i].bubble.setIndex(i);var a=Math.ceil(CMath.getRandom(n.DoubleBubbleRange.Min,n.DoubleBubbleRange.Max)),c=Math.ceil(CMath.getRandom(n.BoomBubbleRange.Min,n.BoomBubbleRange.Max)),l=Math.ceil(CMath.getRandom(n.MagicBubbleRange.Min,n.MagicBubbleRange.Max));console.log(" double:",a,", boom:",c,", magic:",l);var s=[];for(i=0;i<=t-1;i++)this.index2j(i)>=o.IndexJStart&&this.index2j(i)<=o.IndexJEnd&&s.push(i);for(var u=n.BubbleColors.concat(),h={};a>0&&u.length>0&&s.length>=0;){var p=s[m=Math.floor(CMath.getRandom(0,s.length))];s.splice(m,1);var d=u[g=Math.floor(CMath.getRandom(0,u.length))];u.splice(g,1),h[p]=d,a--}console.log(" ---------- \u53cc\u500d\u7403 --------------"),console.log(h);for(var b=n.BubbleColors.concat(),f={};c>0&&b.length>0&&s.length>=0;){p=s[m=Math.floor(CMath.getRandom(0,s.length))];s.splice(m,1);var g;d=b[g=Math.floor(CMath.getRandom(0,b.length))];b.splice(g,1),f[p]=d,c--}console.log(" ---------- \u70b8\u5f39\u7403 --------------"),console.log(f);for(var y={};l>0&&s.length>=0;){var m;p=s[m=Math.floor(CMath.getRandom(0,s.length))];s.splice(m,1),y[p]=n.BubbleType.Blank,l--}console.log(" ---------- \u9b54\u6cd5\u7403 --------------"),console.log(y);for(i=0;i<t-1;i++)this.matrixData[i].color=n.BubbleColors[Math.floor(CMath.getRandom()*n.BubbleColors.length)],this.matrixData[i].bubble=null,this.matrixData[i].type=n.SpecialType.Normal,null!=h[i]&&(this.matrixData[i].type=n.SpecialType.Double,this.matrixData[i].color=h[i]),null!=y[i]&&(this.matrixData[i].type=n.SpecialType.Magic,this.matrixData[i].color=y[i]),null!=f[i]&&(this.matrixData[i].type=n.SpecialType.Boom,this.matrixData[i].color=f[i])}else this.firstRow-=1,r.Game.startIndex-=o.MatrixSize;this.addRowTotalCount-=e,console.log(" \u5269\u4f59 ",this.addRowTotalCount," \u884c\u6570\u636e",", \u7b2c\u4e00\u884c\uff1a",this.firstRow,this.index2i(r.Game.startIndex))},e.prototype.ij2index=function(e,t){return e*o.MatrixSize+t},e.prototype.index2i=function(e){return Math.floor(e/o.MatrixSize)},e.prototype.index2j=function(e){return e%o.MatrixSize},e.prototype.getUseIndexStart=function(){return(o.MatrixSize-o.UseSize)/2*(o.MatrixSize+1)-1},e.prototype.getUseIndexEnd=function(){return o.MatrixSize*o.MatrixSize-this.getUseIndexStart()-1},e.prototype.getPosOfIndex=function(e){var t=this.index2i(e),o=this.index2j(e);return this.getPosOfij(t,o)},e.prototype.getPosOfij=function(e,t){var i=cc.v2(0,0);return i.x=(t-o.MatrixSize/2)*n.BubbleSize.width+(e+this.firstRow+r.Game.getMoveTimes())%2*n.BubbleSize.width/2+n.BubbleXOffset,i.y=(o.MatrixSize/2-e+r.Game.getMoveTimes()+this.firstRow-this.index2i(n.InitStartIndex))*(n.BubbleSize.height+n.BubbleHeightOffset)+n.BubbleYOffset,i},e.prototype.getNeiborMatrix=function(e,t,n){void 0===n&&(n=!1);for(var i=[],a=this.index2i(e),c=r.Game.getMoveTimes()+this.firstRow,l=0;l<=t;l++){var s=a+l,u=a%2==s%2,h=t-Math.floor(l/2);h=Math.min(h,t);for(var p=0;p<=h;p++){var d,b=e+l*o.MatrixSize+p,f=e-l*o.MatrixSize+p,g=e+l*o.MatrixSize-p,y=e-l*o.MatrixSize-p;if(e!=b&&i.indexOf(b)<0&&b>=0&&(b<this.matrixData.length||n))if(u||(s+c)%2==0||p<h)(d=this.index2j(b))>=o.IndexJStart&&d<=o.IndexJEnd&&b>=r.Game.startIndex&&(this.data[b]&&this.data[b].bubble&&!n?i.push(b):!n||this.data[b]&&this.data[b].bubble||i.push(b));if(e!=f&&i.indexOf(f)<0&&f>=0&&(f<this.matrixData.length||n))(d=this.index2j(f))>=o.IndexJStart&&d<=o.IndexJEnd&&f>=r.Game.startIndex&&(u||(s+c)%2==0||p<h)&&(this.data[f]&&this.data[f].bubble&&!n?i.push(f):!n||this.data[f]&&this.data[f].bubble||i.push(f));if(e!=g&&i.indexOf(g)<0&&g>=0&&(g<this.matrixData.length||n))(d=this.index2j(g))>=o.IndexJStart&&d<=o.IndexJEnd&&g>=r.Game.startIndex&&(u||(s+c)%2||p<h)&&(this.data[g]&&this.data[g].bubble&&!n?i.push(g):!n||this.data[g]&&this.data[g].bubble||i.push(g));if(e!=y&&i.indexOf(y)<0&&y>=0&&(y<this.matrixData.length||n))(d=this.index2j(y))>=o.IndexJStart&&d<=o.IndexJEnd&&y>=r.Game.startIndex&&(u||(s+c)%2||p<h)&&(this.data[y]&&this.data[y].bubble&&!n?i.push(y):!n||this.data[y]&&this.data[y].bubble||i.push(y))}}return i.sort(function(e,t){return e-t}),i},e.prototype.initBubbleData=function(){console.log(" init bubble data :",r.Game.MatchInfo.matchId,", seed:",r.Game.MatchInfo.sharedRandomSeed);var e=this.getUseIndexStart(),t=this.getUseIndexEnd();this.firstRow=this.index2i(r.Game.startIndex),this.addRowTotalCount=0;var i=Math.ceil(CMath.getRandom(n.DoubleBubbleInitRange.Min,n.DoubleBubbleInitRange.Max)),a=Math.ceil(CMath.getRandom(n.BoomBubbleInitRange.Min,n.BoomBubbleInitRange.Max)),c=Math.ceil(CMath.getRandom(n.MagicBubbleInitRange.Min,n.MagicBubbleInitRange.Max));console.log("start:",e,", end:",t,", firstRow:",this.firstRow),console.log(" double:",i,", boom:",a,", magic:",c);for(var l=[],s=r.Game.startIndex;s<=t;s++)this.index2j(s)>=o.IndexJStart&&this.index2j(s)<=o.IndexJEnd&&l.push(s);for(var u={},h=0,p=n.BirdIndexRandom[Math.floor(CMath.getRandom()*n.BirdIndexRandom.length)];h<p.length;h++){u[T=p[h]]=n.BubbleType.Bird}for(var d=n.BubbleColors.concat(),b={};i>0&&l.length>=0;){var f=l[S=Math.floor(CMath.getRandom(0,l.length))];l.splice(S,1);var g=d[v=Math.floor(CMath.getRandom(0,d.length))];d.splice(v,1),b[f]=g,i--,d.length<=0&&(d=n.BubbleColors.concat())}console.log(" ---------- \u53cc\u500d\u7403 --------------"),console.log(b);for(var y=n.BubbleColors.concat(),m={};a>0&&l.length>=0;){f=l[S=Math.floor(CMath.getRandom(0,l.length))];l.splice(S,1);var v;g=y[v=Math.floor(CMath.getRandom(0,y.length))];y.splice(v,1),m[f]=g,a--,y.length<=0&&(y=n.BubbleColors.concat())}console.log(" ---------- \u70b8\u5f39\u7403 --------------"),console.log(m);for(var _={};c>0&&l.length>=0;){var S;f=l[S=Math.floor(CMath.getRandom(0,l.length))];l.splice(S,1),_[f]=n.BubbleType.Blank,c--}console.log(" ---------- \u9b54\u6cd5\u7403 --------------"),console.log(_);for(s=e;s<=t;s++){for(var C=this.getNeiborMatrix(s,1),B=[],E=0,M=C;E<M.length;E++){var T=M[E];this.matrixData[T].color!=n.BubbleType.Blank&&B.push(this.matrixData[T])}var x=this.getOtherColors(B);CMath.getRandom()<=.8&&x.length>0?this.matrixData[s].color=x[Math.floor(CMath.getRandom()*x.length)]:this.matrixData[s].color=n.BubbleColors[Math.floor(CMath.getRandom()*n.BubbleColors.length)];for(var A=0;A<C.length;A++){T=C[A];if(this.matrixData[T].color==n.BubbleType.Blank)if(CMath.getRandom()<=.8)this.matrixData[T]=this.matrixData[s];else{var R=this.getOtherColors([this.matrixData[s].color]);this.matrixData[T].color=R[Math.floor(CMath.getRandom()*R.length)]}for(var O=this.getNeiborMatrix(T,1),P=0;P<O.length;P++){var F=O[P];if(this.matrixData[F].color==n.BubbleType.Blank)if(CMath.getRandom()<=.8-.7&&this.matrixData[T]==this.matrixData[s])this.matrixData[F]=this.matrixData[T];else{var G=this.getOtherColors([this.matrixData[s].color,this.matrixData[T].color]);this.matrixData[F].color=G[Math.floor(CMath.getRandom()*G.length)]}}}}for(s=0;s<this.matrixData.length;s++)this.matrixData[s].color==n.BubbleType.Blank&&(this.matrixData[s].color=n.BubbleColors[Math.floor(CMath.getRandom()*n.BubbleColors.length)]),this.matrixData[s].type=n.SpecialType.Normal,null!=b[s]&&(this.matrixData[s].type=n.SpecialType.Double,this.matrixData[s].color=b[s]),null!=_[s]&&(this.matrixData[s].type=n.SpecialType.Magic,this.matrixData[s].color=_[s]),null!=m[s]&&(this.matrixData[s].type=n.SpecialType.Boom,this.matrixData[s].color=m[s]),null!=u[s]&&(this.matrixData[s].type=n.SpecialType.Normal,this.matrixData[s].color=n.BubbleType.Bird),null!=n.SpecialIndex[s]&&(this.matrixData[s].type=n.SpecialIndex[s].type,this.matrixData[s].color=n.SpecialIndex[s].color);console.log(" init bubble data done!"),console.log(this.matrixData.length)},e.prototype.getOtherColors=function(e){for(var t=n.BubbleColors.concat(),o=0,r=e;o<r.length;o++){var i=r[o],a=t.indexOf(i);a<0||t.splice(a,1)}return t},e}();o.BubbleMatrix=i,cc._RF.pop()},{"../Const":"Const","../Controller/Game":"Game"}],BubbleMove:[function(e,t,o){"use strict";cc._RF.push(t,"f122cLSg0BF5pRoYWwgPS74","BubbleMove");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("./Bubble"),a=e("./Controller/EventManager"),c=e("./Controller/EventName"),l=e("./Controller/Game"),s=e("./Const"),u=e("./Controller/GameFactory"),h=e("./BubbleAnimation/BubbleChange"),p=e("./BubbleAnimation/BubbleDrop"),d=e("./BubbleAnimation/BubbleBurst"),b=cc._decorator,f=b.ccclass;b.property;o.BorderX=455;o.DropBorder=-667,o.CollsionFactor=.3,o.CollsionOffset=40,o.CollsionMinFactor=.01;var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.speed=cc.v2(0,0),t.acceleration=cc.v2(0,0),t.hasCollision=!1,t.shooted=!1,t.isDrop=!1,t.animationCallback={},t}return n(t,e),Object.defineProperty(t.prototype,"bubble",{get:function(){return this.getComponent(i.default)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radis",{get:function(){return s.BubbleSize.width/2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isShooterState",{get:function(){return"Shooter"==this.node.getParent().name&&this.node.getNumberOfRunningActions()<=0&&!this.hasCollision&&this.shooted},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isReady2Shoot",{get:function(){return"Shooter"==this.node.getParent().name&&this.node.getNumberOfRunningActions()<=0},enumerable:!0,configurable:!0}),t.prototype.checkBorder=function(){this.isDrop||(this.node.x<=-o.BorderX||this.node.x>=o.BorderX)&&(this.node.x=this.node.x>0?o.BorderX:-o.BorderX,this.speed.x=-this.speed.x,this.acceleration.x=-this.acceleration.x,l.Game.Rebounce++)},t.prototype.forceMove=function(e){var t=this.node.getActionByTag(i.BubbleAction.Collision);if(!t||t.isDone()){var o=cc.sequence(cc.moveBy(.1,e).easing(cc.easeQuadraticActionIn()),cc.moveBy(.1,e.mul(-1)).easing(cc.easeQuadraticActionOut()));o.setTag(i.BubbleAction.Collision),this.node.runAction(o)}},t.prototype.checkCollisionBubble=function(){var e=this;if(this.isShooterState&&!this.isDrop)for(var t=l.Game.getCollisionIndexes(),o=l.Game.getMatrix(),n=function(t){var n=o.data[t].bubble;if(!n)return console.warn(" bubble \u4e0d\u5b58\u5728\uff01"),"continue";var i=CMath.ConvertToNodeSpaceAR(r.node,n.node.parent);if(CMath.Distance(i,n.node.position)<=2*r.radis*.8){var u=o.getNeiborMatrix(t,1,!0),p=-1,d=100;console.log("\u78b0\u5230\uff1a",t),console.log(u);for(var b=0,f=u;b<f.length;b++){var g=f[b],y=o.index2i(g),m=o.index2j(g),v=o.getPosOfij(y,m);CMath.Distance(v,i)<d&&(d=CMath.Distance(v,i),p=g)}return r.bubble.Type==s.SpecialType.Magic?n.Type!=s.SpecialType.Magic&&s.ChangeColorExcept.indexOf(n.Color)<0&&n.node.active&&(r.bubble.setColor(n.Color,s.SpecialType.Normal),a.gEventMgr.emit(c.GlobalEvent.PLAY_EFFECT,"change_color"),r.bubble.playAnimation(h.default,function(){e.bubble.AnimationRoot.runAction(cc.fadeOut(.1))})):n.Type==s.SpecialType.Magic&&n.node.active&&r.bubble.Type!=s.SpecialType.Horce&&s.ChangeColorExcept.indexOf(r.bubble.Color)<0&&(n.setColor(r.bubble.Color,r.bubble.Type),n.playAnimation(h.default,function(){n.AnimationRoot.runAction(cc.fadeOut(.1))}),a.gEventMgr.emit(c.GlobalEvent.PLAY_EFFECT,"change_color")),n.onCollision(),a.gEventMgr.emit(c.GlobalEvent.BUBBLE_FORCE,p),p<0?console.error(" target index -1"):r.onCollision(p,function(){l.Game.checkClear(e.bubble.getIndex(),e.bubble,n),l.Game.updateCollisionIndexes(),a.gEventMgr.emit(c.GlobalEvent.NEXT_BUBBLE)}),{value:void 0}}},r=this,i=0,u=t;i<u.length;i++){var p=n(u[i]);if("object"==typeof p)return p.value}},t.prototype.onCollision=function(e,t){console.log(" on collision:",e);var o=Math.abs(this.speed.x/this.speed.y),n=0==o||isNaN(o)?1.2:1/o,r=1/n;this.speed.x=0,this.speed.y=0,this.acceleration.x=0,this.acceleration.y=0,this.hasCollision=!0;var i=l.Game.getMatrix(),a=i.index2i(e),c=i.index2j(e),s=i.getPosOfij(a,c),u=CMath.ConvertToNodeSpaceAR(this.node,l.Game.BubbleLayer);this.node.x=u.x,this.node.y=u.y,this.node.setParent(l.Game.BubbleLayer),this.node.stopAllActions(),this.scaleBubble(n,r),this.bubble.setIndex(e),this.node.runAction(cc.sequence(cc.moveTo(.1,s),cc.callFunc(function(){t&&t(),l.Game.checkOutOfMove()},this)))},t.prototype.scaleBubble=function(e,t){e=CMath.Clamp(e,1.2,.8),t=CMath.Clamp(t,1.2,.8),this.node.runAction(cc.sequence(cc.scaleTo(.1,e,t),cc.scaleTo(.1,1,1)))},t.prototype.initEvent=function(){a.gEventMgr.targetOff(this),a.gEventMgr.on(c.GlobalEvent.BUBBLE_FORCE,this.force,this)},t.prototype.readyToShoot=function(){a.gEventMgr.on(c.GlobalEvent.SHOOT,this.shoot,this)},t.prototype.unreadyToShoot=function(){a.gEventMgr.off(c.GlobalEvent.SHOOT)},t.prototype.force=function(e){var t=this.bubble.getIndex();if(t!=e){var n=l.Game.getMatrix(),r=n.getPosOfIndex(e),i=n.getPosOfIndex(t),a=CMath.Distance(r,i),c=Math.ceil(a/(2*this.radis)),s=Math.pow(o.CollsionFactor,Math.max(0,c-1));this.forceMove(i.sub(r).normalize().mul(s*o.CollsionOffset))}},t.prototype.reuse=function(){this.node.getChildByName("Bubble").color=cc.Color.WHITE,this.initEvent(),this.hasCollision=!1,this.isDrop=!1,this.speed=cc.v2(0,0),this.acceleration=cc.v2(0,0),this.shooted=!1,this.node.group="default"},t.prototype.unuse=function(){this.enabled=!1,this.shooted=!1,this.isDrop=!1,a.gEventMgr.targetOff(this)},t.prototype.shoot=function(e){a.gEventMgr.off(c.GlobalEvent.SHOOT),console.log("\u53d1\u5c04\uff01"),l.Game.Rebounce=0,a.gEventMgr.emit(c.GlobalEvent.PLAY_EFFECT,"shoot"),this.enabled=!0,this.shooted=!0,e.normalizeSelf(),this.speed.x=4800*e.x,this.speed.y=4800*e.y,this.acceleration.x=800*e.x,this.acceleration.y=800*e.y},t.prototype.isShooted=function(){return this.shooted},t.prototype.drop=function(){l.Game.DropCount++,this.isDrop=!0,this.enabled=!0,this.speed.y=800+CMath.getRandom(0,1e3),this.acceleration.y=4*-this.speed.y,this.speed.x=this.node.x>0?-200:200,this.speed.x*=CMath.getRandom(0,1.5)+1,this.node.group="drop",l.Game.addBubbleDrop(this.bubble.Color),console.log(" \u6389\u843d:",this.enabled,this.bubble.getIndex(),this.speed,this.acceleration,this.hasCollision,"Drop:",l.Game.DropCount)},t.prototype.update=function(e){var t=this;if(this.isShooterState||this.isDrop){for(var n=0;n<10;n++){this.checkBorder(),this.checkCollisionBubble(),this.node.x+=this.speed.x*e/10,this.node.y+=this.speed.y*e/10,this.speed.x+=this.acceleration.x*e/10,this.speed.y+=this.acceleration.y*e/10;var r=CMath.ConvertToNodeSpaceAR(this.node,this.node.getParent().getParent());if(this.isDrop&&r.y<=o.DropBorder){this.enabled=!1,this.scaleBubble(1.1,.9),a.gEventMgr.emit(c.GlobalEvent.PLAY_EFFECT,"drop");var h=this.bubble.DoubleScore?2*i.BubbleDropScore:i.BubbleDropScore;l.Game.addScore(this.bubble.Color,h,1,CMath.ConvertToNodeSpaceAR(this.node,l.Game.TopNode).add(cc.v2(.5*s.BubbleSize.width,.5*s.BubbleSize.height))),l.Game.DropCount--,this.bubble.Color==s.BubbleType.Bird?(a.gEventMgr.emit(c.GlobalEvent.GET_TREASURE,++l.Game.treasureCount,this.node),this.bubble.playAnimation(d.default,function(){u.gFactory.putBubble(t.node)})):this.bubble.playAnimation(p.default,function(){u.gFactory.putBubble(t.node)});break}}this.node.parent&&"Shooter"==this.node.parent.name&&(Math.abs(this.node.x)>=600||this.node.y>1663||this.node.y<0)&&(u.gFactory.putBubble(this.node),this.enabled=!1,console.error("  error , not collision! bubble lost "),a.gEventMgr.emit(c.GlobalEvent.NEXT_BUBBLE))}},t=r([f],t)}(cc.Component);o.default=g,cc._RF.pop()},{"./Bubble":"Bubble","./BubbleAnimation/BubbleBurst":"BubbleBurst","./BubbleAnimation/BubbleChange":"BubbleChange","./BubbleAnimation/BubbleDrop":"BubbleDrop","./Const":"Const","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Controller/GameFactory":"GameFactory"}],Bubble:[function(e,t,o){"use strict";cc._RF.push(t,"ab9ae70D2ZFXoGg9F2uKBO0","Bubble");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i,a=e("./Controller/EventManager"),c=e("./Controller/Game"),l=e("./Controller/EventName"),s=e("./Const"),u=e("./BubbleMove"),h=e("./Controller/GameFactory"),p=e("./BubbleAnimation/BubbleIdle"),d=e("./BubbleAnimation/BubbleBurst"),b=e("./BubbleAnimation/BubbleChange"),f=e("./BubbleAnimation/BubbleDrop"),g=e("./BubbleAnimation/BubbleHorce");o.BubbleDropScore=10,o.BubbleScoreStep=10,function(e){e[e.Bubble=0]="Bubble",e[e.Collision=1]="Collision"}(i=o.BubbleAction||(o.BubbleAction={}));var y=cc._decorator,m=y.ccclass,v=(y.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.index=-1,t.color=s.BubbleType.Blank,t.type=s.SpecialType.Normal,t.animationCallback={},t.doubleScore=!1,t}return n(t,e),t.prototype.getAnimation=function(e){return this.getComponentInChildren(e)},Object.defineProperty(t.prototype,"AnimationRoot",{get:function(){return this.node.getChildByName("Animation")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DropRoot",{get:function(){return this.node.getChildByName("Down")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sprite",{get:function(){return this.node.getChildByName("Bubble").getComponent(cc.Sprite)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"move",{get:function(){return this.getComponent(u.default)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IndexLabel",{get:function(){return this.node.getChildByName("Index").getComponent(cc.Label)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Color",{get:function(){return this.color},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Type",{get:function(){return this.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Double",{get:function(){return this.node.getChildByName("Bubble").getChildByName("Double")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDouble",{get:function(){return this.type==s.SpecialType.Double},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DoubleScore",{get:function(){return this.doubleScore},set:function(e){this.doubleScore=e},enumerable:!0,configurable:!0}),t.prototype.reuse=function(e,t,o,n,r,i,a,c,l){this.node.active=!1,this.node.scale=0,this.X2=l,this.type=o==s.BubbleType.Boom?s.SpecialType.Boom:e==s.SpecialType.Boom?s.SpecialType.Normal:e,this.type==s.SpecialType.Double&&o==s.BubbleType.Bird&&(this.type=s.SpecialType.Normal),this.color=o,this.idleFrames=n,this.burstFrames=i,this.getAnimation(b.default).Animation=r,this.getAnimation(g.default).Animation=a,this.getAnimation(p.default).Animation=this.idleFrames[o],this.getAnimation(d.default).Animation=this.burstFrames[o],this.getAnimation(f.default).Animation=c,this.sprite.node.opacity=255,this.Double.active=this.type==s.SpecialType.Double,this.Double.getComponent(cc.Sprite).spriteFrame=this.X2.getSpriteFrame(s.BubbleX2[this.color]),this.doubleScore=!1,this.updateSprite(),this.IndexLabel.node.active=!0,this.setIndex(t),this.initEvent()},t.prototype.unuse=function(){a.gEventMgr.targetOff(this),this.index=-1,this.IndexLabel.string="",this.node.stopAllActions(),this.getAnimation(p.default).clearAllListener().clearCompleteEvent(),this.getAnimation(d.default).clearAllListener().clearCompleteEvent(),this.getAnimation(b.default).clearAllListener().clearCompleteEvent(),this.getAnimation(g.default).clearAllListener().clearCompleteEvent(),this.getAnimation(f.default).clearAllListener().clearCompleteEvent(),this.AnimationRoot.opacity=0,this.DropRoot.opacity=0,this.node.targetOff(this),this.node.active=!1},t.prototype.setColor=function(e,t){this.color!=e?(this.color=e,this.type=t):console.warn(" color:",s.BubbleType[this.color],s.BubbleType[e])},t.prototype.updateSprite=function(e){void 0===e&&(e=!1),this.getAnimation(p.default).Animation=this.idleFrames[this.color],this.getAnimation(d.default).Animation=this.burstFrames[this.color],this.Double.getComponent(cc.Sprite).spriteFrame=this.X2.getSpriteFrame(s.BubbleX2[this.color])},t.prototype.setIndex=function(e){if(e!=this.index){var t=c.Game.getMatrix();t.data[e]&&t.data[e].bubble?t.data[e].bubble!=this&&(console.error(this.index,"\u6570\u636e\u4e0d\u540c\u6b65\uff01",e,", oldIndex:",t.data[e].bubble.getIndex()),console.log(t.data[e])):t.data[e]={color:this.color,bubble:this,type:this.type},this.index=e}},t.prototype.updateIndex=function(){this.IndexLabel.node.active=!this.IndexLabel.node.active,this.IndexLabel.string=this.index.toString()},t.prototype.getIndex=function(){return this.index},t.prototype.setActive=function(e,t,o){this.node.active!=e&&(this.node.active=e,this.node.active||(this.node.scale=0),this.node.active&&t&&this.bubbleScale(o))},t.prototype.initEvent=function(){this.getAnimation(p.default).addCompleteEvent(this.onAnimationComplete,this),this.getAnimation(d.default).addCompleteEvent(this.onAnimationComplete,this),this.getAnimation(b.default).addCompleteEvent(this.onAnimationComplete,this),this.getAnimation(f.default).addCompleteEvent(this.onAnimationComplete,this),this.getAnimation(g.default).addCompleteEvent(this.onAnimationComplete,this),this.getAnimation(p.default).addKeyEventListener(this.onAnimationKey,this),this.getAnimation(d.default).addKeyEventListener(this.onAnimationKey,this),this.getAnimation(b.default).addKeyEventListener(this.onAnimationKey,this),this.getAnimation(f.default).addKeyEventListener(this.onAnimationKey,this),this.getAnimation(g.default).addKeyEventListener(this.onAnimationKey,this),a.gEventMgr.on(l.GlobalEvent.UPDATE_INDEX,this.updateIndex,this),this.node._onSetParent=this.onSetParent.bind(this)},t.prototype.updateActive=function(e){void 0===e&&(e=0),this.setActive(this.index>=c.Game.startIndex,!0,e)},t.prototype.scaleTest=function(e){e.indexOf(this.index)<0||this.bubbleScale()},t.prototype.bubbleScale=function(e){void 0===e&&(e=0);var t=cc.sequence(cc.scaleTo(0,0),cc.delayTime(e),cc.scaleTo(.2,.9),cc.scaleTo(.1,1.1),cc.scaleTo(.1,1));t.setTag(i.Bubble),this.node.stopActionByTag(i.Bubble),this.node.runAction(t)},t.prototype.onSetParent=function(e){e&&(this.move.enabled="Shooter"==e.name,"BulletArray"==e.name?this.node.rotation=-90:this.node.rotation=0)},t.prototype.onCollision=function(){a.gEventMgr.emit(l.GlobalEvent.PLAY_EFFECT,"colision")},t.prototype.onClear=function(e,t){var n=this;if(this.index==t&&c.Game.Rebounce>0){console.log(" \u53cd\u5f39\u6b21\u6570:",c.Game.Rebounce),c.Game.Rebounce=0;var r=CMath.ConvertToNodeSpaceAR(this.node,c.Game.TopNode);Math.abs(r.x)>=340&&(r.x=r.x>0?340:-340),a.gEventMgr.emit(l.GlobalEvent.SHOW_REBOUNCE,r)}this.color!=s.BubbleType.Bird?(c.Game.addBubbleClear(this.Color),a.gEventMgr.emit(l.GlobalEvent.PLAY_EFFECT,this.type==s.SpecialType.Boom?"boom":"clear"),this.node.runAction(cc.sequence(cc.delayTime(.7*e),cc.callFunc(function(){var e=c.Game.getMatrix().index2i(n.index),r=c.Game.getMatrix().index2j(n.index),i=c.Game.getMatrix().index2i(t),a=c.Game.getMatrix().index2j(t),l=Math.max(Math.abs(e-i)+1,Math.abs(r-a)+1),u=Math.max(1,l)*o.BubbleScoreStep;n.DoubleScore&&(u*=2);var p=.1*l+1;c.Game.addScore(n.color,u,p,CMath.ConvertToNodeSpaceAR(n.node,c.Game.TopNode).add(cc.v2(.5*s.BubbleSize.width,.5*s.BubbleSize.height))),n.updateSprite(!0),n.playAnimation(d.default,function(){h.gFactory.putBubble(n.node)})},this)))):this.move.drop()},t.prototype.playAnimation=function(e,t){console.log(" play animation:",e.aniName),this.animationCallback[e.aniName]=t,this.getAnimation(e).play()},Object.defineProperty(t.prototype,"Bubble",{get:function(){return this.node.getChildByName("Bubble")},enumerable:!0,configurable:!0}),t.prototype.onAnimationKey=function(e,t){switch(0==e&&t!=p.default.prototype.__classname__&&(t==f.default.prototype.__classname__?this.DropRoot.opacity=255:this.AnimationRoot.opacity=255),t){case d.default.prototype.__classname__:0==e&&this.Bubble.runAction(cc.fadeOut(.1));break;case b.default.prototype.__classname__:2==e&&this.updateSprite();break;case g.default.prototype.__classname__:5==e&&this.updateSprite();break;case f.default.prototype.__classname__:0==e&&(this.Bubble.runAction(cc.fadeOut(.1)),this.DropRoot.opacity=255)}},t.prototype.onAnimationComplete=function(e){this.animationCallback[e]&&(this.animationCallback[e](),this.animationCallback[e]=null)},t.prototype.update=function(e){},t=r([m],t)}(cc.Component));o.default=v,cc._RF.pop()},{"./BubbleAnimation/BubbleBurst":"BubbleBurst","./BubbleAnimation/BubbleChange":"BubbleChange","./BubbleAnimation/BubbleDrop":"BubbleDrop","./BubbleAnimation/BubbleHorce":"BubbleHorce","./BubbleAnimation/BubbleIdle":"BubbleIdle","./BubbleMove":"BubbleMove","./Const":"Const","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Controller/GameFactory":"GameFactory"}],Const:[function(e,t,o){"use strict";var n;cc._RF.push(t,"f7b813ZcfJE5JVv1NvPFZPC","Const"),Object.defineProperty(o,"__esModule",{value:!0}),o.BubbleColor={0:"blank",1:"bg_popblue",2:"bg_popgreen",3:"bg_poporange",4:"bg_poppurple",5:"bg_popred",6:"bg_popyellow"},o.BubbleLightColor={0:"blank",1:"bg_popbluelight",2:"bg_popgreenlight",3:"bg_poporangelight",4:"bg_poppurplelight",5:"bg_popredlight",6:"bg_popyellowlight"},o.BoomBubbleLightColor={0:"blank",1:"bomb_bluelight",2:"bomb_greenlight",3:"bomb_orangelight",4:"bomb_purplelight",5:"bomb_redlight",6:"bomb_yellowlight"},o.BoomBubbleColor={0:"blank",1:"bomb_blue",2:"bomb_green",3:"bomb_orange",4:"bomb_purple",5:"bomb_red",6:"bomb_yellow"},o.HorseBubble="horse",o.HorseBubbleLight="horselight",o.MagicBubble="rainbow",o.MagicBubbleLight="rainbowlight",o.BubbleX2={0:"bg_X2blue",1:"bg_X2blue",2:"bg_X2blue",3:"bg_X2green",4:"bg_X2",5:"bg_X2pink",6:"bg_X2red",7:"bg_X2yellow",8:"bg_X2grey",9:"bg_X2grey",10:"bg_X2grey",11:"bg_X2grey"},function(e){e[e.Blank=0]="Blank",e[e.Blue=1]="Blue",e[e.DarkBlue=2]="DarkBlue",e[e.Green=3]="Green",e[e.Orange=4]="Orange",e[e.Purple=5]="Purple",e[e.Red=6]="Red",e[e.Yellow=7]="Yellow",e[e.White=8]="White",e[e.Boom=9]="Boom",e[e.Horce=10]="Horce",e[e.Bird=11]="Bird",e[e.Treasure_1=200]="Treasure_1",e[e.Treasure_2=400]="Treasure_2",e[e.Treasure_3=600]="Treasure_3",e[e.Treasure_4=800]="Treasure_4",e[e.Treasure_5=1e3]="Treasure_5",e[e.Streak=1001]="Streak",e[e.Rebounce=1002]="Rebounce"}(n=o.BubbleType||(o.BubbleType={})),o.BubbleColors=[n.Yellow,n.Red,n.Purple,n.Green,n.Blue,n.White,n.Boom];var r,i;o.BirdIndexRandom=[[79,85,124,130,157],[64,70,97,139,145]],function(e){e[e.Normal=0]="Normal",e[e.Double=1]="Double",e[e.Boom=2]="Boom",e[e.Magic=3]="Magic",e[e.Horce=4]="Horce"}(o.SpecialType||(o.SpecialType={})),o.SpecialIndex={47:null,48:null,49:null},o.ChangeColorExcept=[n.Bird,n.Blank],o.BubbleHeightOffset=-14,o.BubbleYOffset=1205,o.BubbleXOffset=20,o.InitColNumber=10,o.InitStartIndex=47,o.BubbleSize=cc.size(83,83),o.BubbleQueRange={Min:4,Max:9},o.ClearTargetRange={Min:2,Max:6},o.GameTime=180,o.TargetRandomLimit=120,o.DefaultTaskCount=9,o.DoubleBubbleInitRange={Min:3,Max:5},o.DoubleBubbleRange={Min:1,Max:2},o.BoomBubbleRange={Min:1,Max:2},o.MagicBubbleRange={Min:0,Max:1},o.BoomBubbleInitRange={Min:3,Max:5},o.MagicBubbleInitRange={Min:0,Max:3},o.ClearCountLimit=3,o.ShooterDoubleRange={Min:6,Max:10},o.ShooterDoubleBubbleRange={Min:0,Max:1},o.ShooterBoomRange={Min:6,Max:10},o.ShooterBoomBubbleRange={Min:0,Max:1},o.ShooterMagicRange={Min:4,Max:6},o.ShooterMagicBubbleRange={Min:0,Max:1},o.TaskStreakAward=3,function(e){e[e.Spring=0]="Spring",e[e.Summer=1]="Summer",e[e.Autumn=2]="Autumn",e[e.Winter=3]="Winter"}(r=o.Season||(o.Season={})),o.SeasonPool=[r.Spring,r.Summer,r.Autumn,r.Winter],function(e){e[e.Level_200=200]="Level_200",e[e.Level_400=400]="Level_400",e[e.Level_600=600]="Level_600",e[e.Level_800=800]="Level_800",e[e.Level_1000=1e3]="Level_1000"}(i=o.TreasureType||(o.TreasureType={})),o.TreasurePool=[i.Level_200,i.Level_400,i.Level_600,i.Level_800,i.Level_1000],o.Treasure_Top={0:{200:"bg_sfinish200",400:"bg_sfinish400",600:"bg_sfinish600",800:"bg_sfinish800",1e3:"bg_sfinish1000"},1:{200:"bg_smfinish200",400:"bg_smfinish400",600:"bg_smfinish600",800:"bg_smfinish800",1e3:"bg_smfinish1000"},2:{200:"bg_afinish200",400:"bg_afinish400",600:"bg_afinish600",800:"bg_afinish800",1e3:"bg_afinish1000"},3:{200:"bg_wfinish200",400:"bg_wfinish400",600:"bg_wfinish600",800:"bg_wfinish800",1e3:"bg_wfinish1000"}},function(e){e[e.OUT_OF_MOVE=0]="OUT_OF_MOVE",e[e.TIME_UP=1]="TIME_UP"}(o.OverType||(o.OverType={})),o.FireBar={Start:8,End:87},cc._RF.pop()},{}],EventManager:[function(e,t,o){"use strict";cc._RF.push(t,"1be43vsI5VEx6cptNa56Bfq","EventManager"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){this.eventTarget=new cc.EventTarget}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.emit=function(e,t,o,n,r,i){this.eventTarget.emit(e.toString(),t,o,n,r,i)},e.prototype.on=function(e,t,o,n){return this.eventTarget.on(e.toString(),t,o,n)},e.prototype.once=function(e,t,o){this.eventTarget.once(e.toString(),t,o)},e.prototype.dispatchEvent=function(e){this.eventTarget.dispatchEvent(e)},e.prototype.off=function(e,t,o){this.eventTarget.off(e.toString(),t,o)},e.prototype.hasEventListener=function(e){return this.eventTarget.hasEventListener(e.toString())},e.prototype.targetOff=function(e){this.eventTarget.targetOff(e)},e}();o.gEventMgr=n.inst,cc._RF.pop()},{}],EventName:[function(e,t,o){"use strict";cc._RF.push(t,"017c8l+T9FHF5CNitqArJpl","EventName"),Object.defineProperty(o,"__esModule",{value:!0}),function(e){e[e.BUBBLE_SCALE_TEST=0]="BUBBLE_SCALE_TEST",e[e.SMALL_BGM=1]="SMALL_BGM",e[e.NORMAL_BGM=2]="NORMAL_BGM",e[e.SHOOT=3]="SHOOT",e[e.BUBBLE_FORCE=4]="BUBBLE_FORCE",e[e.ADD_BUBBLE=5]="ADD_BUBBLE",e[e.ADD_SCORE=6]="ADD_SCORE",e[e.GAME_OVER=7]="GAME_OVER",e[e.UPDATE_TASK=8]="UPDATE_TASK",e[e.NEXT_BUBBLE=9]="NEXT_BUBBLE",e[e.PLAY_EFFECT=10]="PLAY_EFFECT",e[e.HORCE_CLEAR=11]="HORCE_CLEAR",e[e.GET_TREASURE=12]="GET_TREASURE",e[e.CHECK_TREASURE=13]="CHECK_TREASURE",e[e.CHANGE_BGM=14]="CHANGE_BGM",e[e.SHOW_STREAK=15]="SHOW_STREAK",e[e.SHOW_REBOUNCE=16]="SHOW_REBOUNCE",e[e.UPDATE_INDEX=17]="UPDATE_INDEX",e[e.UPDATE_POINTER_ROTATION=18]="UPDATE_POINTER_ROTATION",e[e.ON_POINTER_ROTATED=19]="ON_POINTER_ROTATED",e[e.IS_GREEN_IDLE=20]="IS_GREEN_IDLE",e[e.GET_CHANGE_BUTTON=21]="GET_CHANGE_BUTTON",e[e.PLAY_LOAD=22]="PLAY_LOAD",e[e.BUBBLE_LOAD=23]="BUBBLE_LOAD",e[e.OPEN_PAUSE=24]="OPEN_PAUSE",e[e.READY_GO=25]="READY_GO",e[e.SHOW_START=26]="SHOW_START",e[e.Hide_Load=27]="Hide_Load"}(o.GlobalEvent||(o.GlobalEvent={})),cc._RF.pop()},{}],FrameAniBase:[function(e,t,o){"use strict";cc._RF.push(t,"b2d80rjoMtDXKhceGVjLXGq","FrameAniBase");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,a=i.ccclass,c=i.property,l=i.executeInEditMode,s=i.requireComponent,u=i.playOnFocus,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.Frames=null,t.Interval=.1,t.Priority=0,t.Loop=!1,t.PlayOnLoad=!1,t.currentIndex=0,t.time=0,t.isPlay=!1,t.listener=[],t.complateEvent=[],t}var o;return n(t,e),o=t,Object.defineProperty(t.prototype,"Sprite",{get:function(){return this.node.getComponent(cc.Sprite)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Animation",{set:function(e){this.Frames=e},enumerable:!0,configurable:!0}),t.prototype.onFocusInEditor=function(){this.time=this.Interval,o.intervalID=setInterval(this.update.bind(this),.016,.016)},t.prototype.onLostFocusInEditor=function(){clearInterval(o.intervalID)},t.prototype.onLoad=function(){this.time=this.Interval,this.isPlay=this.PlayOnLoad},t.prototype.play=function(){this.isPlay=!0,this.currentIndex=0,0==this.isPlaying&&this.callEventComplete()},t.prototype.playOnLoop=function(){this.Loop=!0,this.play()},t.prototype.playByStep=function(){this.isPlay=!0,this.nextFrame(),this.isPlay=!1},t.prototype.pause=function(){this.isPlay=!1},t.prototype.resume=function(){this.isPlay=!0},t.prototype.stop=function(){this.isPlay=!1,this.currentIndex=0,this.Loop=!1},t.prototype.onKeyFrame=function(e){},t.prototype.addKeyEventListener=function(e,t){this.listener.push({callback:e,target:t})},Object.defineProperty(t.prototype,"ListenerCount",{get:function(){return this.listener.length},enumerable:!0,configurable:!0}),t.prototype.clearAllListener=function(){return this.listener.length=0,this},t.prototype.onComplete=function(){},t.prototype.callEventFrame=function(){this.onKeyFrame(this.currentIndex);for(var e=0,t=this.listener;e<t.length;e++){var o=t[e];o.callback.apply(o.target,[this.currentIndex,this.__classname__])}},t.prototype.callEventComplete=function(){this.onComplete();for(var e=0,t=this.complateEvent;e<t.length;e++){var o=t[e];o.f.apply(o.target,[this.__classname__])}},t.prototype.addCompleteEvent=function(e,t){this.complateEvent.push({f:e,target:t})},Object.defineProperty(t.prototype,"TotalFrameCount",{get:function(){return this.Frames&&this.Frames.getSpriteFrames?this.Frames.getSpriteFrames().length:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CompleteEventCount",{get:function(){return this.complateEvent.length},enumerable:!0,configurable:!0}),t.prototype.clearCompleteEvent=function(){return this.complateEvent.length=0,this},t.prototype.start=function(){},Object.defineProperty(t.prototype,"isPlaying",{get:function(){if(this.isPlay&&this.Frames&&this.Frames.getSpriteFrames&&this.Frames.getSpriteFrames().length>0){for(var e=0,t=this.getComponents(o);e<t.length;e++){var n=t[e];if(n.Priority>this.Priority&&n.isPlaying)return!1}return!0}return!1},enumerable:!0,configurable:!0}),t.prototype.nextFrame=function(){0!=this.isPlaying?this.Frames&&this.Frames.getSpriteFrames&&this.Frames.getSpriteFrames().length>0&&(this.Sprite.spriteFrame=this.Frames.getSpriteFrames()[this.currentIndex],this.callEventFrame(),this.currentIndex=(this.currentIndex+1)%this.Frames.getSpriteFrames().length,0==this.currentIndex&&0==this.Loop&&(this.isPlay=!1,this.callEventComplete())):this.time=this.Interval},t.prototype.update=function(e){this.time>=this.Interval&&(this.time=0,this.nextFrame()),this.time+=e},t.aniName="FrameAniBase",t.intervalID=-1,r([c(cc.SpriteAtlas)],t.prototype,"Frames",void 0),r([c],t.prototype,"Interval",void 0),r([c],t.prototype,"Priority",void 0),r([c],t.prototype,"Loop",void 0),r([c],t.prototype,"PlayOnLoad",void 0),t=o=r([a,l,u,s(cc.Sprite)],t)}(cc.Component);o.default=h,cc._RF.pop()},{}],GameFactory:[function(e,t,o){"use strict";cc._RF.push(t,"949976qNuFDsoz+OUdWWlhf","GameFactory"),Object.defineProperty(o,"__esModule",{value:!0});var n,r=e("../Utils/HashMap"),i=function(){function e(e,t,o){this._pool=[],this.poolHandlerComps=[],this.poolHandlerComps=o,this.template=e,this.initPool(t)}return e.prototype.initPool=function(e){for(var t=this,o=0;o<e;++o)if(e>1)setTimeout(function(){var e=cc.instantiate(t.template);t.put(e)});else{var n=cc.instantiate(this.template);this.put(n)}},e.prototype.size=function(){return this._pool.length},e.prototype.clear=function(){for(var e=this._pool.length,t=0;t<e;++t)this._pool[t].destroy&&this._pool[t].destroy();this._pool.length=0},e.prototype.put=function(e){if(e&&-1===this._pool.indexOf(e)){if(e.removeFromParent(!1),this.poolHandlerComps)for(var t=0,o=this.poolHandlerComps;t<o.length;t++){var n=o[t],r=e.getComponent(n);r&&r.unuse&&r.unuse.apply(r)}else for(var i=0,a=e.getComponents(cc.Component);i<a.length;i++){(n=a[i])&&n.unuse&&n.unuse.apply(n)}this._pool.push(e)}},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=this._pool.length-1;o<0&&(console.warn(" last < 0 "),this.initPool(1)),o=this._pool.length-1;var n=this._pool[o];if(this._pool.length=o,this.poolHandlerComps)for(var r=0,i=this.poolHandlerComps;r<i.length;r++){var a=i[r],c=n.getComponent(a);c&&c.reuse&&c.reuse.apply(c,arguments)}else for(var l=0,s=n.getComponents(cc.Component);l<s.length;l++){(a=s[l])&&a.reuse&&a.reuse.apply(a,arguments)}return n},e}();(function(e){e[e.INIT=0]="INIT",e[e.Bubble=4]="Bubble",e[e.Point=8]="Point",e[e.Task=16]="Task",e[e.Score=32]="Score",e[e.Font=64]="Font",e[e.Bird=128]="Bird",e[e.DONE=252]="DONE"})(n||(n={}));var a=function(){function e(){this.step=n.INIT,this.BubblePool=new r.HashMap,this.PointPool=new r.HashMap,this.TaskPool=new r.HashMap,this.ScorePool=new r.HashMap,this.FontPool=new r.HashMap,this.BirdPool=new r.HashMap}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.init=function(e,t,o,n,r,i,a){this.doneCallback=e,this.initBubble(132,t),this.initPoint(20,o),this.initTask(8,n),this.initScore(10,r),this.initFont(5,i),this.initBird(5,a)},e.prototype.nextStep=function(e){this.step|=e,this.step>=n.DONE&&this.doneCallback&&this.doneCallback()},e.prototype.initBubble=function(e,t){var o=this;t?(o.BubblePool.add("Bubble",new i(t,e)),o.nextStep(n.Bubble)):cc.loader.loadRes("prefabs/Bubble",cc.Prefab,function(t,r){t?console.error(t):(o.BubblePool.add("Bubble",new i(r,e)),o.nextStep(n.Bubble))})},e.prototype.getBubble=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return(e=this.BubblePool.get("Bubble")).get.apply(e,t)},e.prototype.putBubble=function(e){this.BubblePool.get("Bubble").put(e)},e.prototype.initPoint=function(e,t){var o=this;t?(o.PointPool.add("Point",new i(t,e)),o.nextStep(n.Point)):cc.loader.loadRes("prefabs/Point",cc.Prefab,function(t,r){t?console.error(t):(o.PointPool.add("Point",new i(r,e)),o.nextStep(n.Point))})},e.prototype.getPoint=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return(e=this.PointPool.get("Point")).get.apply(e,t)},e.prototype.putPoint=function(e){this.PointPool.get("Point").put(e)},e.prototype.initTask=function(e,t){var o=this;t?(o.TaskPool.add("Task",new i(t,e)),o.nextStep(n.Task)):cc.loader.loadRes("prefabs/Mission",cc.Prefab,function(t,r){t?console.error(t):(o.TaskPool.add("Task",new i(r,e)),o.nextStep(n.Task))})},e.prototype.getTask=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return(e=this.TaskPool.get("Task")).get.apply(e,t)},e.prototype.putTask=function(e){this.TaskPool.get("Task").put(e)},e.prototype.initScore=function(e,t){var o=this;t?(o.ScorePool.add("Score",new i(t,e)),o.nextStep(n.Score)):cc.loader.loadRes("prefabs/ScoreFloat",cc.Prefab,function(t,r){t?console.error(t):(o.ScorePool.add("Score",new i(r,e)),o.nextStep(n.Score))})},e.prototype.getScore=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return(e=this.ScorePool.get("Score")).get.apply(e,t)},e.prototype.putScore=function(e){this.ScorePool.get("Score").put(e)},e.prototype.initFont=function(e,t){var o=this;t?(o.FontPool.add("Font",new i(t,e)),o.nextStep(n.Font)):cc.loader.loadRes("prefabs/Font",cc.Prefab,function(t,r){t?console.error(t):(o.FontPool.add("Font",new i(r,e)),o.nextStep(n.Font))})},e.prototype.getFont=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return(e=this.FontPool.get("Font")).get.apply(e,t)},e.prototype.putFont=function(e){this.FontPool.get("Font").put(e)},e.prototype.initBird=function(e,t){var o=this;t?(o.BirdPool.add("Bird",new i(t,e)),o.nextStep(n.Bird)):cc.loader.loadRes("prefabs/Bird",cc.Prefab,function(t,r){t?console.error(t):(o.BirdPool.add("Bird",new i(r,e)),o.nextStep(n.Bird))})},e.prototype.getBird=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return(e=this.BirdPool.get("Bird")).get.apply(e,t)},e.prototype.putBird=function(e){this.BirdPool.get("Bird").put(e)},e}();o.gFactory=a.inst,cc._RF.pop()},{"../Utils/HashMap":"HashMap"}],GameScene:[function(e,t,o){"use strict";cc._RF.push(t,"63c91B5GQpJwrTOBvKO60W6","GameScene");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i,a=e("./Controller/GameFactory"),c=e("./Controller/Game"),l=e("./Const"),s=e("./Data/BubbleMatrix"),u=e("./Bubble"),h=e("./Controller/EventManager"),p=e("./Controller/StepController"),d=e("./Controller/AudioController"),b=e("./Controller/EventName"),f=e("./Guide"),g=e("./ResultLayer"),y=e("./BubbleMove"),m=e("./Utils/LogHandler"),v=e("./FrameAniBase"),_=e("./BubbleAnimation/BubbleHorce"),S=e("./Utils/celerx");(function(e){e.Prefab="Prefab",e.Audio="Audio"})(i||(i={}));var C=cc._decorator,B=C.ccclass,E=C.property,M=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.BubblePrefab=null,t.PointPrefab=null,t.TaskPrefab=null,t.BirdPrefab=null,t.AddScorePrefab=null,t.BubbleAtlas=[],t.BubbleChange=null,t.X2=null,t.BubbleBurst=[],t.BubbleHorce=null,t.BubbleDrop=null,t.SpringBack=null,t.SummerBack=null,t.AutumnBack=null,t.WinterBack=null,t.SpringMask=null,t.SummerMask=null,t.AutumnMask=null,t.WinterMask=null,t.MaskMachine=null,t.NowStreak=null,t.FireBar=null,t.Guide=null,t.Background=null,t.FontAtlas=null,t.TimeFont=null,t.FontPrefab=null,t.FontRoot=null,t.TreasureRoot=null,t.BigTreasure=null,t.SmallTreasure=null,t.ResultTitle=null,t.ResultFont=null,t.BubbleLayer=null,t.Shooter=null,t.TopNode=null,t.BulletArray=null,t.TaskArray=null,t.ShooterLayer=null,t.TimeLabel=null,t.TimeLabel2=null,t.ScoreLabel=null,t.ChangeShooter=null,t.ReadyShooter=null,t.ChangeCube=null,t.ChangeButton=null,t.PauseButton=null,t.TreasureBar=null,t.BirdRoot=null,t.showScore=0,t.score=0,t.addScoreStep=0,t.TreasureProgress=[0,0,.3,.5,.8,1],t}return n(t,e),t.prototype.onLoad=function(){this.ChangeCube.active=!1,this.ChangeButton.node.active=!0,this.ChangeButton.interactable=!0,this.ShooterLayer.active=!1,m.LogHandler.inst.initLog(S.log),m.LogHandler.inst.log(" game scene on load:",window.location?window.location.href:"null location"),cc.debug.setDisplayStats(!1),this.ResultFont.node.scale=0,c.Game.FontRoot=this.FontRoot,c.Game.BubbleLayer=this.BubbleLayer,c.Game.TopNode=this.TopNode;for(var e=0,t=this.BirdRoot.children;e<t.length;e++){t[e].getChildByName("Score").opacity=0}var o=this;S.onStart(function(){o.celerOnStart()}.bind(this)),S.provideScore(function(){return parseInt(c.Game.getScore().toString())}),p.gStep.register(this.celerReady.bind(this),[i.Audio,i.Prefab]),a.gFactory.init(function(){p.gStep.nextStep(i.Prefab)},this.BubblePrefab,this.PointPrefab,this.TaskPrefab,this.AddScorePrefab,this.FontPrefab,this.BirdPrefab),d.gAudio.init(function(){p.gStep.nextStep(i.Audio)}),this.initEvent(),this.TimeLabel.node.getParent().getChildByName("noTime").opacity=0},t.prototype.celerReady=function(){m.LogHandler.inst.log(" call celerx.ready:",CELER_X),S.ready(),CELER_X||this.celerOnStart()},t.prototype.celerOnStart=function(){var e=S.getMatch();c.Game.MatchInfo=e||{},e&&e.sharedRandomSeed?(CMath.randomSeed=e.sharedRandomSeed,CMath.sharedSeed=e.sharedRandomSeed,console.log(" match id:",e.matchId)):(console.error(" match sharedRandomSeed null!"),CMath.randomSeed=Math.random()),m.LogHandler.inst.log(" celer on start:",c.Game.MatchInfo.matchId,", seed:",c.Game.MatchInfo.sharedRandomSeed),c.Game.prepare(),c.Game.start(),this.updateSeason(),this.show(),this.ShooterLayer.active=!0,e&&e.shouldLaunchTutorial?(this.Guide.show(function(){h.gEventMgr.emit(b.GlobalEvent.READY_GO)}),localStorage.setItem("guide","true"),h.gEventMgr.emit(b.GlobalEvent.SHOW_START,!1)):(this.Guide.hide(),h.gEventMgr.emit(b.GlobalEvent.SHOW_START,!0)),cc.loader.loadRes("prefabs/Spring/ResultLayer"),h.gEventMgr.emit(b.GlobalEvent.Hide_Load)},t.prototype.updateTreasure=function(){console.log(" start load treasure");for(var e=[l.TreasureType.Level_1000,l.TreasureType.Level_800],t=function(t){var o=Math.floor(CMath.getRandom(0,e.length)),n=e[o];cc.loader.loadRes("prefabs/"+l.Season[c.Game.Season]+"/"+n,cc.Prefab,function(e,o){if(e)console.error(" load treasure err:",e);else{var n=cc.instantiate(o);t.addChild(n)}}),e.splice(o,1)},o=0,n=this.BigTreasure.children;o<n.length;o++){t(n[o])}for(var r=[l.TreasureType.Level_200,l.TreasureType.Level_400,l.TreasureType.Level_600],i=function(e){var t=Math.floor(CMath.getRandom(0,r.length)),o=r[t];cc.loader.loadRes("prefabs/"+l.Season[c.Game.Season]+"/"+o,cc.Prefab,function(t,o){if(t)console.error(" load treasure err:",t);else{var n=cc.instantiate(o);e.addChild(n)}}),r.splice(t,1)},a=0,s=this.SmallTreasure.children;a<s.length;a++){i(s[a])}},t.prototype.updateSeason=function(){switch(c.Game.Season){case l.Season.Spring:console.log(" set Spring bg"),this.Background.spriteFrame=this.SpringBack,this.MaskMachine.spriteFrame=this.SpringMask;break;case l.Season.Summer:console.log(" set Summer bg"),this.Background.spriteFrame=this.SummerBack,this.MaskMachine.spriteFrame=this.SummerMask;break;case l.Season.Autumn:this.Background.spriteFrame=this.AutumnBack,this.MaskMachine.spriteFrame=this.AutumnMask;break;case l.Season.Winter:this.Background.spriteFrame=this.WinterBack,this.MaskMachine.spriteFrame=this.WinterMask}},t.prototype.updateIndex=function(){h.gEventMgr.emit(b.GlobalEvent.UPDATE_INDEX)},t.prototype.initEvent=function(){var e=this;h.gEventMgr.targetOff(this),this.BulletArray.on(cc.Node.EventType.CHILD_REMOVED,this.onBubbleQueRemoveChild,this),this.Shooter.on(cc.Node.EventType.CHILD_REMOVED,this.onShooterRemoveChild,this),h.gEventMgr.on(b.GlobalEvent.GET_CHANGE_BUTTON,function(){e.ChangeButton.node.active=!0,e.ChangeCube.active=!0,e.ChangeCube.getChildByName("ani").runAction(cc.fadeIn(0)),e.ChangeCube.getChildByName("ani").getComponent(v.default).onComplete=function(){e.ChangeCube.getChildByName("ani").runAction(cc.fadeOut(.1))},e.ChangeCube.getComponentInChildren(v.default).play();var t=e.ChangeCube.getChildByName("Cube");if(t){var o=t.scale;t.runAction(cc.sequence(cc.spawn(cc.scaleTo(.1,2*o),cc.fadeTo(.1,150)),cc.delayTime(.2),cc.spawn(cc.sequence(cc.scaleTo(.1,1.2*o),cc.scaleTo(.1,1.6*o),cc.scaleTo(.1,1*o)),cc.fadeIn(.15)),cc.delayTime(.15),cc.fadeOut(.15)))}var n=e.ChangeCube.getChildByName("CubeAni");n&&(n.runAction(cc.fadeIn(0)),n.getComponent(v.default).onComplete=function(){n.runAction(cc.fadeOut(.1))},n.getComponent(v.default).play())},this),this.ChangeButton.node.on(cc.Node.EventType.TOUCH_END,function(){if(0!=e.ChangeButton.interactable){h.gEventMgr.emit(b.GlobalEvent.PLAY_EFFECT,"selectionChange");var t=e.Shooter.children[0],o=e.ReadyShooter.children[0];t.setPosition(CMath.ConvertToNodeSpaceAR(t,e.ReadyShooter)),t.setParent(e.ReadyShooter),t.getComponent(y.default).unreadyToShoot(),t.runAction(cc.sequence(cc.moveTo(.15,-15,88),cc.moveTo(.1,0,0))),o.setPosition(CMath.ConvertToNodeSpaceAR(o,e.Shooter)),o.setParent(e.Shooter),o.runAction(cc.sequence(cc.delayTime(.1),cc.moveTo(.2,0,0),cc.callFunc(function(){console.log(" ready bubble ready to shoot"),o.getComponent(y.default).readyToShoot()})))}},this),this.PauseButton.node.on(cc.Node.EventType.TOUCH_END,function(){h.gEventMgr.emit(b.GlobalEvent.PLAY_EFFECT,"button_click"),h.gEventMgr.emit(b.GlobalEvent.OPEN_PAUSE)},this),h.gEventMgr.on(b.GlobalEvent.GET_TREASURE,function(t,o){var n=e.BirdRoot.getChildByName(t.toString());if(null!=n){var r=a.gFactory.getBird(200*t,CMath.ConvertToNodeSpaceAR(o,n));n.addChild(r)}},this),h.gEventMgr.on(b.GlobalEvent.SHOW_REBOUNCE,function(t){var o=a.gFactory.getFont();o.getComponent(cc.Sprite).spriteFrame=e.FontAtlas.getSpriteFrame("f_rebound"),o.scale=0,o.opacity=255,e.TopNode.addChild(o),o.x=0;o.setPosition(t),o.group="effect",h.gEventMgr.emit(b.GlobalEvent.PLAY_EFFECT,"font"),o.runAction(cc.sequence(cc.scaleTo(.1,1),cc.callFunc(function(){c.Game.addScore(l.BubbleType.Rebounce,50,2,cc.v2(o.x+o.width/2,o.y),!1)},e),cc.delayTime(.6),cc.spawn(cc.scaleTo(.2,1),cc.fadeTo(.2,0)),cc.callFunc(function(){a.gFactory.putFont(o)},e)))},this),h.gEventMgr.on(b.GlobalEvent.SHOW_STREAK,function(t,o){if(t){var n=null;switch(o){case 2:n=e.FontAtlas.getSpriteFrame("f_streak");break;case 3:n=e.FontAtlas.getSpriteFrame("f_sstreak");break;case 4:n=e.FontAtlas.getSpriteFrame("f_great");break;case 5:n=e.FontAtlas.getSpriteFrame("f_amazing");break;default:n=e.FontAtlas.getSpriteFrame("f_awesome")}var r=a.gFactory.getFont();r.getComponent(cc.Sprite).spriteFrame=n,r.scale=0,r.opacity=255,e.FontRoot.addChild(r),r.x=0;var i=1+.07*o;r.y=e.FontRoot.childrenCount*(150*i),h.gEventMgr.emit(b.GlobalEvent.PLAY_EFFECT,"font"),r.runAction(cc.sequence(cc.scaleTo(.1,i),cc.delayTime(.3),cc.callFunc(function(){if(t){c.Game.addScore(l.BubbleType.Streak,25+15*(o-2),.3*(o-2)+2,CMath.ConvertToNodeSpaceAR(r,e.TopNode).add(cc.v2(r.width/2,r.height/2)))}},e),cc.spawn(cc.scaleTo(.2,1),cc.fadeTo(.2,0)),cc.callFunc(function(){a.gFactory.putFont(r)},e)))}},this),h.gEventMgr.on(b.GlobalEvent.ADD_BUBBLE,this.addNextBubble,this),h.gEventMgr.on(b.GlobalEvent.UPDATE_TASK,this.updateTask,this),h.gEventMgr.on(b.GlobalEvent.NEXT_BUBBLE,this.getShooterBubble,this),h.gEventMgr.on(b.GlobalEvent.ADD_SCORE,this.addScore,this),h.gEventMgr.once(b.GlobalEvent.GAME_OVER,function(t){c.Game.isStart=!1,t==l.OverType.OUT_OF_MOVE?e.ResultFont.spriteFrame=e.ResultTitle.getSpriteFrame("bg_font_gameover"):e.ResultFont.spriteFrame=e.ResultTitle.getSpriteFrame("bg_font_timeup"),e.ResultFont.node.runAction(cc.sequence(cc.scaleTo(.1,1.5),cc.delayTime(.5),cc.scaleTo(.1,1.2),cc.callFunc(function(){cc.loader.loadRes("prefabs/Spring/ResultLayer",cc.Prefab,function(o,n){var r;o?(cc.error("load result :",o),console.error(" submit score by open result err:",c.Game.MatchInfo.matchId,", seed:",c.Game.MatchInfo.sharedRandomSeed),S.submitScore(c.Game.getScore())):(r=t==l.OverType.OUT_OF_MOVE?e.ResultTitle.getSpriteFrame("bg_result_font2"):e.ResultTitle.getSpriteFrame("bg_result_font1"),setTimeout(function(){var t=cc.instantiate(n);t.getComponent(g.default).setTexture(r),e.node.addChild(t)},0))})},e)))},this)},t.prototype.updateTask=function(){var e=c.Game.getCurTarget();console.log(e);for(var t=0;t<Math.min(e.now,this.TaskArray.childrenCount);t++){var o=this.TaskArray.children[t],n=o.getChildByName("Complete");0==o.scale||n.scale>.5||n.runAction(cc.sequence(cc.scaleTo(.1,1.5),cc.scaleTo(.1,1)))}},t.prototype.addNextBubble=function(e){for(void 0===e&&(e=1);e--;)this.nextBubble()},t.prototype.show=function(){console.log(" game show !!!");var e=2+l.InitColNumber,t=s.IndexJStart,o=s.IndexJEnd;this.addBubble(2,e,t,o),this.getNewTask(l.DefaultTaskCount)},t.prototype.nextBubble=function(){c.Game.addMoveTimes();var e=c.Game.getMatrix();e.moveRow(1),this.BubbleLayer.height+=l.BubbleSize.height+l.BubbleHeightOffset,this.BubbleLayer.runAction(cc.sequence(cc.moveBy(.2,0,-(l.BubbleSize.height+l.BubbleHeightOffset)),cc.callFunc(function(){c.Game.checkOutOfMove(),h.gEventMgr.emit(b.GlobalEvent.CHECK_TREASURE)},this))),this.addBubble(e.index2i(c.Game.startIndex)-1,e.index2i(c.Game.startIndex)-1,s.IndexJStart,s.IndexJEnd,1);for(var t=c.Game.startIndex;t<=c.Game.startIndex+s.UseSize-1;t++){if(!e.data[t]||!e.data[t].bubble)return;e.data[t].bubble.updateActive(t/700+(t-c.Game.startIndex)/50)}},t.prototype.addBubble=function(e,t,o,n,r){void 0===r&&(r=0),console.log(" add bubble , istart:",e,", iend:",t,",jstart:",o,", jend:",n);for(var i=c.Game.getMatrix(),a=e;a<=t;a++)for(var l=o;l<=n;l++){var s=i.ij2index(a,l),h=c.Game.getBubble(i.data[s].type,s,i.data[s].color,this.BubbleAtlas,this.BubbleChange,this.BubbleBurst,this.BubbleHorce,this.BubbleDrop,this.X2);h||console.error(" bubble is null");var p=i.getPosOfij(a,l);h.x=p.x,h.y=p.y,this.BubbleLayer.addChild(h),i.data[s].bubble=h.getComponent(u.default),h.getComponent(u.default).updateActive(s/700+(s-c.Game.startIndex)/50*r)}c.Game.updateCollisionIndexes()},t.prototype.onShooterRemoveChild=function(){},t.prototype.newBubbleArray=function(e){var t=c.Game.getCurTarget();t.now<t.target&&this.addNextBubble(1),this.getNewTask(e)},t.prototype.getShooterBubble=function(e){var t=this;if(this.BulletArray.childrenCount<=0&&this.ReadyShooter.childrenCount<=0){if(!this.ChangeCube.active)return void this.newBubbleArray(e);if(this.ChangeShooter.childrenCount<=0)return console.log(" \u4e09\u4e2a\u4f4d\u7f6e\u90fd\u6ca1\u6ce1\u6ce1"),void this.newBubbleArray(e)}if(this.Shooter.childrenCount>0&&console.error(" shooter has bubble! getShooterBubble--"),this.ReadyShooter.childrenCount<=0)if(console.warn(" ready \u6ca1\u6709\u6ce1\u6ce1"),this.ChangeCube.active){if(this.ChangeShooter.childrenCount<=0){if(this.BulletArray.childrenCount<=0)return console.error(" bullet array is 0, cube is active"),void this.newBubbleArray(e);var o=this.BulletArray.children[0];o.setPosition(CMath.ConvertToNodeSpaceAR(o,this.ChangeShooter)),o.setParent(this.ChangeShooter),o.runAction(cc.sequence(cc.moveBy(.1,0,-200),cc.scaleTo(0,0),cc.moveTo(0,0),cc.scaleTo(.1,1),cc.callFunc(function(){if(o.setPosition(CMath.ConvertToNodeSpaceAR(o,t.ReadyShooter)),o.setParent(t.ReadyShooter),o.runAction(cc.sequence(cc.moveTo(.2,0,0),cc.callFunc(function(){t.putNextShooterBubble()}))),t.BulletArray.childrenCount>0){var e=t.BulletArray.children[0];e.setPosition(CMath.ConvertToNodeSpaceAR(e,t.ChangeShooter)),e.setParent(t.ChangeShooter),e.runAction(cc.sequence(cc.moveBy(.1,0,-200),cc.scaleTo(0,0),cc.moveTo(0,0),cc.scaleTo(.1,1)))}else console.log(" bullet array has no bubble 741")})))}}else{if(this.BulletArray.childrenCount<=0)return console.error(" bullet array is 0"),void this.newBubbleArray(e);var n=this.BulletArray.children[0];n.setPosition(CMath.ConvertToNodeSpaceAR(n,this.ReadyShooter)),n.setParent(this.ReadyShooter),h.gEventMgr.emit(b.GlobalEvent.PLAY_LOAD),n.scale=this.BulletArray.scale,n.runAction(cc.sequence(cc.scaleTo(0,0),cc.moveTo(0,0,0))),h.gEventMgr.once(b.GlobalEvent.BUBBLE_LOAD,function(){n.runAction(cc.scaleTo(.1,1))},this)}else this.putNextShooterBubble()},t.prototype.putNextShooterBubble=function(){console.log("putNextShooterBubble, ready:",this.ReadyShooter.childrenCount,", cube:",this.ChangeShooter.childrenCount,", shooter:",this.Shooter.childrenCount);var e=this.ReadyShooter.children[0];if(e.setPosition(CMath.ConvertToNodeSpaceAR(e,this.Shooter)),e.setParent(this.Shooter),e.scale=1,e.runAction(cc.spawn(cc.fadeTo(.2,255),cc.moveTo(.2,0,0),cc.callFunc(function(){e.getComponent(y.default).readyToShoot()}))),this.ChangeCube.active)if(this.ChangeShooter.childrenCount>0){var t=this.ChangeShooter.children[0];if(t.setPosition(CMath.ConvertToNodeSpaceAR(t,this.ReadyShooter)),t.setParent(this.ReadyShooter),h.gEventMgr.emit(b.GlobalEvent.PLAY_LOAD),t.scale=0,h.gEventMgr.once(b.GlobalEvent.BUBBLE_LOAD,function(){t.runAction(cc.scaleTo(.1,1))},this),t.runAction(cc.moveTo(.2,0,0)),this.BulletArray.childrenCount>0){var o=this.BulletArray.children[0];o.setPosition(CMath.ConvertToNodeSpaceAR(o,this.ChangeShooter)),o.setParent(this.ChangeShooter),o.scale=this.BulletArray.scale,o.runAction(cc.sequence(cc.spawn(cc.moveBy(.1,0,-200),cc.scaleTo(.05,0)),cc.scaleTo(0,0),cc.moveTo(0,0,0),cc.scaleTo(.1,1)))}else console.log(" bullet array has no bubble")}else console.log(" change shooter has no bubble");else if(this.BulletArray.childrenCount>0){var n=this.BulletArray.children[0];n.setPosition(CMath.ConvertToNodeSpaceAR(n,this.ReadyShooter)),n.setParent(this.ReadyShooter),h.gEventMgr.emit(b.GlobalEvent.PLAY_LOAD),n.scale=this.BulletArray.scale,n.runAction(cc.sequence(cc.scaleTo(0,0),cc.moveTo(0,0,0))),h.gEventMgr.once(b.GlobalEvent.BUBBLE_LOAD,function(){n.runAction(cc.scaleTo(.1,1))},this)}else console.log(" bullet array is 0")},t.prototype.getNewTask=function(e){var t=this;e||(e=Math.ceil(CMath.getRandom(l.BubbleQueRange.Min,l.BubbleQueRange.Max))),console.log("bubble que\uff1a",e);for(var o=[],n=0;n<e;n++)o.push(n);var r=Math.ceil(CMath.getRandom(l.ShooterDoubleRange.Min,l.ShooterDoubleRange.Max)),i=0,s=l.BubbleColors.concat(),p={};if(c.Game.getTaskLength()%r==0)for(i=Math.ceil(CMath.getRandom(l.ShooterDoubleBubbleRange.Min,l.ShooterDoubleBubbleRange.Max));i-- >0&&o.length>0;){var d=o[n=Math.floor(CMath.getRandom(0,o.length))];o.splice(n,1);var f=s[C=Math.floor(CMath.getRandom(0,s.length))];s.splice(C,1),s.length<=0&&(s=l.BubbleColors.concat()),p[d]=f}var g=Math.ceil(CMath.getRandom(l.ShooterBoomRange.Min,l.ShooterBoomRange.Max)),m=0,v=l.BubbleColors.concat(),S={};if(c.Game.getTaskLength()%g==0)for(m=Math.ceil(CMath.getRandom(l.ShooterBoomBubbleRange.Min,l.ShooterBoomBubbleRange.Max));m-- >0&&o.length>0;){d=o[n=Math.floor(CMath.getRandom(0,o.length))];o.splice(n,1);var C;f=v[C=Math.floor(CMath.getRandom(0,v.length))];v.splice(C,1),v.length<=0&&(v=l.BubbleColors.concat()),S[d]=f}var B=Math.ceil(CMath.getRandom(l.ShooterMagicRange.Min,l.ShooterMagicRange.Max)),E=0,M={};if(c.Game.getTaskLength()%B==0)for(E=Math.ceil(CMath.getRandom(l.ShooterMagicBubbleRange.Min,l.ShooterMagicBubbleRange.Max));E-- >0&&o.length>0;){d=o[n=Math.floor(CMath.getRandom(0,o.length))];o.splice(n,1),M[d]=l.BubbleType.Blank}var T=[];for(n=0;n<e;n++)T.push(l.BubbleColors[Math.floor(CMath.getRandom()*l.BubbleColors.length)]);var x=c.Game.getCurTarget();x.now>=x.target&&x.target>0?(c.Game.addTaskStreak(1),h.gEventMgr.emit(b.GlobalEvent.PLAY_EFFECT,"task_success")):(c.Game.addTaskStreak(-c.Game.getTaskStreak()),x.target>0&&h.gEventMgr.emit(b.GlobalEvent.PLAY_EFFECT,"task_fail"));var A=function(e){var t=T[e],o=l.SpecialType.Normal;p[e]&&(o=l.SpecialType.Double,t=p[e]),S[e]&&(o=l.SpecialType.Boom,t=S[e]),null!=M[e]&&(o=l.SpecialType.Magic,t=M[e]);var n=c.Game.getBubble(o,-1,t,R.BubbleAtlas,R.BubbleChange,R.BubbleBurst,R.BubbleHorce,R.BubbleDrop,R.X2);if(n.getComponent(u.default).setActive(!0,!0,e/50),n.scale=0,n.opacity=0,n.y=0,0==e){R.Shooter.childrenCount>0&&console.error(" shooter has bubble!"),n.x=0,R.Shooter.addChild(n);var r=!1;c.Game.getTaskStreak()>=l.TaskStreakAward&&(c.Game.addTaskStreak(-c.Game.getTaskStreak()),r=!0),n.runAction(cc.spawn(cc.scaleTo(.2,1),cc.fadeTo(.2,255),cc.moveTo(.3,0,0),cc.callFunc(function(){r&&(h.gEventMgr.emit(b.GlobalEvent.PLAY_EFFECT,"change_horce"),n.getComponent(u.default).setColor(l.BubbleType.Horce,l.SpecialType.Horce),n.getComponent(u.default).playAnimation(_.default,function(){n.getComponent(u.default).AnimationRoot.runAction(cc.fadeOut(.2))})),n.getComponent(y.default).readyToShoot()})))}else 1==e?(R.ReadyShooter.childrenCount>0&&console.error(" shooter has bubble!"),n.x=0,R.ReadyShooter.addChild(n),h.gEventMgr.once(b.GlobalEvent.BUBBLE_LOAD,function(){n.runAction(cc.scaleTo(.1,1))},R),n.scale=0,h.gEventMgr.emit(b.GlobalEvent.PLAY_LOAD),n.runAction(cc.spawn(cc.fadeTo(.2,255),cc.moveTo(.3,0,0),cc.callFunc(function(){})))):2==e?R.ChangeCube.active&&(R.ChangeShooter.childrenCount>0&&console.error(" shooter has bubble!"),n.x=0,R.ChangeShooter.addChild(n),n.runAction(cc.spawn(cc.scaleTo(.2,1),cc.fadeTo(.2,255),cc.moveTo(.3,0,0),cc.callFunc(function(){})))):(n.x=-200*e,R.BulletArray.addChild(n),n.runAction(cc.spawn(cc.scaleTo(.2,.5),cc.fadeTo(.2,255),cc.moveTo(.4,40-R.BulletArray.childrenCount*l.BubbleSize.width,0))))},R=this;for(n=0;n<T.length;n++)A(n);var O=CMath.getRandom(),P=0;if(P=c.Game.getGameTime()>=120?O<=.6?CMath.Clamp(e-Math.ceil(CMath.getRandom(2,10)),l.ClearTargetRange.Max,l.ClearTargetRange.Min):O<=.3?CMath.Clamp(e-Math.ceil(CMath.getRandom(1,2)),l.ClearTargetRange.Max,l.ClearTargetRange.Min):CMath.Clamp(e,l.ClearTargetRange.Max,l.ClearTargetRange.Min):O<=.6?CMath.Clamp(e-Math.ceil(CMath.getRandom(1,2)),l.ClearTargetRange.Max,l.ClearTargetRange.Min):O<=.2?CMath.Clamp(e-Math.ceil(CMath.getRandom(2,10)),l.ClearTargetRange.Max,l.ClearTargetRange.Min):CMath.Clamp(e,l.ClearTargetRange.Max,l.ClearTargetRange.Min),P=Math.min(e-1,P),console.log("task count\uff1a",P),this.TaskArray.childrenCount>0){var F=function(e){var o=G.TaskArray.children[e],n=o.getChildByName("Complete"),r=o.getChildByName("Fail");x.now>=x.target?o.runAction(cc.sequence(cc.delayTime(e/10),cc.scaleTo(.1,0),cc.callFunc(function(){e==t.TaskArray.childrenCount-1&&h.gEventMgr.emit(b.GlobalEvent.PLAY_EFFECT,"new_task"),n.scale=0,r.scale=0,e<=P-1&&o.runAction(cc.sequence(cc.delayTime(0),cc.scaleTo(.1,1.2),cc.delayTime(.05),cc.scaleTo(.1,1)))}))):(n.stopAllActions(),n.scale=0,r.runAction(cc.sequence(cc.delayTime(e/10),cc.scaleTo(.1,1),cc.delayTime(.2),cc.callFunc(function(){e==t.TaskArray.childrenCount-1&&h.gEventMgr.emit(b.GlobalEvent.PLAY_EFFECT,"new_task"),o.runAction(cc.sequence(cc.delayTime(e/10),cc.scaleTo(.1,0),cc.callFunc(function(){r.scale=0,e<=P-1&&o.runAction(cc.sequence(cc.delayTime(0),cc.scaleTo(.1,1.2),cc.delayTime(.05),cc.scaleTo(.1,1)))})))}))))},G=this;for(n=0;n<this.TaskArray.childrenCount;n++)F(n)}else for(h.gEventMgr.emit(b.GlobalEvent.PLAY_EFFECT,"new_task");this.TaskArray.childrenCount<6;){var w=a.gFactory.getTask();w.y=0,w.x=this.TaskArray.childrenCount*w.width*1.3+30,w.scale=0,this.TaskArray.childrenCount<P&&w.runAction(cc.sequence(cc.delayTime(this.TaskArray.childrenCount/10),cc.scaleTo(.1,1.2),cc.delayTime(.05),cc.scaleTo(.1,1))),this.TaskArray.addChild(w),w.getChildByName("Complete").scale=0,w.getChildByName("Fail").scale=0}c.Game.pushTarget({now:0,target:P}),console.log(" add new task done:",this.Shooter.childrenCount)},t.prototype.onBubbleQueRemoveChild=function(){for(var e=0,t=this.BulletArray.children;e<t.length;e++){t[e].runAction(cc.moveBy(.2,l.BubbleSize.width,0))}},t.prototype.addScore=function(e,t,o,n){var r=this;if(void 0===o&&(o=cc.v2(0,0)),void 0===n&&(n=!0),0==n)return this.score=c.Game.getScore(),void(this.addScoreStep=(this.score-this.showScore)/20);var i=a.gFactory.getScore();i.scale=0,i.opacity=255,i.getComponent(cc.Label).string="/"+e.toString(),this.TopNode.addChild(i),i.setPosition(o);var l=CMath.Distance(o,this.ScoreLabel.node.position)/1560;i.runAction(cc.sequence(cc.delayTime(.4),cc.fadeTo(l+.3,0))),i.runAction(cc.sequence(cc.scaleTo(.1,1.2*t),cc.delayTime(.2),cc.scaleTo(.1,1*t),cc.moveTo(l,this.ScoreLabel.node.position).easing(cc.easeInOut(1)),cc.scaleTo(.3,0),cc.callFunc(function(){r.score=c.Game.getScore(),r.addScoreStep=(r.score-r.showScore)/20,a.gFactory.putScore(i)})))},t.prototype.updateTimeCount=function(){var e=Math.floor(c.Game.getGameTime());if(!(e>5)){var t=this.TimeLabel.node.getParent().getChildByName("font").getComponent(cc.Sprite),o=this.TimeFont.getSpriteFrame("bg_time"+e);t.spriteFrame!=o&&(h.gEventMgr.emit(b.GlobalEvent.PLAY_EFFECT,"count"),t.spriteFrame=o,t.node.runAction(cc.sequence(cc.fadeTo(.2,255),cc.scaleTo(.1,1.2),cc.delayTime(.5),cc.scaleTo(.1,1),cc.fadeTo(.1,0))))}},t.prototype.update=function(e){if(this.FireBar.height=c.Game.getTaskStreak()/l.TaskStreakAward*(l.FireBar.End-l.FireBar.Start)+l.FireBar.Start,this.ChangeButton.interactable=this.ReadyShooter.childrenCount>0&&this.Shooter.childrenCount>0&&Math.abs(this.Shooter.children[0].x)<=.01&&Math.abs(this.Shooter.children[0].y)<=.01&&Math.abs(this.ReadyShooter.children[0].x)<=.01&&Math.abs(this.ReadyShooter.children[0].y)<=.01,c.Game.isStart&&(this.NowStreak.string=c.Game.getTaskStreak().toString(),this.TreasureBar.progress=this.TreasureProgress[c.Game.treasureCount],!this.Guide.node.active&&!this.node.getChildByName("PauseLayer").active)){c.Game.addGameTime(-e);var t=CMath.TimeFormat(c.Game.getGameTime()).split("-");this.TimeLabel.string=t[0],this.TimeLabel2.string=t[1],30==Math.floor(c.Game.getGameTime())&&this.TimeLabel.node.getParent().getChildByName("noTime").opacity<=0&&(this.TimeLabel.node.getParent().getChildByName("noTime").opacity=255,this.TimeLabel.node.getParent().getComponentInChildren(v.default).play(),h.gEventMgr.emit(b.GlobalEvent.CHANGE_BGM,"bgm_30")),this.updateTimeCount()}this.showScore<this.score&&(this.showScore+=this.addScoreStep,this.showScore=Math.min(this.score,this.showScore),this.ScoreLabel.string=Math.floor(this.showScore).toString())},r([E(cc.Prefab)],t.prototype,"BubblePrefab",void 0),r([E(cc.Prefab)],t.prototype,"PointPrefab",void 0),r([E(cc.Prefab)],t.prototype,"TaskPrefab",void 0),r([E(cc.Prefab)],t.prototype,"BirdPrefab",void 0),r([E(cc.Prefab)],t.prototype,"AddScorePrefab",void 0),r([E(cc.SpriteAtlas)],t.prototype,"BubbleAtlas",void 0),r([E(cc.SpriteAtlas)],t.prototype,"BubbleChange",void 0),r([E(cc.SpriteAtlas)],t.prototype,"X2",void 0),r([E(cc.SpriteAtlas)],t.prototype,"BubbleBurst",void 0),r([E(cc.SpriteAtlas)],t.prototype,"BubbleHorce",void 0),r([E(cc.SpriteAtlas)],t.prototype,"BubbleDrop",void 0),r([E(cc.SpriteFrame)],t.prototype,"SpringBack",void 0),r([E(cc.SpriteFrame)],t.prototype,"SummerBack",void 0),r([E(cc.SpriteFrame)],t.prototype,"AutumnBack",void 0),r([E(cc.SpriteFrame)],t.prototype,"WinterBack",void 0),r([E(cc.SpriteFrame)],t.prototype,"SpringMask",void 0),r([E(cc.SpriteFrame)],t.prototype,"SummerMask",void 0),r([E(cc.SpriteFrame)],t.prototype,"AutumnMask",void 0),r([E(cc.SpriteFrame)],t.prototype,"WinterMask",void 0),r([E(cc.Sprite)],t.prototype,"MaskMachine",void 0),r([E(cc.Label)],t.prototype,"NowStreak",void 0),r([E(cc.Node)],t.prototype,"FireBar",void 0),r([E(f.default)],t.prototype,"Guide",void 0),r([E(cc.Sprite)],t.prototype,"Background",void 0),r([E(cc.SpriteAtlas)],t.prototype,"FontAtlas",void 0),r([E(cc.SpriteAtlas)],t.prototype,"TimeFont",void 0),r([E(cc.Prefab)],t.prototype,"FontPrefab",void 0),r([E(cc.Node)],t.prototype,"FontRoot",void 0),r([E(cc.Node)],t.prototype,"TreasureRoot",void 0),r([E(cc.Node)],t.prototype,"BigTreasure",void 0),r([E(cc.Node)],t.prototype,"SmallTreasure",void 0),r([E(cc.SpriteAtlas)],t.prototype,"ResultTitle",void 0),r([E(cc.Sprite)],t.prototype,"ResultFont",void 0),r([E(cc.Node)],t.prototype,"BubbleLayer",void 0),r([E(cc.Node)],t.prototype,"Shooter",void 0),r([E(cc.Node)],t.prototype,"TopNode",void 0),r([E(cc.Node)],t.prototype,"BulletArray",void 0),r([E(cc.Node)],t.prototype,"TaskArray",void 0),r([E(cc.Node)],t.prototype,"ShooterLayer",void 0),r([E(cc.Label)],t.prototype,"TimeLabel",void 0),r([E(cc.Label)],t.prototype,"TimeLabel2",void 0),r([E(cc.Label)],t.prototype,"ScoreLabel",void 0),r([E(cc.Node)],t.prototype,"ChangeShooter",void 0),r([E(cc.Node)],t.prototype,"ReadyShooter",void 0),r([E(cc.Node)],t.prototype,"ChangeCube",void 0),r([E(cc.Button)],t.prototype,"ChangeButton",void 0),r([E(cc.Button)],t.prototype,"PauseButton",void 0),r([E(cc.ProgressBar)],t.prototype,"TreasureBar",void 0),r([E(cc.Node)],t.prototype,"BirdRoot",void 0),t=r([B],t)}(cc.Component);o.default=M,cc._RF.pop()},{"./Bubble":"Bubble","./BubbleAnimation/BubbleHorce":"BubbleHorce","./BubbleMove":"BubbleMove","./Const":"Const","./Controller/AudioController":"AudioController","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Controller/GameFactory":"GameFactory","./Controller/StepController":"StepController","./Data/BubbleMatrix":"BubbleMatrix","./FrameAniBase":"FrameAniBase","./Guide":"Guide","./ResultLayer":"ResultLayer","./Utils/LogHandler":"LogHandler","./Utils/celerx":"celerx"}],Game:[function(e,t,o){"use strict";cc._RF.push(t,"f56074wKGJAf7tmCkTOJ+cK","Game"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../Data/BubbleMatrix"),r=e("../Const"),i=e("./GameFactory"),a=e("../BubbleMove"),c=e("./EventManager"),l=e("./EventName"),s=function(){function e(){this.BubbleLayer=null,this.TopNode=null,this.FontRoot=null,this.moveTimes=0,this.bubbleMatrix=new n.BubbleMatrix,this.score=0,this.streak=0,this.maxStreak=0,this.taskStreak=0,this.maxTaskStreak=0,this.bubbleScore={},this.bubbleClear={},this.bubbleDrop={},this.collisionIndexes=[],this.targets=[],this.clearIndex=[],this.dropIndex=[],this.fixedIndex=[],this.forceIndex=[],this.gameTime=0,this.isStart=!1,this.lastIndex=r.InitStartIndex,this._startIndex=r.InitStartIndex,this.DropCount=0,this.hasReadygo=!1,this.treasureCount=0,this.Rebounce=0}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Season",{get:function(){return this.season},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startIndex",{get:function(){return this._startIndex},set:function(e){this._startIndex=e,console.log(" startIndex:",this.startIndex)},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.moveTimes=0,this.score=0,this.collisionIndexes.length=0,this.targets.length=0,this.clearIndex.length=0,this.dropIndex.length=0,this.forceIndex.length=0,this.gameTime=r.GameTime,this.streak=0,this.maxStreak=0,this.taskStreak=0,this.maxTaskStreak=0;for(var e=0,t=r.BubbleColors;e<t.length;e++){var o=t[e];this.bubbleClear[o]=0,this.bubbleDrop[o]=0,this.bubbleScore[o]=0}for(var n=0;n<10;n++)this.season=r.SeasonPool[Math.floor(CMath.getRandom(0,r.SeasonPool.length))];console.log(" Season:",r.Season[this.season])},e.prototype.getBubbleScore=function(){return this.bubbleScore},e.prototype.getTaskLength=function(){return this.targets.length},e.prototype.getCurTarget=function(){return 0==this.targets.length?{target:0,now:0}:this.targets[this.targets.length-1]},e.prototype.addTarget=function(e){0!=this.targets.length&&(this.targets[this.targets.length-1].now+=e,c.gEventMgr.emit(l.GlobalEvent.UPDATE_TASK))},e.prototype.pushTarget=function(e){this.streak=0,this.targets.push(e)},e.prototype.getCollisionIndexes=function(){return this.collisionIndexes},e.prototype.updateCollisionIndexes=function(){this.collisionIndexes.length=0;for(var e=this.bubbleMatrix.data,t=0;t<e.length;t++){if(e[t]&&e[t].bubble)this.bubbleMatrix.getNeiborMatrix(t,1).length<6&&this.collisionIndexes.push(t)}for(t=0;t<e.length;t++)if(e[t]&&e[t].bubble&&!(this.collisionIndexes.indexOf(t)>=0)){for(var o=!0,r=0,i=this.bubbleMatrix.getNeiborMatrix(t,1);r<i.length;r++){var a=i[r];if(this.collisionIndexes.indexOf(a)<0){o=!1;break}}o&&this.collisionIndexes.push(t)}for(t=this.startIndex-n.MatrixSize;t<this.startIndex-n.MatrixSize+n.UseSize;t++);console.log(this.collisionIndexes)},e.prototype.getScore=function(){return this.score},e.prototype.addScore=function(e,t,o,n,r){void 0===n&&(n=cc.v2(0,0)),void 0===r&&(r=!0),this.score+=t,this.score=Math.max(0,this.score),this.addBubbleScore(e,t),c.gEventMgr.emit(l.GlobalEvent.ADD_SCORE,t,o,n,r)},e.prototype.getMatrix=function(){return this.bubbleMatrix},e.prototype.prepare=function(){this.bubbleMatrix.initBubbleData()},e.prototype.getLastI=function(){return this.bubbleMatrix.index2i(this.lastIndex)},e.prototype.addGameTime=function(e){this.gameTime+=e,this.gameTime<=0&&(this.gameTime=0,this.isStart=!1,console.log("DropCount:",o.Game.DropCount),setTimeout(function(){c.gEventMgr.emit(l.GlobalEvent.GAME_OVER,r.OverType.TIME_UP)},100*o.Game.DropCount))},e.prototype.checkOutOfMove=function(){for(var e=null,t=this.bubbleMatrix.data.length-1;t>=this.startIndex;t--)if(this.bubbleMatrix.data[t]&&this.bubbleMatrix.data[t].bubble&&this.bubbleMatrix.data[t].bubble.node.active){e=this.bubbleMatrix.data[t].bubble;break}if(e){var o=CMath.ConvertToNodeSpaceAR(e.node,e.node.getParent().getParent());console.log(" check out of move:",o.y),o.y<=a.DropBorder&&(this.isStart=!1,c.gEventMgr.emit(l.GlobalEvent.GAME_OVER,r.OverType.OUT_OF_MOVE))}},e.prototype.getGameTime=function(){return this.gameTime},e.prototype.addMoveTimes=function(e){void 0===e&&(e=1),this.moveTimes+=e},e.prototype.getMoveTimes=function(){return this.moveTimes},e.prototype.getBubble=function(e,t,o,n,r,a,c,l,s){return i.gFactory.getBubble(e,t,o,n,r,a,c,l,s)},e.prototype.checkRecurily=function(e,t){if(!(this.clearIndex.indexOf(e)>=0||e<this.startIndex)){this.clearIndex.push(e);for(var o=0,n=this.bubbleMatrix.getNeiborMatrix(e,1);o<n.length;o++){var r=n[o];if(!(r<this.startIndex)){var i=this.bubbleMatrix.data[r].bubble;i&&i.node.active&&t.Color==i.Color&&this.checkRecurily(r,t)}}}},e.prototype.addBubbleScore=function(e,t){this.bubbleScore[e]||(this.bubbleScore[e]=0),this.bubbleScore[e]+=t},e.prototype.addBubbleDrop=function(e){this.bubbleDrop[e]++},e.prototype.addBubbleClear=function(e){this.bubbleClear[e]++},e.prototype.checkBoomBubble=function(e){for(var t=0,o=e;t<o.length;t++){var n=o[t];if(this.bubbleMatrix.data[n].type==r.SpecialType.Boom){for(var i=[],a=0,c=this.bubbleMatrix.getNeiborMatrix(n,1,!1);a<c.length;a++){var l=c[a];this.clearIndex.indexOf(l)<0&&l>=this.startIndex&&(this.clearIndex.push(l),this.bubbleMatrix.data[l].type==r.SpecialType.Boom&&i.push(l))}this.checkBoomBubble(i)}}},e.prototype.checkClear=function(e,t,o){if(this.clearIndex.length=0,t.Type==r.SpecialType.Horce){console.log("\u5c0f\u9a6c\u7403:",this.startIndex),this.clearIndex.push(e);for(var n=this.startIndex;n<this.bubbleMatrix.data.length;n++)this.bubbleMatrix.data[n]&&this.bubbleMatrix.data[n].bubble&&this.bubbleMatrix.data[n].bubble.node.active&&this.bubbleMatrix.data[n].color==o.Color&&this.clearIndex.push(n)}else this.checkRecurily(e,t);if(this.clearIndex.length<r.ClearCountLimit&&t.Type!=r.SpecialType.Horce)return this.clearIndex.length=0,void(this.streak=0);console.log(" --------------- \u68c0\u6d4b\u6d88\u9664 start---------------:",this.startIndex),console.log(this.clearIndex),console.log(" --------------- \u68c0\u6d4b\u6d88\u9664 end---------------"),this.checkBoomBubble(this.clearIndex),this.streak++,this.streak>=2&&c.gEventMgr.emit(l.GlobalEvent.SHOW_STREAK,!0,this.streak),this.clearIndex.length>=5&&(this.clearIndex.length<=8?c.gEventMgr.emit(l.GlobalEvent.SHOW_STREAK,!1,4):this.clearIndex.length<=12?c.gEventMgr.emit(l.GlobalEvent.SHOW_STREAK,!1,5):c.gEventMgr.emit(l.GlobalEvent.SHOW_STREAK,!1,6)),this.maxStreak=Math.max(this.streak,this.maxStreak);var i=0;for(i=this.bubbleMatrix.data.length-1;i>=this.startIndex;i--){var a=this.bubbleMatrix.data[i];if(a&&a.color&&a.bubble&&a.bubble.node.active)break}this.lastIndex=i;for(var s=!1,u=0;u<this.clearIndex.length;u++){var h=this.clearIndex[u];if((d=this.bubbleMatrix.data[h].bubble)&&d.isDouble){s=!0,c.gEventMgr.emit(l.GlobalEvent.PLAY_EFFECT,"double_score");break}}t.Type==r.SpecialType.Horce&&(c.gEventMgr.emit(l.GlobalEvent.PLAY_EFFECT,"super_clear"),c.gEventMgr.emit(l.GlobalEvent.HORCE_CLEAR));for(var p=0;p<this.clearIndex.length;p++){var d;h=this.clearIndex[p];(d=this.bubbleMatrix.data[h].bubble)&&(s&&(d.DoubleScore=!0),d.onClear(.1*p,e),this.bubbleMatrix.data[h].bubble=null,this.bubbleMatrix.data[h].color=r.BubbleType.Blank,this.bubbleMatrix.data[h].type=r.SpecialType.Normal)}this.clearIndex.length=0,this.checkBubbleDrop(),this.addTarget(1),c.gEventMgr.emit(l.GlobalEvent.CHECK_TREASURE),this.checkAddBubble()},e.prototype.checkAddBubble=function(){for(var e=0,t=this.startIndex;t<=this.startIndex+9;t++)this.bubbleMatrix.data[t]&&this.bubbleMatrix.data[t].bubble&&this.bubbleMatrix.data[t].bubble.node.active&&e++;e<=5&&c.gEventMgr.emit(l.GlobalEvent.ADD_BUBBLE,3)},e.prototype.checkDrop=function(e){for(var t=this.bubbleMatrix.getNeiborMatrix(e,1,!1),o=0,n=t;o<n.length;o++){var r=n[o];if(this.fixedIndex.indexOf(r)>=0){this.fixedIndex=this.fixedIndex.concat(t),this.fixedIndex.push(e);break}}},e.prototype.checkBubbleDrop=function(){this.dropIndex.length=0,this.fixedIndex.length=0;for(var e=this.startIndex;e<this.startIndex+n.UseSize;e++)this.bubbleMatrix.data[e]&&this.bubbleMatrix.data[e].bubble&&this.fixedIndex.push(e);for(e=this.startIndex;e<this.bubbleMatrix.data.length;e++)e>=this.startIndex+n.UseSize&&this.bubbleMatrix.data[e]&&this.bubbleMatrix.data[e].bubble&&this.dropIndex.push(e);if(!(this.dropIndex.length<=0)){for(var t=0,o=this.dropIndex;t<o.length;t++){var i=o[t];this.checkDrop(i)}for(var a=0,c=this.fixedIndex;a<c.length;a++){i=c[a];(e=this.dropIndex.indexOf(i))>=0&&this.dropIndex.splice(e,1)}console.log(" \u68c0\u6d4b\u6389\u843d---------------"),console.log(this.dropIndex);for(var l=0,s=this.dropIndex;l<s.length;l++){i=s[l];if(this.bubbleMatrix.data[i]){var u=this.bubbleMatrix.data[i].bubble;u&&(u.move.drop(),this.bubbleMatrix.data[i].bubble=null,this.bubbleMatrix.data[i].color=r.BubbleType.Blank,this.bubbleMatrix.data[i].type=r.SpecialType.Normal)}}this.dropIndex.length=0}},e.prototype.addTaskStreak=function(e){this.taskStreak+=e,console.log(" 1task streak:",this.taskStreak,e),this.taskStreak=Math.max(0,this.taskStreak),console.log(" task streak:",this.taskStreak,e),this.maxTaskStreak=Math.max(this.maxTaskStreak,this.taskStreak)},e.prototype.getTaskStreak=function(){return this.taskStreak},e}();o.Game=s.inst,cc._RF.pop()},{"../BubbleMove":"BubbleMove","../Const":"Const","../Data/BubbleMatrix":"BubbleMatrix","./EventManager":"EventManager","./EventName":"EventName","./GameFactory":"GameFactory"}],GreenIdle:[function(e,t,o){"use strict";cc._RF.push(t,"4b6acWt//tGdJok24P7E67l","GreenIdle");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../../FrameAniBase"),a=e("../../Controller/EventManager"),c=e("../../Controller/EventName"),l=cc._decorator,s=l.ccclass,u=(l.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),a.gEventMgr.on(c.GlobalEvent.IS_GREEN_IDLE,function(e){e&&0==t.isPlaying?t.playOnLoop():t.stop()})},t.aniName="GreenIdle",t=r([s],t)}(i.default));o.default=u,cc._RF.pop()},{"../../Controller/EventManager":"EventManager","../../Controller/EventName":"EventName","../../FrameAniBase":"FrameAniBase"}],Guide:[function(e,t,o){"use strict";cc._RF.push(t,"4d6d2YvErVK1L2MNAsgprAA","Guide");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("./Controller/EventManager"),a=e("./Controller/EventName"),c=cc._decorator,l=c.ccclass,s=c.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ButtonAtlas=null,t.Next=null,t.Forward=null,t.Content=null,t.GuideView=null,t.callback=null,t}return n(t,e),t.prototype.onLoad=function(){var e=this;this.Next.node.on(cc.Node.EventType.TOUCH_END,this.nextPage,this),this.Forward.node.on(cc.Node.EventType.TOUCH_END,this.forwardPage,this);for(var t=0,o=this.Content.children;t<o.length;t++){o[t].getChildByName("Close").on(cc.Node.EventType.TOUCH_END,function(){e.hide(),i.gEventMgr.emit(a.GlobalEvent.PLAY_EFFECT,"button_click")},this)}this.GuideView.node.on("scroll-ended",this.updateButton,this)},t.prototype.start=function(){},t.prototype.hide=function(){var e=this;setTimeout(function(){e.node.active=!1,e.callback&&e.callback(),cc.Node.maxTouchNum=1,cc.Node.touchNum=0},0)},t.prototype.show=function(e){cc.Node.maxTouchNum=10,cc.Node.touchNum=0,this.node.active=!0,this.callback=e,this.GuideView.scrollToPage(0,0),this.Forward.node.active=!1,this.Next.node.getComponent(cc.Sprite).spriteFrame=this.ButtonAtlas.getSpriteFrame("btn_new")},t.prototype.nextPage=function(){if(i.gEventMgr.emit(a.GlobalEvent.PLAY_EFFECT,"button_click"),this.GuideView.getCurrentPageIndex()>=this.GuideView.content.childrenCount-1)this.hide();else{var e=(this.GuideView.getCurrentPageIndex()+1)%this.GuideView.content.childrenCount;this.GuideView.setCurrentPageIndex(e),this.updateButton()}},t.prototype.forwardPage=function(){if(i.gEventMgr.emit(a.GlobalEvent.PLAY_EFFECT,"button_click"),this.GuideView.getCurrentPageIndex()<=0);else{var e=(this.GuideView.getCurrentPageIndex()-1)%this.GuideView.content.childrenCount;this.GuideView.setCurrentPageIndex(e),this.updateButton()}},t.prototype.updateButton=function(){this.GuideView.getCurrentPageIndex()>=this.GuideView.content.childrenCount-1?this.Next.node.getComponent(cc.Sprite).spriteFrame=this.ButtonAtlas.getSpriteFrame("new_close"):this.Next.node.getComponent(cc.Sprite).spriteFrame=this.ButtonAtlas.getSpriteFrame("btn_new"),this.Forward.node.active=0!=this.GuideView.getCurrentPageIndex()},r([s(cc.SpriteAtlas)],t.prototype,"ButtonAtlas",void 0),r([s(cc.Button)],t.prototype,"Next",void 0),r([s(cc.Button)],t.prototype,"Forward",void 0),r([s(cc.Node)],t.prototype,"Content",void 0),r([s(cc.PageView)],t.prototype,"GuideView",void 0),t=r([l],t)}(cc.Component);o.default=u,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName"}],HandUpLeft:[function(e,t,o){"use strict";cc._RF.push(t,"ffe9bP+UqVKj75trtccD5k+","HandUpLeft");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../../FrameAniBase"),a=e("../../Controller/EventManager"),c=e("../../Controller/EventName"),l=cc._decorator,s=l.ccclass,u=(l.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),a.gEventMgr.on(c.GlobalEvent.ON_POINTER_ROTATED,function(e){e?t.playByStep():t.stop()},this)},t.aniName="HandUpLeft",t=r([s],t)}(i.default));o.default=u,cc._RF.pop()},{"../../Controller/EventManager":"EventManager","../../Controller/EventName":"EventName","../../FrameAniBase":"FrameAniBase"}],HandUpRight:[function(e,t,o){"use strict";cc._RF.push(t,"bf0e8y4ZthFO51qKbDIAQoB","HandUpRight");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../../Controller/EventManager"),a=e("../../Controller/EventName"),c=e("../../FrameAniBase"),l=cc._decorator,s=l.ccclass,u=(l.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),i.gEventMgr.on(a.GlobalEvent.ON_POINTER_ROTATED,function(e){e?t.stop():t.playByStep()},this)},t.aniName="HandUpRight",t=r([s],t)}(c.default));o.default=u,cc._RF.pop()},{"../../Controller/EventManager":"EventManager","../../Controller/EventName":"EventName","../../FrameAniBase":"FrameAniBase"}],HashMap:[function(e,t,o){"use strict";cc._RF.push(t,"834d8P+ikFOAYgMzFmudtRR","HashMap"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){this._list=new Array,this.clear()}return e.prototype.getIndexByKey=function(e){for(var t=this._list.length,o=0;o<t;o++){if(this._list[o].key==e)return o}return-1},e.prototype.keyOf=function(e){for(var t=this._list.length,o=0;o<t;o++){var n=this._list[o];if(n.value==e)return n.key}return null},Object.defineProperty(e.prototype,"keys",{get:function(){for(var e=new Array,t=0,o=this._list;t<o.length;t++){var n=o[t];n&&e.push(n.key)}return e},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){var o={key:e,value:t},n=this.getIndexByKey(e);-1!=n?this._list[n]=o:this._list.push(o)},Object.defineProperty(e.prototype,"values",{get:function(){return this._list},enumerable:!0,configurable:!0}),e.prototype.remove=function(e){var t=this.getIndexByKey(e);if(-1!=t){var o=this._list[t];return this._list.splice(t,1),o}return null},e.prototype.has=function(e){return-1!=this.getIndexByKey(e)},e.prototype.get=function(e){var t=this.getIndexByKey(e);return-1!=t?this._list[t].value:null},Object.defineProperty(e.prototype,"length",{get:function(){return this._list.length},enumerable:!0,configurable:!0}),e.prototype.sort=function(e){this._list.sort(e)},e.prototype.forEachKeyValue=function(e){for(var t=this._list.length,o=0;o<t;o++){e(this._list[o])}},e.prototype.forEach=function(e){for(var t=this._list.length,o=0;o<t;o++){var n=this._list[o];e(n.key,n.value)}},e.prototype.clear=function(){this._list=[]},e}();o.HashMap=n,cc._RF.pop()},{}],LoadingImg:[function(e,t,o){"use strict";cc._RF.push(t,"08b58X7vJJJUY4roqLZ8Atp","LoadingImg");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("./Controller/EventManager"),a=e("./Controller/EventName"),c=cc._decorator,l=c.ccclass,s=(c.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.onLoad=function(){var e=this;this.node.scale=1,i.gEventMgr.on(a.GlobalEvent.Hide_Load,function(){e.node.runAction(cc.sequence(cc.fadeOut(.05),cc.callFunc(function(){e.node.removeFromParent(!0)})))},this)},t=r([l],t)}(cc.Component));o.default=s,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName"}],LogHandler:[function(e,t,o){"use strict";cc._RF.push(t,"4e3f0ZIKgdJt7KKOAGW0fes","LogHandler"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){if(this.logMsg=null,this.frameTimes=0,this.now=0,this.Frame=20,this.totalFrames=0,this.startTime=0,window.addEventListener)for(var t=0,o=e.LISTENNING_EVENTS;t<o.length;t++){var n=o[t],r="trigger"+n.charAt(0).toLocaleUpperCase()+n.substring(1);this[r]&&"function"==typeof this[r]&&window.addEventListener(n,this[r].bind(this))}}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.dumpFrameInfo=function(){var e=(Date.now()-this.startTime)/1e3,t=e/this.totalFrames;this.addLog(" total frames:",this.totalFrames," ,total cost time:",e+"s"," , per frame cost time ave:"+t+"s"),this.sendLog()},e.prototype.initLog=function(t){var o=this;cc.director.once(cc.Director.EVENT_AFTER_SCENE_LAUNCH,function(){o.frameTimes=0,o.now=Date.now(),o.startTime=Date.now()},this),cc.director.on(cc.Director.EVENT_AFTER_DRAW,function(){o.frameTimes++,o.totalFrames++,o.frameTimes>=o.Frame&&(o.frameTimes=0,o.now=Date.now())},this),this.logFunc=t,console.error=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];e.inst.log("[ERROR]",t)},console.warn=function(){for(var t,o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];(t=e.inst).log.apply(t,["[WARN]"].concat(o))},console.log=function(){for(var t,o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];(t=e.inst).log.apply(t,["[INFO]"].concat(o))}},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.addLog.apply(this,e),this.sendLog()},e.prototype.formatLogArguments=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var o="",n=0;n<arguments.length;n++){var r=typeof arguments[n];"string"==r||"number"==r?o+=" "+arguments[n]:"object"==r?o+=" "+JSON.stringify(arguments[n]):"boolean"==r&&arguments[n].toString&&(o+=arguments[n].toString())}return o},e.prototype.addLog=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];null==this.logMsg&&(this.logMsg={});var n=this.formatLogArguments.apply(this,t),r=this.getFullTime(new Date);this.logMsg[r]=e.VERSION+n},e.prototype.getFullTime=function(e){var t="";t+=e.getFullYear();var o=e.getMonth();t+="-"+(o>=10?o:"0"+o);var n=e.getDate();t+="-"+(n>=10?n:"0"+n);var r=e.getHours();t+="  "+(r>=10?r:"0"+r);var i=e.getMinutes();t+=":"+(i>=10?i:"0"+i);var a=e.getSeconds();return t+=":"+(a>=10?a:"0"+a)},e.prototype.sendLog=function(){this.logFunc&&null!=this.logMsg&&(this.logFunc(JSON.stringify(this.logMsg)),this.logMsg=null)},e.prototype.triggerClose=function(e){this.addLog("triggerClose"),this.sendLog()},e.prototype.triggerLoad=function(e){this.addLog("triggerLoad"),this.sendLog()},e.prototype.triggerUnload=function(e){this.addLog("triggerUnload"),this.sendLog()},e.prototype.triggerOnunload=function(e){this.addLog("triggerUnload"),this.sendLog()},e.prototype.triggerError=function(e){this.addLog("triggerError"),this.addLog(e.message),this.sendLog()},e.prototype.triggerFocus=function(e){this.addLog("triggerFocus"),this.sendLog()},e.prototype.triggerBlur=function(e){this.addLog("triggerBlur"),this.sendLog()},e.prototype.triggerAbort=function(e){this.addLog("triggerAbort"),this.sendLog()},e.prototype.triggerSuspend=function(e){this.addLog("triggerSuspend"),this.sendLog()},e.prototype.beforeunload=function(e){this.addLog("beforeunload"),this.sendLog()},e.VERSION="Bust-A-Move version 24 : ",e.LISTENNING_EVENTS=["error"],e}();o.LogHandler=n,cc._RF.pop()},{}],PauseLayer:[function(e,t,o){"use strict";cc._RF.push(t,"06fb3hXnkNL34EZDW3IRUcG","PauseLayer");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("./Guide"),a=e("./Controller/EventManager"),c=e("./Controller/EventName"),l=cc._decorator,s=l.ccclass,u=l.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.GuideLayer=null,t}return n(t,e),Object.defineProperty(t.prototype,"Resume",{get:function(){return this.node.getChildByName("Resume")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Help",{get:function(){return this.node.getChildByName("Help")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MusicSlider",{get:function(){return this.node.getChildByName("Music").getComponent(cc.Slider)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EffectSlider",{get:function(){return this.node.getChildByName("Effect").getComponent(cc.Slider)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MusicMask",{get:function(){return this.MusicSlider.node.getChildByName("Mask")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EffectMask",{get:function(){return this.EffectSlider.node.getChildByName("Mask")},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){var e=this;this.node.active=!1,a.gEventMgr.on(c.GlobalEvent.OPEN_PAUSE,function(){e.show()},this),this.Help.on(cc.Node.EventType.TOUCH_END,function(){a.gEventMgr.emit(c.GlobalEvent.PLAY_EFFECT,"button_click"),e.GuideLayer.show()},this),this.Resume.on(cc.Node.EventType.TOUCH_END,function(){a.gEventMgr.emit(c.GlobalEvent.PLAY_EFFECT,"button_click"),e.hide()},this),this.EffectSlider.node.on("slide",function(){cc.audioEngine.setEffectsVolume(e.EffectSlider.progress),e.updateVolumeSlider()},this),this.MusicSlider.node.on("slide",function(){cc.audioEngine.setMusicVolume(e.MusicSlider.progress),e.updateVolumeSlider()},this)},t.prototype.updateVolumeSlider=function(){this.MusicSlider.progress=cc.audioEngine.getMusicVolume(),this.EffectSlider.progress=cc.audioEngine.getEffectsVolume(),this.EffectMask.width=507*this.EffectSlider.progress,this.MusicMask.width=507*this.MusicSlider.progress},t.prototype.show=function(){this.node.active=!0,this.updateVolumeSlider()},t.prototype.hide=function(){var e=this;setTimeout(function(){e.node.active=!1},0)},r([u(i.default)],t.prototype,"GuideLayer",void 0),t=r([s],t)}(cc.Component);o.default=h,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Guide":"Guide"}],Pointer:[function(e,t,o){"use strict";cc._RF.push(t,"dfda2iUzjJK2KNyR3Mo4JBL","Pointer");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("./Controller/EventManager"),a=e("./Controller/EventName"),c=cc._decorator,l=c.ccclass,s=c.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.factor=1,t}return n(t,e),t.prototype.onLoad=function(){var e=this;i.gEventMgr.on(a.GlobalEvent.UPDATE_POINTER_ROTATION,function(t){Math.floor(t)%5==0&&i.gEventMgr.emit(a.GlobalEvent.ON_POINTER_ROTATED,e.node.rotation<=0),e.node.rotation=t*e.factor},this)},t.prototype.start=function(){},r([s],t.prototype,"factor",void 0),t=r([l],t)}(cc.Component);o.default=u,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName"}],ReadyGoAnimation:[function(e,t,o){"use strict";cc._RF.push(t,"af2caQWsglGhLpOpE7b4hy8","ReadyGoAnimation");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("./Controller/EventManager"),a=e("./Controller/EventName"),c=e("./Controller/Game"),l=cc._decorator,s=l.ccclass,u=l.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ReadyGo=null,t}return n(t,e),Object.defineProperty(t.prototype,"sprite",{get:function(){return this.getComponent(cc.Sprite)},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){var e=this;i.gEventMgr.once(a.GlobalEvent.READY_GO,function(){i.gEventMgr.emit(a.GlobalEvent.PLAY_EFFECT,"readygo"),e.play()},this)},t.prototype.play=function(){var e=this;this.sprite.spriteFrame=this.ReadyGo.getSpriteFrame("bg_font_ready"),this.node.runAction(cc.fadeIn(.2)),this.node.runAction(cc.sequence(cc.scaleTo(2.3,1.5),cc.callFunc(function(){e.sprite.spriteFrame=e.ReadyGo.getSpriteFrame("bg_font_go")}),cc.scaleTo(.1,1),cc.fadeOut(.5),cc.callFunc(function(){c.Game.hasReadygo=!0,c.Game.isStart=!0})))},r([u(cc.SpriteAtlas)],t.prototype,"ReadyGo",void 0),t=r([s],t)}(cc.Component);o.default=h,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game"}],ResultAnimation:[function(e,t,o){"use strict";cc._RF.push(t,"9c567CEF4pENLRjcHnTQ9NP","ResultAnimation");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("./FrameAniBase"),a=cc._decorator,c=a.ccclass,l=a.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.frames=[],t}return n(t,e),t.prototype.nextFrame=function(){this.frames&&this.frames.length>0&&(this.Sprite.spriteFrame=this.frames[this.currentIndex],this.callEventFrame(),this.currentIndex=(this.currentIndex+1)%this.frames.length)},t.aniName="ResultAnimation",r([l(cc.SpriteFrame)],t.prototype,"frames",void 0),t=r([c],t)}(i.default);o.default=s,cc._RF.pop()},{"./FrameAniBase":"FrameAniBase"}],ResultLayer:[function(e,t,o){"use strict";cc._RF.push(t,"6cddevafb1BXoHh5PEsKHRP","ResultLayer");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("./Controller/Game"),a=e("./Const"),c=e("./Controller/EventManager"),l=e("./Controller/EventName"),s=e("./Utils/LogHandler"),u=cc._decorator,h=u.ccclass,p=u.property,d=e("./Utils/celerx"),b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.Result=null,t.Submit=null,t.Title=null,t.FinalScore=null,t.GameScore=null,t.Bonus=null,t.Equip=null,t.BonusScore=null,t.gameScore=0,t.showGameScore=0,t.bonus=0,t.showBonus=0,t.bonusScore=0,t.showBonusScore=0,t.totalScore=0,t.showTotalScore=0,t.scoreStep=0,t.submit=!1,t.show=!1,t.canSubmit=!1,t}return n(t,e),t.prototype.onLoad=function(){var e=this;s.LogHandler.inst.dumpFrameInfo(),this.updateScore();for(var t=0,o=this.Equip.children;t<o.length;t++){var n=o[t];n.getChildByName("Back").opacity=255,n.getChildByName("Bird").scale=0,parseInt(n.name)<=i.Game.treasureCount&&(n.getChildByName("Back").runAction(cc.sequence(cc.delayTime(parseInt(n.name)/6),cc.fadeOut(.1))),n.getChildByName("Bird").runAction(cc.sequence(cc.delayTime(parseInt(n.name)/6),cc.scaleTo(.1,1.2),cc.scaleTo(.1,1))))}this.Submit.scale=0,this.Result.scale=0,this.Result.runAction(cc.sequence(cc.scaleTo(.1,1.2),cc.scaleTo(.1,1),cc.callFunc(this.showScore,this))),this.Submit.on(cc.Node.EventType.TOUCH_END,function(){e.canSubmit&&(c.gEventMgr.emit(l.GlobalEvent.PLAY_EFFECT,"button_click"),e.submit||(console.log(" submit score by click:",i.Game.MatchInfo.matchId,", seed:",i.Game.MatchInfo.sharedRandomSeed),d.submitScore(i.Game.getScore()),e.submit=!0))},this)},t.prototype.updateScore=function(){var e=i.Game.getBubbleScore();this.bonusScore=0,this.bonus=0;for(var t=0,o=a.TreasurePool;t<o.length;t++){var n=o[t];e[n]&&(this.bonusScore+=e[n],this.bonus+=1)}this.totalScore=i.Game.getScore(),this.gameScore=this.totalScore-this.bonusScore,this.scoreStep=Math.max(Math.floor(Math.min(this.totalScore/100,this.gameScore/100)),10)},t.prototype.setTexture=function(e){this.Title.spriteFrame=e},t.prototype.showScore=function(){c.gEventMgr.emit(l.GlobalEvent.PLAY_EFFECT,"over"),this.show=!0},t.prototype.update=function(){var e=this;this.show&&(this.updateScore(),this.showGameScore<this.gameScore&&(this.showGameScore+=this.scoreStep,this.showGameScore=Math.min(this.showGameScore,this.gameScore),this.GameScore.string=this.showGameScore.toString()),this.showBonus<this.bonus&&(this.showBonus+=.1,this.showBonus=Math.min(this.showBonus,this.bonus),this.Bonus.string=Math.floor(this.showBonus).toString()),this.showBonusScore<this.bonusScore&&(this.showBonusScore+=this.scoreStep,this.showBonusScore=Math.min(this.showBonusScore,this.bonusScore),this.BonusScore.string=this.showBonusScore.toString()),this.showGameScore==this.gameScore&&this.showTotalScore<this.totalScore&&(this.showTotalScore+=this.scoreStep,this.showTotalScore=Math.min(this.totalScore,this.showTotalScore),this.FinalScore.string=this.showTotalScore.toString()),this.showTotalScore==this.totalScore&&(this.show=!1,this.Submit.runAction(cc.sequence(cc.scaleTo(.1,1.2),cc.scaleTo(.1,1),cc.callFunc(function(){e.canSubmit=!0,setTimeout(function(){e.submit||(console.log(" submit score by timeout:",i.Game.MatchInfo.matchId,", seed:",i.Game.MatchInfo.sharedRandomSeed),d.submitScore(i.Game.getScore()),e.submit=!0)},3e3)},this)))))},r([p(cc.Node)],t.prototype,"Result",void 0),r([p(cc.Node)],t.prototype,"Submit",void 0),r([p(cc.Sprite)],t.prototype,"Title",void 0),r([p(cc.Label)],t.prototype,"FinalScore",void 0),r([p(cc.Label)],t.prototype,"GameScore",void 0),r([p(cc.Label)],t.prototype,"Bonus",void 0),r([p(cc.Node)],t.prototype,"Equip",void 0),r([p(cc.Label)],t.prototype,"BonusScore",void 0),t=r([h],t)}(cc.Component);o.default=b,cc._RF.pop()},{"./Const":"Const","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Utils/LogHandler":"LogHandler","./Utils/celerx":"celerx"}],ShooterLayer:[function(e,t,o){"use strict";cc._RF.push(t,"a86feZkxotMl5W4gIeRr5Ex","ShooterLayer");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("./Controller/EventManager"),a=e("./Controller/EventName"),c=e("./Bubble"),l=e("./BubbleMove"),s=e("./Controller/GameFactory"),u=e("./Controller/Game"),h=cc._decorator,p=h.ccclass,d=h.property,b=20,f={0:"bg_pointrainbow",1:"bg_pointblue",2:"bg_pointblue",3:"bg_pointgreen",4:"bg_pointorg",5:"bg_pointpink",6:"bg_pointred",7:"bg_pointyellow",8:"bg_pointwhite",9:"bg_pointboom",10:"bg_pointfire",11:"bg_pointfire"},g={0:"rainbow",1:"blue",2:"blue",3:"green",4:"orange",5:"purple",6:"red",7:"yellow",8:"white",9:"boom",10:"fireball",11:"fireball"},y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ShooterStar=null,t.Shooter=null,t.PointAtlas=null,t.Point=null,t.pointCount=b,t.isStart=!1,t}return n(t,e),t.prototype.onLoad=function(){this.ShooterStar.active=!1,this.Point.active=!1,this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},t.prototype.start=function(){},t.prototype.updateStarPosition=function(e){var t=CMath.GetWorldPosition(this.Shooter),o=this.node.getParent().convertToNodeSpaceAR(e),n=CMath.getK(e,t),r=0;if(null===n){var c=t.y<=e.y?1:-1;this.ShooterStar.x=0,this.ShooterStar.y=o.y+150*c,this.updatePoint(n,c)}else{var l=Math.atan(n);c=t.x<=e.x?1:-1;this.ShooterStar.x=o.x+150*Math.cos(l)*c,this.ShooterStar.y=o.y+150*Math.sin(l)*c,this.updatePoint(n,c),l>0?(r=180*(Math.PI/2-l)/Math.PI,c<0&&(r+=180)):(r=180*(-Math.PI/2-l)/Math.PI,c>0&&(r+=180))}return i.gEventMgr.emit(a.GlobalEvent.UPDATE_POINTER_ROTATION,r),e.sub(t)},t.prototype.updatePoint=function(e,t){for(;this.Point.childrenCount>this.pointCount;)s.gFactory.putPoint(this.Point.children[this.Point.childrenCount-1]);for(;this.Point.childrenCount<this.pointCount;)this.Point.addChild(s.gFactory.getPoint());var o=this.Point.childrenCount;if(null===e)for(var n=0;n<o;n++){(i=this.Point.children[n]).x=0,i.y=60*n*t,i.opacity=255-n/o*150,i.getComponent(cc.Sprite).spriteFrame=this.PointAtlas.getSpriteFrame(f[this.Shooter.children[0].getComponent(c.default).Color])}else{var r=Math.atan(e);for(n=0;n<o;n++){var i;(i=this.Point.children[n]).opacity=255-n/o*150,i.x=60*n*Math.cos(r)*t;for(var a=-1==t?1:2;Math.abs(i.x)>l.BorderX;)i.x-=(Math.abs(i.x)-l.BorderX)*Math.pow(-1,a++)*2;i.y=60*n*Math.sin(r)*t,i.getComponent(cc.Sprite).spriteFrame=this.PointAtlas.getSpriteFrame(f[this.Shooter.children[0].getComponent(c.default).Color])}}},t.prototype.onTouchStart=function(e){this.Shooter.childrenCount<=0?console.log(" shooter has no bubble"):u.Game.isStart?(this.updateStarPosition(e.getLocation()),this.ShooterStar.active=!0,this.Point.active=!0,this.ShooterStar.getComponent(cc.Sprite).spriteFrame=this.PointAtlas.getSpriteFrame(g[this.Shooter.children[0].getComponent(c.default).Color]),i.gEventMgr.emit(a.GlobalEvent.IS_GREEN_IDLE,!1)):console.log(" game not start ")},t.prototype.onTouchMove=function(e){this.Shooter.childrenCount<=0?console.log(" shooter has no bubble, on touchmove"):u.Game.isStart?(this.ShooterStar.active=!0,this.Point.active=!0,this.ShooterStar.getComponent(cc.Sprite).spriteFrame=this.PointAtlas.getSpriteFrame(g[this.Shooter.children[0].getComponent(c.default).Color]),this.updateStarPosition(e.getLocation()),i.gEventMgr.emit(a.GlobalEvent.IS_GREEN_IDLE,!1)):console.log(" isStart is false, on touchmove")},t.prototype.onTouchEnd=function(e){if(u.Game.isStart)if(this.ShooterStar.active=!1,this.Point.active=!1,this.Shooter.childrenCount<=0)console.log(" shooter has no bubble, on touchend");else{var t=this.updateStarPosition(e.getLocation());this.ShooterStar.y>=-700?(console.log("\u53d1\u9001\u53d1\u5c04\u4e8b\u4ef6"),i.gEventMgr.emit(a.GlobalEvent.SHOOT,t)):console.log(" \u53d1\u5c04\u89d2\u5ea6\u4e0d\u5728\u6709\u6548\u8303\u56f4"),i.gEventMgr.emit(a.GlobalEvent.IS_GREEN_IDLE,!0)}else console.log(" on touch end ,is not start")},r([d(cc.Node)],t.prototype,"ShooterStar",void 0),r([d(cc.Node)],t.prototype,"Shooter",void 0),r([d(cc.SpriteAtlas)],t.prototype,"PointAtlas",void 0),r([d(cc.Node)],t.prototype,"Point",void 0),t=r([p],t)}(cc.Component);o.default=y,cc._RF.pop()},{"./Bubble":"Bubble","./BubbleMove":"BubbleMove","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Controller/GameFactory":"GameFactory"}],StartButton:[function(e,t,o){"use strict";cc._RF.push(t,"1b320qWv9lJjqxUKlPWL5Sm","StartButton");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("./Controller/Game"),a=e("./Controller/EventManager"),c=e("./Controller/EventName"),l=cc._decorator,s=l.ccclass,u=(l.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.onLoad=function(){var e=this;a.gEventMgr.on(c.GlobalEvent.SHOW_START,function(t){e.node.active=t},this),this.node.on(cc.Node.EventType.TOUCH_END,function(){a.gEventMgr.emit(c.GlobalEvent.PLAY_EFFECT,"button_click"),setTimeout(function(){if(0==i.Game.hasReadygo)return console.log(" has ready go false"),void setTimeout(function(){a.gEventMgr.emit(c.GlobalEvent.READY_GO)},0)},0),e.node.removeFromParent(!0)},this)},t.prototype.start=function(){},t=r([s],t)}(cc.Component));o.default=u,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game"}],StepController:[function(e,t,o){"use strict";cc._RF.push(t,"09ac2ySMaBKF6e+GcvfUxR0","StepController"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){this.totalStep=[],this.curStep=[]}return Object.defineProperty(e,"inst",{get:function(){return this._ins?this._ins:this._ins=new e},enumerable:!0,configurable:!0}),e.prototype.register=function(e,t){this.completeCallback=e,this.totalStep=t},e.prototype.nextStep=function(e){this.totalStep.indexOf(e)<0?console.error(" \u6ca1\u6709\u8fd9\u4e00\u6b65\uff1a",e):this.curStep.indexOf(e)>=0?console.error(" \u6b65\u9aa4\u5df2\u5b8c\u6210\uff1a",e):(this.curStep.push(e),this.curStep.sort(function(e,t){return e>t?-1:1}),this.totalStep.sort(function(e,t){return e>t?-1:1}),console.log(" cur step:",this.curStep.join(",")),console.log(" total step:",this.totalStep.join(",")),this.curStep.join(",")==this.totalStep.join(",")&&(this.totalStep.length=0,this.completeCallback(),this.completeCallback=null))},e}();o.gStep=n.inst,cc._RF.pop()},{}],SuperHorceAni:[function(e,t,o){"use strict";cc._RF.push(t,"1aa15GeVWdLs6SMx7rN7ubY","SuperHorceAni");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("./FrameAniBase"),a=e("./Controller/EventManager"),c=e("./Controller/EventName"),l=cc._decorator,s=l.ccclass,u=(l.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),a.gEventMgr.on(c.GlobalEvent.HORCE_CLEAR,function(){t.play(),t.node.opacity=255},this)},t.prototype.onComplete=function(){this.node.runAction(cc.fadeOut(.2))},t.aniName="SuperHorceAni",t=r([s],t)}(i.default));o.default=u,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./FrameAniBase":"FrameAniBase"}],Treasure:[function(e,t,o){"use strict";cc._RF.push(t,"839c8WNoRJFOZY4LdvRkdlU","Treasure");var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),r=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var i=e("./Controller/Game"),a=e("./Const"),c=e("./Controller/EventManager"),l=e("./Controller/EventName"),s=cc._decorator,u=s.ccclass,h=(s.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isCollider=!0,t}return n(t,e),Object.defineProperty(t.prototype,"Self",{get:function(){return this.node.getChildByName("self")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Alpha",{get:function(){return this.node.getChildByName("alpha")},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){var e=this;this.node.group="default",this.node.opacity=255,this.Alpha.opacity=255,c.gEventMgr.on(l.GlobalEvent.CHECK_TREASURE,function(){i.Game.isStart&&e.checkCollider()},this)},t.prototype.update=function(){},t.prototype.checkCollider=function(){this.isCollider=!1;for(var e=i.Game.getMatrix(),t=i.Game.startIndex;t<e.data.length;t++)if(e.data[t]&&e.data[t].bubble&&e.data[t].bubble.node.active){var o=e.data[t].bubble;if(cc.Intersection.polygonCircle(this.getComponent(cc.PolygonCollider).points,{position:CMath.ConvertToNodeSpaceAR(o.node,this.node.getParent()),radius:o.getComponent(cc.CircleCollider).radius})){this.isCollider=!0;break}}this.isCollider||(c.gEventMgr.targetOff(this),i.Game.treasureCount++,console.log(" treasureCount:",i.Game.treasureCount),i.Game.treasureCount,this.getTreasure(i.Game.treasureCount))},t.prototype.getTreasure=function(e){var t=this,o=CMath.ConvertToNodeSpaceAR(i.Game.TopNode.getChildByName("TreasureRoot").getChildByName(i.Game.treasureCount.toString()),this.node.getParent()),n=CMath.Distance(o,this.node.position)/1500;this.enabled=!1,this.node.group="treasure",c.gEventMgr.emit(l.GlobalEvent.PLAY_EFFECT,"get_treasure"),this.Alpha.runAction(cc.sequence(cc.delayTime(.3),cc.spawn(cc.scaleTo(.2,5),cc.fadeOut(.2)))),this.Self.runAction(cc.sequence(cc.delayTime(.1),cc.scaleTo(.1,2),cc.delayTime(.3),cc.callFunc(function(){i.Game.addScore(a.BubbleType["Treasure_"+e],a.BubbleType["Treasure_"+e],a.BubbleType["Treasure_"+e]/200*.1+1,CMath.ConvertToNodeSpaceAR(t.Self,i.Game.TopNode))}),cc.scaleTo(.1,1),cc.moveTo(n,o),cc.fadeTo(.1,0),cc.callFunc(function(){c.gEventMgr.emit(l.GlobalEvent.GET_TREASURE,e),t.node.removeFromParent()})))},t=r([u],t)}(cc.Component));o.default=h,cc._RF.pop()},{"./Const":"Const","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game"}],celerx:[function(e,t,o){"use strict";cc._RF.push(t,"86cd8TXnY5AKqy5mkWiIwvz","celerx");var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r={default:void 0,call:function(e,t,o){var n="";if("function"==typeof t&&(o=t,t={}),t={data:void 0===t?null:t},"function"==typeof o){var r="dscb"+window.dscb++;window[r]=o,t._dscbstub=r}return t=JSON.stringify(t),window._dsbridge?n=_dsbridge.call(e,t):(window._dswk||-1!=navigator.userAgent.indexOf("_dsbridge"))&&(n=prompt("_dsbridge="+e,t)),JSON.parse(n||"{}").data},register:function(e,t,o){o=o?window._dsaf:window._dsf,window._dsInit||(window._dsInit=!0,setTimeout(function(){r.call("_dsb.dsinit")},0)),"object"==(void 0===t?"undefined":n(t))?o._obs[e]=t:o[e]=t},registerAsyn:function(e,t){this.register(e,t,!0)},hasNativeMethod:function(e,t){return this.call("_dsb.hasNativeMethod",{name:e,type:t||"all"})},disableJavascriptDialogBlock:function(e){this.call("_dsb.disableJavascriptDialogBlock",{disable:!1!==e})}};!function(){if(!window._dsf){var e,t={_dsf:{_obs:{}},_dsaf:{_obs:{}},dscb:0,celerx:r,close:function(){r.call("_dsb.closePage")},_handleMessageFromNative:function(e){var t=JSON.parse(e.data),o={id:e.callbackId,complete:!0},n=this._dsf[e.method],i=this._dsaf[e.method],a=function(e,n){o.data=e.apply(n,t),r.call("_dsb.returnValue",o)},c=function(e,n){t.push(function(e,t){o.data=e,o.complete=!1!==t,r.call("_dsb.returnValue",o)}),e.apply(n,t)};if(n)a(n,this._dsf);else if(i)c(i,this._dsaf);else if(n=e.method.split("."),!(2>n.length)){e=n.pop();n=n.join(".");var l=(i=(i=this._dsf._obs)[n]||{})[e];l&&"function"==typeof l?a(l,i):(l=(i=(i=this._dsaf._obs)[n]||{})[e])&&"function"==typeof l&&c(l,i)}}};for(e in t)window[e]=t[e];r.register("_hasJavascriptMethod",function(e,t){return 2>(t=e.split(".")).length?!(!_dsf[t]&&!_dsaf[t]):(e=t.pop(),t=t.join("."),(t=_dsf._obs[t]||_dsaf._obs[t])&&!!t[e])})}}();var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function a(e){for(var t=new Uint8Array(e),o=new Array,n=0,r=0,a=new Array(3),c=new Array(4),l=t.length,s=0;l--;)if(a[n++]=t[s++],3==n){for(c[0]=(252&a[0])>>2,c[1]=((3&a[0])<<4)+((240&a[1])>>4),c[2]=((15&a[1])<<2)+((192&a[2])>>6),c[3]=63&a[2],n=0;n<4;n++)o+=i.charAt(c[n]);n=0}if(n){for(r=n;r<3;r++)a[r]=0;for(c[0]=(252&a[0])>>2,c[1]=((3&a[0])<<4)+((240&a[1])>>4),c[2]=((15&a[1])<<2)+((192&a[2])>>6),c[3]=63&a[2],r=0;r<n+1;r++)o+=i.charAt(c[r]);for(;n++<3;)o+="="}return o}var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function l(e){var t,o,n,r,i,a,l=new Array,s=0;if(e!=(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""))&&alert("Warning! Characters outside Base64 range in input string ignored."),e.length%4)return alert("Error: Input length is not a multiple of 4 bytes."),"";for(var u=0;s<e.length;)t=c.indexOf(e.charAt(s++))<<2|(r=c.indexOf(e.charAt(s++)))>>4,o=(15&r)<<4|(i=c.indexOf(e.charAt(s++)))>>2,n=(3&i)<<6|(a=c.indexOf(e.charAt(s++))),l[u++]=t,64!=i&&(l[u++]=o),64!=a&&(l[u++]=n);return l}var s={callback:function(){return""}},u={callback:function(){return""}};r.register("provideScore",function(){return s.callback()}),r.register("provideCurrentFrameData",function(){return u.callback()}),t.exports=window.celerSDK={onStateReceived:function(e){return r.register("onStateReceived",function(t){var o=l(t);return e(new Uint8Array(o))})},onCourtModeStarted:function(e){return r.register("onCourtModeStarted",e)},getMatch:function(){var e=r.call("getMatch","123");try{e=JSON.parse(e)}catch(e){}return e},showCourtModeDialog:function(){return r.call("showCourtModeDialog")},start:function(){return r.call("start")},sendState:function(e){return r.call("sendState",a(e))},draw:function(e){return r.call("draw",a(e))},win:function(e){return r.call("win",a(e))},lose:function(e){return r.call("lose",a(e))},surrender:function(e){return r.call("surrender",a(e))},applyAction:function(e,t){return r.call("applyAction",a(e),t)},getOnChainState:function(e){return r.call("getOnChainState","123",function(t){var o=l(t);return e(new Uint8Array(o))})},getOnChainActionDeadline:function(e){return r.call("getOnChainActionDeadline","123",e)},getCurrentBlockNumber:function(){return r.call("getCurrentBlockNumber","123")},finalizeOnChainGame:function(e){return r.call("finalizeOnChainGame","123",e)},submitScore:function(e){return r.call("submitScore",e)},ready:function(){if(window.cc){var e=!1,t=document.getElementsByTagName("canvas")[0];cc.director.on(cc.Director.EVENT_AFTER_DRAW,function(){e&&(e=!1,celerSDK.didTakeSnapshot(t.toDataURL("image/jpeg",.1)))}),celerSDK.provideCurrentFrameData(function(){e=!0})}return r.call("ready")},onStart:function(e){return r.register("onStart",e)},provideScore:function(e){return s={callback:e}},provideCurrentFrameData:function(e){return u={callback:e}},didTakeSnapshot:function(e){if(!(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.celerSDK&&window.webkit.messageHandlers.celerSDK.postMessage))return r.call("didTakeSnapshot",e);window.webkit.messageHandlers.celerSDK.postMessage({method:"didTakeSnapshot",args:e})},log:function(e){if(!(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.celerSDK&&window.webkit.messageHandlers.celerSDK.postMessage))return r.call("log",e);window.webkit.messageHandlers.celerSDK.postMessage({method:"log",args:e})},getGameScore:function(){return s&&s.callback&&""!=s.callback()?s.callback():0},switchSnapShotFlag:function(){return u&&u.callback&&""!=u.callback()?u.callback():0}},cc._RF.pop()},{}]},{},["Bird","Bubble","BubbleBurst","BubbleChange","BubbleDrop","BubbleHorce","BubbleIdle","BubbleMove","Const","AudioController","EventManager","EventName","Game","GameFactory","StepController","BubbleMatrix","FrameAniBase","GameScene","Guide","LoadingImg","PauseLayer","Pointer","ReadyGoAnimation","ResultAnimation","ResultLayer","BlueIdle","BlueLoad","GreenIdle","HandUpLeft","HandUpRight","ShooterLayer","StartButton","SuperHorceAni","Treasure","HashMap","LogHandler","celerx"]);