window.__require=function e(t,o,n){function i(r,l){if(!o[r]){if(!t[r]){var c=r.split("/");if(c=c[c.length-1],!t[c]){var s="function"==typeof __require&&__require;if(!l&&s)return s(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+r+"'")}}var u=o[r]={exports:{}};t[r][0].call(u.exports,function(e){return i(t[r][1][e]||e)},u,u.exports,e,t,o,n)}return o[r].exports}for(var a="function"==typeof __require&&__require,r=0;r<n.length;r++)i(n[r]);return i}({AudioController:[function(e,t,o){"use strict";cc._RF.push(t,"c3611jDu5hL7auVf9iIBCz5","AudioController"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../Utils/HashMap"),i=e("./EventManager"),a=e("./EventName"),r="sounds/";window.oncanplay&&(window.oncanplay=function(){l.canPlay=!0});var l=function(){function e(){this.audioID={},this.clips=new n.HashMap}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.init=function(e){console.warn(" start load AudioClip ");var t=this;cc.loader.loadResDir(r,cc.AudioClip,function(o,n,i){if(o)console.error(o);else{for(var a=0,r=n;a<r.length;a++){var l=r[a];0,t.clips.add(l.name,l)}t.initEvent(),e&&e()}})},e.prototype.initEvent=function(){var e=this;i.gEventMgr.targetOff(this),this.playMusic("bgm"),i.gEventMgr.on(a.GlobalEvent.CHANGE_BGM,function(t){e.playMusic(t)},this),i.gEventMgr.on(a.GlobalEvent.PLAY_EFFECT,function(t){e.playEffect(t)},this)},e.prototype.playEffect=function(t,o){var n=this;if(void 0===o&&(o=!1),e.canPlay){if(!(cc.audioEngine.getEffectsVolume()<=.05)){var i=this.clips.get(t);i?this.audioID[t]=cc.audioEngine.playEffect(i,o):cc.loader.loadRes(r+t,cc.AudioClip,function(e,i){e?console.error(e):(n.clips.add(i.name,i),n.audioID[t]=cc.audioEngine.playEffect(i,o))})}}else this.bindTouch()},e.prototype.playMusic=function(t,o){var n=this;if(void 0===o&&(o=!0),!e.canPlay)return this.bindTouch(),void e.PlayedList.push({loop:!0,volume:1,clipName:t,supTime:Date.now(),skip:!1,isBgm:!0});var i=this.clips.get(t);i?cc.audioEngine.playMusic(i,o):cc.loader.loadRes(r+t,cc.AudioClip,function(e,t){e?console.error(e):("string"==typeof t._audio&&cc.loader._cache&&cc.loader._cache[t._audio]&&cc.loader._cache[t._audio].buffer&&(t._audio=cc.loader._cache[t._audio].buffer),n.clips.add(t.name,t),cc.audioEngine.playMusic(t,o))})},e.prototype.bindTouch=function(){if(!e.hasBindTouch){var t=this,o=function(){var n;for(cc.game.canvas.removeEventListener("touchstart",o),cc.sys.platform==cc.sys.DESKTOP_BROWSER&&cc.game.canvas.removeEventListener("click",o),e.canPlay=!0;(n=e.PlayedList.pop())&&t.clips.get(n.clipName)&&!n.skip;)cc.audioEngine.playMusic(t.clips.get(n.clipName),n.loop)};e.hasBindTouch=!0,cc.game.canvas.addEventListener("touchstart",o),cc.sys.platform==cc.sys.DESKTOP_BROWSER&&cc.game.canvas.addEventListener("click",o)}},e.PlayedList=[],e.canPlay=!1,e.hasBindTouch=!1,e}();o.gAudio=l.inst,cc._RF.pop()},{"../Utils/HashMap":"HashMap","./EventManager":"EventManager","./EventName":"EventName"}],Bird:[function(e,t,o){"use strict";cc._RF.push(t,"ae760SeGw5Fo6VvYIpO18qP","Bird"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Controller/Game"),i=e("./Const"),a=e("./Controller/EventManager"),r=e("./Controller/EventName"),l=e("./BubbleMove"),c=e("./Controller/GameSignal"),s=e("./Controller/GameFactory"),u=cc._decorator,h=u.ccclass,p=(u.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.acceleration=cc.v2(0,0),t.velocity=cc.v2(0,0),t.Speed=cc.v2(400,800),t.score=0,t.Scale=1.2,t.fly=!1,t}var o;return __extends(t,e),o=t,Object.defineProperty(t.prototype,"Spine",{get:function(){return this.getComponent(sp.Skeleton)},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){},t.prototype.start=function(){},t.prototype.reuse=function(e,t){var l=this;this.score=e,this.Spine.setCompleteListener(this.onAnimationComplete.bind(this)),this.node.setPosition(t),Math.abs(o.Border)<Math.abs(t.x)&&(o.Border=Math.abs(t.x)+2),this.node.scale=0;var c=cc.v2(this.node.x>0?1:-1,1).mul(this.Scale);this.node.runAction(cc.sequence(cc.scaleTo(.2,1.2*c.x,1.2*c.y),cc.scaleTo(.1,c.x,c.y),cc.callFunc(function(){l.startFly()}))),a.gEventMgr.once(r.GlobalEvent.GAME_OVER,function(){l.node.stopAllActions(),l.flyDone(1e3,!1),n.Game.addScore(i.BubbleType.Bird,l.score,1.5,CMath.ConvertToNodeSpaceAR(l.node,n.Game.TopNode).add(cc.v2(.5*i.BubbleSize.width,.5*i.BubbleSize.height)))},this)},t.prototype.startFly=function(){a.gEventMgr.emit(r.GlobalEvent.PLAY_EFFECT,"chackn"),this.Spine.loop=!0,this.Spine.animation="fly",this.velocity.y=this.Speed.y,this.velocity.x=this.node.scaleX>0?-this.Speed.x:this.Speed.x,this.fly=!0},t.prototype.onAnimationComplete=function(e){var t=this;switch(e.animation.name){case"get":break;case"fly":this.velocity.y=.3*-this.Speed.y,this.acceleration.y=this.Speed.y;break;case"idle":setTimeout(function(){t.Spine.loop=!1,t.Spine.animation="idle"},700*CMath.getRandom())}},t.prototype.update=function(e){this.fly&&(this.node.scaleX=this.velocity.x>=0?-1:1,this.node.scaleX*=this.Scale,this.velocity.addSelf(this.acceleration.mul(e)),this.velocity.y>=this.Speed.y&&(this.acceleration.y=0),this.node.setPosition(this.node.position.add(this.velocity.mul(e))),CMath.ConvertToNodeSpaceAR(this.node,n.Game.TopNode).x>o.Border?(this.velocity.x=-Math.abs(this.velocity.x),this.velocity.y=.2*-this.Speed.y,this.acceleration.y=this.Speed.y):CMath.ConvertToNodeSpaceAR(this.node,n.Game.TopNode).x<-o.Border&&(this.velocity.x=Math.abs(this.velocity.x),this.velocity.y=.2*-this.Speed.y,this.acceleration.y=this.Speed.y),(CMath.Distance(this.node.position,cc.v2(0,0))<=200||this.node.y>=-100)&&this.flyDone())},t.prototype.flyDone=function(e,t){var o=this;void 0===e&&(e=500),void 0===t&&(t=!0),this.fly=!1,this.acceleration=cc.v2(0,0),this.velocity=cc.v2(0,0);var r=CMath.Distance(this.node.position,cc.v2(0,0));this.node.scaleX=this.node.x>0?1:-1,this.node.scaleX*=this.Scale,0==t&&(this.node.group="default"),c.ChacknCountChangedSignal.inst.dispatchOne(n.Game.treasureCount),this.node.runAction(cc.sequence(cc.moveTo(r/e,cc.v2(0,0)),cc.callFunc(function(){a.gEventMgr.targetOff(o),o.node.scaleX=1*o.Scale,o.node.runAction(cc.scaleTo(.1,1)),o.Spine.loop=!1,o.Spine.animation="idle",o.node.group="default",t&&n.Game.addScore(i.BubbleType.Bird,o.score,1.5,CMath.ConvertToNodeSpaceAR(o.node,n.Game.TopNode).add(cc.v2(.5*i.BubbleSize.width,.5*i.BubbleSize.height))),o.node.getParent().childrenCount>=3?s.gFactory.putBird(o.node):o.node.getParent().getChildByName("back").runAction(cc.fadeOut(.1))})))},t.Border=l.BorderX,t=o=__decorate([h],t)}(cc.Component));o.default=p,cc._RF.pop()},{"./BubbleMove":"BubbleMove","./Const":"Const","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Controller/GameFactory":"GameFactory","./Controller/GameSignal":"GameSignal"}],BlueIdle:[function(e,t,o){"use strict";cc._RF.push(t,"20036nLdjNApYvTy8Xi4ECH","BlueIdle"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../../FrameAniBase"),i=cc._decorator,a=i.ccclass,r=(i.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onLoad=function(){e.prototype.onLoad.call(this)},t.aniName="BlueIdle",t=__decorate([a],t)}(n.default));o.default=r,cc._RF.pop()},{"../../FrameAniBase":"FrameAniBase"}],BlueLoad:[function(e,t,o){"use strict";cc._RF.push(t,"08214k9+Y1NIr0C3aDpVb67","BlueLoad"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../../FrameAniBase"),i=e("../../Controller/EventManager"),a=e("../../Controller/EventName"),r=cc._decorator,l=r.ccclass,c=(r.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),i.gEventMgr.on(a.GlobalEvent.PLAY_LOAD,function(){t.play()},this)},t.prototype.onKeyFrame=function(e){8==e&&i.gEventMgr.emit(a.GlobalEvent.BUBBLE_LOAD)},t.prototype.start=function(){},t.aniName="BlueLoad",t=__decorate([l],t)}(n.default));o.default=c,cc._RF.pop()},{"../../Controller/EventManager":"EventManager","../../Controller/EventName":"EventName","../../FrameAniBase":"FrameAniBase"}],BubbleBurst:[function(e,t,o){"use strict";cc._RF.push(t,"2a3f2DDgVZNpIG4fasOghMK","BubbleBurst"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../FrameAniBase"),i=cc._decorator,a=i.ccclass,r=(i.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.play=function(){e.prototype.play.call(this)},t.aniName="BubbleBurst",t=__decorate([a],t)}(n.default));o.default=r,cc._RF.pop()},{"../FrameAniBase":"FrameAniBase"}],BubbleChange:[function(e,t,o){"use strict";cc._RF.push(t,"3a817znFDhDCaEwLpCddbyw","BubbleChange"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../FrameAniBase"),i=cc._decorator,a=i.ccclass,r=(i.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.play=function(){e.prototype.play.call(this)},t.aniName="BubbleChange",t=__decorate([a],t)}(n.default));o.default=r,cc._RF.pop()},{"../FrameAniBase":"FrameAniBase"}],BubbleDrop:[function(e,t,o){"use strict";cc._RF.push(t,"623af7xlK1EQ4Szsrycvrsz","BubbleDrop"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../FrameAniBase"),i=cc._decorator,a=i.ccclass,r=(i.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.play=function(){e.prototype.play.call(this)},t.aniName="BubbleDrop",t=__decorate([a],t)}(n.default));o.default=r,cc._RF.pop()},{"../FrameAniBase":"FrameAniBase"}],BubbleHorce:[function(e,t,o){"use strict";cc._RF.push(t,"dc741sapJBNlKYdfySF/Y71","BubbleHorce"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../FrameAniBase"),i=cc._decorator,a=i.ccclass,r=(i.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.play=function(){e.prototype.play.call(this)},t.aniName="BubbleHorce",t=__decorate([a],t)}(n.default));o.default=r,cc._RF.pop()},{"../FrameAniBase":"FrameAniBase"}],BubbleIdle:[function(e,t,o){"use strict";cc._RF.push(t,"97381k3pDhIrLdCJF11xOn7","BubbleIdle"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../FrameAniBase"),i=cc._decorator,a=i.ccclass,r=(i.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.play=function(){e.prototype.play.call(this)},t.aniName="BubbleIdle",t=__decorate([a],t)}(n.default));o.default=r,cc._RF.pop()},{"../FrameAniBase":"FrameAniBase"}],BubbleMatrix:[function(e,t,o){"use strict";cc._RF.push(t,"3fc87k3ArdNNIwVYgSiAJGh","BubbleMatrix"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../Const"),i=e("../Controller/Game");o.MatrixSize=14,o.UseSize=10,o.IndexJStart=(o.MatrixSize-o.UseSize)/2,o.IndexJEnd=o.UseSize+1;var a=function(){function e(){this.matrixData=[],this.addRowTotalCount=0,this.firstRow=0;for(var e=0;e<o.MatrixSize*o.MatrixSize;e++)this.matrixData[e]={color:n.BubbleType.Blank,bubble:null,type:n.SpecialType.Normal}}return Object.defineProperty(e.prototype,"data",{get:function(){return this.matrixData},enumerable:!0,configurable:!0}),e.prototype.addRow=function(e){var t=this.matrixData.length;this.matrixData.length+=e*o.MatrixSize;for(var i=t;i<this.matrixData.length;i++)this.matrixData[i]={color:n.BubbleType.Blank,bubble:null,type:n.SpecialType.Normal}},e.prototype.getRestRowCount=function(){return this.addRowTotalCount},e.prototype.getFirstRow=function(){return this.firstRow},e.prototype.moveRow=function(e){if(this.addRowTotalCount<=e){this.addRow(6),this.firstRow+=5,i.Game.startIndex+=5*o.MatrixSize,this.addRowTotalCount+=6;var t=6*o.MatrixSize;console.log(" \u65b0\u589e6\u884c\uff1a ",t,", total length:",this.data.length);for(var a=this.matrixData.length-1;a>=t;a--)this.matrixData[a-t]||(this.matrixData[a-t]={color:n.BubbleType.Blank,bubble:null,type:n.SpecialType.Normal}),this.matrixData[a].color=this.matrixData[a-t].color,this.matrixData[a].type=this.matrixData[a-t].type,this.matrixData[a].bubble=this.matrixData[a-t].bubble,this.matrixData[a-t]={color:n.BubbleType.Blank,bubble:null,type:n.SpecialType.Normal},this.matrixData[a].bubble&&this.matrixData[a].bubble.setIndex(a);var r=Math.ceil(CMath.getRandom(n.DoubleBubbleRange.Min,n.DoubleBubbleRange.Max)),l=Math.ceil(CMath.getRandom(n.BoomBubbleRange.Min,n.BoomBubbleRange.Max)),c=Math.ceil(CMath.getRandom(n.MagicBubbleRange.Min,n.MagicBubbleRange.Max));console.log(" double:",r,", boom:",l,", magic:",c);var s=[];for(a=0;a<=t-1;a++)this.index2j(a)>=o.IndexJStart&&this.index2j(a)<=o.IndexJEnd&&s.push(a);for(var u=Math.ceil(CMath.getRandom(2,3)),h={};u>0&&s.length>0;){var p=s[E=Math.floor(CMath.getRandom(0,s.length))];s.splice(E,1);for(var d=!1,b=0,g=this.getNeiborMatrix(p,1);b<g.length;b++){if(h[g[b]]==n.BubbleType.Bird){d=!0;break}}d||(h[p]=n.BubbleType.Bird,u--)}for(var f=n.BubbleColors.concat(),m={};r>0&&f.length>0&&s.length>=0;){p=s[E=Math.floor(CMath.getRandom(0,s.length))];s.splice(E,1);var y=f[C=Math.floor(CMath.getRandom(0,f.length))];f.splice(C,1),m[p]=y,r--}console.log(" ---------- \u53cc\u500d\u7403 --------------"),console.log(m);for(var v=n.BubbleColors.concat(),_={};l>0&&v.length>0&&s.length>=0;){p=s[E=Math.floor(CMath.getRandom(0,s.length))];s.splice(E,1);var C;y=v[C=Math.floor(CMath.getRandom(0,v.length))];v.splice(C,1),_[p]=y,l--}console.log(" ---------- \u70b8\u5f39\u7403 --------------"),console.log(_);for(var S={};c>0&&s.length>=0;){var E;p=s[E=Math.floor(CMath.getRandom(0,s.length))];s.splice(E,1),S[p]=n.BubbleType.Blank,c--}console.log(" ---------- \u9b54\u6cd5\u7403 --------------"),console.log(S);for(a=0;a<t-1;a++)this.matrixData[a].color=n.BubbleColors[Math.floor(CMath.getRandom()*n.BubbleColors.length)],this.matrixData[a].bubble=null,this.matrixData[a].type=n.SpecialType.Normal,null!=m[a]&&(this.matrixData[a].type=n.SpecialType.Double,this.matrixData[a].color=m[a]),null!=S[a]&&(this.matrixData[a].type=n.SpecialType.Magic,this.matrixData[a].color=S[a]),null!=_[a]&&(this.matrixData[a].type=n.SpecialType.Boom,this.matrixData[a].color=_[a]),null!=h[a]&&(this.matrixData[a].type=n.SpecialType.Normal,this.matrixData[a].color=n.BubbleType.Bird)}else this.firstRow-=1,i.Game.startIndex-=o.MatrixSize;this.addRowTotalCount-=e,console.log(" \u5269\u4f59 ",this.addRowTotalCount," \u884c\u6570\u636e",", \u7b2c\u4e00\u884c\uff1a",this.firstRow,this.index2i(i.Game.startIndex))},e.prototype.ij2index=function(e,t){return e*o.MatrixSize+t},e.prototype.index2i=function(e){return Math.floor(e/o.MatrixSize)},e.prototype.index2j=function(e){return e%o.MatrixSize},e.prototype.getUseIndexStart=function(){return(o.MatrixSize-o.UseSize)/2*(o.MatrixSize+1)-1},e.prototype.getUseIndexEnd=function(){return o.MatrixSize*o.MatrixSize-this.getUseIndexStart()-1},e.prototype.getPosOfIndex=function(e){var t=this.index2i(e),o=this.index2j(e);return this.getPosOfij(t,o)},e.prototype.getPosOfij=function(e,t){var a=cc.v2(0,0);return a.x=(t-o.MatrixSize/2)*(n.BubbleSize.width+n.BubbleXOffset)+(e+this.firstRow+i.Game.getMoveTimes())%2*n.BubbleSize.width/2+n.BubbleStartX,a.y=(o.MatrixSize/2-e+i.Game.getMoveTimes()+this.firstRow-this.index2i(n.InitStartIndex))*(n.BubbleSize.height+n.BubbleHeightOffset)+n.BubbleYOffset,a},e.prototype.getNeiborMatrix=function(e,t,n){void 0===n&&(n=!1);for(var a=[],r=this.index2i(e),l=i.Game.getMoveTimes()+this.firstRow,c=0;c<=t;c++){var s=r+c,u=r%2==s%2,h=t-Math.floor(c/2);h=Math.min(h,t);for(var p=0;p<=h;p++){var d,b=e+c*o.MatrixSize+p,g=e-c*o.MatrixSize+p,f=e+c*o.MatrixSize-p,m=e-c*o.MatrixSize-p;if(e!=b&&a.indexOf(b)<0&&b>=0&&(b<this.matrixData.length||n))if(u||(s+l)%2==0||p<h)(d=this.index2j(b))>=o.IndexJStart&&d<=o.IndexJEnd&&b>=i.Game.startIndex&&(this.data[b]&&this.data[b].bubble&&!n?a.push(b):!n||this.data[b]&&this.data[b].bubble||a.push(b));if(e!=g&&a.indexOf(g)<0&&g>=0&&(g<this.matrixData.length||n))(d=this.index2j(g))>=o.IndexJStart&&d<=o.IndexJEnd&&g>=i.Game.startIndex&&(u||(s+l)%2==0||p<h)&&(this.data[g]&&this.data[g].bubble&&!n?a.push(g):!n||this.data[g]&&this.data[g].bubble||a.push(g));if(e!=f&&a.indexOf(f)<0&&f>=0&&(f<this.matrixData.length||n))(d=this.index2j(f))>=o.IndexJStart&&d<=o.IndexJEnd&&f>=i.Game.startIndex&&(u||(s+l)%2||p<h)&&(this.data[f]&&this.data[f].bubble&&!n?a.push(f):!n||this.data[f]&&this.data[f].bubble||a.push(f));if(e!=m&&a.indexOf(m)<0&&m>=0&&(m<this.matrixData.length||n))(d=this.index2j(m))>=o.IndexJStart&&d<=o.IndexJEnd&&m>=i.Game.startIndex&&(u||(s+l)%2||p<h)&&(this.data[m]&&this.data[m].bubble&&!n?a.push(m):!n||this.data[m]&&this.data[m].bubble||a.push(m))}}return a.sort(function(e,t){return e-t}),a},e.prototype.initBubbleData=function(){console.log(" init bubble data :",i.Game.MatchInfo.matchId,", seed:",i.Game.MatchInfo.sharedRandomSeed);var e=this.getUseIndexStart(),t=this.getUseIndexEnd();this.firstRow=this.index2i(i.Game.startIndex),this.addRowTotalCount=0;var a=Math.ceil(CMath.getRandom(n.DoubleBubbleInitRange.Min,n.DoubleBubbleInitRange.Max)),r=Math.ceil(CMath.getRandom(n.BoomBubbleInitRange.Min,n.BoomBubbleInitRange.Max)),l=Math.ceil(CMath.getRandom(n.MagicBubbleInitRange.Min,n.MagicBubbleInitRange.Max));console.log("start:",e,", end:",t,", firstRow:",this.firstRow),console.log(" double:",a,", boom:",r,", magic:",l);for(var c=[],s=i.Game.startIndex;s<=t;s++)this.index2j(s)>=o.IndexJStart&&this.index2j(s)<=o.IndexJEnd&&c.push(s);for(var u={},h=6,p=c.length-40;h>0&&c.length>0;){var d=c[A=Math.floor(CMath.getRandom(p,c.length))];c.splice(A,1);for(var b=!1,g=0,f=R=this.getNeiborMatrix(d,1,!0);g<f.length;g++){if(u[f[g]]==n.BubbleType.Bird){b=!0;break}}b||(u[d]=n.BubbleType.Bird,h--)}for(var m=4,y=c.length-40;m>0&&c.length>0;){d=c[A=Math.floor(CMath.getRandom(0,y))];c.splice(A,1),y--;b=!1;for(var v=0,_=R=this.getNeiborMatrix(d,1,!0);v<_.length;v++){if(u[_[v]]==n.BubbleType.Bird){b=!0;break}}b||(u[d]=n.BubbleType.Bird,m--)}for(var C=n.BubbleColors.concat(),S={};a>0&&c.length>=0;){d=c[A=Math.floor(CMath.getRandom(0,c.length))];c.splice(A,1);var E=C[T=Math.floor(CMath.getRandom(0,C.length))];C.splice(T,1),S[d]=E,a--,C.length<=0&&(C=n.BubbleColors.concat())}console.log(" ---------- \u53cc\u500d\u7403 --------------"),console.log(S);for(var B=n.BubbleColors.concat(),M={};r>0&&c.length>=0;){d=c[A=Math.floor(CMath.getRandom(0,c.length))];c.splice(A,1);var T;E=B[T=Math.floor(CMath.getRandom(0,B.length))];B.splice(T,1),M[d]=E,r--,B.length<=0&&(B=n.BubbleColors.concat())}console.log(" ---------- \u70b8\u5f39\u7403 --------------"),console.log(M);for(var x={};l>0&&c.length>=0;){var A;d=c[A=Math.floor(CMath.getRandom(0,c.length))];c.splice(A,1),x[d]=n.BubbleType.Blank,l--}console.log(" ---------- \u9b54\u6cd5\u7403 --------------"),console.log(x);for(s=e;s<=t;s++){for(var R,F=[],P=0,G=R=this.getNeiborMatrix(s,1);P<G.length;P++){var N=G[P];this.matrixData[N].color!=n.BubbleType.Blank&&F.push(this.matrixData[N])}var O=this.getOtherColors(F);CMath.getRandom()<=.8&&O.length>0?this.matrixData[s].color=O[Math.floor(CMath.getRandom()*O.length)]:this.matrixData[s].color=n.BubbleColors[Math.floor(CMath.getRandom()*n.BubbleColors.length)];for(var L=0;L<R.length;L++){N=R[L];if(this.matrixData[N].color==n.BubbleType.Blank)if(CMath.getRandom()<=.8)this.matrixData[N]=this.matrixData[s];else{var I=this.getOtherColors([this.matrixData[s].color]);this.matrixData[N].color=I[Math.floor(CMath.getRandom()*I.length)]}for(var k=this.getNeiborMatrix(N,1),D=0;D<k.length;D++){var w=k[D];if(this.matrixData[w].color==n.BubbleType.Blank)if(CMath.getRandom()<=.8-.7&&this.matrixData[N]==this.matrixData[s])this.matrixData[w]=this.matrixData[N];else{var H=this.getOtherColors([this.matrixData[s].color,this.matrixData[N].color]);this.matrixData[w].color=H[Math.floor(CMath.getRandom()*H.length)]}}}}for(s=0;s<this.matrixData.length;s++)this.matrixData[s].color==n.BubbleType.Blank&&(this.matrixData[s].color=n.BubbleColors[Math.floor(CMath.getRandom()*n.BubbleColors.length)]),this.matrixData[s].type=n.SpecialType.Normal,null!=S[s]&&(this.matrixData[s].type=n.SpecialType.Double,this.matrixData[s].color=S[s]),null!=x[s]&&(this.matrixData[s].type=n.SpecialType.Magic,this.matrixData[s].color=x[s]),null!=M[s]&&(this.matrixData[s].type=n.SpecialType.Boom,this.matrixData[s].color=M[s]),null!=u[s]&&(this.matrixData[s].type=n.SpecialType.Normal,this.matrixData[s].color=n.BubbleType.Bird),null!=n.SpecialIndex[s]&&(this.matrixData[s].type=n.SpecialIndex[s].type,this.matrixData[s].color=n.SpecialIndex[s].color);console.log(" init bubble data done!"),console.log(this.matrixData.length)},e.prototype.getOtherColors=function(e){for(var t=n.BubbleColors.concat(),o=0,i=e;o<i.length;o++){var a=i[o],r=t.indexOf(a);r<0||t.splice(r,1)}return t},e}();o.BubbleMatrix=a,cc._RF.pop()},{"../Const":"Const","../Controller/Game":"Game"}],BubbleMove:[function(e,t,o){"use strict";cc._RF.push(t,"f122cLSg0BF5pRoYWwgPS74","BubbleMove"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Bubble"),i=e("./Controller/EventManager"),a=e("./Controller/EventName"),r=e("./Controller/Game"),l=e("./Const"),c=e("./Controller/GameFactory"),s=e("./BubbleAnimation/BubbleChange"),u=e("./BubbleAnimation/BubbleDrop"),h=e("./BubbleAnimation/BubbleBurst"),p=cc._decorator,d=p.ccclass;p.property;o.BorderX=440;o.DropBorder=-667,o.CollsionFactor=.3,o.CollsionOffset=40,o.CollsionMinFactor=.01;var b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.speed=cc.v2(0,0),t.acceleration=cc.v2(0,0),t.hasCollision=!1,t.shooted=!1,t.isDrop=!1,t.animationCallback={},t}return __extends(t,e),Object.defineProperty(t.prototype,"bubble",{get:function(){return this.getComponent(n.default)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radis",{get:function(){return l.BubbleSize.width/2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isShooterState",{get:function(){return"Shooter"==this.node.getParent().name&&this.node.getNumberOfRunningActions()<=0&&!this.hasCollision&&this.shooted},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isReady2Shoot",{get:function(){return"Shooter"==this.node.getParent().name&&this.node.getNumberOfRunningActions()<=0},enumerable:!0,configurable:!0}),t.prototype.checkBorder=function(){this.isDrop||(this.node.x<=-o.BorderX||this.node.x>=o.BorderX)&&(this.node.x=this.node.x>0?.999*o.BorderX:.999*-o.BorderX,this.speed.x=-this.speed.x,this.acceleration.x=-this.acceleration.x,r.Game.Rebounce++)},t.prototype.forceMove=function(e){var t=this.node.getActionByTag(n.BubbleAction.Collision);if(!t||t.isDone()){var o=cc.sequence(cc.moveBy(.1,e).easing(cc.easeQuadraticActionIn()),cc.moveBy(.1,e.mul(-1)).easing(cc.easeQuadraticActionOut()));o.setTag(n.BubbleAction.Collision),this.node.runAction(o)}},t.prototype.checkCollisionBubble=function(){var e=this;if(this.isShooterState&&!this.isDrop)for(var t=r.Game.getCollisionIndexes(),o=r.Game.getMatrix(),n=function(t){var n=o.data[t].bubble;if(!n)return console.warn(" bubble \u4e0d\u5b58\u5728\uff01"),"continue";var u=CMath.ConvertToNodeSpaceAR(c.node,n.node.parent);if(CMath.Distance(u,n.node.position)<=2*c.radis*.8){var h=o.getNeiborMatrix(t,1,!0),p=-1,d=100;console.log("\u78b0\u5230\uff1a",t),console.log(h);for(var b=0,g=h;b<g.length;b++){var f=g[b],m=o.index2i(f),y=o.index2j(f),v=o.getPosOfij(m,y);CMath.Distance(v,u)<d&&(d=CMath.Distance(v,u),p=f)}return c.bubble.Type==l.SpecialType.Magic?n.Type!=l.SpecialType.Magic&&l.ChangeColorExcept.indexOf(n.Color)<0&&n.node.active&&(c.bubble.setColor(n.Color,l.SpecialType.Normal),i.gEventMgr.emit(a.GlobalEvent.PLAY_EFFECT,"change_color"),c.bubble.playAnimation(s.default,function(){e.bubble.AnimationRoot.runAction(cc.fadeOut(.1))})):n.Type==l.SpecialType.Magic&&n.node.active&&c.bubble.Type!=l.SpecialType.Horce&&l.ChangeColorExcept.indexOf(c.bubble.Color)<0&&(n.setColor(c.bubble.Color,c.bubble.Type),n.playAnimation(s.default,function(){n.AnimationRoot.runAction(cc.fadeOut(.1))}),i.gEventMgr.emit(a.GlobalEvent.PLAY_EFFECT,"change_color")),n.onCollision(),i.gEventMgr.emit(a.GlobalEvent.BUBBLE_FORCE,p),p<0?console.error(" target index -1"):c.onCollision(p,function(){r.Game.checkClear(e.bubble.getIndex(),e.bubble,n),r.Game.updateCollisionIndexes(),i.gEventMgr.emit(a.GlobalEvent.NEXT_BUBBLE)}),{value:void 0}}},c=this,u=0,h=t;u<h.length;u++){var p=n(h[u]);if("object"==typeof p)return p.value}},t.prototype.onCollision=function(e,t){console.log(" on collision:",e);var o=Math.abs(this.speed.x/this.speed.y),n=0==o||isNaN(o)?1.2:1/o,i=1/n;this.speed.x=0,this.speed.y=0,this.acceleration.x=0,this.acceleration.y=0,this.hasCollision=!0;var a=r.Game.getMatrix(),l=a.index2i(e),c=a.index2j(e),s=a.getPosOfij(l,c),u=CMath.ConvertToNodeSpaceAR(this.node,r.Game.BubbleLayer);this.node.x=u.x,this.node.y=u.y,this.node.setParent(r.Game.BubbleLayer),this.node.stopAllActions(),this.scaleBubble(n,i),this.bubble.setIndex(e),this.node.runAction(cc.sequence(cc.moveTo(.1,s),cc.callFunc(function(){t&&t(),r.Game.checkOutOfMove()},this)))},t.prototype.scaleBubble=function(e,t){e=CMath.Clamp(e,1.2,.8),t=CMath.Clamp(t,1.2,.8),this.node.runAction(cc.sequence(cc.scaleTo(.1,e,t),cc.scaleTo(.1,1,1)))},t.prototype.initEvent=function(){i.gEventMgr.targetOff(this),i.gEventMgr.on(a.GlobalEvent.BUBBLE_FORCE,this.force,this)},t.prototype.readyToShoot=function(){i.gEventMgr.on(a.GlobalEvent.SHOOT,this.shoot,this)},t.prototype.unreadyToShoot=function(){i.gEventMgr.off(a.GlobalEvent.SHOOT)},t.prototype.force=function(e){var t=this.bubble.getIndex();if(t!=e){var n=r.Game.getMatrix(),i=n.getPosOfIndex(e),a=n.getPosOfIndex(t),l=CMath.Distance(i,a),c=Math.ceil(l/(2*this.radis)),s=Math.pow(o.CollsionFactor,Math.max(0,c-1));this.forceMove(a.sub(i).normalize().mul(s*o.CollsionOffset))}},t.prototype.reuse=function(){this.node.getChildByName("Bubble").color=cc.Color.WHITE,this.initEvent(),this.hasCollision=!1,this.isDrop=!1,this.speed=cc.v2(0,0),this.acceleration=cc.v2(0,0),this.shooted=!1,this.node.group="default"},t.prototype.unuse=function(){this.enabled=!1,this.shooted=!1,this.isDrop=!1,i.gEventMgr.targetOff(this)},t.prototype.shoot=function(e){i.gEventMgr.off(a.GlobalEvent.SHOOT),console.log("\u53d1\u5c04\uff01"),r.Game.Rebounce=0,i.gEventMgr.emit(a.GlobalEvent.PLAY_EFFECT,"shoot"),i.gEventMgr.emit(a.GlobalEvent.AFTER_SHOOT),this.enabled=!0,this.shooted=!0,e.normalizeSelf(),this.speed.x=5200*e.x,this.speed.y=5200*e.y,this.acceleration.x=800*e.x,this.acceleration.y=800*e.y},t.prototype.isShooted=function(){return this.shooted},t.prototype.drop=function(){r.Game.DropCount++,this.isDrop=!0,this.enabled=!0,this.speed.y=800+CMath.getRandom(0,1e3),this.acceleration.y=4*-this.speed.y,this.speed.x=this.node.x>0?-200:200,this.speed.x*=CMath.getRandom(0,1.5)+1,this.node.group="drop",r.Game.addBubbleDrop(this.bubble.Color),console.log(" \u6389\u843d:",this.enabled,this.bubble.getIndex(),this.speed,this.acceleration,this.hasCollision,"Drop:",r.Game.DropCount)},t.prototype.update=function(e){var t=this;if(this.isShooterState||this.isDrop){for(var s=0;s<10;s++){this.checkBorder(),this.checkCollisionBubble(),this.node.x+=this.speed.x*e/10,this.node.y+=this.speed.y*e/10,this.speed.x+=this.acceleration.x*e/10,this.speed.y+=this.acceleration.y*e/10;var p=CMath.ConvertToNodeSpaceAR(this.node,this.node.getParent().getParent());if(this.isDrop&&p.y<=o.DropBorder){if(this.enabled=!1,this.scaleBubble(1.1,.9),i.gEventMgr.emit(a.GlobalEvent.PLAY_EFFECT,"drop"),r.Game.DropCount--,this.bubble.Color==l.BubbleType.Bird)i.gEventMgr.emit(a.GlobalEvent.GET_TREASURE,++r.Game.treasureCount,this.node),this.bubble.playAnimation(h.default,function(){c.gFactory.putBubble(t.node)});else{var d=this.bubble.DoubleScore?2*n.BubbleDropScore:n.BubbleDropScore;r.Game.addScore(this.bubble.Color,d,1,CMath.ConvertToNodeSpaceAR(this.node,r.Game.TopNode).add(cc.v2(.5*l.BubbleSize.width,.5*l.BubbleSize.height))),this.bubble.playAnimation(u.default,function(){c.gFactory.putBubble(t.node)})}break}}this.node.parent&&"Shooter"==this.node.parent.name&&(Math.abs(this.node.x)>=600||this.node.y>1663||this.node.y<0)&&(c.gFactory.putBubble(this.node),this.enabled=!1,console.error("  error , not collision! bubble lost "),i.gEventMgr.emit(a.GlobalEvent.NEXT_BUBBLE))}},t=__decorate([d],t)}(cc.Component);o.default=b,cc._RF.pop()},{"./Bubble":"Bubble","./BubbleAnimation/BubbleBurst":"BubbleBurst","./BubbleAnimation/BubbleChange":"BubbleChange","./BubbleAnimation/BubbleDrop":"BubbleDrop","./Const":"Const","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Controller/GameFactory":"GameFactory"}],Bubble:[function(e,t,o){"use strict";cc._RF.push(t,"ab9ae70D2ZFXoGg9F2uKBO0","Bubble"),Object.defineProperty(o,"__esModule",{value:!0});var n,i=e("./Controller/EventManager"),a=e("./Controller/Game"),r=e("./Controller/EventName"),l=e("./Const"),c=e("./BubbleMove"),s=e("./Controller/GameFactory"),u=e("./BubbleAnimation/BubbleIdle"),h=e("./BubbleAnimation/BubbleBurst"),p=e("./BubbleAnimation/BubbleChange"),d=e("./BubbleAnimation/BubbleDrop"),b=e("./BubbleAnimation/BubbleHorce");o.BubbleDropScore=10,o.BubbleScoreStep=10,function(e){e[e.Bubble=0]="Bubble",e[e.Collision=1]="Collision"}(n=o.BubbleAction||(o.BubbleAction={}));var g=cc._decorator,f=g.ccclass,m=(g.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.index=-1,t.color=l.BubbleType.Blank,t.type=l.SpecialType.Normal,t.animationCallback={},t.doubleScore=!1,t}return __extends(t,e),t.prototype.getAnimation=function(e){return this.getComponentInChildren(e)},Object.defineProperty(t.prototype,"AnimationRoot",{get:function(){return this.node.getChildByName("Animation")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DropRoot",{get:function(){return this.node.getChildByName("Down")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sprite",{get:function(){return this.node.getChildByName("Bubble").getComponent(cc.Sprite)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"move",{get:function(){return this.getComponent(c.default)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IndexLabel",{get:function(){return this.node.getChildByName("Index").getComponent(cc.Label)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Color",{get:function(){return this.color},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Type",{get:function(){return this.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Double",{get:function(){return this.node.getChildByName("Bubble").getChildByName("Double")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDouble",{get:function(){return this.type==l.SpecialType.Double},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DoubleScore",{get:function(){return this.doubleScore},set:function(e){this.doubleScore=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Bubble",{get:function(){return this.node.getChildByName("Bubble")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ChacknBubble",{get:function(){return this.Bubble.getChildByName("bg_chackn pop")},enumerable:!0,configurable:!0}),t.prototype.reuse=function(e,t,o,n,i,a,r,c,s){this.node.active=!1,this.node.scale=0,this.X2=s,this.type=o==l.BubbleType.Boom?l.SpecialType.Boom:e==l.SpecialType.Boom?l.SpecialType.Normal:e,this.type==l.SpecialType.Double&&o==l.BubbleType.Bird&&(this.type=l.SpecialType.Normal),this.color=o,this.idleFrames=n,this.burstFrames=a,this.getAnimation(p.default).Animation=i,this.getAnimation(b.default).Animation=r,this.getAnimation(u.default).Animation=this.idleFrames[o],this.getAnimation(h.default).Animation=this.burstFrames[o],this.getAnimation(d.default).Animation=c,this.ChacknBubble.active=this.color==l.BubbleType.Bird,this.color==l.BubbleType.Bird?this.Bubble.width=this.Bubble.height=90:this.Bubble.width=this.Bubble.height=92,this.sprite.node.opacity=255,this.Double.active=this.type==l.SpecialType.Double,this.Double.getComponent(cc.Sprite).spriteFrame=this.X2.getSpriteFrame(l.BubbleX2[this.color]),this.doubleScore=!1,this.updateSprite(),this.IndexLabel.node.active=!1,this.setIndex(t),this.initEvent()},t.prototype.unuse=function(){i.gEventMgr.targetOff(this),this.index=-1,this.IndexLabel.string="",this.node.stopAllActions(),this.getAnimation(u.default).clearAllListener().clearCompleteEvent(),this.getAnimation(h.default).clearAllListener().clearCompleteEvent(),this.getAnimation(p.default).clearAllListener().clearCompleteEvent(),this.getAnimation(b.default).clearAllListener().clearCompleteEvent(),this.getAnimation(d.default).clearAllListener().clearCompleteEvent(),this.AnimationRoot.opacity=0,this.DropRoot.opacity=0,this.node.targetOff(this),this.node.active=!1},t.prototype.setColor=function(e,t){this.color!=e?(this.color=e,this.type=t,this.ChacknBubble.active=this.color==l.BubbleType.Bird):console.warn(" color:",l.BubbleType[this.color],l.BubbleType[e])},t.prototype.updateSprite=function(e){void 0===e&&(e=!1),this.getAnimation(u.default).Animation=this.idleFrames[this.color],this.getAnimation(h.default).Animation=this.burstFrames[this.color],this.Double.getComponent(cc.Sprite).spriteFrame=this.X2.getSpriteFrame(l.BubbleX2[this.color])},t.prototype.setIndex=function(e){if(e!=this.index){var t=a.Game.getMatrix();t.data[e]&&t.data[e].bubble?t.data[e].bubble!=this&&(console.error(this.index,"\u6570\u636e\u4e0d\u540c\u6b65\uff01",e,", oldIndex:",t.data[e].bubble.getIndex()),console.log(t.data[e])):t.data[e]={color:this.color,bubble:this,type:this.type},this.index=e}},t.prototype.updateIndex=function(){this.IndexLabel.node.active=!this.IndexLabel.node.active,this.IndexLabel.string=this.index.toString()},t.prototype.getIndex=function(){return this.index},t.prototype.setActive=function(e,t,o){this.node.active!=e&&(this.node.active=e,this.node.active||(this.node.scale=0),this.node.active&&t&&this.bubbleScale(o))},t.prototype.initEvent=function(){this.getAnimation(u.default).addCompleteEvent(this.onAnimationComplete,this),this.getAnimation(h.default).addCompleteEvent(this.onAnimationComplete,this),this.getAnimation(p.default).addCompleteEvent(this.onAnimationComplete,this),this.getAnimation(d.default).addCompleteEvent(this.onAnimationComplete,this),this.getAnimation(b.default).addCompleteEvent(this.onAnimationComplete,this),this.getAnimation(u.default).addKeyEventListener(this.onAnimationKey,this),this.getAnimation(h.default).addKeyEventListener(this.onAnimationKey,this),this.getAnimation(p.default).addKeyEventListener(this.onAnimationKey,this),this.getAnimation(d.default).addKeyEventListener(this.onAnimationKey,this),this.getAnimation(b.default).addKeyEventListener(this.onAnimationKey,this),i.gEventMgr.on(r.GlobalEvent.UPDATE_INDEX,this.updateIndex,this),this.node._onSetParent=this.onSetParent.bind(this)},t.prototype.updateActive=function(e){void 0===e&&(e=0),this.setActive(this.index>=a.Game.startIndex,!0,e)},t.prototype.scaleTest=function(e){e.indexOf(this.index)<0||this.bubbleScale()},t.prototype.bubbleScale=function(e){void 0===e&&(e=0);var t=cc.sequence(cc.scaleTo(0,0),cc.delayTime(e),cc.scaleTo(.2,.9),cc.scaleTo(.1,1.1),cc.scaleTo(.1,1));t.setTag(n.Bubble),this.node.stopActionByTag(n.Bubble),this.node.runAction(t)},t.prototype.onSetParent=function(e){e&&(this.move.enabled="Shooter"==e.name,"BulletArray"==e.name?this.node.rotation=-90:this.node.rotation=0)},t.prototype.onCollision=function(){i.gEventMgr.emit(r.GlobalEvent.PLAY_EFFECT,"colision")},t.prototype.onClear=function(e,t){var n=this;if(this.index==t&&a.Game.Rebounce>0){console.log(" \u53cd\u5f39\u6b21\u6570:",a.Game.Rebounce),a.Game.Rebounce=0;var c=CMath.ConvertToNodeSpaceAR(this.node,a.Game.TopNode);Math.abs(c.x)>=340&&(c.x=c.x>0?340:-340),i.gEventMgr.emit(r.GlobalEvent.SHOW_REBOUNCE,c)}this.color!=l.BubbleType.Bird?(a.Game.addBubbleClear(this.Color),i.gEventMgr.emit(r.GlobalEvent.PLAY_EFFECT,this.type==l.SpecialType.Boom?"boom":"clear"),this.node.runAction(cc.sequence(cc.delayTime(.7*e),cc.callFunc(function(){var e=a.Game.getMatrix().index2i(n.index),i=a.Game.getMatrix().index2j(n.index),r=a.Game.getMatrix().index2i(t),c=a.Game.getMatrix().index2j(t),u=Math.max(Math.abs(e-r)+1,Math.abs(i-c)+1),p=Math.max(1,u)*o.BubbleScoreStep;n.DoubleScore&&(p*=2);var d=.1*u+1;a.Game.addScore(n.color,p,d,CMath.ConvertToNodeSpaceAR(n.node,a.Game.TopNode).add(cc.v2(.5*l.BubbleSize.width,.5*l.BubbleSize.height))),n.updateSprite(!0),n.playAnimation(h.default,function(){s.gFactory.putBubble(n.node)})},this)))):this.move.drop()},t.prototype.playAnimation=function(e,t){this.animationCallback[e.aniName]=t,this.getAnimation(e).play()},t.prototype.onAnimationKey=function(e,t){switch(0==e&&t!=u.default.prototype.__classname__&&(t==d.default.prototype.__classname__?this.DropRoot.opacity=255:this.AnimationRoot.opacity=255),t){case h.default.prototype.__classname__:0==e&&this.Bubble.runAction(cc.fadeOut(.1));break;case p.default.prototype.__classname__:2==e&&this.updateSprite();break;case b.default.prototype.__classname__:5==e&&this.updateSprite();break;case d.default.prototype.__classname__:0==e&&(this.Bubble.runAction(cc.fadeOut(.1)),this.DropRoot.opacity=255)}},t.prototype.onAnimationComplete=function(e){this.animationCallback[e]&&(this.animationCallback[e](),this.animationCallback[e]=null)},t.prototype.update=function(e){},t=__decorate([f],t)}(cc.Component));o.default=m,cc._RF.pop()},{"./BubbleAnimation/BubbleBurst":"BubbleBurst","./BubbleAnimation/BubbleChange":"BubbleChange","./BubbleAnimation/BubbleDrop":"BubbleDrop","./BubbleAnimation/BubbleHorce":"BubbleHorce","./BubbleAnimation/BubbleIdle":"BubbleIdle","./BubbleMove":"BubbleMove","./Const":"Const","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Controller/GameFactory":"GameFactory"}],ChacknCountView:[function(e,t,o){"use strict";cc._RF.push(t,"bef74UxmRNMJZfHb6cVk/et","ChacknCountView"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../Controller/GameSignal"),i=e("../Utils/NumberChangedView"),a=cc._decorator,r=a.ccclass,l=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onLoad=function(){n.ChacknCountChangedSignal.inst.addListenerOne(this.onNumberChanged,this)},t.prototype.start=function(){},t=__decorate([r],t)}(i.default));o.default=l,cc._RF.pop()},{"../Controller/GameSignal":"GameSignal","../Utils/NumberChangedView":"NumberChangedView"}],ChacknScoreView:[function(e,t,o){"use strict";cc._RF.push(t,"59b92pUfe5F2a0O3yWwNB3y","ChacknScoreView"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../Utils/NumberChangedView"),i=e("../Controller/GameSignal"),a=cc._decorator,r=a.ccclass,l=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onLoad=function(){i.ChacknScoreChangedSignal.inst.addListenerOne(this.onNumberChanged,this)},t.prototype.start=function(){},t.prototype.onDestroy=function(){i.ChacknCountChangedSignal.inst.removeTarget(this)},t=__decorate([r],t)}(n.default));o.default=l,cc._RF.pop()},{"../Controller/GameSignal":"GameSignal","../Utils/NumberChangedView":"NumberChangedView"}],Const:[function(e,t,o){"use strict";var n,i,a;cc._RF.push(t,"f7b813ZcfJE5JVv1NvPFZPC","Const"),Object.defineProperty(o,"__esModule",{value:!0}),o.BubbleColor={0:"blank",1:"bg_popblue",2:"bg_popgreen",3:"bg_poporange",4:"bg_poppurple",5:"bg_popred",6:"bg_popyellow"},o.BubbleLightColor={0:"blank",1:"bg_popbluelight",2:"bg_popgreenlight",3:"bg_poporangelight",4:"bg_poppurplelight",5:"bg_popredlight",6:"bg_popyellowlight"},o.BoomBubbleLightColor={0:"blank",1:"bomb_bluelight",2:"bomb_greenlight",3:"bomb_orangelight",4:"bomb_purplelight",5:"bomb_redlight",6:"bomb_yellowlight"},o.BoomBubbleColor={0:"blank",1:"bomb_blue",2:"bomb_green",3:"bomb_orange",4:"bomb_purple",5:"bomb_red",6:"bomb_yellow"},o.HorseBubble="horse",o.HorseBubbleLight="horselight",o.MagicBubble="rainbow",o.MagicBubbleLight="rainbowlight",o.BubbleX2={0:"bg_X2blue",1:"bg_X2blue",2:"bg_X2blue",3:"bg_X2green",4:"bg_X2",5:"bg_X2pink",6:"bg_X2red",7:"bg_X2yellow",8:"bg_X2grey",9:"bg_X2grey",10:"bg_X2grey",11:"bg_X2grey"},function(e){e[e.Blank=0]="Blank",e[e.Blue=1]="Blue",e[e.DarkBlue=2]="DarkBlue",e[e.Green=3]="Green",e[e.Orange=4]="Orange",e[e.Purple=5]="Purple",e[e.Red=6]="Red",e[e.Yellow=7]="Yellow",e[e.White=8]="White",e[e.Boom=9]="Boom",e[e.Horce=10]="Horce",e[e.Bird=11]="Bird",e[e.Treasure_1=200]="Treasure_1",e[e.Treasure_2=400]="Treasure_2",e[e.Treasure_3=600]="Treasure_3",e[e.Treasure_4=800]="Treasure_4",e[e.Treasure_5=1e3]="Treasure_5",e[e.Streak=1001]="Streak",e[e.Rebounce=1002]="Rebounce"}(n=o.BubbleType||(o.BubbleType={})),o.BubbleColors=[n.Red,n.Purple,n.Green,n.Blue,n.White,n.Boom],function(e){e[e.Normal=0]="Normal",e[e.Double=1]="Double",e[e.Boom=2]="Boom",e[e.Magic=3]="Magic",e[e.Horce=4]="Horce"}(o.SpecialType||(o.SpecialType={})),o.SpecialIndex={47:null,48:null,49:null},o.ChangeColorExcept=[n.Bird,n.Blank],o.BubbleHeightOffset=-15,o.BubbleYOffset=1205,o.BubbleXOffset=-3,o.BubbleStartX=20,o.InitColNumber=9,o.InitStartIndex=44,o.BubbleSize=cc.size(83*1.1,83*1.1),o.BubbleQueRange={Min:4,Max:7},o.ClearTargetRange={Min:2,Max:4},o.GameTime=180,o.TargetRandomLimit=120,o.DefaultTaskCount=9,o.DoubleBubbleInitRange={Min:3,Max:5},o.DoubleBubbleRange={Min:1,Max:2},o.BoomBubbleRange={Min:1,Max:2},o.MagicBubbleRange={Min:0,Max:1},o.BoomBubbleInitRange={Min:3,Max:5},o.MagicBubbleInitRange={Min:0,Max:3},o.ClearCountLimit=1,o.ShooterDoubleRange={Min:6,Max:10},o.ShooterDoubleBubbleRange={Min:0,Max:1},o.ShooterBoomRange={Min:6,Max:10},o.ShooterBoomBubbleRange={Min:0,Max:1},o.ShooterMagicRange={Min:4,Max:6},o.ShooterMagicBubbleRange={Min:0,Max:1},o.TaskStreakAward=2,function(e){e[e.Spring=0]="Spring",e[e.Summer=1]="Summer",e[e.Autumn=2]="Autumn",e[e.Winter=3]="Winter"}(i=o.Season||(o.Season={})),o.SeasonPool=[i.Spring,i.Summer,i.Autumn,i.Winter],function(e){e[e.Level_200=200]="Level_200",e[e.Level_400=400]="Level_400",e[e.Level_600=600]="Level_600",e[e.Level_800=800]="Level_800",e[e.Level_1000=1e3]="Level_1000"}(a=o.TreasureType||(o.TreasureType={})),o.TreasurePool=[a.Level_200,a.Level_400,a.Level_600,a.Level_800,a.Level_1000],o.Treasure_Top={0:{200:"bg_sfinish200",400:"bg_sfinish400",600:"bg_sfinish600",800:"bg_sfinish800",1e3:"bg_sfinish1000"},1:{200:"bg_smfinish200",400:"bg_smfinish400",600:"bg_smfinish600",800:"bg_smfinish800",1e3:"bg_smfinish1000"},2:{200:"bg_afinish200",400:"bg_afinish400",600:"bg_afinish600",800:"bg_afinish800",1e3:"bg_afinish1000"},3:{200:"bg_wfinish200",400:"bg_wfinish400",600:"bg_wfinish600",800:"bg_wfinish800",1e3:"bg_wfinish1000"}},function(e){e[e.OUT_OF_MOVE=0]="OUT_OF_MOVE",e[e.TIME_UP=1]="TIME_UP"}(o.OverType||(o.OverType={})),o.FireBar={Start:8,End:87},cc._RF.pop()},{}],EventManager:[function(e,t,o){"use strict";cc._RF.push(t,"1be43vsI5VEx6cptNa56Bfq","EventManager"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){this.eventTarget=new cc.EventTarget}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.emit=function(e,t,o,n,i,a){this.eventTarget.emit(e.toString(),t,o,n,i,a)},e.prototype.on=function(e,t,o,n){return this.eventTarget.on(e.toString(),t,o,n)},e.prototype.once=function(e,t,o){this.eventTarget.once(e.toString(),t,o)},e.prototype.dispatchEvent=function(e){this.eventTarget.dispatchEvent(e)},e.prototype.off=function(e,t,o){this.eventTarget.off(e.toString(),t,o)},e.prototype.hasEventListener=function(e){return this.eventTarget.hasEventListener(e.toString())},e.prototype.targetOff=function(e){this.eventTarget.targetOff(e)},e}();o.gEventMgr=n.inst,cc._RF.pop()},{}],EventName:[function(e,t,o){"use strict";cc._RF.push(t,"017c8l+T9FHF5CNitqArJpl","EventName"),Object.defineProperty(o,"__esModule",{value:!0}),function(e){e[e.BUBBLE_SCALE_TEST=0]="BUBBLE_SCALE_TEST",e[e.SMALL_BGM=1]="SMALL_BGM",e[e.NORMAL_BGM=2]="NORMAL_BGM",e[e.SHOOT=3]="SHOOT",e[e.BUBBLE_FORCE=4]="BUBBLE_FORCE",e[e.ADD_BUBBLE=5]="ADD_BUBBLE",e[e.ADD_SCORE=6]="ADD_SCORE",e[e.GAME_OVER=7]="GAME_OVER",e[e.UPDATE_TASK=8]="UPDATE_TASK",e[e.NEXT_BUBBLE=9]="NEXT_BUBBLE",e[e.PLAY_EFFECT=10]="PLAY_EFFECT",e[e.HORCE_CLEAR=11]="HORCE_CLEAR",e[e.GET_TREASURE=12]="GET_TREASURE",e[e.CHECK_TREASURE=13]="CHECK_TREASURE",e[e.CHANGE_BGM=14]="CHANGE_BGM",e[e.SHOW_STREAK=15]="SHOW_STREAK",e[e.SHOW_REBOUNCE=16]="SHOW_REBOUNCE",e[e.UPDATE_INDEX=17]="UPDATE_INDEX",e[e.UPDATE_POINTER_ROTATION=18]="UPDATE_POINTER_ROTATION",e[e.ON_POINTER_ROTATED=19]="ON_POINTER_ROTATED",e[e.IS_GREEN_IDLE=20]="IS_GREEN_IDLE",e[e.GET_CHANGE_BUTTON=21]="GET_CHANGE_BUTTON",e[e.PLAY_LOAD=22]="PLAY_LOAD",e[e.BUBBLE_LOAD=23]="BUBBLE_LOAD",e[e.OPEN_PAUSE=24]="OPEN_PAUSE",e[e.READY_GO=25]="READY_GO",e[e.SHOW_START=26]="SHOW_START",e[e.Hide_Load=27]="Hide_Load",e[e.AFTER_SHOOT=28]="AFTER_SHOOT",e[e.ON_HIDE=29]="ON_HIDE",e[e.ON_SHOW=30]="ON_SHOW"}(o.GlobalEvent||(o.GlobalEvent={})),cc._RF.pop()},{}],FrameAniBase:[function(e,t,o){"use strict";cc._RF.push(t,"b2d80rjoMtDXKhceGVjLXGq","FrameAniBase"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,i=n.ccclass,a=n.property,r=n.executeInEditMode,l=n.requireComponent,c=n.playOnFocus,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.Frames=null,t.Interval=.1,t.Priority=0,t.Loop=!1,t.PlayOnLoad=!1,t.currentIndex=0,t.time=0,t.isPlay=!1,t.listener=[],t.complateEvent=[],t}var o;return __extends(t,e),o=t,Object.defineProperty(t.prototype,"Sprite",{get:function(){return this.node.getComponent(cc.Sprite)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Animation",{set:function(e){this.Frames=e},enumerable:!0,configurable:!0}),t.prototype.onFocusInEditor=function(){this.time=this.Interval,o.intervalID=setInterval(this.update.bind(this),.016,.016)},t.prototype.onLostFocusInEditor=function(){clearInterval(o.intervalID)},t.prototype.onLoad=function(){this.time=this.Interval,this.isPlay=this.PlayOnLoad},t.prototype.play=function(){this.isPlay=!0,this.currentIndex=0,0==this.isPlaying&&this.callEventComplete()},t.prototype.playOnLoop=function(){this.Loop=!0,this.play()},t.prototype.playByStep=function(){this.isPlay=!0,this.nextFrame(),this.isPlay=!1},t.prototype.pause=function(){this.isPlay=!1},t.prototype.resume=function(){this.isPlay=!0},t.prototype.stop=function(){this.isPlay=!1,this.currentIndex=0,this.Loop=!1},t.prototype.onKeyFrame=function(e){},t.prototype.addKeyEventListener=function(e,t){this.listener.push({callback:e,target:t})},Object.defineProperty(t.prototype,"ListenerCount",{get:function(){return this.listener.length},enumerable:!0,configurable:!0}),t.prototype.clearAllListener=function(){return this.listener.length=0,this},t.prototype.onComplete=function(){},t.prototype.callEventFrame=function(){this.onKeyFrame(this.currentIndex);for(var e=0,t=this.listener;e<t.length;e++){var o=t[e];o.callback.apply(o.target,[this.currentIndex,this.__classname__])}},t.prototype.callEventComplete=function(){this.onComplete();for(var e=0,t=this.complateEvent;e<t.length;e++){var o=t[e];o.f.apply(o.target,[this.__classname__])}},t.prototype.addCompleteEvent=function(e,t){this.complateEvent.push({f:e,target:t})},Object.defineProperty(t.prototype,"TotalFrameCount",{get:function(){return this.Frames&&this.Frames.getSpriteFrames?this.Frames.getSpriteFrames().length:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CompleteEventCount",{get:function(){return this.complateEvent.length},enumerable:!0,configurable:!0}),t.prototype.clearCompleteEvent=function(){return this.complateEvent.length=0,this},t.prototype.start=function(){},Object.defineProperty(t.prototype,"isPlaying",{get:function(){if(this.isPlay&&this.Frames&&this.Frames.getSpriteFrames&&this.Frames.getSpriteFrames().length>0){for(var e=0,t=this.getComponents(o);e<t.length;e++){var n=t[e];if(n.Priority>this.Priority&&n.isPlaying)return!1}return!0}return!1},enumerable:!0,configurable:!0}),t.prototype.nextFrame=function(){0!=this.isPlaying?this.Frames&&this.Frames.getSpriteFrames&&this.Frames.getSpriteFrames().length>0&&(this.Sprite.spriteFrame=this.Frames.getSpriteFrames()[this.currentIndex],this.callEventFrame(),this.currentIndex=(this.currentIndex+1)%this.Frames.getSpriteFrames().length,0==this.currentIndex&&0==this.Loop&&(this.isPlay=!1,this.callEventComplete())):this.time=this.Interval},t.prototype.update=function(e){this.time>=this.Interval&&(this.time=0,this.nextFrame()),this.time+=e},t.aniName="FrameAniBase",t.intervalID=-1,__decorate([a(cc.SpriteAtlas)],t.prototype,"Frames",void 0),__decorate([a],t.prototype,"Interval",void 0),__decorate([a],t.prototype,"Priority",void 0),__decorate([a],t.prototype,"Loop",void 0),__decorate([a],t.prototype,"PlayOnLoad",void 0),t=o=__decorate([i,r,c,l(cc.Sprite)],t)}(cc.Component);o.default=s,cc._RF.pop()},{}],GameFactory:[function(e,t,o){"use strict";cc._RF.push(t,"949976qNuFDsoz+OUdWWlhf","GameFactory"),Object.defineProperty(o,"__esModule",{value:!0});var n,i=e("../Utils/HashMap"),a=function(){function e(e,t,o){this._pool=[],this.poolHandlerComps=[],this.poolHandlerComps=o,this.template=e,this.initPool(t)}return e.prototype.initPool=function(e){for(var t=this,o=0;o<e;++o)if(e>1)setTimeout(function(){var e=cc.instantiate(t.template);t.put(e)});else{var n=cc.instantiate(this.template);this.put(n)}},e.prototype.size=function(){return this._pool.length},e.prototype.clear=function(){for(var e=this._pool.length,t=0;t<e;++t)this._pool[t].destroy&&this._pool[t].destroy();this._pool.length=0},e.prototype.put=function(e){if(e&&-1===this._pool.indexOf(e)){if(e.removeFromParent(!1),this.poolHandlerComps)for(var t=0,o=this.poolHandlerComps;t<o.length;t++){var n=o[t],i=e.getComponent(n);i&&i.unuse&&i.unuse.apply(i)}else for(var a=0,r=e.getComponents(cc.Component);a<r.length;a++){(n=r[a])&&n.unuse&&n.unuse.apply(n)}this._pool.push(e)}},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=this._pool.length-1;o<0&&this.initPool(1),o=this._pool.length-1;var n=this._pool[o];if(this._pool.length=o,this.poolHandlerComps)for(var i=0,a=this.poolHandlerComps;i<a.length;i++){var r=a[i],l=n.getComponent(r);l&&l.reuse&&l.reuse.apply(l,arguments)}else for(var c=0,s=n.getComponents(cc.Component);c<s.length;c++){(r=s[c])&&r.reuse&&r.reuse.apply(r,arguments)}return n},e}();(function(e){e[e.INIT=0]="INIT",e[e.Bubble=4]="Bubble",e[e.Point=8]="Point",e[e.Task=16]="Task",e[e.Score=32]="Score",e[e.Font=64]="Font",e[e.Bird=128]="Bird",e[e.DONE=252]="DONE"})(n||(n={}));var r=function(){function e(){this.step=n.INIT,this.BubblePool=new i.HashMap,this.PointPool=new i.HashMap,this.TaskPool=new i.HashMap,this.ScorePool=new i.HashMap,this.FontPool=new i.HashMap,this.BirdPool=new i.HashMap}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.init=function(e,t,o,n,i,a,r){this.doneCallback=e,this.initBubble(132,t),this.initPoint(20,o),this.initTask(8,n),this.initScore(10,i),this.initFont(5,a),this.initBird(5,r)},e.prototype.nextStep=function(e){this.step|=e,this.step>=n.DONE&&this.doneCallback&&this.doneCallback()},e.prototype.initBubble=function(e,t){var o=this;t?(o.BubblePool.add("Bubble",new a(t,e)),o.nextStep(n.Bubble)):cc.loader.loadRes("prefabs/Bubble",cc.Prefab,function(t,i){t?console.error(t):(o.BubblePool.add("Bubble",new a(i,e)),o.nextStep(n.Bubble))})},e.prototype.getBubble=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return(e=this.BubblePool.get("Bubble")).get.apply(e,t)},e.prototype.putBubble=function(e){this.BubblePool.get("Bubble").put(e)},e.prototype.initPoint=function(e,t){var o=this;t?(o.PointPool.add("Point",new a(t,e)),o.nextStep(n.Point)):cc.loader.loadRes("prefabs/Point",cc.Prefab,function(t,i){t?console.error(t):(o.PointPool.add("Point",new a(i,e)),o.nextStep(n.Point))})},e.prototype.getPoint=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return(e=this.PointPool.get("Point")).get.apply(e,t)},e.prototype.putPoint=function(e){this.PointPool.get("Point").put(e)},e.prototype.initTask=function(e,t){var o=this;t?(o.TaskPool.add("Task",new a(t,e)),o.nextStep(n.Task)):cc.loader.loadRes("prefabs/Mission",cc.Prefab,function(t,i){t?console.error(t):(o.TaskPool.add("Task",new a(i,e)),o.nextStep(n.Task))})},e.prototype.getTask=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return(e=this.TaskPool.get("Task")).get.apply(e,t)},e.prototype.putTask=function(e){this.TaskPool.get("Task").put(e)},e.prototype.initScore=function(e,t){var o=this;t?(o.ScorePool.add("Score",new a(t,e)),o.nextStep(n.Score)):cc.loader.loadRes("prefabs/ScoreFloat",cc.Prefab,function(t,i){t?console.error(t):(o.ScorePool.add("Score",new a(i,e)),o.nextStep(n.Score))})},e.prototype.getScore=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return(e=this.ScorePool.get("Score")).get.apply(e,t)},e.prototype.putScore=function(e){this.ScorePool.get("Score").put(e)},e.prototype.initFont=function(e,t){var o=this;t?(o.FontPool.add("Font",new a(t,e)),o.nextStep(n.Font)):cc.loader.loadRes("prefabs/Font",cc.Prefab,function(t,i){t?console.error(t):(o.FontPool.add("Font",new a(i,e)),o.nextStep(n.Font))})},e.prototype.getFont=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return(e=this.FontPool.get("Font")).get.apply(e,t)},e.prototype.putFont=function(e){this.FontPool.get("Font").put(e)},e.prototype.initBird=function(e,t){var o=this;t?(o.BirdPool.add("Bird",new a(t,e)),o.nextStep(n.Bird)):cc.loader.loadRes("prefabs/Bird",cc.Prefab,function(t,i){t?console.error(t):(o.BirdPool.add("Bird",new a(i,e)),o.nextStep(n.Bird))})},e.prototype.getBird=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return(e=this.BirdPool.get("Bird")).get.apply(e,t)},e.prototype.putBird=function(e){this.BirdPool.get("Bird").put(e)},e}();o.gFactory=r.inst,cc._RF.pop()},{"../Utils/HashMap":"HashMap"}],GameScene:[function(e,t,o){"use strict";cc._RF.push(t,"63c91B5GQpJwrTOBvKO60W6","GameScene"),Object.defineProperty(o,"__esModule",{value:!0});var n,i=e("./Controller/GameFactory"),a=e("./Controller/Game"),r=e("./Const"),l=e("./Data/BubbleMatrix"),c=e("./Bubble"),s=e("./Controller/EventManager"),u=e("./Controller/StepController"),h=e("./Controller/AudioController"),p=e("./Controller/EventName"),d=e("./Guide"),b=e("./ResultLayer"),g=e("./BubbleMove"),f=e("./Utils/LogHandler"),m=e("./FrameAniBase"),y=e("./BubbleAnimation/BubbleHorce");(function(e){e.Prefab="Prefab",e.Audio="Audio"})(n||(n={}));var v=cc._decorator,_=v.ccclass,C=v.property,S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.BubblePrefab=null,t.PointPrefab=null,t.TaskPrefab=null,t.BirdPrefab=null,t.AddScorePrefab=null,t.BubbleAtlas=[],t.BubbleChange=null,t.X2=null,t.BubbleBurst=[],t.BubbleHorce=null,t.BubbleDrop=null,t.SpringBack=null,t.SummerBack=null,t.AutumnBack=null,t.WinterBack=null,t.SpringMask=null,t.SummerMask=null,t.AutumnMask=null,t.WinterMask=null,t.MaskMachine=null,t.NowStreak=null,t.FireBar=null,t.Guide=null,t.Background=null,t.FontAtlas=null,t.TimeFont=null,t.FontPrefab=null,t.FontRoot=null,t.TreasureRoot=null,t.BigTreasure=null,t.SmallTreasure=null,t.ResultTitle=null,t.ResultFont=null,t.BubbleLayer=null,t.Shooter=null,t.TopNode=null,t.BulletArray=null,t.TaskArray=null,t.ShooterLayer=null,t.TimeLabel=null,t.TimeLabel2=null,t.ScoreLabel=null,t.ChangeShooter=null,t.ReadyShooter=null,t.ChangeCube=null,t.ChangeButton=null,t.PauseButton=null,t.TreasureBar=null,t.BirdRoot=null,t.showScore=0,t.score=0,t.addScoreStep=0,t.psitonOffset=-50,t.TreasureProgress=[0,0,.3,.5,.8,1],t}return __extends(t,e),t.prototype.onLoad=function(){this.BirdRoot.active=!0,this.PauseButton.node.active=!0,this.ChangeCube.active=!1,this.ChangeButton.node.active=!1,this.ChangeButton.interactable=!1,this.ShooterLayer.active=!1,CELER_X&&f.LogHandler.inst.initLog(celerSDK.log),f.LogHandler.inst.log(" game scene on load:",window.location?window.location.href:"null location"),cc.debug.setDisplayStats(!1),this.ResultFont.node.scale=0,a.Game.FontRoot=this.FontRoot,a.Game.BubbleLayer=this.BubbleLayer,a.Game.TopNode=this.TopNode;var e=this;CELER_X&&celerSDK.onStart(function(){e.celerOnStart()}.bind(this)),CELER_X&&celerSDK.provideScore(function(){return parseInt(a.Game.getScore().toString())}),u.gStep.register(this.celerReady.bind(this),[n.Audio,n.Prefab]),i.gFactory.init(function(){u.gStep.nextStep(n.Prefab)},this.BubblePrefab,this.PointPrefab,this.TaskPrefab,this.AddScorePrefab,this.FontPrefab,this.BirdPrefab),h.gAudio.init(function(){u.gStep.nextStep(n.Audio)}),this.initEvent(),this.TimeLabel.node.getParent().getChildByName("noTime").opacity=0},t.prototype.celerReady=function(){f.LogHandler.inst.log(" call celerx.ready:",CELER_X),CELER_X&&celerSDK.ready(),CELER_X||this.celerOnStart()},t.prototype.celerOnStart=function(){var e=CELER_X?celerSDK.getMatch():{matchId:"",sharedRandomSeed:Math.random(),difficultyLevel:1,shouldLaunchTutorial:!0};a.Game.MatchInfo=e,e&&e.sharedRandomSeed?(CMath.randomSeed=e.sharedRandomSeed,CMath.sharedSeed=e.sharedRandomSeed,console.log(" match id:",e.matchId)):(console.error(" match sharedRandomSeed null!"),CMath.randomSeed=.6554873874384882),f.LogHandler.inst.log(" celer on start:",a.Game.MatchInfo),a.Game.prepare(),a.Game.start(),this.updateSeason(),this.show(),this.ShooterLayer.active=!0,e&&e.shouldLaunchTutorial?(this.Guide.show(function(){s.gEventMgr.emit(p.GlobalEvent.READY_GO)}),s.gEventMgr.emit(p.GlobalEvent.SHOW_START,!1)):(this.Guide.hide(),s.gEventMgr.emit(p.GlobalEvent.SHOW_START,!0)),setTimeout(function(){cc.loader.loadRes("prefabs/Spring/ResultLayer")},1e4),CELER_X?s.gEventMgr.emit(p.GlobalEvent.Hide_Load,3):s.gEventMgr.emit(p.GlobalEvent.Hide_Load)},t.prototype.updateTreasure=function(){console.log(" start load treasure");for(var e=[r.TreasureType.Level_1000,r.TreasureType.Level_800],t=function(t){var o=Math.floor(CMath.getRandom(0,e.length)),n=e[o];cc.loader.loadRes("prefabs/"+r.Season[a.Game.Season]+"/"+n,cc.Prefab,function(e,o){if(e)console.error(" load treasure err:",e);else{var n=cc.instantiate(o);t.addChild(n)}}),e.splice(o,1)},o=0,n=this.BigTreasure.children;o<n.length;o++){t(n[o])}for(var i=[r.TreasureType.Level_200,r.TreasureType.Level_400,r.TreasureType.Level_600],l=function(e){var t=Math.floor(CMath.getRandom(0,i.length)),o=i[t];cc.loader.loadRes("prefabs/"+r.Season[a.Game.Season]+"/"+o,cc.Prefab,function(t,o){if(t)console.error(" load treasure err:",t);else{var n=cc.instantiate(o);e.addChild(n)}}),i.splice(t,1)},c=0,s=this.SmallTreasure.children;c<s.length;c++){l(s[c])}},t.prototype.updateSeason=function(){switch(a.Game.Season){case r.Season.Spring:console.log(" set Spring bg"),this.Background.spriteFrame=this.SpringBack,this.MaskMachine.spriteFrame=this.SpringMask;break;case r.Season.Summer:console.log(" set Summer bg"),this.Background.spriteFrame=this.SummerBack,this.MaskMachine.spriteFrame=this.SummerMask;break;case r.Season.Autumn:this.Background.spriteFrame=this.AutumnBack,this.MaskMachine.spriteFrame=this.AutumnMask;break;case r.Season.Winter:this.Background.spriteFrame=this.WinterBack,this.MaskMachine.spriteFrame=this.WinterMask}},t.prototype.updateIndex=function(){s.gEventMgr.emit(p.GlobalEvent.UPDATE_INDEX)},t.prototype.initEvent=function(){var e=this;s.gEventMgr.targetOff(this),this.BulletArray.on(cc.Node.EventType.CHILD_REMOVED,this.onBubbleQueRemoveChild,this),this.Shooter.on(cc.Node.EventType.CHILD_REMOVED,this.onShooterRemoveChild,this),s.gEventMgr.on(p.GlobalEvent.GET_CHANGE_BUTTON,function(){e.ChangeButton.node.active=!0,e.ChangeCube.active=!0,e.ChangeCube.getChildByName("ani").runAction(cc.fadeIn(0)),e.ChangeCube.getChildByName("ani").getComponent(m.default).onComplete=function(){e.ChangeCube.getChildByName("ani").runAction(cc.fadeOut(.1))},e.ChangeCube.getComponentInChildren(m.default).play();var t=e.ChangeCube.getChildByName("Cube");if(t){var o=t.scale;t.runAction(cc.sequence(cc.spawn(cc.scaleTo(.1,2*o),cc.fadeTo(.1,150)),cc.delayTime(.2),cc.spawn(cc.sequence(cc.scaleTo(.1,1.2*o),cc.scaleTo(.1,1.6*o),cc.scaleTo(.1,1*o)),cc.fadeIn(.15)),cc.delayTime(.15),cc.fadeOut(.15)))}var n=e.ChangeCube.getChildByName("CubeAni");n&&(n.runAction(cc.fadeIn(0)),n.getComponent(m.default).onComplete=function(){n.runAction(cc.fadeOut(.1))},n.getComponent(m.default).play())},this),this.ChangeButton.node.on(cc.Node.EventType.TOUCH_END,function(){if(0!=e.ChangeButton.interactable){s.gEventMgr.emit(p.GlobalEvent.PLAY_EFFECT,"selectionChange");var t=e.Shooter.children[0],o=e.ReadyShooter.children[0];t.setPosition(CMath.ConvertToNodeSpaceAR(t,e.ReadyShooter)),t.setParent(e.ReadyShooter),t.getComponent(g.default).unreadyToShoot(),t.runAction(cc.sequence(cc.moveTo(.15,-15,88),cc.moveTo(.1,0,0))),o.setPosition(CMath.ConvertToNodeSpaceAR(o,e.Shooter)),o.setParent(e.Shooter),o.runAction(cc.sequence(cc.fadeTo(0,255),cc.scaleTo(.1,1.2,1.4),cc.scaleTo(0,1,1.4),cc.spawn(cc.scaleTo(.1,.8,1.6),cc.moveBy(.1,0,e.psitonOffset).easing(cc.easeIn(.1))),cc.moveTo(0,0,0),cc.scaleTo(0,0,0),cc.scaleTo(.1,1,1),cc.callFunc(function(){o.getComponent(g.default).readyToShoot()})))}},this),this.PauseButton.node.on(cc.Node.EventType.TOUCH_END,function(){s.gEventMgr.emit(p.GlobalEvent.PLAY_EFFECT,"button_click"),s.gEventMgr.emit(p.GlobalEvent.OPEN_PAUSE)},this),s.gEventMgr.on(p.GlobalEvent.GET_TREASURE,function(t,o){var n=i.gFactory.getBird(500,CMath.ConvertToNodeSpaceAR(o,e.BirdRoot));e.BirdRoot.addChild(n)},this),s.gEventMgr.on(p.GlobalEvent.SHOW_REBOUNCE,function(t){var o=i.gFactory.getFont();o.getComponent(cc.Sprite).spriteFrame=e.FontAtlas.getSpriteFrame("f_rebound"),o.scale=0,o.opacity=255,e.TopNode.addChild(o),o.x=0;o.setPosition(t),o.group="effect",s.gEventMgr.emit(p.GlobalEvent.PLAY_EFFECT,"font"),o.runAction(cc.sequence(cc.scaleTo(.1,1),cc.callFunc(function(){a.Game.addScore(r.BubbleType.Rebounce,50,2,cc.v2(o.x+o.width/2,o.y),!1)},e),cc.delayTime(.6),cc.spawn(cc.scaleTo(.2,1),cc.fadeTo(.2,0)),cc.callFunc(function(){i.gFactory.putFont(o)},e)))},this),s.gEventMgr.on(p.GlobalEvent.SHOW_STREAK,function(t,o){if(t){var n=null;switch(o){case 2:n=e.FontAtlas.getSpriteFrame("f_streak");break;case 3:n=e.FontAtlas.getSpriteFrame("f_sstreak");break;case 4:n=e.FontAtlas.getSpriteFrame("f_great");break;case 5:n=e.FontAtlas.getSpriteFrame("f_amazing");break;default:n=e.FontAtlas.getSpriteFrame("f_awesome")}var l=i.gFactory.getFont();l.getComponent(cc.Sprite).spriteFrame=n,l.scale=0,l.opacity=255,e.FontRoot.addChild(l),l.x=0;var c=1+.07*o;l.y=e.FontRoot.childrenCount*(150*c),s.gEventMgr.emit(p.GlobalEvent.PLAY_EFFECT,"font"),l.runAction(cc.sequence(cc.scaleTo(.1,c),cc.delayTime(.3),cc.callFunc(function(){if(t){a.Game.addScore(r.BubbleType.Streak,25+15*(o-2),.3*(o-2)+2,CMath.ConvertToNodeSpaceAR(l,e.TopNode).add(cc.v2(l.width/2,l.height/2)))}},e),cc.spawn(cc.scaleTo(.2,1),cc.fadeTo(.2,0)),cc.callFunc(function(){i.gFactory.putFont(l)},e)))}},this),s.gEventMgr.on(p.GlobalEvent.ADD_BUBBLE,this.addNextBubble,this),s.gEventMgr.on(p.GlobalEvent.UPDATE_TASK,this.updateTask,this),s.gEventMgr.on(p.GlobalEvent.NEXT_BUBBLE,this.getShooterBubble,this),s.gEventMgr.on(p.GlobalEvent.ADD_SCORE,this.addScore,this),s.gEventMgr.once(p.GlobalEvent.GAME_OVER,function(t){a.Game.isStart=!1,t==r.OverType.OUT_OF_MOVE?e.ResultFont.spriteFrame=e.ResultTitle.getSpriteFrame("bg_font_gameover"):e.ResultFont.spriteFrame=e.ResultTitle.getSpriteFrame("bg_font_timeup"),e.ResultFont.node.runAction(cc.sequence(cc.scaleTo(.1,1.5),cc.delayTime(.5),cc.scaleTo(.1,1.2),cc.callFunc(function(){cc.loader.loadRes("prefabs/Spring/ResultLayer",cc.Prefab,function(o,n){var i;o?(cc.error("load result :",o),console.error(" submit score by open result err:",a.Game.MatchInfo.matchId,", seed:",a.Game.MatchInfo.sharedRandomSeed),CELER_X&&celerSDK.submitScore(a.Game.getScore())):(i=t==r.OverType.OUT_OF_MOVE?e.ResultTitle.getSpriteFrame("bg_result_font2"):e.ResultTitle.getSpriteFrame("bg_result_font1"),setTimeout(function(){var t=cc.instantiate(n);t.getComponent(b.default).setTexture(i),e.node.addChild(t)},0))})},e)))},this)},t.prototype.updateTask=function(){for(var e=a.Game.getCurTarget(),t=0;t<Math.min(e.now,this.TaskArray.childrenCount);t++){var o=this.TaskArray.children[t],n=o.getChildByName("Complete");0==o.scale||n.scale>.5||n.runAction(cc.sequence(cc.scaleTo(.1,1.5),cc.scaleTo(.1,1)))}},t.prototype.addNextBubble=function(e){for(void 0===e&&(e=1);e--;)this.nextBubble()},t.prototype.show=function(){console.log(" game show !!!");var e=2+r.InitColNumber,t=l.IndexJStart,o=l.IndexJEnd;this.addBubble(2,e,t,o),this.getNewTask(r.DefaultTaskCount)},t.prototype.nextBubble=function(){a.Game.addMoveTimes();var e=a.Game.getMatrix();e.moveRow(1),this.BubbleLayer.height+=r.BubbleSize.height+r.BubbleHeightOffset,this.BubbleLayer.runAction(cc.sequence(cc.moveBy(.2,0,-(r.BubbleSize.height+r.BubbleHeightOffset)),cc.callFunc(function(){a.Game.checkOutOfMove(),s.gEventMgr.emit(p.GlobalEvent.CHECK_TREASURE)},this))),this.addBubble(e.index2i(a.Game.startIndex)-1,e.index2i(a.Game.startIndex)-1,l.IndexJStart,l.IndexJEnd,1);for(var t=a.Game.startIndex;t<=a.Game.startIndex+l.UseSize-1;t++){if(!e.data[t]||!e.data[t].bubble)return;e.data[t].bubble.updateActive(t/700+(t-a.Game.startIndex)/50)}},t.prototype.addBubble=function(e,t,o,n,i){void 0===i&&(i=0),console.log(" add bubble , istart:",e,", iend:",t,",jstart:",o,", jend:",n);for(var r=a.Game.getMatrix(),l=e;l<=t;l++)for(var s=o;s<=n;s++){var u=r.ij2index(l,s),h=a.Game.getBubble(r.data[u].type,u,r.data[u].color,this.BubbleAtlas,this.BubbleChange,this.BubbleBurst,this.BubbleHorce,this.BubbleDrop,this.X2);h||console.error(" bubble is null");var p=r.getPosOfij(l,s);h.x=p.x,h.y=p.y,this.BubbleLayer.addChild(h),r.data[u].bubble=h.getComponent(c.default),h.getComponent(c.default).updateActive(u/700+(u-a.Game.startIndex)/50*i)}a.Game.updateCollisionIndexes()},t.prototype.onShooterRemoveChild=function(){},t.prototype.newBubbleArray=function(e){var t=a.Game.getCurTarget();t.now<t.target&&this.addNextBubble(1),this.getNewTask(e)},t.prototype.getShooterBubble=function(e){var t=this;if(this.BulletArray.childrenCount<=0&&this.ReadyShooter.childrenCount<=0){if(!this.ChangeCube.active)return void this.newBubbleArray(e);if(this.ChangeShooter.childrenCount<=0)return console.log(" \u4e09\u4e2a\u4f4d\u7f6e\u90fd\u6ca1\u6ce1\u6ce1"),void this.newBubbleArray(e)}if(this.Shooter.childrenCount>0&&console.error(" shooter has bubble! getShooterBubble--"),this.ReadyShooter.childrenCount<=0)if(console.warn(" ready \u6ca1\u6709\u6ce1\u6ce1"),this.ChangeCube.active){if(this.ChangeShooter.childrenCount<=0){if(this.BulletArray.childrenCount<=0)return console.error(" bullet array is 0, cube is active"),void this.newBubbleArray(e);var o=this.BulletArray.children[0];o.setPosition(CMath.ConvertToNodeSpaceAR(o,this.ChangeShooter)),o.setParent(this.ChangeShooter),o.runAction(cc.sequence(cc.moveBy(.1,0,-200),cc.scaleTo(0,0),cc.moveTo(0,0),cc.scaleTo(.1,1),cc.callFunc(function(){if(o.setPosition(CMath.ConvertToNodeSpaceAR(o,t.ReadyShooter)),o.setParent(t.ReadyShooter),o.runAction(cc.sequence(cc.moveTo(.2,0,0),cc.callFunc(function(){t.putNextShooterBubble()}))),t.BulletArray.childrenCount>0){var e=t.BulletArray.children[0];e.setPosition(CMath.ConvertToNodeSpaceAR(e,t.ChangeShooter)),e.setParent(t.ChangeShooter),e.runAction(cc.sequence(cc.moveBy(.1,0,-200),cc.scaleTo(0,0),cc.moveTo(0,0),cc.scaleTo(.1,1)))}else console.log(" bullet array has no bubble 741")})))}}else{if(this.BulletArray.childrenCount<=0)return console.error(" bullet array is 0"),void this.newBubbleArray(e);var n=this.BulletArray.children[0];n.setPosition(CMath.ConvertToNodeSpaceAR(n,this.ReadyShooter)),n.setParent(this.ReadyShooter),s.gEventMgr.emit(p.GlobalEvent.PLAY_LOAD),n.scale=this.BulletArray.scale,n.runAction(cc.sequence(cc.scaleTo(0,0),cc.moveTo(0,0,0))),s.gEventMgr.once(p.GlobalEvent.BUBBLE_LOAD,function(){n.runAction(cc.scaleTo(.1,1))},this)}else this.putNextShooterBubble()},t.prototype.putNextShooterBubble=function(){var e=this.ReadyShooter.children[0];if(e.setPosition(CMath.ConvertToNodeSpaceAR(e,this.Shooter)),e.setParent(this.Shooter),e.scale=1,e.runAction(cc.sequence(cc.fadeTo(0,255),cc.scaleTo(.1,1.2,1.4),cc.scaleTo(0,1,1.4),cc.spawn(cc.scaleTo(.1,.8,1.6),cc.moveBy(.1,0,this.psitonOffset).easing(cc.easeIn(.1))),cc.moveTo(0,0,0),cc.scaleTo(0,0,0),cc.scaleTo(.1,1,1),cc.callFunc(function(){e.getComponent(g.default).readyToShoot()}))),this.ChangeCube.active)if(this.ChangeShooter.childrenCount>0){var t=this.ChangeShooter.children[0];if(t.setPosition(CMath.ConvertToNodeSpaceAR(t,this.ReadyShooter)),t.setParent(this.ReadyShooter),s.gEventMgr.emit(p.GlobalEvent.PLAY_LOAD),t.scale=0,s.gEventMgr.once(p.GlobalEvent.BUBBLE_LOAD,function(){t.runAction(cc.scaleTo(.1,1))},this),t.runAction(cc.moveTo(.2,0,0)),this.BulletArray.childrenCount>0){var o=this.BulletArray.children[0];o.setPosition(CMath.ConvertToNodeSpaceAR(o,this.ChangeShooter)),o.setParent(this.ChangeShooter),o.scale=this.BulletArray.scale,o.runAction(cc.sequence(cc.spawn(cc.moveBy(.1,0,-200),cc.scaleTo(.05,0)),cc.scaleTo(0,0),cc.moveTo(0,0,0),cc.scaleTo(.1,1)))}else console.log(" bullet array has no bubble")}else console.log(" change shooter has no bubble");else if(this.BulletArray.childrenCount>0){var n=this.BulletArray.children[0];n.setPosition(CMath.ConvertToNodeSpaceAR(n,this.ReadyShooter)),n.setParent(this.ReadyShooter),s.gEventMgr.emit(p.GlobalEvent.PLAY_LOAD),n.scale=this.BulletArray.scale,n.runAction(cc.sequence(cc.moveBy(.1,0,this.psitonOffset),cc.scaleTo(0,0),cc.moveTo(0,0,0))),s.gEventMgr.once(p.GlobalEvent.BUBBLE_LOAD,function(){n.runAction(cc.scaleTo(.1,1))},this)}else console.log(" bullet array is 0")},t.prototype.getNewTask=function(e){var t=this;e||(e=Math.ceil(CMath.getRandom(r.BubbleQueRange.Min,r.BubbleQueRange.Max))),console.log("bubble que\uff1a",e);for(var o=[],n=0;n<e;n++)o.push(n);var l=Math.ceil(CMath.getRandom(r.ShooterDoubleRange.Min,r.ShooterDoubleRange.Max)),u=0,h=r.BubbleColors.concat(),d={};if(a.Game.getTaskLength()%l==0)for(u=Math.ceil(CMath.getRandom(r.ShooterDoubleBubbleRange.Min,r.ShooterDoubleBubbleRange.Max));u-- >0&&o.length>0;){var b=o[n=Math.floor(CMath.getRandom(0,o.length))];o.splice(n,1);var f=h[S=Math.floor(CMath.getRandom(0,h.length))];h.splice(S,1),h.length<=0&&(h=r.BubbleColors.concat()),d[b]=f}var m=Math.ceil(CMath.getRandom(r.ShooterBoomRange.Min,r.ShooterBoomRange.Max)),v=0,_=r.BubbleColors.concat(),C={};if(a.Game.getTaskLength()%m==0)for(v=Math.ceil(CMath.getRandom(r.ShooterBoomBubbleRange.Min,r.ShooterBoomBubbleRange.Max));v-- >0&&o.length>0;){b=o[n=Math.floor(CMath.getRandom(0,o.length))];o.splice(n,1);var S;f=_[S=Math.floor(CMath.getRandom(0,_.length))];_.splice(S,1),_.length<=0&&(_=r.BubbleColors.concat()),C[b]=f}var E=Math.ceil(CMath.getRandom(r.ShooterMagicRange.Min,r.ShooterMagicRange.Max)),B=0,M={};if(a.Game.getTaskLength()%E==0)for(B=Math.ceil(CMath.getRandom(r.ShooterMagicBubbleRange.Min,r.ShooterMagicBubbleRange.Max));B-- >0&&o.length>0;){b=o[n=Math.floor(CMath.getRandom(0,o.length))];o.splice(n,1),M[b]=r.BubbleType.Blank}var T=[];for(n=0;n<e;n++)T.push(r.BubbleColors[Math.floor(CMath.getRandom()*r.BubbleColors.length)]);var x=a.Game.getCurTarget();x.now>=x.target&&x.target>0?(a.Game.addTaskStreak(1),s.gEventMgr.emit(p.GlobalEvent.PLAY_EFFECT,"task_success")):(a.Game.addTaskStreak(-a.Game.getTaskStreak()),x.target>0&&s.gEventMgr.emit(p.GlobalEvent.PLAY_EFFECT,"task_fail"));var A=function(e){var t=T[e],o=r.SpecialType.Normal;d[e]&&(o=r.SpecialType.Double,t=d[e]),C[e]&&(o=r.SpecialType.Boom,t=C[e]),null!=M[e]&&(o=r.SpecialType.Magic,t=M[e]);var n=a.Game.getBubble(o,-1,t,R.BubbleAtlas,R.BubbleChange,R.BubbleBurst,R.BubbleHorce,R.BubbleDrop,R.X2);if(n.getComponent(c.default).setActive(!0,!0,e/50),n.scale=0,n.opacity=0,n.y=0,0==e){R.Shooter.childrenCount>0&&console.error(" shooter has bubble!"),n.x=0,R.Shooter.addChild(n);var i=!1;a.Game.getTaskStreak()>=r.TaskStreakAward&&(a.Game.addTaskStreak(-a.Game.getTaskStreak()),i=!0),n.runAction(cc.sequence(cc.fadeTo(0,255),cc.moveTo(0,0,0),cc.callFunc(function(){i&&(s.gEventMgr.emit(p.GlobalEvent.PLAY_EFFECT,"change_horce"),n.getComponent(c.default).setColor(r.BubbleType.Horce,r.SpecialType.Horce),n.getComponent(c.default).playAnimation(y.default,function(){n.getComponent(c.default).AnimationRoot.runAction(cc.fadeOut(.2))})),n.getComponent(g.default).readyToShoot()})))}else 1==e?(R.ReadyShooter.childrenCount>0&&console.error(" shooter has bubble!"),n.x=0,R.ReadyShooter.addChild(n),s.gEventMgr.once(p.GlobalEvent.BUBBLE_LOAD,function(){n.runAction(cc.scaleTo(.1,1))},R),n.stopActionByTag(c.BubbleAction.Bubble),n.scale=0,s.gEventMgr.emit(p.GlobalEvent.PLAY_LOAD),n.runAction(cc.spawn(cc.fadeTo(.2,255),cc.moveTo(.3,0,0),cc.callFunc(function(){})))):2==e?R.ChangeCube.active&&(R.ChangeShooter.childrenCount>0&&console.error(" shooter has bubble!"),n.x=0,R.ChangeShooter.addChild(n),n.runAction(cc.spawn(cc.scaleTo(.2,1),cc.fadeTo(.2,255),cc.moveTo(.3,0,0),cc.callFunc(function(){})))):(n.x=-200*e,R.BulletArray.addChild(n),n.runAction(cc.spawn(cc.scaleTo(.2,.5),cc.fadeTo(.2,255),cc.moveTo(.4,40-R.BulletArray.childrenCount*r.BubbleSize.width,0))))},R=this;for(n=0;n<T.length;n++)A(n);var F=CMath.getRandom(),P=0;if(P=a.Game.getGameTime()>=60?F<=.7?CMath.Clamp(e-Math.ceil(CMath.getRandom(2,10)),r.ClearTargetRange.Max,r.ClearTargetRange.Min):F<=.3?CMath.Clamp(e-Math.ceil(CMath.getRandom(1,2)),r.ClearTargetRange.Max,r.ClearTargetRange.Min):CMath.Clamp(e,r.ClearTargetRange.Max,r.ClearTargetRange.Min):F<=.6?CMath.Clamp(e-Math.ceil(CMath.getRandom(1,2)),r.ClearTargetRange.Max,r.ClearTargetRange.Min):F<=.3?CMath.Clamp(e-Math.ceil(CMath.getRandom(2,10)),r.ClearTargetRange.Max,r.ClearTargetRange.Min):CMath.Clamp(e,r.ClearTargetRange.Max,r.ClearTargetRange.Min),P=Math.min(e-1,P),console.log("task count\uff1a",P),this.TaskArray.childrenCount>0){var G=function(e){var o=N.TaskArray.children[e],n=o.getChildByName("Complete"),i=o.getChildByName("Fail");x.now>=x.target?o.runAction(cc.sequence(cc.delayTime(e/10),cc.scaleTo(.1,0),cc.callFunc(function(){e==t.TaskArray.childrenCount-1&&s.gEventMgr.emit(p.GlobalEvent.PLAY_EFFECT,"new_task"),n.scale=0,i.scale=0,e<=P-1&&o.runAction(cc.sequence(cc.delayTime(0),cc.scaleTo(.1,1.2),cc.delayTime(.05),cc.scaleTo(.1,1)))}))):(n.stopAllActions(),n.scale=0,i.runAction(cc.sequence(cc.delayTime(e/10),cc.scaleTo(.1,1),cc.delayTime(.2),cc.callFunc(function(){e==t.TaskArray.childrenCount-1&&s.gEventMgr.emit(p.GlobalEvent.PLAY_EFFECT,"new_task"),o.runAction(cc.sequence(cc.delayTime(e/10),cc.scaleTo(.1,0),cc.callFunc(function(){i.scale=0,e<=P-1&&o.runAction(cc.sequence(cc.delayTime(0),cc.scaleTo(.1,1.2),cc.delayTime(.05),cc.scaleTo(.1,1)))})))}))))},N=this;for(n=0;n<this.TaskArray.childrenCount;n++)G(n)}else for(s.gEventMgr.emit(p.GlobalEvent.PLAY_EFFECT,"new_task");this.TaskArray.childrenCount<6;){var O=i.gFactory.getTask();O.y=0,O.x=this.TaskArray.childrenCount*O.width*1.3+30,O.scale=0,this.TaskArray.childrenCount<P&&O.runAction(cc.sequence(cc.delayTime(this.TaskArray.childrenCount/10),cc.scaleTo(.1,1.2),cc.delayTime(.05),cc.scaleTo(.1,1))),this.TaskArray.addChild(O),O.getChildByName("Complete").scale=0,O.getChildByName("Fail").scale=0}a.Game.pushTarget({now:0,target:P}),console.log(" add new task done:",this.Shooter.childrenCount)},t.prototype.onBubbleQueRemoveChild=function(){for(var e=0,t=this.BulletArray.children;e<t.length;e++){t[e].runAction(cc.moveBy(.2,r.BubbleSize.width,0))}},t.prototype.addScore=function(e,t,o,n){var r=this;if(void 0===o&&(o=cc.v2(0,0)),void 0===n&&(n=!0),0==n)return this.score=a.Game.getPureScore(),void(this.addScoreStep=(this.score-this.showScore)/20);var l=i.gFactory.getScore();l.scale=0,l.opacity=255,l.getComponent(cc.Label).string="/"+e.toString(),this.TopNode.addChild(l),l.setPosition(o);var c=CMath.Distance(o,this.ScoreLabel.node.position)/1560;l.runAction(cc.sequence(cc.delayTime(.4),cc.fadeTo(c+.3,0))),l.runAction(cc.sequence(cc.scaleTo(.1,1.2*t),cc.delayTime(.2),cc.scaleTo(.1,1*t),cc.moveTo(c,this.ScoreLabel.node.position).easing(cc.easeInOut(1)),cc.scaleTo(.3,0),cc.callFunc(function(){r.score=a.Game.getPureScore(),r.addScoreStep=(r.score-r.showScore)/20,i.gFactory.putScore(l)})))},t.prototype.updateTimeCount=function(){var e=Math.floor(a.Game.getGameTime());if(!(e>5)){var t=this.TimeLabel.node.getParent().getChildByName("font").getComponent(cc.Sprite),o=this.TimeFont.getSpriteFrame("bg_time"+e);t.spriteFrame!=o&&(s.gEventMgr.emit(p.GlobalEvent.PLAY_EFFECT,"count"),t.spriteFrame=o,t.node.runAction(cc.sequence(cc.fadeTo(.2,255),cc.scaleTo(.1,1.2),cc.delayTime(.5),cc.scaleTo(.1,1),cc.fadeTo(.1,0))))}},t.prototype.update=function(e){if(this.FireBar.height=a.Game.getTaskStreak()/r.TaskStreakAward*(r.FireBar.End-r.FireBar.Start)+r.FireBar.Start,this.ChangeButton.interactable=this.ReadyShooter.childrenCount>0&&this.Shooter.childrenCount>0&&Math.abs(this.Shooter.children[0].x)<=.01&&Math.abs(this.Shooter.children[0].y)<=.01&&Math.abs(this.ReadyShooter.children[0].x)<=.01&&Math.abs(this.ReadyShooter.children[0].y)<=.01,a.Game.isStart&&(this.NowStreak.string=a.Game.getTaskStreak().toString(),this.TreasureBar.progress=this.TreasureProgress[a.Game.treasureCount],!this.Guide.node.active&&!this.node.getChildByName("PauseLayer").active)){a.Game.addGameTime(-e);var t=CMath.TimeFormat(a.Game.getGameTime()).split("-");this.TimeLabel.string=t[0],this.TimeLabel2.string=t[1],30==Math.floor(a.Game.getGameTime())&&this.TimeLabel.node.getParent().getChildByName("noTime").opacity<=0&&(this.TimeLabel.node.getParent().getChildByName("noTime").opacity=255,this.TimeLabel.node.getParent().getComponentInChildren(m.default).play(),s.gEventMgr.emit(p.GlobalEvent.CHANGE_BGM,"bgm_30")),this.updateTimeCount()}this.showScore<this.score&&(this.showScore+=this.addScoreStep,this.showScore=Math.min(this.score,this.showScore),this.ScoreLabel.string=Math.floor(this.showScore).toString())},__decorate([C(cc.Prefab)],t.prototype,"BubblePrefab",void 0),__decorate([C(cc.Prefab)],t.prototype,"PointPrefab",void 0),__decorate([C(cc.Prefab)],t.prototype,"TaskPrefab",void 0),__decorate([C(cc.Prefab)],t.prototype,"BirdPrefab",void 0),__decorate([C(cc.Prefab)],t.prototype,"AddScorePrefab",void 0),__decorate([C(cc.SpriteAtlas)],t.prototype,"BubbleAtlas",void 0),__decorate([C(cc.SpriteAtlas)],t.prototype,"BubbleChange",void 0),__decorate([C(cc.SpriteAtlas)],t.prototype,"X2",void 0),__decorate([C(cc.SpriteAtlas)],t.prototype,"BubbleBurst",void 0),__decorate([C(cc.SpriteAtlas)],t.prototype,"BubbleHorce",void 0),__decorate([C(cc.SpriteAtlas)],t.prototype,"BubbleDrop",void 0),__decorate([C(cc.SpriteFrame)],t.prototype,"SpringBack",void 0),__decorate([C(cc.SpriteFrame)],t.prototype,"SummerBack",void 0),__decorate([C(cc.SpriteFrame)],t.prototype,"AutumnBack",void 0),__decorate([C(cc.SpriteFrame)],t.prototype,"WinterBack",void 0),__decorate([C(cc.SpriteFrame)],t.prototype,"SpringMask",void 0),__decorate([C(cc.SpriteFrame)],t.prototype,"SummerMask",void 0),__decorate([C(cc.SpriteFrame)],t.prototype,"AutumnMask",void 0),__decorate([C(cc.SpriteFrame)],t.prototype,"WinterMask",void 0),__decorate([C(cc.Sprite)],t.prototype,"MaskMachine",void 0),__decorate([C(cc.Label)],t.prototype,"NowStreak",void 0),__decorate([C(cc.Node)],t.prototype,"FireBar",void 0),__decorate([C(d.default)],t.prototype,"Guide",void 0),__decorate([C(cc.Sprite)],t.prototype,"Background",void 0),__decorate([C(cc.SpriteAtlas)],t.prototype,"FontAtlas",void 0),__decorate([C(cc.SpriteAtlas)],t.prototype,"TimeFont",void 0),__decorate([C(cc.Prefab)],t.prototype,"FontPrefab",void 0),__decorate([C(cc.Node)],t.prototype,"FontRoot",void 0),__decorate([C(cc.Node)],t.prototype,"TreasureRoot",void 0),__decorate([C(cc.Node)],t.prototype,"BigTreasure",void 0),__decorate([C(cc.Node)],t.prototype,"SmallTreasure",void 0),__decorate([C(cc.SpriteAtlas)],t.prototype,"ResultTitle",void 0),__decorate([C(cc.Sprite)],t.prototype,"ResultFont",void 0),__decorate([C(cc.Node)],t.prototype,"BubbleLayer",void 0),__decorate([C(cc.Node)],t.prototype,"Shooter",void 0),__decorate([C(cc.Node)],t.prototype,"TopNode",void 0),__decorate([C(cc.Node)],t.prototype,"BulletArray",void 0),__decorate([C(cc.Node)],t.prototype,"TaskArray",void 0),__decorate([C(cc.Node)],t.prototype,"ShooterLayer",void 0),__decorate([C(cc.Label)],t.prototype,"TimeLabel",void 0),__decorate([C(cc.Label)],t.prototype,"TimeLabel2",void 0),__decorate([C(cc.Label)],t.prototype,"ScoreLabel",void 0),__decorate([C(cc.Node)],t.prototype,"ChangeShooter",void 0),__decorate([C(cc.Node)],t.prototype,"ReadyShooter",void 0),__decorate([C(cc.Node)],t.prototype,"ChangeCube",void 0),__decorate([C(cc.Button)],t.prototype,"ChangeButton",void 0),__decorate([C(cc.Button)],t.prototype,"PauseButton",void 0),__decorate([C(cc.ProgressBar)],t.prototype,"TreasureBar",void 0),__decorate([C(cc.Node)],t.prototype,"BirdRoot",void 0),t=__decorate([_],t)}(cc.Component);o.default=S,cc._RF.pop()},{"./Bubble":"Bubble","./BubbleAnimation/BubbleHorce":"BubbleHorce","./BubbleMove":"BubbleMove","./Const":"Const","./Controller/AudioController":"AudioController","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Controller/GameFactory":"GameFactory","./Controller/StepController":"StepController","./Data/BubbleMatrix":"BubbleMatrix","./FrameAniBase":"FrameAniBase","./Guide":"Guide","./ResultLayer":"ResultLayer","./Utils/LogHandler":"LogHandler"}],GameSignal:[function(e,t,o){"use strict";cc._RF.push(t,"5b11cqe4MZNk4psFqqHILEE","GameSignal"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../Utils/Signal"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(n.BaseSignal);o.ChacknCountChangedSignal=i;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(n.BaseSignal);o.ChacknScoreChangedSignal=a,cc._RF.pop()},{"../Utils/Signal":"Signal"}],Game:[function(e,t,o){"use strict";cc._RF.push(t,"f56074wKGJAf7tmCkTOJ+cK","Game"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../Data/BubbleMatrix"),i=e("../Const"),a=e("./GameFactory"),r=e("../BubbleMove"),l=e("./EventManager"),c=e("./EventName"),s=e("./GameSignal"),u=function(){function e(){this.BubbleLayer=null,this.TopNode=null,this.FontRoot=null,this.moveTimes=0,this.bubbleMatrix=new n.BubbleMatrix,this.score=0,this.streak=0,this.maxStreak=0,this.taskStreak=0,this.maxTaskStreak=0,this.bubbleScore={},this.bubbleClear={},this.bubbleDrop={},this.collisionIndexes=[],this.targets=[],this.clearIndex=[],this.dropIndex=[],this.fixedIndex=[],this.forceIndex=[],this.gameTime=0,this.isStart=!1,this.lastIndex=i.InitStartIndex,this._startIndex=i.InitStartIndex,this.DropCount=0,this.hasReadygo=!1,this.treasureCount=0,this.Rebounce=0}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Season",{get:function(){return this.season},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startIndex",{get:function(){return this._startIndex},set:function(e){this._startIndex=e,console.log(" startIndex:",this.startIndex)},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.moveTimes=0,this.score=0,this.collisionIndexes.length=0,this.targets.length=0,this.clearIndex.length=0,this.dropIndex.length=0,this.forceIndex.length=0,this.gameTime=i.GameTime,this.streak=0,this.maxStreak=0,this.taskStreak=0,this.maxTaskStreak=0;for(var e=0,t=i.BubbleColors;e<t.length;e++){var o=t[e];this.bubbleClear[o]=0,this.bubbleDrop[o]=0,this.bubbleScore[o]=0}for(var n=0;n<10;n++)this.season=i.SeasonPool[Math.floor(CMath.getRandom(0,i.SeasonPool.length))];console.log(" Season:",i.Season[this.season])},e.prototype.getBubbleScore=function(){return this.bubbleScore},e.prototype.getTaskLength=function(){return this.targets.length},e.prototype.getCurTarget=function(){return 0==this.targets.length?{target:0,now:0}:this.targets[this.targets.length-1]},e.prototype.addTarget=function(e){0!=this.targets.length&&(this.targets[this.targets.length-1].now+=e,l.gEventMgr.emit(c.GlobalEvent.UPDATE_TASK))},e.prototype.pushTarget=function(e){this.streak=0,this.targets.push(e)},e.prototype.getCollisionIndexes=function(){return this.collisionIndexes},e.prototype.updateCollisionIndexes=function(){this.collisionIndexes.length=0;for(var e=this.bubbleMatrix.data,t=0;t<e.length;t++){if(e[t]&&e[t].bubble)this.bubbleMatrix.getNeiborMatrix(t,1).length<6&&this.collisionIndexes.push(t)}for(t=0;t<e.length;t++)if(e[t]&&e[t].bubble&&!(this.collisionIndexes.indexOf(t)>=0)){for(var o=!0,i=0,a=this.bubbleMatrix.getNeiborMatrix(t,1);i<a.length;i++){var r=a[i];if(this.collisionIndexes.indexOf(r)<0){o=!1;break}}o&&this.collisionIndexes.push(t)}for(t=this.startIndex-n.MatrixSize;t<this.startIndex-n.MatrixSize+n.UseSize;t++);},e.prototype.getScore=function(){return this.score},e.prototype.addScore=function(e,t,o,n,i){void 0===n&&(n=cc.v2(0,0)),void 0===i&&(i=!0),this.score+=t,this.score=Math.max(0,this.score),this.addBubbleScore(e,t),l.gEventMgr.emit(c.GlobalEvent.ADD_SCORE,t,o,n,i)},e.prototype.getMatrix=function(){return this.bubbleMatrix},e.prototype.prepare=function(){this.bubbleMatrix.initBubbleData()},e.prototype.getLastI=function(){return this.bubbleMatrix.index2i(this.lastIndex)},e.prototype.addGameTime=function(e){this.gameTime+=e,this.gameTime<=0&&(this.gameTime=0,this.isStart=!1,console.log("DropCount:",o.Game.DropCount),setTimeout(function(){l.gEventMgr.emit(c.GlobalEvent.GAME_OVER,i.OverType.TIME_UP)},100*o.Game.DropCount))},e.prototype.checkOutOfMove=function(){for(var e=null,t=this.bubbleMatrix.data.length-1;t>=this.startIndex;t--)if(this.bubbleMatrix.data[t]&&this.bubbleMatrix.data[t].bubble&&this.bubbleMatrix.data[t].bubble.node.active){e=this.bubbleMatrix.data[t].bubble;break}if(e){var o=CMath.ConvertToNodeSpaceAR(e.node,e.node.getParent().getParent());console.log(" check out of move:",o.y),o.y<=r.DropBorder&&(this.isStart=!1,l.gEventMgr.emit(c.GlobalEvent.GAME_OVER,i.OverType.OUT_OF_MOVE))}},e.prototype.getGameTime=function(){return this.gameTime},e.prototype.addMoveTimes=function(e){void 0===e&&(e=1),this.moveTimes+=e},e.prototype.getMoveTimes=function(){return this.moveTimes},e.prototype.getBubble=function(e,t,o,n,i,r,l,c,s){return a.gFactory.getBubble(e,t,o,n,i,r,l,c,s)},e.prototype.checkRecurily=function(e,t){if(!(this.clearIndex.indexOf(e)>=0||e<this.startIndex)){this.clearIndex.push(e);for(var o=0,n=this.bubbleMatrix.getNeiborMatrix(e,1);o<n.length;o++){var i=n[o];if(!(i<this.startIndex)){var a=this.bubbleMatrix.data[i].bubble;a&&a.node.active&&t.Color==a.Color&&this.checkRecurily(i,t)}}}},e.prototype.addBubbleScore=function(e,t){this.bubbleScore[e]||(this.bubbleScore[e]=0),this.bubbleScore[e]+=t,e==i.BubbleType.Bird&&s.ChacknScoreChangedSignal.inst.dispatchOne(this.bubbleScore[e])},e.prototype.getSocreByType=function(e){return this.bubbleScore[e]?this.bubbleScore[e]:0},e.prototype.getPureScore=function(){var e=this.getSocreByType(i.BubbleType.Bird);return Math.max(this.score-e,0)},e.prototype.addBubbleDrop=function(e){this.bubbleDrop[e]++},e.prototype.addBubbleClear=function(e){this.bubbleClear[e]++},e.prototype.checkBoomBubble=function(e){for(var t=0,o=e;t<o.length;t++){var n=o[t];if(this.bubbleMatrix.data[n].type==i.SpecialType.Boom){for(var a=[],r=0,l=this.bubbleMatrix.getNeiborMatrix(n,1,!1);r<l.length;r++){var c=l[r];this.clearIndex.indexOf(c)<0&&c>=this.startIndex&&(this.clearIndex.push(c),this.bubbleMatrix.data[c].type==i.SpecialType.Boom&&a.push(c))}this.checkBoomBubble(a)}}},e.prototype.checkClear=function(e,t,o){if(this.clearIndex.length=0,t.Type==i.SpecialType.Horce){console.log("\u5c0f\u9a6c\u7403:",this.startIndex,i.BubbleType[o.Color]),this.clearIndex.push(e);for(var n=this.startIndex;n<this.bubbleMatrix.data.length;n++)this.bubbleMatrix.data[n]&&this.bubbleMatrix.data[n].bubble&&this.bubbleMatrix.data[n].bubble.node.active&&this.bubbleMatrix.data[n].color==o.Color&&this.clearIndex.push(n)}else this.checkRecurily(e,t);if(this.clearIndex.length<i.ClearCountLimit&&t.Type!=i.SpecialType.Horce)return this.clearIndex.length=0,void(this.streak=0);console.log(" --------------- \u68c0\u6d4b\u6d88\u9664 start---------------:",this.startIndex),console.log(this.clearIndex),console.log(" --------------- \u68c0\u6d4b\u6d88\u9664 end---------------"),this.checkBoomBubble(this.clearIndex),this.streak++,this.streak>=2&&l.gEventMgr.emit(c.GlobalEvent.SHOW_STREAK,!0,this.streak),this.clearIndex.length>=5&&(this.clearIndex.length<=8?l.gEventMgr.emit(c.GlobalEvent.SHOW_STREAK,!1,4):this.clearIndex.length<=12?l.gEventMgr.emit(c.GlobalEvent.SHOW_STREAK,!1,5):l.gEventMgr.emit(c.GlobalEvent.SHOW_STREAK,!1,6)),this.maxStreak=Math.max(this.streak,this.maxStreak);var a=0;for(a=this.bubbleMatrix.data.length-1;a>=this.startIndex;a--){var r=this.bubbleMatrix.data[a];if(r&&r.color&&r.bubble&&r.bubble.node.active)break}this.lastIndex=a;for(var s=!1,u=0;u<this.clearIndex.length;u++){var h=this.clearIndex[u];if((d=this.bubbleMatrix.data[h].bubble)&&d.isDouble){s=!0,l.gEventMgr.emit(c.GlobalEvent.PLAY_EFFECT,"double_score");break}}t.Type==i.SpecialType.Horce&&(l.gEventMgr.emit(c.GlobalEvent.PLAY_EFFECT,"super_clear"),l.gEventMgr.emit(c.GlobalEvent.HORCE_CLEAR));for(var p=0;p<this.clearIndex.length;p++){var d;h=this.clearIndex[p];(d=this.bubbleMatrix.data[h].bubble)&&(s&&(d.DoubleScore=!0),d.onClear(.1*p,e),this.bubbleMatrix.data[h].bubble=null,this.bubbleMatrix.data[h].color=i.BubbleType.Blank,this.bubbleMatrix.data[h].type=i.SpecialType.Normal)}this.clearIndex.length=0,this.checkBubbleDrop(),this.addTarget(1),l.gEventMgr.emit(c.GlobalEvent.CHECK_TREASURE),this.checkAddBubble()},e.prototype.checkAddBubble=function(){for(var e=0,t=this.startIndex;t<=this.startIndex+23;t++)this.bubbleMatrix.data[t]&&this.bubbleMatrix.data[t].bubble&&this.bubbleMatrix.data[t].bubble.node.active&&e++;console.log(" top three count:",e),e<=19&&l.gEventMgr.emit(c.GlobalEvent.ADD_BUBBLE,3)},e.prototype.checkDrop=function(e){for(var t=this.bubbleMatrix.getNeiborMatrix(e,1,!1),o=0,n=t;o<n.length;o++){var i=n[o];if(this.fixedIndex.indexOf(i)>=0){this.fixedIndex=this.fixedIndex.concat(t),this.fixedIndex.push(e);break}}},e.prototype.checkBubbleDrop=function(){this.dropIndex.length=0,this.fixedIndex.length=0;for(var e=this.startIndex;e<this.startIndex+n.UseSize;e++)this.bubbleMatrix.data[e]&&this.bubbleMatrix.data[e].bubble&&this.fixedIndex.push(e);for(e=this.startIndex;e<this.bubbleMatrix.data.length;e++)e>=this.startIndex+n.UseSize&&this.bubbleMatrix.data[e]&&this.bubbleMatrix.data[e].bubble&&this.dropIndex.push(e);if(!(this.dropIndex.length<=0)){for(var t=0,o=this.dropIndex;t<o.length;t++){var a=o[t];this.checkDrop(a)}for(var r=0,l=this.fixedIndex;r<l.length;r++){a=l[r];(e=this.dropIndex.indexOf(a))>=0&&this.dropIndex.splice(e,1)}console.log(" \u68c0\u6d4b\u6389\u843d---------------"),console.log(this.dropIndex);for(var c=0,s=this.dropIndex;c<s.length;c++){a=s[c];if(this.bubbleMatrix.data[a]){var u=this.bubbleMatrix.data[a].bubble;u&&(u.move.drop(),this.bubbleMatrix.data[a].bubble=null,this.bubbleMatrix.data[a].color=i.BubbleType.Blank,this.bubbleMatrix.data[a].type=i.SpecialType.Normal)}}this.dropIndex.length=0}},e.prototype.addTaskStreak=function(e){this.taskStreak+=e,this.taskStreak=Math.max(0,this.taskStreak),this.maxTaskStreak=Math.max(this.maxTaskStreak,this.taskStreak)},e.prototype.getTaskStreak=function(){return this.taskStreak},e}();o.Game=u.inst,cc._RF.pop()},{"../BubbleMove":"BubbleMove","../Const":"Const","../Data/BubbleMatrix":"BubbleMatrix","./EventManager":"EventManager","./EventName":"EventName","./GameFactory":"GameFactory","./GameSignal":"GameSignal"}],GreenIdle:[function(e,t,o){"use strict";cc._RF.push(t,"4b6acWt//tGdJok24P7E67l","GreenIdle"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../../FrameAniBase"),i=e("../../Controller/EventManager"),a=e("../../Controller/EventName"),r=cc._decorator,l=r.ccclass,c=(r.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),i.gEventMgr.on(a.GlobalEvent.IS_GREEN_IDLE,function(e){e&&0==t.isPlaying?t.playOnLoop():t.stop()})},t.aniName="GreenIdle",t=__decorate([l],t)}(n.default));o.default=c,cc._RF.pop()},{"../../Controller/EventManager":"EventManager","../../Controller/EventName":"EventName","../../FrameAniBase":"FrameAniBase"}],Guide:[function(e,t,o){"use strict";cc._RF.push(t,"4d6d2YvErVK1L2MNAsgprAA","Guide"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Controller/EventManager"),i=e("./Controller/EventName"),a=cc._decorator,r=a.ccclass,l=a.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ButtonAtlas=null,t.Next=null,t.Close=null,t.Content=null,t.GuideView=null,t.callback=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.Next.node.on(cc.Node.EventType.TOUCH_END,this.nextPage,this),this.Close.node.on(cc.Node.EventType.TOUCH_END,this.hide,this),this.GuideView.node.on("scroll-ended",this.updateButton,this)},t.prototype.start=function(){},t.prototype.hide=function(){var e=this;setTimeout(function(){e.node.active=!1,e.callback&&e.callback(),cc.Node.maxTouchNum=1,cc.Node.touchNum=0},0)},t.prototype.show=function(e){var t=this;cc.Node.maxTouchNum=10,cc.Node.touchNum=0,this.node.active=!0,this.callback=e,this.GuideView.scrollToPage(0,0),setTimeout(function(){t.Close.node.active=!1,t.Next.node.active=!0},0)},t.prototype.nextPage=function(){var e=this;if(n.gEventMgr.emit(i.GlobalEvent.PLAY_EFFECT,"button_click"),this.GuideView.getCurrentPageIndex()>=this.GuideView.content.childrenCount-1)setTimeout(function(){e.Next.node.active=!1,e.Close.node.active=!0},0);else{var t=(this.GuideView.getCurrentPageIndex()+1)%this.GuideView.content.childrenCount;this.GuideView.setCurrentPageIndex(t),this.updateButton()}},t.prototype.forwardPage=function(){if(n.gEventMgr.emit(i.GlobalEvent.PLAY_EFFECT,"button_click"),this.GuideView.getCurrentPageIndex()<=0);else{var e=(this.GuideView.getCurrentPageIndex()-1)%this.GuideView.content.childrenCount;this.GuideView.setCurrentPageIndex(e),this.updateButton()}},t.prototype.updateButton=function(){var e=this;this.GuideView.getCurrentPageIndex()>=this.GuideView.content.childrenCount-1?setTimeout(function(){e.Next.node.active=!1,e.Close.node.active=!0},0):setTimeout(function(){e.Next.node.active=!0,e.Close.node.active=!1},0)},__decorate([l(cc.SpriteAtlas)],t.prototype,"ButtonAtlas",void 0),__decorate([l(cc.Button)],t.prototype,"Next",void 0),__decorate([l(cc.Button)],t.prototype,"Close",void 0),__decorate([l(cc.Node)],t.prototype,"Content",void 0),__decorate([l(cc.PageView)],t.prototype,"GuideView",void 0),t=__decorate([r],t)}(cc.Component);o.default=c,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName"}],HandUpLeft:[function(e,t,o){"use strict";cc._RF.push(t,"ffe9bP+UqVKj75trtccD5k+","HandUpLeft"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../../FrameAniBase"),i=e("../../Controller/EventManager"),a=e("../../Controller/EventName"),r=cc._decorator,l=r.ccclass,c=(r.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),i.gEventMgr.on(a.GlobalEvent.ON_POINTER_ROTATED,function(e){e?t.playByStep():t.stop()},this)},t.aniName="HandUpLeft",t=__decorate([l],t)}(n.default));o.default=c,cc._RF.pop()},{"../../Controller/EventManager":"EventManager","../../Controller/EventName":"EventName","../../FrameAniBase":"FrameAniBase"}],HandUpRight:[function(e,t,o){"use strict";cc._RF.push(t,"bf0e8y4ZthFO51qKbDIAQoB","HandUpRight"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../../Controller/EventManager"),i=e("../../Controller/EventName"),a=e("../../FrameAniBase"),r=cc._decorator,l=r.ccclass,c=(r.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),n.gEventMgr.on(i.GlobalEvent.ON_POINTER_ROTATED,function(e){e?t.stop():t.playByStep()},this)},t.aniName="HandUpRight",t=__decorate([l],t)}(a.default));o.default=c,cc._RF.pop()},{"../../Controller/EventManager":"EventManager","../../Controller/EventName":"EventName","../../FrameAniBase":"FrameAniBase"}],HashMap:[function(e,t,o){"use strict";cc._RF.push(t,"834d8P+ikFOAYgMzFmudtRR","HashMap"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){this._list=new Array,this.clear()}return e.prototype.getIndexByKey=function(e){for(var t=this._list.length,o=0;o<t;o++){if(this._list[o].key==e)return o}return-1},e.prototype.keyOf=function(e){for(var t=this._list.length,o=0;o<t;o++){var n=this._list[o];if(n.value==e)return n.key}return null},Object.defineProperty(e.prototype,"keys",{get:function(){for(var e=new Array,t=0,o=this._list;t<o.length;t++){var n=o[t];n&&e.push(n.key)}return e},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){var o={key:e,value:t},n=this.getIndexByKey(e);-1!=n?this._list[n]=o:this._list.push(o)},Object.defineProperty(e.prototype,"values",{get:function(){return this._list},enumerable:!0,configurable:!0}),e.prototype.remove=function(e){var t=this.getIndexByKey(e);if(-1!=t){var o=this._list[t];return this._list.splice(t,1),o}return null},e.prototype.has=function(e){return-1!=this.getIndexByKey(e)},e.prototype.get=function(e){var t=this.getIndexByKey(e);return-1!=t?this._list[t].value:null},Object.defineProperty(e.prototype,"length",{get:function(){return this._list.length},enumerable:!0,configurable:!0}),e.prototype.sort=function(e){this._list.sort(e)},e.prototype.forEachKeyValue=function(e){for(var t=this._list.length,o=0;o<t;o++){e(this._list[o])}},e.prototype.forEach=function(e){for(var t=this._list.length,o=0;o<t;o++){var n=this._list[o];e(n.key,n.value)}},e.prototype.clear=function(){this._list=[]},e}();o.HashMap=n,cc._RF.pop()},{}],LoadingImg:[function(e,t,o){"use strict";cc._RF.push(t,"08b58X7vJJJUY4roqLZ8Atp","LoadingImg"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Controller/EventManager"),i=e("./Controller/EventName"),a=cc._decorator,r=a.ccclass,l=(a.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.startTime=0,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;this.node.scale=1,this.startTime=Date.now(),n.gEventMgr.targetOff(this),n.gEventMgr.on(i.GlobalEvent.Hide_Load,function(t){void 0===t&&(t=0);var o=0;Date.now()-e.startTime<=5e3&&(o=(5e3-(Date.now()-e.startTime))/1e3),e.node.runAction(cc.sequence(cc.delayTime(o+t),cc.fadeOut(.05),cc.callFunc(function(){e.node.removeFromParent(!0)})))},this)},t=__decorate([r],t)}(cc.Component));o.default=l,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName"}],LogHandler:[function(e,t,o){"use strict";cc._RF.push(t,"4e3f0ZIKgdJt7KKOAGW0fes","LogHandler"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){if(this.logMsg=null,this.frameTimes=0,this.now=0,this.Frame=20,this.totalFrames=0,this.startTime=0,window.addEventListener)for(var t=0,o=e.LISTENNING_EVENTS;t<o.length;t++){var n=o[t],i="trigger"+n.charAt(0).toLocaleUpperCase()+n.substring(1);this[i]&&"function"==typeof this[i]&&window.addEventListener(n,this[i].bind(this))}}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.dumpFrameInfo=function(){var e=(Date.now()-this.startTime)/1e3,t=e/this.totalFrames;this.addLog(" total frames:",this.totalFrames," ,total cost time:",e+"s"," , per frame cost time ave:"+t+"s"),this.sendLog()},e.prototype.initLog=function(t){var o=this;cc.director.once(cc.Director.EVENT_AFTER_SCENE_LAUNCH,function(){o.frameTimes=0,o.now=Date.now(),o.startTime=Date.now()},this),cc.director.on(cc.Director.EVENT_AFTER_DRAW,function(){o.frameTimes++,o.totalFrames++,o.frameTimes>=o.Frame&&(o.frameTimes=0,o.now=Date.now())},this),this.logFunc=t,console.error=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];e.inst.log("[ERROR]",t)},console.warn=function(){for(var t,o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];(t=e.inst).log.apply(t,["[WARN]"].concat(o))},console.log=function(){for(var t,o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];(t=e.inst).log.apply(t,["[INFO]"].concat(o))}},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.addLog.apply(this,e),this.sendLog()},e.prototype.formatLogArguments=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var o="",n=0;n<arguments.length;n++){var i=typeof arguments[n];"string"==i||"number"==i?o+=" "+arguments[n]:"object"==i?o+=" "+JSON.stringify(arguments[n]):"boolean"==i&&arguments[n].toString&&(o+=arguments[n].toString())}return o},e.prototype.addLog=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];null==this.logMsg&&(this.logMsg={});var n=this.formatLogArguments.apply(this,t),i=this.getFullTime(new Date);this.logMsg[i]=e.VERSION+n},e.prototype.getFullTime=function(e){var t="";t+=e.getFullYear();var o=e.getMonth();t+="-"+(o>=10?o:"0"+o);var n=e.getDate();t+="-"+(n>=10?n:"0"+n);var i=e.getHours();t+="  "+(i>=10?i:"0"+i);var a=e.getMinutes();t+=":"+(a>=10?a:"0"+a);var r=e.getSeconds();return t+=":"+(r>=10?r:"0"+r)},e.prototype.sendLog=function(){this.logFunc&&null!=this.logMsg&&(this.logFunc(JSON.stringify(this.logMsg)),this.logMsg=null)},e.prototype.triggerClose=function(e){this.addLog("triggerClose"),this.sendLog()},e.prototype.triggerLoad=function(e){this.addLog("triggerLoad"),this.sendLog()},e.prototype.triggerUnload=function(e){this.addLog("triggerUnload"),this.sendLog()},e.prototype.triggerOnunload=function(e){this.addLog("triggerUnload"),this.sendLog()},e.prototype.triggerError=function(e){this.addLog("triggerError"),this.addLog(e.message),this.sendLog()},e.prototype.triggerFocus=function(e){this.addLog("triggerFocus"),this.sendLog()},e.prototype.triggerBlur=function(e){this.addLog("triggerBlur"),this.sendLog()},e.prototype.triggerAbort=function(e){this.addLog("triggerAbort"),this.sendLog()},e.prototype.triggerSuspend=function(e){this.addLog("triggerSuspend"),this.sendLog()},e.prototype.beforeunload=function(e){this.addLog("beforeunload"),this.sendLog()},e.VERSION="Bust-A-Move version 44 : ",e.LISTENNING_EVENTS=["error"],e}();o.LogHandler=n,cc._RF.pop()},{}],NumberChangedView:[function(e,t,o){"use strict";cc._RF.push(t,"6a0e8jwfZxCE7vmfMKFvdKT","NumberChangedView"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,i=n.ccclass,a=(n.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.num=0,t.showNum=0,t.step=0,t.label=null,t}return __extends(t,e),Object.defineProperty(t.prototype,"Label",{get:function(){return this.label?this.label:this.label=this.node.getComponent(cc.Label)},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){},t.prototype.start=function(){},t.prototype.onNumberChanged=function(e){this.num=e,this.num!=this.showNum?this.step=Math.ceil((this.num-this.showNum)/120):this.step=0},t.prototype.update=function(e){this.num!=this.showNum&&(this.showNum+=this.step,(this.showNum>this.num&&this.step>0||this.showNum<this.num&&this.step<0)&&(this.showNum=this.num,this.step=0)),this.Label.string=this.showNum.toString()},t=__decorate([i],t)}(cc.Component));o.default=a,cc._RF.pop()},{}],PauseLayer:[function(e,t,o){"use strict";cc._RF.push(t,"06fb3hXnkNL34EZDW3IRUcG","PauseLayer"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Guide"),i=e("./Controller/EventManager"),a=e("./Controller/EventName"),r=e("./Const"),l=cc._decorator,c=l.ccclass,s=l.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.GuideLayer=null,t}return __extends(t,e),Object.defineProperty(t.prototype,"Resume",{get:function(){return this.node.getChildByName("Resume")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EndNow",{get:function(){return this.node.getChildByName("EndNow")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Help",{get:function(){return this.node.getChildByName("Help")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MusicSlider",{get:function(){return this.node.getChildByName("Music").getComponent(cc.Slider)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EffectSlider",{get:function(){return this.node.getChildByName("Effect").getComponent(cc.Slider)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MusicMask",{get:function(){return this.MusicSlider.node.getChildByName("Mask")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EffectMask",{get:function(){return this.EffectSlider.node.getChildByName("Mask")},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){var e=this;this.node.scale=1,this.node.active=!1,i.gEventMgr.on(a.GlobalEvent.OPEN_PAUSE,function(){e.show()},this),this.EndNow.on(cc.Node.EventType.TOUCH_END,function(){i.gEventMgr.emit(a.GlobalEvent.PLAY_EFFECT,"button_click"),e.hide(),i.gEventMgr.emit(a.GlobalEvent.GAME_OVER,r.OverType.TIME_UP)},this),i.gEventMgr.on(a.GlobalEvent.ON_SHOW,function(){},this),this.Help.on(cc.Node.EventType.TOUCH_END,function(){i.gEventMgr.emit(a.GlobalEvent.PLAY_EFFECT,"button_click"),e.GuideLayer.show()},this),this.Resume.on(cc.Node.EventType.TOUCH_END,function(){i.gEventMgr.emit(a.GlobalEvent.PLAY_EFFECT,"button_click"),e.hide()},this),this.EffectSlider.node.on("slide",function(){cc.audioEngine.setEffectsVolume(e.EffectSlider.progress),e.updateVolumeSlider()},this),this.MusicSlider.node.on("slide",function(){cc.audioEngine.setMusicVolume(e.MusicSlider.progress),e.updateVolumeSlider()},this)},t.prototype.updateVolumeSlider=function(){this.MusicSlider.progress=cc.audioEngine.getMusicVolume(),this.EffectSlider.progress=cc.audioEngine.getEffectsVolume(),this.EffectMask.width=507*this.EffectSlider.progress,this.MusicMask.width=507*this.MusicSlider.progress},t.prototype.show=function(){this.node.active||(this.node.active=!0,this.updateVolumeSlider())},t.prototype.hide=function(){var e=this;0!=this.node.active&&setTimeout(function(){e.node.active=!1},0)},__decorate([s(n.default)],t.prototype,"GuideLayer",void 0),t=__decorate([c],t)}(cc.Component);o.default=u,cc._RF.pop()},{"./Const":"Const","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Guide":"Guide"}],Pointer:[function(e,t,o){"use strict";cc._RF.push(t,"dfda2iUzjJK2KNyR3Mo4JBL","Pointer"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Controller/EventManager"),i=e("./Controller/EventName"),a=cc._decorator,r=a.ccclass,l=a.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.factor=1,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;n.gEventMgr.on(i.GlobalEvent.UPDATE_POINTER_ROTATION,function(t){Math.floor(t)%5==0&&n.gEventMgr.emit(i.GlobalEvent.ON_POINTER_ROTATED,e.node.rotation<=0),e.node.rotation=t*e.factor},this)},t.prototype.start=function(){},__decorate([l],t.prototype,"factor",void 0),t=__decorate([r],t)}(cc.Component);o.default=c,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName"}],Psiton:[function(e,t,o){"use strict";cc._RF.push(t,"5c367a1qjBEFYPKZJtSQSpU","Psiton"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Controller/EventManager"),i=e("./Controller/EventName"),a=cc._decorator,r=a.ccclass,l=a.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.targetPosition=cc.v2(0,0),t.startPosition=cc.v2(0,0),t}return __extends(t,e),t.prototype.onLoad=function(){this.defaultPosition=this.node.position.clone(),n.gEventMgr.on(i.GlobalEvent.AFTER_SHOOT,this.onShoot,this)},t.prototype.start=function(){},t.prototype.onShoot=function(){this.node.runAction(cc.sequence(cc.spawn(cc.scaleTo(.05,.9),cc.moveTo(.05,this.startPosition)),cc.delayTime(.05),cc.spawn(cc.moveTo(.05,this.targetPosition),cc.scaleTo(.05,1)),cc.moveTo(.05,this.defaultPosition)))},__decorate([l(cc.Vec2)],t.prototype,"targetPosition",void 0),__decorate([l(cc.Vec2)],t.prototype,"startPosition",void 0),t=__decorate([r],t)}(cc.Component);o.default=c,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName"}],ReadyGoAnimation:[function(e,t,o){"use strict";cc._RF.push(t,"af2caQWsglGhLpOpE7b4hy8","ReadyGoAnimation"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Controller/EventManager"),i=e("./Controller/EventName"),a=e("./Controller/Game"),r=cc._decorator,l=r.ccclass,c=r.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ReadyGo=null,t}return __extends(t,e),Object.defineProperty(t.prototype,"sprite",{get:function(){return this.getComponent(cc.Sprite)},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){var e=this;n.gEventMgr.once(i.GlobalEvent.READY_GO,function(){n.gEventMgr.emit(i.GlobalEvent.PLAY_EFFECT,"readygo"),e.play()},this)},t.prototype.play=function(){var e=this;this.sprite.spriteFrame=this.ReadyGo.getSpriteFrame("bg_font_ready"),this.node.runAction(cc.fadeIn(.2));var t=this;this.node.runAction(cc.sequence(cc.scaleTo(2.3,1.5),cc.callFunc(function(){e.sprite.spriteFrame=e.ReadyGo.getSpriteFrame("bg_font_go")}),cc.scaleTo(.1,1),cc.fadeOut(.5),cc.callFunc(function(){a.Game.hasReadygo=!0,a.Game.isStart=!0,t.registerEvent()})))},t.prototype.registerEvent=function(){CELER_X?(celerSDK.onPause(function(){0!=a.Game.isStart&&(console.log(" game on background"),n.gEventMgr.emit(i.GlobalEvent.OPEN_PAUSE))}),celerSDK.onResume(function(){n.gEventMgr.emit(i.GlobalEvent.ON_SHOW)})):(cc.game.on(cc.game.EVENT_HIDE,function(){0!=a.Game.isStart&&(console.log(" game on background"),n.gEventMgr.emit(i.GlobalEvent.OPEN_PAUSE))},this),cc.game.on(cc.game.EVENT_SHOW,function(){console.log(" game on forground"),n.gEventMgr.emit(i.GlobalEvent.ON_SHOW)},this))},__decorate([c(cc.SpriteAtlas)],t.prototype,"ReadyGo",void 0),t=__decorate([l],t)}(cc.Component);o.default=s,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game"}],ResultAnimation:[function(e,t,o){"use strict";cc._RF.push(t,"9c567CEF4pENLRjcHnTQ9NP","ResultAnimation"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./FrameAniBase"),i=cc._decorator,a=i.ccclass,r=i.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.frames=[],t}return __extends(t,e),t.prototype.nextFrame=function(){this.frames&&this.frames.length>0&&(this.Sprite.spriteFrame=this.frames[this.currentIndex],this.callEventFrame(),this.currentIndex=(this.currentIndex+1)%this.frames.length)},t.aniName="ResultAnimation",__decorate([r(cc.SpriteFrame)],t.prototype,"frames",void 0),t=__decorate([a],t)}(n.default);o.default=l,cc._RF.pop()},{"./FrameAniBase":"FrameAniBase"}],ResultLayer:[function(e,t,o){"use strict";cc._RF.push(t,"6cddevafb1BXoHh5PEsKHRP","ResultLayer"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Controller/Game"),i=e("./Const"),a=e("./Controller/EventManager"),r=e("./Controller/EventName"),l=e("./Utils/LogHandler"),c=cc._decorator,s=c.ccclass,u=c.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.Result=null,t.Submit=null,t.Title=null,t.FinalScore=null,t.GameScore=null,t.Bonus=null,t.Equip=null,t.BonusScore=null,t.gameScore=0,t.showGameScore=0,t.bonus=0,t.showBonus=0,t.bonusScore=0,t.showBonusScore=0,t.totalScore=0,t.showTotalScore=0,t.scoreStep=0,t.submit=!1,t.show=!1,t.canSubmit=!1,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;l.LogHandler.inst.dumpFrameInfo(),this.updateScore(),this.Equip.getChildByName("Back").opacity=255,this.Equip.getChildByName("Bird").scale=0,n.Game.treasureCount>0&&(this.Equip.getChildByName("Back").runAction(cc.sequence(cc.delayTime(0),cc.fadeOut(.1))),this.Equip.getChildByName("Bird").runAction(cc.sequence(cc.delayTime(0),cc.scaleTo(.1,1.2),cc.scaleTo(.1,1)))),this.Submit.scale=0,this.Result.scale=0,this.Result.runAction(cc.sequence(cc.scaleTo(.1,1.2),cc.scaleTo(.1,1),cc.callFunc(this.showScore,this))),this.Submit.on(cc.Node.EventType.TOUCH_END,function(){e.canSubmit&&(a.gEventMgr.emit(r.GlobalEvent.PLAY_EFFECT,"button_click"),e.submit||(console.log(" submit score by click:",n.Game.MatchInfo.matchId,", seed:",n.Game.MatchInfo.sharedRandomSeed),CELER_X&&celerSDK.submitScore(n.Game.getScore()),e.submit=!0))},this)},t.prototype.updateScore=function(){this.bonusScore=0,this.bonus=0,this.totalScore=n.Game.getScore(),this.gameScore=n.Game.getPureScore(),this.bonusScore=n.Game.getSocreByType(i.BubbleType.Bird),this.bonus=n.Game.treasureCount,this.scoreStep=Math.max(Math.floor(Math.min(this.totalScore/100,this.gameScore/100)),10)},t.prototype.setTexture=function(e){this.Title.spriteFrame=e},t.prototype.showScore=function(){a.gEventMgr.emit(r.GlobalEvent.PLAY_EFFECT,"over"),this.show=!0},t.prototype.update=function(){var e=this;this.show&&(this.updateScore(),this.showGameScore<this.gameScore&&(this.showGameScore+=this.scoreStep,this.showGameScore=Math.min(this.showGameScore,this.gameScore),this.GameScore.string=this.showGameScore.toString()),this.showBonus<this.bonus&&(this.showBonus+=.1,this.showBonus=Math.min(this.showBonus,this.bonus),this.Bonus.string=Math.floor(this.showBonus).toString()),this.showBonusScore<this.bonusScore&&(this.showBonusScore+=this.scoreStep,this.showBonusScore=Math.min(this.showBonusScore,this.bonusScore),this.BonusScore.string=this.showBonusScore.toString()),this.showGameScore==this.gameScore&&this.showTotalScore<this.totalScore&&(this.showTotalScore+=this.scoreStep,this.showTotalScore=Math.min(this.totalScore,this.showTotalScore),this.FinalScore.string=this.showTotalScore.toString()),this.showTotalScore==this.totalScore&&(this.show=!1,this.Submit.runAction(cc.sequence(cc.scaleTo(.1,1.2),cc.scaleTo(.1,1),cc.callFunc(function(){e.canSubmit=!0,setTimeout(function(){e.submit||(console.log(" submit score by timeout:",n.Game.MatchInfo.matchId,", seed:",n.Game.MatchInfo.sharedRandomSeed),CELER_X&&celerSDK.submitScore(n.Game.getScore()),e.submit=!0)},3e3)},this)))))},__decorate([u(cc.Node)],t.prototype,"Result",void 0),__decorate([u(cc.Node)],t.prototype,"Submit",void 0),__decorate([u(cc.Sprite)],t.prototype,"Title",void 0),__decorate([u(cc.Label)],t.prototype,"FinalScore",void 0),__decorate([u(cc.Label)],t.prototype,"GameScore",void 0),__decorate([u(cc.Label)],t.prototype,"Bonus",void 0),__decorate([u(cc.Node)],t.prototype,"Equip",void 0),__decorate([u(cc.Label)],t.prototype,"BonusScore",void 0),t=__decorate([s],t)}(cc.Component);o.default=h,cc._RF.pop()},{"./Const":"Const","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Utils/LogHandler":"LogHandler"}],ShooterLayer:[function(e,t,o){"use strict";cc._RF.push(t,"a86feZkxotMl5W4gIeRr5Ex","ShooterLayer"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Controller/EventManager"),i=e("./Controller/EventName"),a=e("./Bubble"),r=e("./BubbleMove"),l=e("./Controller/GameFactory"),c=e("./Controller/Game"),s=cc._decorator,u=s.ccclass,h=s.property,p=20,d={0:"bg_pointrainbow",1:"bg_pointblue",2:"bg_pointblue",3:"bg_pointgreen",4:"bg_pointorg",5:"bg_pointpink",6:"bg_pointred",7:"bg_pointyellow",8:"bg_pointwhite",9:"bg_pointboom",10:"bg_pointfire",11:"bg_pointfire"},b={0:"rainbow",1:"blue",2:"blue",3:"green",4:"orange",5:"purple",6:"red",7:"yellow",8:"white",9:"boom",10:"fireball",11:"fireball"},g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ShooterStar=null,t.Shooter=null,t.PointAtlas=null,t.Point=null,t.pointCount=p,t.isStart=!1,t}return __extends(t,e),t.prototype.onLoad=function(){this.ShooterStar.active=!1,this.Point.active=!1,this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},t.prototype.start=function(){},t.prototype.updateStarPosition=function(e){var t=CMath.GetWorldPosition(this.Shooter),o=this.node.getParent().convertToNodeSpaceAR(e),a=CMath.getK(e,t),r=0;if(null===a){var l=t.y<=e.y?1:-1;this.ShooterStar.x=0,this.ShooterStar.y=o.y+150*l,this.updatePoint(a,l)}else{var c=Math.atan(a);l=t.x<=e.x?1:-1;this.ShooterStar.x=o.x+150*Math.cos(c)*l,this.ShooterStar.y=o.y+150*Math.sin(c)*l,this.updatePoint(a,l),c>0?(r=180*(Math.PI/2-c)/Math.PI,l<0&&(r+=180)):(r=180*(-Math.PI/2-c)/Math.PI,l>0&&(r+=180))}return n.gEventMgr.emit(i.GlobalEvent.UPDATE_POINTER_ROTATION,r),e.sub(t)},t.prototype.updatePoint=function(e,t){for(;this.Point.childrenCount>this.pointCount;)l.gFactory.putPoint(this.Point.children[this.Point.childrenCount-1]);for(;this.Point.childrenCount<this.pointCount;)this.Point.addChild(l.gFactory.getPoint());var o=this.Point.childrenCount;if(null===e)for(var n=0;n<o;n++){(c=this.Point.children[n]).x=0,c.y=60*n*t,c.opacity=255-n/o*150,c.getComponent(cc.Sprite).spriteFrame=this.PointAtlas.getSpriteFrame(d[this.Shooter.children[0].getComponent(a.default).Color])}else{var i=Math.atan(e);for(n=0;n<o;n++){var c=this.Point.children[n];this.Point.children[n-1];c.opacity=255-n/o*150,c.x=60*n*Math.cos(i)*t;for(var s=-1==t?1:2;Math.abs(c.x)>=r.BorderX;)c.x-=(Math.abs(c.x)-r.BorderX)*Math.pow(-1,s++)*2;c.x+=0,c.y=60*n*Math.sin(i)*t,c.getComponent(cc.Sprite).spriteFrame=this.PointAtlas.getSpriteFrame(d[this.Shooter.children[0].getComponent(a.default).Color])}}},t.prototype.onTouchStart=function(e){this.Shooter.childrenCount<=0?console.log(" shooter has no bubble"):c.Game.isStart?(this.updateStarPosition(e.getLocation()),this.ShooterStar.active=!0,this.Point.active=!0,this.ShooterStar.getComponent(cc.Sprite).spriteFrame=this.PointAtlas.getSpriteFrame(b[this.Shooter.children[0].getComponent(a.default).Color]),n.gEventMgr.emit(i.GlobalEvent.IS_GREEN_IDLE,!1)):console.log(" game not start ")},t.prototype.onTouchMove=function(e){this.Shooter.childrenCount<=0||c.Game.isStart&&(this.ShooterStar.active=!0,this.Point.active=!0,this.ShooterStar.getComponent(cc.Sprite).spriteFrame=this.PointAtlas.getSpriteFrame(b[this.Shooter.children[0].getComponent(a.default).Color]),this.updateStarPosition(e.getLocation()),n.gEventMgr.emit(i.GlobalEvent.IS_GREEN_IDLE,!1))},t.prototype.onTouchEnd=function(e){if(c.Game.isStart)if(this.ShooterStar.active=!1,this.Point.active=!1,this.Shooter.childrenCount<=0)console.log(" shooter has no bubble, on touchend");else{var t=this.updateStarPosition(e.getLocation());this.ShooterStar.y>=-700?(console.log("\u53d1\u9001\u53d1\u5c04\u4e8b\u4ef6"),n.gEventMgr.emit(i.GlobalEvent.SHOOT,t)):console.log(" \u53d1\u5c04\u89d2\u5ea6\u4e0d\u5728\u6709\u6548\u8303\u56f4"),n.gEventMgr.emit(i.GlobalEvent.IS_GREEN_IDLE,!0)}else console.log(" on touch end ,is not start")},__decorate([h(cc.Node)],t.prototype,"ShooterStar",void 0),__decorate([h(cc.Node)],t.prototype,"Shooter",void 0),__decorate([h(cc.SpriteAtlas)],t.prototype,"PointAtlas",void 0),__decorate([h(cc.Node)],t.prototype,"Point",void 0),t=__decorate([u],t)}(cc.Component);o.default=g,cc._RF.pop()},{"./Bubble":"Bubble","./BubbleMove":"BubbleMove","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Controller/GameFactory":"GameFactory"}],Signal:[function(e,t,o){"use strict";cc._RF.push(t,"1d887L8WQZKNbLn/jQjfYEq","Signal"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.listenerMap=[],t.onceListenerMap=[],t}return __extends(t,e),t.prototype.doDispatch=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.excuteListener.apply(this,e),this.excuteOnce.apply(this,e)},t.prototype.excuteListener=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(this.listenerMap&&this.listenerMap.length>0)for(var o=0,n=this.listenerMap;o<n.length;o++){var i=n[o];i.callback.apply(i.target,e)}},t.prototype.excuteOnce=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(this.onceListenerMap&&this.onceListenerMap.length>0){for(var o=0,n=this.onceListenerMap;o<n.length;o++){var i=n[o];i.callback.apply(i.target,e)}this.onceListenerMap.length=0}},t.prototype.listen=function(e,t){this.listenerMap.push({callback:e,target:t})},t.prototype.listenOnce=function(e,t){this.onceListenerMap.push({callback:e,target:t})},t.prototype.removeListener=function(e,t){if(this.listenerMap&&this.listenerMap.length>0)for(var o=0;o<this.listenerMap.length;++o){var n=this.listenerMap[o];n.callback==e&&n.target==t&&(this.listenerMap.splice(o,1),--o)}},t.prototype.removeTarget=function(e){if(this.listenerMap&&this.listenerMap.length>0)for(var t=0;t<this.listenerMap.length;++t){this.listenerMap[t].target==e&&(this.listenerMap.splice(t,1),--t)}},t.prototype.dispatch=function(){this.doDispatch(null)},t.prototype.dispatchOne=function(e){this.doDispatch(e)},t.prototype.dispatchTwo=function(e,t){this.doDispatch(e,t)},t.prototype.dispatchThree=function(e,t,o){this.doDispatch(e,t,o)},t.prototype.dispatchFour=function(e,t,o,n){this.doDispatch(e,t,o,n)},t.prototype.dispatchFive=function(e,t,o,n,i){this.doDispatch(e,t,o,n,i)},t.prototype.addListener=function(e,t){this.listen(e,t)},t.prototype.addOnce=function(e,t){this.listenOnce(e,t)},t.prototype.addListenerOne=function(e,t){this.listen(e,t)},t.prototype.addListenerTwo=function(e,t){this.listen(e,t)},t.prototype.addListenerThree=function(e,t){this.listen(e,t)},t.prototype.addListenerFour=function(e,t){this.listen(e,t)},t.prototype.addListenerFive=function(e,t){this.listen(e,t)},t.prototype.addOnceOne=function(e,t){this.listenOnce(e,t)},t.prototype.addOnceTwo=function(e,t){this.listenOnce(e,t)},t.prototype.addOnceThree=function(e,t){this.listenOnce(e,t)},t.prototype.addOnceFour=function(e,t){this.listenOnce(e,t)},t.prototype.addOnceFive=function(e,t){this.listenOnce(e,t)},t}(e("./ToSingleton").SingleTon());o.BaseSignal=n,cc._RF.pop()},{"./ToSingleton":"ToSingleton"}],StartButton:[function(e,t,o){"use strict";cc._RF.push(t,"1b320qWv9lJjqxUKlPWL5Sm","StartButton"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Controller/Game"),i=e("./Controller/EventManager"),a=e("./Controller/EventName"),r=cc._decorator,l=r.ccclass,c=(r.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onLoad=function(){var e=this;this.node.scale=1,i.gEventMgr.on(a.GlobalEvent.SHOW_START,function(t){e.node.getParent().active=t,e.node._touchid=null},this),this.node.on(cc.Node.EventType.TOUCH_END,function(){i.gEventMgr.emit(a.GlobalEvent.PLAY_EFFECT,"button_click"),setTimeout(function(){if(0==n.Game.hasReadygo)return console.log(" has ready go false"),void setTimeout(function(){i.gEventMgr.emit(a.GlobalEvent.READY_GO)},0)},0),e.node.getParent().removeFromParent(!0)},this)},t.prototype.start=function(){},t=__decorate([l],t)}(cc.Component));o.default=c,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game"}],StepController:[function(e,t,o){"use strict";cc._RF.push(t,"09ac2ySMaBKF6e+GcvfUxR0","StepController"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){this.totalStep=[],this.curStep=[]}return Object.defineProperty(e,"inst",{get:function(){return this._ins?this._ins:this._ins=new e},enumerable:!0,configurable:!0}),e.prototype.register=function(e,t){this.completeCallback=e,this.totalStep=t},e.prototype.nextStep=function(e){this.totalStep.indexOf(e)<0?console.error(" \u6ca1\u6709\u8fd9\u4e00\u6b65\uff1a",e):this.curStep.indexOf(e)>=0?console.error(" \u6b65\u9aa4\u5df2\u5b8c\u6210\uff1a",e):(this.curStep.push(e),this.curStep.sort(function(e,t){return e>t?-1:1}),this.totalStep.sort(function(e,t){return e>t?-1:1}),console.log(" cur step:",this.curStep.join(",")),console.log(" total step:",this.totalStep.join(",")),this.curStep.join(",")==this.totalStep.join(",")&&(this.totalStep.length=0,this.completeCallback(),this.completeCallback=null))},e}();o.gStep=n.inst,cc._RF.pop()},{}],SuperHorceAni:[function(e,t,o){"use strict";cc._RF.push(t,"1aa15GeVWdLs6SMx7rN7ubY","SuperHorceAni"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./FrameAniBase"),i=e("./Controller/EventManager"),a=e("./Controller/EventName"),r=cc._decorator,l=r.ccclass,c=(r.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),i.gEventMgr.on(a.GlobalEvent.HORCE_CLEAR,function(){t.play(),t.node.opacity=255},this)},t.prototype.onComplete=function(){this.node.runAction(cc.fadeOut(.2))},t.aniName="SuperHorceAni",t=__decorate([l],t)}(n.default));o.default=c,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./FrameAniBase":"FrameAniBase"}],ToSingleton:[function(e,t,o){"use strict";cc._RF.push(t,"0b717hJnuhFk4sfelXowcMt","ToSingleton"),Object.defineProperty(o,"__esModule",{value:!0}),o.SingleTon=function(){return function(){function e(){}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new this},enumerable:!0,configurable:!0}),e}()},cc._RF.pop()},{}],Treasure:[function(e,t,o){"use strict";cc._RF.push(t,"839c8WNoRJFOZY4LdvRkdlU","Treasure"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Controller/Game"),i=e("./Const"),a=e("./Controller/EventManager"),r=e("./Controller/EventName"),l=cc._decorator,c=l.ccclass,s=(l.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isCollider=!0,t}return __extends(t,e),Object.defineProperty(t.prototype,"Self",{get:function(){return this.node.getChildByName("self")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Alpha",{get:function(){return this.node.getChildByName("alpha")},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){var e=this;this.node.group="default",this.node.opacity=255,this.Alpha.opacity=255,a.gEventMgr.on(r.GlobalEvent.CHECK_TREASURE,function(){n.Game.isStart&&e.checkCollider()},this)},t.prototype.update=function(){},t.prototype.checkCollider=function(){this.isCollider=!1;for(var e=n.Game.getMatrix(),t=n.Game.startIndex;t<e.data.length;t++)if(e.data[t]&&e.data[t].bubble&&e.data[t].bubble.node.active){var o=e.data[t].bubble;if(cc.Intersection.polygonCircle(this.getComponent(cc.PolygonCollider).points,{position:CMath.ConvertToNodeSpaceAR(o.node,this.node.getParent()),radius:o.getComponent(cc.CircleCollider).radius})){this.isCollider=!0;break}}this.isCollider||(a.gEventMgr.targetOff(this),n.Game.treasureCount++,console.log(" treasureCount:",n.Game.treasureCount),n.Game.treasureCount,this.getTreasure(n.Game.treasureCount))},t.prototype.getTreasure=function(e){var t=this,o=CMath.ConvertToNodeSpaceAR(n.Game.TopNode.getChildByName("TreasureRoot").getChildByName(n.Game.treasureCount.toString()),this.node.getParent()),l=CMath.Distance(o,this.node.position)/1500;this.enabled=!1,this.node.group="treasure",a.gEventMgr.emit(r.GlobalEvent.PLAY_EFFECT,"get_treasure"),this.Alpha.runAction(cc.sequence(cc.delayTime(.3),cc.spawn(cc.scaleTo(.2,5),cc.fadeOut(.2)))),this.Self.runAction(cc.sequence(cc.delayTime(.1),cc.scaleTo(.1,2),cc.delayTime(.3),cc.callFunc(function(){n.Game.addScore(i.BubbleType["Treasure_"+e],i.BubbleType["Treasure_"+e],i.BubbleType["Treasure_"+e]/200*.1+1,CMath.ConvertToNodeSpaceAR(t.Self,n.Game.TopNode))}),cc.scaleTo(.1,1),cc.moveTo(l,o),cc.fadeTo(.1,0),cc.callFunc(function(){a.gEventMgr.emit(r.GlobalEvent.GET_TREASURE,e),t.node.removeFromParent()})))},t=__decorate([c],t)}(cc.Component));o.default=s,cc._RF.pop()},{"./Const":"Const","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game"}]},{},["Bird","Bubble","BubbleBurst","BubbleChange","BubbleDrop","BubbleHorce","BubbleIdle","BubbleMove","Const","AudioController","EventManager","EventName","Game","GameFactory","GameSignal","StepController","BubbleMatrix","FrameAniBase","GameScene","Guide","LoadingImg","PauseLayer","Pointer","Psiton","ReadyGoAnimation","ResultAnimation","ResultLayer","BlueIdle","BlueLoad","GreenIdle","HandUpLeft","HandUpRight","ShooterLayer","StartButton","SuperHorceAni","Treasure","HashMap","LogHandler","NumberChangedView","Signal","ToSingleton","ChacknCountView","ChacknScoreView"]);