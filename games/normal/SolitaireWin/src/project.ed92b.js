window.__require=function e(t,o,n){function a(i,l){if(!o[i]){if(!t[i]){var s=i.split("/");if(s=s[s.length-1],!t[s]){var c="function"==typeof __require&&__require;if(!l&&c)return c(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+i+"'")}}var u=o[i]={exports:{}};t[i][0].call(u.exports,function(e){return a(t[i][1][e]||e)},u,u.exports,e,t,o,n)}return o[i].exports}for(var r="function"==typeof __require&&__require,i=0;i<n.length;i++)a(n[i]);return a}({AudioController:[function(e,t,o){"use strict";cc._RF.push(t,"c3611jDu5hL7auVf9iIBCz5","AudioController"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../Utils/HashMap"),a=e("./EventManager"),r=e("./EventName"),i="sounds/";window.oncanplay&&(window.oncanplay=function(){l.canPlay=!0});var l=function(){function e(){this.audioID={},this.clips=new n.HashMap}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.init=function(e){console.warn(" start load AudioClip ");var t=this;cc.loader.loadResDir(i,cc.AudioClip,function(o,n,a){if(o)console.error(o);else{for(var r=0,i=n;r<i.length;r++){var l=i[r];0,t.clips.add(l.name,l)}t.initEvent(),e&&e()}})},e.prototype.initEvent=function(){var e=this;a.gEventMgr.targetOff(this),this.playMusic("bgm"),a.gEventMgr.on(r.GlobalEvent.CHANGE_BGM,function(t){e.playMusic(t)},this),a.gEventMgr.on(r.GlobalEvent.PLAY_EFFECT,function(t){e.playEffect(t)},this)},e.prototype.playEffect=function(t,o){var n=this;if(void 0===o&&(o=!1),e.canPlay){if(!(cc.audioEngine.getEffectsVolume()<=.05)){var a=this.clips.get(t);a?this.audioID[t]=cc.audioEngine.playEffect(a,o):cc.loader.loadRes(i+t,cc.AudioClip,function(e,a){e?console.error(e):(n.clips.add(a.name,a),n.audioID[t]=cc.audioEngine.playEffect(a,o))})}}else this.bindTouch()},e.prototype.playMusic=function(t,o){var n=this;if(void 0===o&&(o=!0),!e.canPlay)return this.bindTouch(),void e.PlayedList.push({loop:!0,volume:1,clipName:t,supTime:Date.now(),skip:!1,isBgm:!0});var a=this.clips.get(t);a?cc.audioEngine.playMusic(a,o):cc.loader.loadRes(i+t,cc.AudioClip,function(e,t){e?console.error(e):("string"==typeof t._audio&&cc.loader._cache&&cc.loader._cache[t._audio]&&cc.loader._cache[t._audio].buffer&&(t._audio=cc.loader._cache[t._audio].buffer),n.clips.add(t.name,t),cc.audioEngine.playMusic(t,o))})},e.prototype.bindTouch=function(){if(!e.hasBindTouch){var t=this,o=function(){var n;for(cc.game.canvas.removeEventListener("touchstart",o),e.canPlay=!0;(n=e.PlayedList.pop())&&t.clips.get(n.clipName)&&!n.skip;)cc.audioEngine.playMusic(t.clips.get(n.clipName),n.loop)};e.hasBindTouch=!0,cc.game.canvas.addEventListener("touchstart",o)}},e.PlayedList=[],e.canPlay=!1,e.hasBindTouch=!1,e}();o.gAudio=l.inst,cc._RF.pop()},{"../Utils/HashMap":"HashMap","./EventManager":"EventManager","./EventName":"EventName"}],BlueIdle:[function(e,t,o){"use strict";cc._RF.push(t,"20036nLdjNApYvTy8Xi4ECH","BlueIdle"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../../FrameAniBase"),a=cc._decorator,r=a.ccclass,i=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onLoad=function(){e.prototype.onLoad.call(this)},t.aniName="BlueIdle",t=__decorate([r],t)}(n.default));o.default=i,cc._RF.pop()},{"../../FrameAniBase":"FrameAniBase"}],BlueLoad:[function(e,t,o){"use strict";cc._RF.push(t,"08214k9+Y1NIr0C3aDpVb67","BlueLoad"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../../FrameAniBase"),a=e("../../Controller/EventManager"),r=e("../../Controller/EventName"),i=cc._decorator,l=i.ccclass,s=(i.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),a.gEventMgr.on(r.GlobalEvent.PLAY_LOAD,function(){t.play()},this)},t.prototype.onKeyFrame=function(e){8==e&&a.gEventMgr.emit(r.GlobalEvent.BUBBLE_LOAD)},t.prototype.start=function(){},t.aniName="BlueLoad",t=__decorate([l],t)}(n.default));o.default=s,cc._RF.pop()},{"../../Controller/EventManager":"EventManager","../../Controller/EventName":"EventName","../../FrameAniBase":"FrameAniBase"}],BubbleBurst:[function(e,t,o){"use strict";cc._RF.push(t,"2a3f2DDgVZNpIG4fasOghMK","BubbleBurst"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../FrameAniBase"),a=cc._decorator,r=a.ccclass,i=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.play=function(){e.prototype.play.call(this)},t.aniName="BubbleBurst",t=__decorate([r],t)}(n.default));o.default=i,cc._RF.pop()},{"../FrameAniBase":"FrameAniBase"}],BubbleChange:[function(e,t,o){"use strict";cc._RF.push(t,"3a817znFDhDCaEwLpCddbyw","BubbleChange"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../FrameAniBase"),a=cc._decorator,r=a.ccclass,i=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.play=function(){e.prototype.play.call(this)},t.aniName="BubbleChange",t=__decorate([r],t)}(n.default));o.default=i,cc._RF.pop()},{"../FrameAniBase":"FrameAniBase"}],BubbleDrop:[function(e,t,o){"use strict";cc._RF.push(t,"623af7xlK1EQ4Szsrycvrsz","BubbleDrop"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../FrameAniBase"),a=cc._decorator,r=a.ccclass,i=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.play=function(){e.prototype.play.call(this)},t.aniName="BubbleDrop",t=__decorate([r],t)}(n.default));o.default=i,cc._RF.pop()},{"../FrameAniBase":"FrameAniBase"}],BubbleHorce:[function(e,t,o){"use strict";cc._RF.push(t,"dc741sapJBNlKYdfySF/Y71","BubbleHorce"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../FrameAniBase"),a=cc._decorator,r=a.ccclass,i=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.play=function(){e.prototype.play.call(this)},t.aniName="BubbleHorce",t=__decorate([r],t)}(n.default));o.default=i,cc._RF.pop()},{"../FrameAniBase":"FrameAniBase"}],BubbleIdle:[function(e,t,o){"use strict";cc._RF.push(t,"97381k3pDhIrLdCJF11xOn7","BubbleIdle"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../FrameAniBase"),a=cc._decorator,r=a.ccclass,i=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.play=function(){e.prototype.play.call(this)},t.aniName="BubbleIdle",t=__decorate([r],t)}(n.default));o.default=i,cc._RF.pop()},{"../FrameAniBase":"FrameAniBase"}],BubbleMatrix:[function(e,t,o){"use strict";cc._RF.push(t,"3fc87k3ArdNNIwVYgSiAJGh","BubbleMatrix"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../Const"),a=e("../Controller/Game");o.MatrixSize=15,o.UseSize=11,o.IndexJStart=(o.MatrixSize-o.UseSize)/2,o.IndexJEnd=o.UseSize+1;var r;(function(e){e[e.Normal=0]="Normal",e[e.Double=1]="Double",e[e.Boom=2]="Boom",e[e.Magic=3]="Magic",e[e.Horce=4]="Horce"})(r=o.SpecialType||(o.SpecialType={}));var i=function(){function e(){this.matrixData=[],this.addRowTotalCount=0,this.firstRow=0;for(var e=0;e<o.MatrixSize*o.MatrixSize;e++)this.matrixData[e]={color:n.BubbleType.Blank,bubble:null,type:r.Normal}}return Object.defineProperty(e.prototype,"data",{get:function(){return this.matrixData},enumerable:!0,configurable:!0}),e.prototype.addRow=function(e){var t=this.matrixData.length;this.matrixData.length+=e*o.MatrixSize;for(var a=t;a<this.matrixData.length;a++)this.matrixData[a]={color:n.BubbleType.Blank,bubble:null,type:r.Normal}},e.prototype.getRestRowCount=function(){return this.addRowTotalCount},e.prototype.getFirstRow=function(){return this.firstRow},e.prototype.moveRow=function(e){if(this.addRowTotalCount<=e){this.addRow(6),this.firstRow+=5,a.Game.startIndex+=5*o.MatrixSize,this.addRowTotalCount+=6;var t=6*o.MatrixSize;console.log(" \u65b0\u589e6\u884c\uff1a ",t,", total length:",this.data.length);for(var i=this.matrixData.length-1;i>=t;i--)this.matrixData[i-t]||(this.matrixData[i-t]={color:n.BubbleType.Blank,bubble:null,type:r.Normal}),this.matrixData[i].color=this.matrixData[i-t].color,this.matrixData[i].type=this.matrixData[i-t].type,this.matrixData[i].bubble=this.matrixData[i-t].bubble,this.matrixData[i-t]={color:n.BubbleType.Blank,bubble:null,type:r.Normal},this.matrixData[i].bubble&&this.matrixData[i].bubble.setIndex(i);var l=Math.ceil(CMath.getRandom(n.DoubleBubbleRange.Min,n.DoubleBubbleRange.Max)),s=Math.ceil(CMath.getRandom(n.BoomBubbleRange.Min,n.BoomBubbleRange.Max)),c=Math.ceil(CMath.getRandom(n.MagicBubbleRange.Min,n.MagicBubbleRange.Max));console.log(" double:",l,", boom:",s,", magic:",c);var u=[];for(i=0;i<=t-1;i++)this.index2j(i)>=o.IndexJStart&&this.index2j(i)<=o.IndexJEnd&&u.push(i);for(var h=n.BubbleColors.concat(),d={};l>0&&h.length>0&&u.length>=0;){var p=u[v=Math.floor(CMath.getRandom(0,u.length))];u.splice(v,1);var b=h[m=Math.floor(CMath.getRandom(0,h.length))];h.splice(m,1),d[p]=b,l--}console.log(" ---------- \u53cc\u500d\u7403 --------------"),console.log(d);for(var g=n.BubbleColors.concat(),f={};s>0&&g.length>0&&u.length>=0;){p=u[v=Math.floor(CMath.getRandom(0,u.length))];u.splice(v,1);var m;b=g[m=Math.floor(CMath.getRandom(0,g.length))];g.splice(m,1),f[p]=b,s--}console.log(" ---------- \u70b8\u5f39\u7403 --------------"),console.log(f);for(var y={};c>0&&u.length>=0;){var v;p=u[v=Math.floor(CMath.getRandom(0,u.length))];u.splice(v,1),y[p]=n.BubbleType.Blank,c--}console.log(" ---------- \u9b54\u6cd5\u7403 --------------"),console.log(y);for(i=0;i<t-1;i++)this.matrixData[i].color=n.BubbleColors[Math.floor(CMath.getRandom()*n.BubbleColors.length)],this.matrixData[i].bubble=null,this.matrixData[i].type=r.Normal,null!=d[i]&&(this.matrixData[i].type=r.Double,this.matrixData[i].color=d[i]),null!=y[i]&&(this.matrixData[i].type=r.Magic,this.matrixData[i].color=y[i]),null!=f[i]&&(this.matrixData[i].type=r.Boom,this.matrixData[i].color=f[i])}else this.firstRow-=1,a.Game.startIndex-=o.MatrixSize;this.addRowTotalCount-=e,console.log(" \u5269\u4f59 ",this.addRowTotalCount," \u884c\u6570\u636e",", \u7b2c\u4e00\u884c\uff1a",this.firstRow,this.index2i(a.Game.startIndex))},e.prototype.ij2index=function(e,t){return e*o.MatrixSize+t},e.prototype.index2i=function(e){return Math.floor(e/o.MatrixSize)},e.prototype.index2j=function(e){return e%o.MatrixSize},e.prototype.getUseIndexStart=function(){return(o.MatrixSize-o.UseSize)/2*(o.MatrixSize+1)-1},e.prototype.getUseIndexEnd=function(){return o.MatrixSize*o.MatrixSize-this.getUseIndexStart()-1},e.prototype.getPosOfIndex=function(e){var t=this.index2i(e),o=this.index2j(e);return this.getPosOfij(t,o)},e.prototype.getPosOfij=function(e,t){var r=cc.v2(0,0);return r.x=(t-o.MatrixSize/2)*n.BubbleSize.width+(e+this.firstRow+a.Game.getMoveTimes())%2*n.BubbleSize.width/2+n.BubbleXOffset,r.y=(o.MatrixSize/2-e+a.Game.getMoveTimes()+this.firstRow-this.index2i(n.InitStartIndex))*(n.BubbleSize.height+n.BubbleHeightOffset)+n.BubbleYOffset,r},e.prototype.getNeiborMatrix=function(e,t,n){void 0===n&&(n=!1);for(var r=[],i=this.index2i(e),l=a.Game.getMoveTimes()+this.firstRow,s=0;s<=t;s++){var c=i+s,u=i%2==c%2,h=t-Math.floor(s/2);h=Math.min(h,t);for(var d=0;d<=h;d++){var p,b=e+s*o.MatrixSize+d,g=e-s*o.MatrixSize+d,f=e+s*o.MatrixSize-d,m=e-s*o.MatrixSize-d;if(e!=b&&r.indexOf(b)<0&&b>=0&&(b<this.matrixData.length||n))if(u||(c+l)%2==0||d<h)(p=this.index2j(b))>=o.IndexJStart&&p<=o.IndexJEnd&&b>=a.Game.startIndex&&(this.data[b]&&this.data[b].bubble&&!n?r.push(b):!n||this.data[b]&&this.data[b].bubble||r.push(b));if(e!=g&&r.indexOf(g)<0&&g>=0&&(g<this.matrixData.length||n))(p=this.index2j(g))>=o.IndexJStart&&p<=o.IndexJEnd&&g>=a.Game.startIndex&&(u||(c+l)%2==0||d<h)&&(this.data[g]&&this.data[g].bubble&&!n?r.push(g):!n||this.data[g]&&this.data[g].bubble||r.push(g));if(e!=f&&r.indexOf(f)<0&&f>=0&&(f<this.matrixData.length||n))(p=this.index2j(f))>=o.IndexJStart&&p<=o.IndexJEnd&&f>=a.Game.startIndex&&(u||(c+l)%2||d<h)&&(this.data[f]&&this.data[f].bubble&&!n?r.push(f):!n||this.data[f]&&this.data[f].bubble||r.push(f));if(e!=m&&r.indexOf(m)<0&&m>=0&&(m<this.matrixData.length||n))(p=this.index2j(m))>=o.IndexJStart&&p<=o.IndexJEnd&&m>=a.Game.startIndex&&(u||(c+l)%2||d<h)&&(this.data[m]&&this.data[m].bubble&&!n?r.push(m):!n||this.data[m]&&this.data[m].bubble||r.push(m))}}return r.sort(function(e,t){return e-t}),r},e.prototype.initBubbleData=function(){console.log(" init bubble data :",a.Game.MatchInfo.matchId,", seed:",a.Game.MatchInfo.sharedRandomSeed);var e=this.getUseIndexStart(),t=this.getUseIndexEnd();this.firstRow=this.index2i(a.Game.startIndex),this.addRowTotalCount=0;var i=Math.ceil(CMath.getRandom(n.DoubleBubbleInitRange.Min,n.DoubleBubbleInitRange.Max)),l=Math.ceil(CMath.getRandom(n.BoomBubbleInitRange.Min,n.BoomBubbleInitRange.Max)),s=Math.ceil(CMath.getRandom(n.MagicBubbleInitRange.Min,n.MagicBubbleInitRange.Max));console.log("start:",e,", end:",t,", firstRow:",this.firstRow),console.log(" double:",i,", boom:",l,", magic:",s);for(var c=[],u=a.Game.startIndex;u<=t;u++)this.index2j(u)>=o.IndexJStart&&this.index2j(u)<=o.IndexJEnd&&c.push(u);for(var h=n.BubbleColors.concat(),d={};i>0&&c.length>=0;){var p=c[v=Math.floor(CMath.getRandom(0,c.length))];c.splice(v,1);var b=h[m=Math.floor(CMath.getRandom(0,h.length))];h.splice(m,1),d[p]=b,i--,h.length<=0&&(h=n.BubbleColors.concat())}console.log(" ---------- \u53cc\u500d\u7403 --------------"),console.log(d);for(var g=n.BubbleColors.concat(),f={};l>0&&c.length>=0;){p=c[v=Math.floor(CMath.getRandom(0,c.length))];c.splice(v,1);var m;b=g[m=Math.floor(CMath.getRandom(0,g.length))];g.splice(m,1),f[p]=b,l--,g.length<=0&&(g=n.BubbleColors.concat())}console.log(" ---------- \u70b8\u5f39\u7403 --------------"),console.log(f);for(var y={};s>0&&c.length>=0;){var v;p=c[v=Math.floor(CMath.getRandom(0,c.length))];c.splice(v,1),y[p]=n.BubbleType.Blank,s--}console.log(" ---------- \u9b54\u6cd5\u7403 --------------"),console.log(y);for(u=e;u<=t;u++){for(var _=this.getNeiborMatrix(u,1),C=[],S=0,B=_;S<B.length;S++){var M=B[S];this.matrixData[M].color!=n.BubbleType.Blank&&C.push(this.matrixData[M])}var E=this.getOtherColors(C);CMath.getRandom()<=.8&&E.length>0?this.matrixData[u].color=E[Math.floor(CMath.getRandom()*E.length)]:this.matrixData[u].color=n.BubbleColors[Math.floor(CMath.getRandom()*n.BubbleColors.length)];for(var T=0;T<_.length;T++){M=_[T];if(this.matrixData[M].color==n.BubbleType.Blank)if(CMath.getRandom()<=.8)this.matrixData[M]=this.matrixData[u];else{var x=this.getOtherColors([this.matrixData[u].color]);this.matrixData[M].color=x[Math.floor(CMath.getRandom()*x.length)]}for(var A=this.getNeiborMatrix(M,1),R=0;R<A.length;R++){var F=A[R];if(this.matrixData[F].color==n.BubbleType.Blank)if(CMath.getRandom()<=.8-.7&&this.matrixData[M]==this.matrixData[u])this.matrixData[F]=this.matrixData[M];else{var P=this.getOtherColors([this.matrixData[u].color,this.matrixData[M].color]);this.matrixData[F].color=P[Math.floor(CMath.getRandom()*P.length)]}}}}for(u=0;u<this.matrixData.length;u++)this.matrixData[u].color==n.BubbleType.Blank&&(this.matrixData[u].color=n.BubbleColors[Math.floor(CMath.getRandom()*n.BubbleColors.length)]),this.matrixData[u].type=r.Normal,null!=d[u]&&(this.matrixData[u].type=r.Double,this.matrixData[u].color=d[u]),null!=y[u]&&(this.matrixData[u].type=r.Magic,this.matrixData[u].color=y[u]),null!=f[u]&&(this.matrixData[u].type=r.Boom,this.matrixData[u].color=f[u]);console.log(" init bubble data done!"),console.log(this.matrixData.length)},e.prototype.getOtherColors=function(e){for(var t=n.BubbleColors.concat(),o=0,a=e;o<a.length;o++){var r=a[o],i=t.indexOf(r);i<0||t.splice(i,1)}return t},e}();o.BubbleMatrix=i,cc._RF.pop()},{"../Const":"Const","../Controller/Game":"Game"}],BubbleMove:[function(e,t,o){"use strict";cc._RF.push(t,"f122cLSg0BF5pRoYWwgPS74","BubbleMove"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Bubble"),a=e("./Controller/EventManager"),r=e("./Controller/EventName"),i=e("./Controller/Game"),l=e("./Const"),s=e("./Controller/GameFactory"),c=e("./Data/BubbleMatrix"),u=e("./BubbleAnimation/BubbleChange"),h=e("./BubbleAnimation/BubbleDrop"),d=cc._decorator,p=d.ccclass;d.property;o.BorderX=455;o.DropBorder=-667,o.CollsionFactor=.3,o.CollsionOffset=40,o.CollsionMinFactor=.01;var b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.speed=cc.v2(0,0),t.acceleration=cc.v2(0,0),t.hasCollision=!1,t.shooted=!1,t.isDrop=!1,t.animationCallback={},t}return __extends(t,e),Object.defineProperty(t.prototype,"bubble",{get:function(){return this.getComponent(n.default)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radis",{get:function(){return l.BubbleSize.width/2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isShooterState",{get:function(){return"Shooter"==this.node.getParent().name&&this.node.getNumberOfRunningActions()<=0&&!this.hasCollision&&this.shooted},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isReady2Shoot",{get:function(){return"Shooter"==this.node.getParent().name&&this.node.getNumberOfRunningActions()<=0},enumerable:!0,configurable:!0}),t.prototype.checkBorder=function(){this.isDrop||(this.node.x<=-o.BorderX||this.node.x>=o.BorderX)&&(this.node.x=this.node.x>0?o.BorderX:-o.BorderX,this.speed.x=-this.speed.x,this.acceleration.x=-this.acceleration.x)},t.prototype.forceMove=function(e){var t=this.node.getActionByTag(n.BubbleAction.Collision);if(!t||t.isDone()){var o=cc.sequence(cc.moveBy(.1,e).easing(cc.easeQuadraticActionIn()),cc.moveBy(.1,e.mul(-1)).easing(cc.easeQuadraticActionOut()));o.setTag(n.BubbleAction.Collision),this.node.runAction(o)}},t.prototype.checkCollisionBubble=function(){var e=this;if(this.isShooterState&&!this.isDrop)for(var t=i.Game.getCollisionIndexes(),o=i.Game.getMatrix(),n=function(t){var n=o.data[t].bubble;if(!n)return console.warn(" bubble \u4e0d\u5b58\u5728\uff01"),"continue";var s=CMath.ConvertToNodeSpaceAR(l.node,n.node.parent);if(CMath.Distance(s,n.node.position)<=2*l.radis*.8){var h=o.getNeiborMatrix(t,1,!0),d=-1,p=100;console.log("\u78b0\u5230\uff1a",t),console.log(h);for(var b=0,g=h;b<g.length;b++){var f=g[b],m=o.index2i(f),y=o.index2j(f),v=o.getPosOfij(m,y);CMath.Distance(v,s)<p&&(p=CMath.Distance(v,s),d=f)}return l.bubble.Type==c.SpecialType.Magic?n.Type!=c.SpecialType.Magic&&n.node.active&&(l.bubble.setColor(n.Color,c.SpecialType.Normal),a.gEventMgr.emit(r.GlobalEvent.PLAY_EFFECT,"change_color"),l.bubble.playAnimation(u.default,function(){e.bubble.AnimationRoot.runAction(cc.fadeOut(.1))})):n.Type==c.SpecialType.Magic&&n.node.active&&l.bubble.Type!=c.SpecialType.Horce&&(n.setColor(l.bubble.Color,l.bubble.Type),n.playAnimation(u.default,function(){n.AnimationRoot.runAction(cc.fadeOut(.1))}),a.gEventMgr.emit(r.GlobalEvent.PLAY_EFFECT,"change_color")),n.onCollision(),a.gEventMgr.emit(r.GlobalEvent.BUBBLE_FORCE,d),d<0?console.error(" target index -1"):l.onCollision(d,function(){i.Game.checkClear(e.bubble.getIndex(),e.bubble,n),i.Game.updateCollisionIndexes(),a.gEventMgr.emit(r.GlobalEvent.NEXT_BUBBLE)}),{value:void 0}}},l=this,s=0,h=t;s<h.length;s++){var d=n(h[s]);if("object"==typeof d)return d.value}},t.prototype.onCollision=function(e,t){console.log(" on collision:",e);var o=Math.abs(this.speed.x/this.speed.y),n=0==o||isNaN(o)?1.2:1/o,a=1/n;this.speed.x=0,this.speed.y=0,this.acceleration.x=0,this.acceleration.y=0,this.hasCollision=!0;var r=i.Game.getMatrix(),l=r.index2i(e),s=r.index2j(e),c=r.getPosOfij(l,s),u=CMath.ConvertToNodeSpaceAR(this.node,i.Game.BubbleLayer);this.node.x=u.x,this.node.y=u.y,this.node.setParent(i.Game.BubbleLayer),this.node.stopAllActions(),this.scaleBubble(n,a),this.bubble.setIndex(e),this.node.runAction(cc.sequence(cc.moveTo(.1,c),cc.callFunc(function(){t&&t(),i.Game.checkOutOfMove()},this)))},t.prototype.scaleBubble=function(e,t){e=CMath.Clamp(e,1.2,.8),t=CMath.Clamp(t,1.2,.8),this.node.runAction(cc.sequence(cc.scaleTo(.1,e,t),cc.scaleTo(.1,1,1)))},t.prototype.initEvent=function(){a.gEventMgr.targetOff(this),a.gEventMgr.on(r.GlobalEvent.BUBBLE_FORCE,this.force,this)},t.prototype.readyToShoot=function(){a.gEventMgr.on(r.GlobalEvent.SHOOT,this.shoot,this)},t.prototype.unreadyToShoot=function(){a.gEventMgr.off(r.GlobalEvent.SHOOT)},t.prototype.force=function(e){var t=this.bubble.getIndex();if(t!=e){var n=i.Game.getMatrix(),a=n.getPosOfIndex(e),r=n.getPosOfIndex(t),l=CMath.Distance(a,r),s=Math.ceil(l/(2*this.radis)),c=Math.pow(o.CollsionFactor,Math.max(0,s-1));this.forceMove(r.sub(a).normalize().mul(c*o.CollsionOffset))}},t.prototype.reuse=function(){this.node.getChildByName("Bubble").color=cc.Color.WHITE,this.initEvent(),this.hasCollision=!1,this.isDrop=!1,this.speed=cc.v2(0,0),this.acceleration=cc.v2(0,0),this.shooted=!1,this.node.group="default"},t.prototype.unuse=function(){this.enabled=!1,this.shooted=!1,this.isDrop=!1,a.gEventMgr.targetOff(this)},t.prototype.shoot=function(e){a.gEventMgr.off(r.GlobalEvent.SHOOT),console.log("\u53d1\u5c04\uff01"),a.gEventMgr.emit(r.GlobalEvent.PLAY_EFFECT,"shoot"),this.enabled=!0,this.shooted=!0,e.normalizeSelf(),this.speed.x=4800*e.x,this.speed.y=4800*e.y,this.acceleration.x=800*e.x,this.acceleration.y=800*e.y},t.prototype.isShooted=function(){return this.shooted},t.prototype.drop=function(){this.isDrop=!0,this.enabled=!0,this.speed.y=800+CMath.getRandom(0,1e3),this.acceleration.y=4*-this.speed.y,this.speed.x=this.node.x>0?-200:200,this.speed.x*=CMath.getRandom(0,1.5)+1,this.node.group="drop",i.Game.addBubbleDrop(this.bubble.Color),console.log(" \u6389\u843d:",this.enabled,this.bubble.getIndex(),this.speed,this.acceleration,this.hasCollision)},t.prototype.update=function(e){var t=this;if(this.isShooterState||this.isDrop){for(var c=0;c<10;c++){this.checkBorder(),this.checkCollisionBubble(),this.node.x+=this.speed.x*e/10,this.node.y+=this.speed.y*e/10,this.speed.x+=this.acceleration.x*e/10,this.speed.y+=this.acceleration.y*e/10;var u=CMath.ConvertToNodeSpaceAR(this.node,this.node.getParent().getParent());if(this.isDrop&&u.y<=o.DropBorder){this.enabled=!1,this.scaleBubble(1.1,.9),a.gEventMgr.emit(r.GlobalEvent.PLAY_EFFECT,"drop");var d=this.bubble.DoubleScore?2*n.BubbleDropScore:n.BubbleDropScore;i.Game.addScore(this.bubble.Color,d,1,CMath.ConvertToNodeSpaceAR(this.node,i.Game.TopNode).add(cc.v2(.5*l.BubbleSize.width,.5*l.BubbleSize.height))),this.bubble.playAnimation(h.default,function(){s.gFactory.putBubble(t.node)});break}}this.node.parent&&"Shooter"==this.node.parent.name&&(Math.abs(this.node.x)>=600||this.node.y>1663||this.node.y<0)&&(s.gFactory.putBubble(this.node),this.enabled=!1,console.error("  error , not collision! bubble lost "),a.gEventMgr.emit(r.GlobalEvent.NEXT_BUBBLE))}},t=__decorate([p],t)}(cc.Component);o.default=b,cc._RF.pop()},{"./Bubble":"Bubble","./BubbleAnimation/BubbleChange":"BubbleChange","./BubbleAnimation/BubbleDrop":"BubbleDrop","./Const":"Const","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Controller/GameFactory":"GameFactory","./Data/BubbleMatrix":"BubbleMatrix"}],Bubble:[function(e,t,o){"use strict";cc._RF.push(t,"ab9ae70D2ZFXoGg9F2uKBO0","Bubble"),Object.defineProperty(o,"__esModule",{value:!0});var n,a=e("./Controller/EventManager"),r=e("./Controller/Game"),i=e("./Controller/EventName"),l=e("./Const"),s=e("./BubbleMove"),c=e("./Controller/GameFactory"),u=e("./Data/BubbleMatrix"),h=e("./BubbleAnimation/BubbleIdle"),d=e("./BubbleAnimation/BubbleBurst"),p=e("./BubbleAnimation/BubbleChange"),b=e("./BubbleAnimation/BubbleDrop"),g=e("./BubbleAnimation/BubbleHorce");o.BubbleDropScore=10,o.BubbleScoreStep=10,function(e){e[e.Bubble=0]="Bubble",e[e.Collision=1]="Collision"}(n=o.BubbleAction||(o.BubbleAction={}));var f=cc._decorator,m=f.ccclass,y=(f.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.index=-1,t.color=l.BubbleType.Blank,t.type=u.SpecialType.Normal,t.animationCallback={},t.doubleScore=!1,t}return __extends(t,e),t.prototype.getAnimation=function(e){return this.getComponentInChildren(e)},Object.defineProperty(t.prototype,"AnimationRoot",{get:function(){return this.node.getChildByName("Animation")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DropRoot",{get:function(){return this.node.getChildByName("Down")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sprite",{get:function(){return this.node.getChildByName("Bubble").getComponent(cc.Sprite)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"move",{get:function(){return this.getComponent(s.default)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IndexLabel",{get:function(){return this.node.getChildByName("Index").getComponent(cc.Label)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Color",{get:function(){return this.color},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Type",{get:function(){return this.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Double",{get:function(){return this.node.getChildByName("Bubble").getChildByName("Double")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDouble",{get:function(){return this.type==u.SpecialType.Double},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DoubleScore",{get:function(){return this.doubleScore},set:function(e){this.doubleScore=e},enumerable:!0,configurable:!0}),t.prototype.reuse=function(e,t,o,n,a,r,i,s){this.node.active=!1,this.node.scale=0,this.type=o==l.BubbleType.Boom?u.SpecialType.Boom:e==u.SpecialType.Boom?u.SpecialType.Normal:e,this.color=o,this.idleFrames=n,this.burstFrames=r,this.dropFrames=s,this.getAnimation(p.default).Animation=a,this.getAnimation(g.default).Animation=i,this.getAnimation(h.default).Animation=this.idleFrames[o],this.getAnimation(d.default).Animation=this.burstFrames[o],this.getAnimation(b.default).Animation=this.dropFrames[o],this.sprite.node.opacity=255,this.Double.active=this.type==u.SpecialType.Double,this.doubleScore=!1,this.updateSprite(),this.IndexLabel.node.active=!1,this.setIndex(t),this.initEvent()},t.prototype.unuse=function(){a.gEventMgr.targetOff(this),this.index=-1,this.IndexLabel.string="",this.node.stopAllActions(),this.getAnimation(h.default).clearAllListener().clearCompleteEvent(),this.getAnimation(d.default).clearAllListener().clearCompleteEvent(),this.getAnimation(p.default).clearAllListener().clearCompleteEvent(),this.getAnimation(g.default).clearAllListener().clearCompleteEvent(),this.getAnimation(b.default).clearAllListener().clearCompleteEvent(),this.AnimationRoot.opacity=0,this.DropRoot.opacity=0,this.node.targetOff(this),this.node.active=!1},t.prototype.setColor=function(e,t){this.color!=e?(this.color=e,this.type=t):console.warn(" color:",l.BubbleType[this.color],l.BubbleType[e])},t.prototype.updateSprite=function(e){void 0===e&&(e=!1),this.getAnimation(h.default).Animation=this.idleFrames[this.color],this.getAnimation(d.default).Animation=this.burstFrames[this.color],this.getAnimation(b.default).Animation=this.dropFrames[this.color]},t.prototype.setIndex=function(e){if(e!=this.index){var t=r.Game.getMatrix();t.data[e]&&t.data[e].bubble?t.data[e].bubble!=this&&(console.error(this.index,"\u6570\u636e\u4e0d\u540c\u6b65\uff01",e,", oldIndex:",t.data[e].bubble.getIndex()),console.log(t.data[e])):t.data[e]={color:this.color,bubble:this,type:this.type},this.index=e}},t.prototype.updateIndex=function(){this.IndexLabel.node.active=!this.IndexLabel.node.active,this.IndexLabel.string=this.index.toString()},t.prototype.getIndex=function(){return this.index},t.prototype.setActive=function(e,t,o){this.node.active!=e&&(this.node.active=e,this.node.active||(this.node.scale=0),this.node.active&&t&&this.bubbleScale(o))},t.prototype.initEvent=function(){this.getAnimation(h.default).addCompleteEvent(this.onAnimationComplete,this),this.getAnimation(d.default).addCompleteEvent(this.onAnimationComplete,this),this.getAnimation(p.default).addCompleteEvent(this.onAnimationComplete,this),this.getAnimation(b.default).addCompleteEvent(this.onAnimationComplete,this),this.getAnimation(g.default).addCompleteEvent(this.onAnimationComplete,this),this.getAnimation(h.default).addKeyEventListener(this.onAnimationKey,this),this.getAnimation(d.default).addKeyEventListener(this.onAnimationKey,this),this.getAnimation(p.default).addKeyEventListener(this.onAnimationKey,this),this.getAnimation(b.default).addKeyEventListener(this.onAnimationKey,this),this.getAnimation(g.default).addKeyEventListener(this.onAnimationKey,this),a.gEventMgr.on(i.GlobalEvent.UPDATE_INDEX,this.updateIndex,this),this.node._onSetParent=this.onSetParent.bind(this)},t.prototype.updateActive=function(e){void 0===e&&(e=0),this.setActive(this.index>=r.Game.startIndex,!0,e)},t.prototype.scaleTest=function(e){e.indexOf(this.index)<0||this.bubbleScale()},t.prototype.bubbleScale=function(e){void 0===e&&(e=0);var t=cc.sequence(cc.scaleTo(0,0),cc.delayTime(e),cc.scaleTo(.2,.9),cc.scaleTo(.1,1.1),cc.scaleTo(.1,1));t.setTag(n.Bubble),this.node.stopActionByTag(n.Bubble),this.node.runAction(t)},t.prototype.onSetParent=function(e){e&&(this.move.enabled="Shooter"==e.name,"BulletArray"==e.name?this.node.rotation=-90:this.node.rotation=0)},t.prototype.onCollision=function(){a.gEventMgr.emit(i.GlobalEvent.PLAY_EFFECT,"colision")},t.prototype.onClear=function(e,t){var n=this;r.Game.addBubbleClear(this.Color),a.gEventMgr.emit(i.GlobalEvent.PLAY_EFFECT,this.type==u.SpecialType.Boom?"boom":"clear"),this.node.runAction(cc.sequence(cc.delayTime(.7*e),cc.callFunc(function(){var e=r.Game.getMatrix().index2i(n.index),a=r.Game.getMatrix().index2j(n.index),i=r.Game.getMatrix().index2i(t),s=r.Game.getMatrix().index2j(t),u=Math.max(Math.abs(e-i)+1,Math.abs(a-s)+1),h=Math.max(1,u)*o.BubbleScoreStep;n.DoubleScore&&(h*=2);var p=.1*u+1;r.Game.addScore(n.color,h,p,CMath.ConvertToNodeSpaceAR(n.node,r.Game.TopNode).add(cc.v2(.5*l.BubbleSize.width,.5*l.BubbleSize.height))),n.updateSprite(!0),n.playAnimation(d.default,function(){c.gFactory.putBubble(n.node)})},this)))},t.prototype.playAnimation=function(e,t){console.log(" play animation:",e.aniName),this.animationCallback[e.aniName]=t,this.getAnimation(e).play()},Object.defineProperty(t.prototype,"Bubble",{get:function(){return this.node.getChildByName("Bubble")},enumerable:!0,configurable:!0}),t.prototype.onAnimationKey=function(e,t){switch(0==e&&t!=h.default.prototype.__classname__&&(t==b.default.prototype.__classname__?this.DropRoot.opacity=255:this.AnimationRoot.opacity=255),t){case d.default.prototype.__classname__:0==e&&this.Bubble.runAction(cc.fadeOut(.1));break;case p.default.prototype.__classname__:2==e&&this.updateSprite();break;case g.default.prototype.__classname__:5==e&&this.updateSprite();break;case b.default.prototype.__classname__:0==e&&(this.Bubble.runAction(cc.fadeOut(.1)),this.DropRoot.opacity=255)}},t.prototype.onAnimationComplete=function(e){this.animationCallback[e]&&(this.animationCallback[e](),this.animationCallback[e]=null)},t.prototype.update=function(e){},t=__decorate([m],t)}(cc.Component));o.default=y,cc._RF.pop()},{"./BubbleAnimation/BubbleBurst":"BubbleBurst","./BubbleAnimation/BubbleChange":"BubbleChange","./BubbleAnimation/BubbleDrop":"BubbleDrop","./BubbleAnimation/BubbleHorce":"BubbleHorce","./BubbleAnimation/BubbleIdle":"BubbleIdle","./BubbleMove":"BubbleMove","./Const":"Const","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Controller/GameFactory":"GameFactory","./Data/BubbleMatrix":"BubbleMatrix"}],Const:[function(e,t,o){"use strict";var n,a,r;cc._RF.push(t,"f7b813ZcfJE5JVv1NvPFZPC","Const"),Object.defineProperty(o,"__esModule",{value:!0}),o.BubbleColor={0:"blank",1:"bg_popblue",2:"bg_popgreen",3:"bg_poporange",4:"bg_poppurple",5:"bg_popred",6:"bg_popyellow"},o.BubbleLightColor={0:"blank",1:"bg_popbluelight",2:"bg_popgreenlight",3:"bg_poporangelight",4:"bg_poppurplelight",5:"bg_popredlight",6:"bg_popyellowlight"},o.BoomBubbleLightColor={0:"blank",1:"bomb_bluelight",2:"bomb_greenlight",3:"bomb_orangelight",4:"bomb_purplelight",5:"bomb_redlight",6:"bomb_yellowlight"},o.BoomBubbleColor={0:"blank",1:"bomb_blue",2:"bomb_green",3:"bomb_orange",4:"bomb_purple",5:"bomb_red",6:"bomb_yellow"},o.HorseBubble="horse",o.HorseBubbleLight="horselight",o.MagicBubble="rainbow",o.MagicBubbleLight="rainbowlight",function(e){e[e.Blank=0]="Blank",e[e.Blue=1]="Blue",e[e.DarkBlue=2]="DarkBlue",e[e.Green=3]="Green",e[e.Orange=4]="Orange",e[e.Purple=5]="Purple",e[e.Red=6]="Red",e[e.Yellow=7]="Yellow",e[e.White=8]="White",e[e.Boom=9]="Boom",e[e.Horce=10]="Horce",e[e.Treasure_1=200]="Treasure_1",e[e.Treasure_2=400]="Treasure_2",e[e.Treasure_3=600]="Treasure_3",e[e.Treasure_4=800]="Treasure_4",e[e.Treasure_5=1e3]="Treasure_5",e[e.Streak=1001]="Streak"}(n=o.BubbleType||(o.BubbleType={})),o.BubbleColors=[n.Yellow,n.Red,n.Purple,n.Orange,n.Green,n.Blue,n.Boom],o.BubbleHeightOffset=-14,o.BubbleYOffset=1205,o.BubbleXOffset=20,o.InitColNumber=10,o.InitStartIndex=47,o.BubbleSize=cc.size(83,83),o.BubbleQueRange={Min:4,Max:9},o.ClearTargetRange={Min:2,Max:6},o.GameTime=180,o.TargetRandomLimit=120,o.DefaultTaskCount=9,o.DoubleBubbleInitRange={Min:3,Max:5},o.DoubleBubbleRange={Min:1,Max:2},o.BoomBubbleRange={Min:1,Max:2},o.MagicBubbleRange={Min:0,Max:1},o.BoomBubbleInitRange={Min:3,Max:5},o.MagicBubbleInitRange={Min:0,Max:3},o.ClearCountLimit=3,o.ShooterDoubleRange={Min:6,Max:10},o.ShooterDoubleBubbleRange={Min:0,Max:1},o.ShooterBoomRange={Min:6,Max:10},o.ShooterBoomBubbleRange={Min:0,Max:1},o.ShooterMagicRange={Min:4,Max:6},o.ShooterMagicBubbleRange={Min:0,Max:1},o.TaskStreakAward=3,function(e){e[e.Spring=0]="Spring",e[e.Summer=1]="Summer",e[e.Autumn=2]="Autumn",e[e.Winter=3]="Winter"}(a=o.Season||(o.Season={})),o.SeasonPool=[a.Spring,a.Summer,a.Autumn,a.Winter],function(e){e[e.Level_200=200]="Level_200",e[e.Level_400=400]="Level_400",e[e.Level_600=600]="Level_600",e[e.Level_800=800]="Level_800",e[e.Level_1000=1e3]="Level_1000"}(r=o.TreasureType||(o.TreasureType={})),o.TreasurePool=[r.Level_200,r.Level_400,r.Level_600,r.Level_800,r.Level_1000],o.Treasure_Top={0:{200:"bg_sfinish200",400:"bg_sfinish400",600:"bg_sfinish600",800:"bg_sfinish800",1e3:"bg_sfinish1000"},1:{200:"bg_smfinish200",400:"bg_smfinish400",600:"bg_smfinish600",800:"bg_smfinish800",1e3:"bg_smfinish1000"},2:{200:"bg_afinish200",400:"bg_afinish400",600:"bg_afinish600",800:"bg_afinish800",1e3:"bg_afinish1000"},3:{200:"bg_wfinish200",400:"bg_wfinish400",600:"bg_wfinish600",800:"bg_wfinish800",1e3:"bg_wfinish1000"}},function(e){e[e.OUT_OF_MOVE=0]="OUT_OF_MOVE",e[e.TIME_UP=1]="TIME_UP"}(o.OverType||(o.OverType={})),o.FireBar={Start:8,End:87},cc._RF.pop()},{}],EventManager:[function(e,t,o){"use strict";cc._RF.push(t,"1be43vsI5VEx6cptNa56Bfq","EventManager"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){this.eventTarget=new cc.EventTarget}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.emit=function(e,t,o,n,a,r){this.eventTarget.emit(e.toString(),t,o,n,a,r)},e.prototype.on=function(e,t,o,n){return this.eventTarget.on(e.toString(),t,o,n)},e.prototype.once=function(e,t,o){this.eventTarget.once(e.toString(),t,o)},e.prototype.dispatchEvent=function(e){this.eventTarget.dispatchEvent(e)},e.prototype.off=function(e,t,o){this.eventTarget.off(e.toString(),t,o)},e.prototype.hasEventListener=function(e){return this.eventTarget.hasEventListener(e.toString())},e.prototype.targetOff=function(e){this.eventTarget.targetOff(e)},e}();o.gEventMgr=n.inst,cc._RF.pop()},{}],EventName:[function(e,t,o){"use strict";cc._RF.push(t,"017c8l+T9FHF5CNitqArJpl","EventName"),Object.defineProperty(o,"__esModule",{value:!0}),function(e){e[e.BUBBLE_SCALE_TEST=0]="BUBBLE_SCALE_TEST",e[e.SMALL_BGM=1]="SMALL_BGM",e[e.NORMAL_BGM=2]="NORMAL_BGM",e[e.SHOOT=3]="SHOOT",e[e.BUBBLE_FORCE=4]="BUBBLE_FORCE",e[e.ADD_BUBBLE=5]="ADD_BUBBLE",e[e.ADD_SCORE=6]="ADD_SCORE",e[e.GAME_OVER=7]="GAME_OVER",e[e.UPDATE_TASK=8]="UPDATE_TASK",e[e.NEXT_BUBBLE=9]="NEXT_BUBBLE",e[e.PLAY_EFFECT=10]="PLAY_EFFECT",e[e.HORCE_CLEAR=11]="HORCE_CLEAR",e[e.GET_TREASURE=12]="GET_TREASURE",e[e.CHECK_TREASURE=13]="CHECK_TREASURE",e[e.CHANGE_BGM=14]="CHANGE_BGM",e[e.SHOW_STREAK=15]="SHOW_STREAK",e[e.UPDATE_INDEX=16]="UPDATE_INDEX",e[e.UPDATE_POINTER_ROTATION=17]="UPDATE_POINTER_ROTATION",e[e.ON_POINTER_ROTATED=18]="ON_POINTER_ROTATED",e[e.IS_GREEN_IDLE=19]="IS_GREEN_IDLE",e[e.GET_CHANGE_BUTTON=20]="GET_CHANGE_BUTTON",e[e.PLAY_LOAD=21]="PLAY_LOAD",e[e.BUBBLE_LOAD=22]="BUBBLE_LOAD",e[e.OPEN_PAUSE=23]="OPEN_PAUSE",e[e.READY_GO=24]="READY_GO"}(o.GlobalEvent||(o.GlobalEvent={})),cc._RF.pop()},{}],FrameAniBase:[function(e,t,o){"use strict";cc._RF.push(t,"b2d80rjoMtDXKhceGVjLXGq","FrameAniBase"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,r=n.property,i=n.executeInEditMode,l=n.requireComponent,s=n.playOnFocus,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.Frames=null,t.Interval=.1,t.Priority=0,t.Loop=!1,t.PlayOnLoad=!1,t.currentIndex=0,t.time=0,t.isPlay=!1,t.listener=[],t.complateEvent=[],t}var o;return __extends(t,e),o=t,Object.defineProperty(t.prototype,"Sprite",{get:function(){return this.node.getComponent(cc.Sprite)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Animation",{set:function(e){this.Frames=e},enumerable:!0,configurable:!0}),t.prototype.onFocusInEditor=function(){this.time=this.Interval,o.intervalID=setInterval(this.update.bind(this),.016,.016)},t.prototype.onLostFocusInEditor=function(){clearInterval(o.intervalID)},t.prototype.onLoad=function(){this.time=this.Interval,this.isPlay=this.PlayOnLoad},t.prototype.play=function(){this.isPlay=!0,this.currentIndex=0,0==this.isPlaying&&this.callEventComplete()},t.prototype.playOnLoop=function(){this.Loop=!0,this.play()},t.prototype.playByStep=function(){this.isPlay=!0,this.nextFrame(),this.isPlay=!1},t.prototype.pause=function(){this.isPlay=!1},t.prototype.resume=function(){this.isPlay=!0},t.prototype.stop=function(){this.isPlay=!1,this.currentIndex=0,this.Loop=!1},t.prototype.onKeyFrame=function(e){},t.prototype.addKeyEventListener=function(e,t){this.listener.push({callback:e,target:t})},Object.defineProperty(t.prototype,"ListenerCount",{get:function(){return this.listener.length},enumerable:!0,configurable:!0}),t.prototype.clearAllListener=function(){return this.listener.length=0,this},t.prototype.onComplete=function(){},t.prototype.callEventFrame=function(){this.onKeyFrame(this.currentIndex);for(var e=0,t=this.listener;e<t.length;e++){var o=t[e];o.callback.apply(o.target,[this.currentIndex,this.__classname__])}},t.prototype.callEventComplete=function(){this.onComplete();for(var e=0,t=this.complateEvent;e<t.length;e++){var o=t[e];o.f.apply(o.target,[this.__classname__])}},t.prototype.addCompleteEvent=function(e,t){this.complateEvent.push({f:e,target:t})},Object.defineProperty(t.prototype,"TotalFrameCount",{get:function(){return this.Frames&&this.Frames.getSpriteFrames?this.Frames.getSpriteFrames().length:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CompleteEventCount",{get:function(){return this.complateEvent.length},enumerable:!0,configurable:!0}),t.prototype.clearCompleteEvent=function(){return this.complateEvent.length=0,this},t.prototype.start=function(){},Object.defineProperty(t.prototype,"isPlaying",{get:function(){if(this.isPlay&&this.Frames&&this.Frames.getSpriteFrames&&this.Frames.getSpriteFrames().length>0){for(var e=0,t=this.getComponents(o);e<t.length;e++){var n=t[e];if(n.Priority>this.Priority&&n.isPlaying)return!1}return!0}return!1},enumerable:!0,configurable:!0}),t.prototype.nextFrame=function(){0!=this.isPlaying?this.Frames&&this.Frames.getSpriteFrames&&this.Frames.getSpriteFrames().length>0&&(this.Sprite.spriteFrame=this.Frames.getSpriteFrames()[this.currentIndex],this.callEventFrame(),this.currentIndex=(this.currentIndex+1)%this.Frames.getSpriteFrames().length,0==this.currentIndex&&0==this.Loop&&(this.isPlay=!1,this.callEventComplete())):this.time=this.Interval},t.prototype.update=function(e){this.time>=this.Interval&&(this.time=0,this.nextFrame()),this.time+=e},t.aniName="FrameAniBase",t.intervalID=-1,__decorate([r(cc.SpriteAtlas)],t.prototype,"Frames",void 0),__decorate([r],t.prototype,"Interval",void 0),__decorate([r],t.prototype,"Priority",void 0),__decorate([r],t.prototype,"Loop",void 0),__decorate([r],t.prototype,"PlayOnLoad",void 0),t=o=__decorate([a,i,s,l(cc.Sprite)],t)}(cc.Component);o.default=c,cc._RF.pop()},{}],GameFactory:[function(e,t,o){"use strict";cc._RF.push(t,"949976qNuFDsoz+OUdWWlhf","GameFactory"),Object.defineProperty(o,"__esModule",{value:!0});var n,a=e("../Utils/HashMap"),r=function(){function e(e,t,o){this._pool=[],this.poolHandlerComps=[],this.poolHandlerComps=o,this.template=e,this.initPool(t)}return e.prototype.initPool=function(e){for(var t=this,o=0;o<e;++o)if(e>1)setTimeout(function(){var e=cc.instantiate(t.template);t.put(e)});else{var n=cc.instantiate(this.template);this.put(n)}},e.prototype.size=function(){return this._pool.length},e.prototype.clear=function(){for(var e=this._pool.length,t=0;t<e;++t)this._pool[t].destroy&&this._pool[t].destroy();this._pool.length=0},e.prototype.put=function(e){if(e&&-1===this._pool.indexOf(e)){if(e.removeFromParent(!1),this.poolHandlerComps)for(var t=0,o=this.poolHandlerComps;t<o.length;t++){var n=o[t],a=e.getComponent(n);a&&a.unuse&&a.unuse.apply(a)}else for(var r=0,i=e.getComponents(cc.Component);r<i.length;r++){(n=i[r])&&n.unuse&&n.unuse.apply(n)}this._pool.push(e)}},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=this._pool.length-1;o<0&&(console.warn(" last < 0 "),this.initPool(1)),o=this._pool.length-1;var n=this._pool[o];if(this._pool.length=o,this.poolHandlerComps)for(var a=0,r=this.poolHandlerComps;a<r.length;a++){var i=r[a],l=n.getComponent(i);l&&l.reuse&&l.reuse.apply(l,arguments)}else for(var s=0,c=n.getComponents(cc.Component);s<c.length;s++){(i=c[s])&&i.reuse&&i.reuse.apply(i,arguments)}return n},e}();(function(e){e[e.INIT=0]="INIT",e[e.Bubble=4]="Bubble",e[e.Point=8]="Point",e[e.Task=16]="Task",e[e.Score=32]="Score",e[e.Font=64]="Font",e[e.DONE=124]="DONE"})(n||(n={}));var i=function(){function e(){this.step=n.INIT,this.BubblePool=new a.HashMap,this.PointPool=new a.HashMap,this.TaskPool=new a.HashMap,this.ScorePool=new a.HashMap,this.FontPool=new a.HashMap}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.init=function(e,t,o,n,a,r){this.doneCallback=e,this.initBubble(132,t),this.initPoint(20,o),this.initTask(8,n),this.initScore(10,a),this.initFont(5,r)},e.prototype.nextStep=function(e){this.step|=e,this.step>=n.DONE&&this.doneCallback&&this.doneCallback()},e.prototype.initBubble=function(e,t){var o=this;t?(o.BubblePool.add("Bubble",new r(t,e)),o.nextStep(n.Bubble)):cc.loader.loadRes("prefabs/Bubble",cc.Prefab,function(t,a){t?console.error(t):(o.BubblePool.add("Bubble",new r(a,e)),o.nextStep(n.Bubble))})},e.prototype.getBubble=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return(e=this.BubblePool.get("Bubble")).get.apply(e,t)},e.prototype.putBubble=function(e){this.BubblePool.get("Bubble").put(e)},e.prototype.initPoint=function(e,t){var o=this;t?(o.PointPool.add("Point",new r(t,e)),o.nextStep(n.Point)):cc.loader.loadRes("prefabs/Point",cc.Prefab,function(t,a){t?console.error(t):(o.PointPool.add("Point",new r(a,e)),o.nextStep(n.Point))})},e.prototype.getPoint=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return(e=this.PointPool.get("Point")).get.apply(e,t)},e.prototype.putPoint=function(e){this.PointPool.get("Point").put(e)},e.prototype.initTask=function(e,t){var o=this;t?(o.TaskPool.add("Task",new r(t,e)),o.nextStep(n.Task)):cc.loader.loadRes("prefabs/Mission",cc.Prefab,function(t,a){t?console.error(t):(o.TaskPool.add("Task",new r(a,e)),o.nextStep(n.Task))})},e.prototype.getTask=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return(e=this.TaskPool.get("Task")).get.apply(e,t)},e.prototype.putTask=function(e){this.TaskPool.get("Task").put(e)},e.prototype.initScore=function(e,t){var o=this;t?(o.ScorePool.add("Score",new r(t,e)),o.nextStep(n.Score)):cc.loader.loadRes("prefabs/ScoreFloat",cc.Prefab,function(t,a){t?console.error(t):(o.ScorePool.add("Score",new r(a,e)),o.nextStep(n.Score))})},e.prototype.getScore=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return(e=this.ScorePool.get("Score")).get.apply(e,t)},e.prototype.putScore=function(e){this.ScorePool.get("Score").put(e)},e.prototype.initFont=function(e,t){var o=this;t?(o.FontPool.add("Font",new r(t,e)),o.nextStep(n.Font)):cc.loader.loadRes("prefabs/Font",cc.Prefab,function(t,a){t?console.error(t):(o.FontPool.add("Font",new r(a,e)),o.nextStep(n.Font))})},e.prototype.getFont=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return(e=this.FontPool.get("Font")).get.apply(e,t)},e.prototype.putFont=function(e){this.FontPool.get("Font").put(e)},e}();o.gFactory=i.inst,cc._RF.pop()},{"../Utils/HashMap":"HashMap"}],GameScene:[function(e,t,o){"use strict";cc._RF.push(t,"63c91B5GQpJwrTOBvKO60W6","GameScene"),Object.defineProperty(o,"__esModule",{value:!0});var n,a=e("./Controller/GameFactory"),r=e("./Controller/Game"),i=e("./Const"),l=e("./Data/BubbleMatrix"),s=e("./Bubble"),c=e("./Controller/EventManager"),u=e("./Controller/StepController"),h=e("./Controller/AudioController"),d=e("./Controller/EventName"),p=e("./Guide"),b=e("./ResultLayer"),g=e("./BubbleMove"),f=e("./Utils/LogHandler"),m=e("./FrameAniBase"),y=e("./BubbleAnimation/BubbleHorce"),v=e("./Utils/celerx");(function(e){e.Prefab="Prefab",e.Audio="Audio"})(n||(n={}));var _=cc._decorator,C=_.ccclass,S=_.property,B=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.BubblePrefab=null,t.PointPrefab=null,t.TaskPrefab=null,t.AddScorePrefab=null,t.BubbleAtlas=[],t.BubbleChange=[],t.BubbleBurst=[],t.BubbleHorce=[],t.BubbleDrop=[],t.SpringBack=null,t.SummerBack=null,t.AutumnBack=null,t.WinterBack=null,t.NowStreak=null,t.FireBar=null,t.Guide=null,t.Background=null,t.FontAtlas=null,t.TimeFont=null,t.FontPrefab=null,t.FontRoot=null,t.TreasureRoot=null,t.BigTreasure=null,t.SmallTreasure=null,t.ResultTitle=null,t.ResultFont=null,t.BubbleLayer=null,t.Shooter=null,t.TopNode=null,t.BulletArray=null,t.TaskArray=null,t.ShooterLayer=null,t.TimeLabel=null,t.TimeLabel2=null,t.ScoreLabel=null,t.ChangeShooter=null,t.ReadyShooter=null,t.ChangeCube=null,t.ChangeButton=null,t.PauseButton=null,t.TreasureBar=null,t.showScore=0,t.score=0,t.addScoreStep=0,t.TreasureProgress=[0,0,.3,.5,.8,1],t}return __extends(t,e),t.prototype.onLoad=function(){this.ChangeCube.active=!1,this.ChangeButton.node.active=this.ChangeCube.active,this.ChangeButton.interactable=this.ChangeCube.active,this.ShooterLayer.active=!1,f.LogHandler.inst.initLog(v.log),f.LogHandler.inst.log(" game scene on load"),cc.debug.setDisplayStats(!1),this.ResultFont.node.scale=0,r.Game.FontRoot=this.FontRoot,r.Game.BubbleLayer=this.BubbleLayer,r.Game.TopNode=this.TopNode;var e=this;v.onStart(function(){e.celerOnStart()}.bind(this)),v.provideScore(function(){return parseInt(r.Game.getScore().toString())}),u.gStep.register(this.celerReady.bind(this),[n.Audio,n.Prefab]),a.gFactory.init(function(){u.gStep.nextStep(n.Prefab)},this.BubblePrefab,this.PointPrefab,this.TaskPrefab,this.AddScorePrefab,this.FontPrefab),h.gAudio.init(function(){u.gStep.nextStep(n.Audio)}),this.initEvent(),this.TimeLabel.node.getParent().getChildByName("noTime").opacity=0},t.prototype.celerReady=function(){f.LogHandler.inst.log(" call celerx.ready"),v.ready()},t.prototype.celerOnStart=function(){var e=v.getMatch();r.Game.MatchInfo=e||{},e&&e.sharedRandomSeed?(CMath.randomSeed=e.sharedRandomSeed,CMath.sharedSeed=e.sharedRandomSeed,console.log(" match id:",e.matchId)):(console.error(" match sharedRandomSeed null!"),CMath.randomSeed=Math.random()),f.LogHandler.inst.log(" celer on start:",r.Game.MatchInfo.matchId,", seed:",r.Game.MatchInfo.sharedRandomSeed),r.Game.prepare(),r.Game.start(),this.updateSeason(),this.show(),this.ShooterLayer.active=!0,e&&e.shouldLaunchTutorial?this.Guide.show(function(){c.gEventMgr.emit(d.GlobalEvent.READY_GO)}):this.Guide.hide(),cc.loader.loadRes("prefabs/Spring/ResultLayer")},t.prototype.updateTreasure=function(){console.log(" start load treasure");for(var e=[i.TreasureType.Level_1000,i.TreasureType.Level_800],t=function(t){var o=Math.floor(CMath.getRandom(0,e.length)),n=e[o];cc.loader.loadRes("prefabs/"+i.Season[r.Game.Season]+"/"+n,cc.Prefab,function(e,o){if(e)console.error(" load treasure err:",e);else{var n=cc.instantiate(o);t.addChild(n)}}),e.splice(o,1)},o=0,n=this.BigTreasure.children;o<n.length;o++){t(n[o])}for(var a=[i.TreasureType.Level_200,i.TreasureType.Level_400,i.TreasureType.Level_600],l=function(e){var t=Math.floor(CMath.getRandom(0,a.length)),o=a[t];cc.loader.loadRes("prefabs/"+i.Season[r.Game.Season]+"/"+o,cc.Prefab,function(t,o){if(t)console.error(" load treasure err:",t);else{var n=cc.instantiate(o);e.addChild(n)}}),a.splice(t,1)},s=0,c=this.SmallTreasure.children;s<c.length;s++){l(c[s])}},t.prototype.updateSeason=function(){switch(r.Game.Season){case i.Season.Spring:console.log(" set Spring bg"),this.Background.spriteFrame=this.SpringBack;break;case i.Season.Summer:console.log(" set Summer bg"),this.Background.spriteFrame=this.SummerBack;break;case i.Season.Autumn:this.Background.spriteFrame=this.AutumnBack;break;case i.Season.Winter:this.Background.spriteFrame=this.WinterBack}},t.prototype.updateIndex=function(){c.gEventMgr.emit(d.GlobalEvent.UPDATE_INDEX)},t.prototype.initEvent=function(){var e=this;c.gEventMgr.targetOff(this),this.BulletArray.on(cc.Node.EventType.CHILD_REMOVED,this.onBubbleQueRemoveChild,this),this.Shooter.on(cc.Node.EventType.CHILD_REMOVED,this.onShooterRemoveChild,this),c.gEventMgr.on(d.GlobalEvent.GET_CHANGE_BUTTON,function(){e.ChangeButton.node.active=!0,e.ChangeCube.active=!0,e.ChangeCube.getChildByName("ani").runAction(cc.fadeIn(0)),e.ChangeCube.getChildByName("ani").getComponent(m.default).onComplete=function(){e.ChangeCube.getChildByName("ani").runAction(cc.fadeOut(.1))},e.ChangeCube.getComponentInChildren(m.default).play();var t=e.ChangeCube.getChildByName("Cube");if(t){var o=t.scale;t.runAction(cc.sequence(cc.spawn(cc.scaleTo(.1,2*o),cc.fadeTo(.1,150)),cc.delayTime(.2),cc.spawn(cc.sequence(cc.scaleTo(.1,1.2*o),cc.scaleTo(.1,1.6*o),cc.scaleTo(.1,1*o)),cc.fadeIn(.15)),cc.delayTime(.15),cc.fadeOut(.15)))}var n=e.ChangeCube.getChildByName("CubeAni");n&&(n.runAction(cc.fadeIn(0)),n.getComponent(m.default).onComplete=function(){n.runAction(cc.fadeOut(.1))},n.getComponent(m.default).play())},this),this.ChangeButton.node.on(cc.Node.EventType.TOUCH_END,function(){if(0!=e.ChangeButton.interactable){c.gEventMgr.emit(d.GlobalEvent.PLAY_EFFECT,"selectionChange");var t=e.Shooter.children[0],o=e.ReadyShooter.children[0],n=e.ChangeShooter.children[0];t.setPosition(CMath.ConvertToNodeSpaceAR(t,e.ChangeShooter)),t.setParent(e.ChangeShooter),t.getComponent(g.default).unreadyToShoot(),t.runAction(cc.sequence(cc.moveTo(.1,-128,136),cc.moveTo(.1,0,0))),o.setPosition(CMath.ConvertToNodeSpaceAR(t,e.Shooter)),o.setParent(e.Shooter),o.runAction(cc.sequence(cc.moveTo(.2,0,0),cc.callFunc(function(){console.log(" ready bubble ready to shoot"),o.getComponent(g.default).readyToShoot()}))),n.setPosition(CMath.ConvertToNodeSpaceAR(t,e.ReadyShooter)),n.setParent(e.ReadyShooter),n.getComponent(g.default).unreadyToShoot(),n.runAction(cc.moveTo(.2,0,0))}},this),this.PauseButton.node.on(cc.Node.EventType.TOUCH_END,function(){c.gEventMgr.emit(d.GlobalEvent.PLAY_EFFECT,"button_click"),c.gEventMgr.emit(d.GlobalEvent.OPEN_PAUSE)},this),c.gEventMgr.on(d.GlobalEvent.GET_TREASURE,function(t){var o=e.TreasureRoot.getChildByName(t.toString()),n=o.getChildByName("ani").getComponent(m.default);o&&n&&(o.getChildByName("ani").runAction(cc.fadeIn(0)),o.getChildByName("ani").getComponent(m.default).onComplete=function(){o.getChildByName("ani").runAction(cc.fadeOut(.1))},o.getComponentInChildren(m.default).play(),o.getChildByName("icon")&&o.getChildByName("icon").runAction(cc.fadeIn(.2)),t>=5&&(o.getChildByName("circle")&&(o.getChildByName("circle").active=!0,o.getChildByName("circle").runAction(cc.repeatForever(cc.rotateBy(.1,10)))),o.getChildByName("get")&&(o.getChildByName("get").runAction(cc.sequence(cc.fadeTo(0,100),cc.scaleTo(0,5),cc.spawn(cc.scaleTo(.15,.8),cc.fadeIn(.15)),cc.scaleTo(.1,1.2),cc.scaleTo(.1,.9),cc.scaleTo(.1,1.1),cc.scaleTo(.1,1))),o.getChildByName("get").active=!0)))},this),c.gEventMgr.on(d.GlobalEvent.SHOW_STREAK,function(t,o){if(t){var n=null;switch(o){case 2:n=e.FontAtlas.getSpriteFrame("f_streak");break;case 3:n=e.FontAtlas.getSpriteFrame("f_sstreak");break;case 4:n=e.FontAtlas.getSpriteFrame("f_great");break;case 5:n=e.FontAtlas.getSpriteFrame("f_amazing");break;default:n=e.FontAtlas.getSpriteFrame("f_awesome")}var l=a.gFactory.getFont();l.getComponent(cc.Sprite).spriteFrame=n,l.scale=0,l.opacity=255,e.FontRoot.addChild(l),l.x=0;var s=1+.1*o;l.y=e.FontRoot.childrenCount*(150*s),c.gEventMgr.emit(d.GlobalEvent.PLAY_EFFECT,"font"),l.runAction(cc.sequence(cc.scaleTo(.1,s),cc.delayTime(.3),cc.callFunc(function(){if(t){r.Game.addScore(i.BubbleType.Streak,25+15*(o-2),.3*(o-2)+2,CMath.ConvertToNodeSpaceAR(l,e.TopNode).add(cc.v2(l.width/2,l.height/2)))}},e),cc.spawn(cc.scaleTo(.2,1),cc.fadeTo(.2,0)),cc.callFunc(function(){a.gFactory.putFont(l)},e)))}},this),c.gEventMgr.on(d.GlobalEvent.ADD_BUBBLE,this.addNextBubble,this),c.gEventMgr.on(d.GlobalEvent.UPDATE_TASK,this.updateTask,this),c.gEventMgr.on(d.GlobalEvent.NEXT_BUBBLE,this.getShooterBubble,this),c.gEventMgr.on(d.GlobalEvent.ADD_SCORE,this.addScore,this),c.gEventMgr.once(d.GlobalEvent.GAME_OVER,function(t){r.Game.isStart=!1,t==i.OverType.OUT_OF_MOVE?e.ResultFont.spriteFrame=e.ResultTitle.getSpriteFrame("bg_font_gameover"):e.ResultFont.spriteFrame=e.ResultTitle.getSpriteFrame("bg_font_timeup"),e.ResultFont.node.runAction(cc.sequence(cc.scaleTo(.1,1.5),cc.delayTime(.3),cc.scaleTo(.1,1.2),cc.callFunc(function(){cc.loader.loadRes("prefabs/Spring/ResultLayer",cc.Prefab,function(o,n){if(o)cc.error("load result :",o),console.error(" submit score by open result err:",r.Game.MatchInfo.matchId,", seed:",r.Game.MatchInfo.sharedRandomSeed),v.submitScore(r.Game.getScore());else{var a=void 0;a=t==i.OverType.OUT_OF_MOVE?e.ResultTitle.getSpriteFrame("bg_result_font2"):e.ResultTitle.getSpriteFrame("bg_result_font1");var l=cc.instantiate(n);l.getComponent(b.default).setTexture(a),e.node.addChild(l)}})},e)))},this)},t.prototype.updateTask=function(){var e=r.Game.getCurTarget();console.log(e);for(var t=0;t<Math.min(e.now,this.TaskArray.childrenCount);t++){var o=this.TaskArray.children[t],n=o.getChildByName("Complete");0==o.scale||n.scale>.5||n.runAction(cc.sequence(cc.scaleTo(.1,1.5),cc.scaleTo(.1,1)))}},t.prototype.addNextBubble=function(e){for(void 0===e&&(e=1);e--;)this.nextBubble()},t.prototype.show=function(){console.log(" game show !!!");var e=2+i.InitColNumber,t=l.IndexJStart,o=l.IndexJEnd;this.addBubble(2,e,t,o),this.getNewTask(i.DefaultTaskCount)},t.prototype.nextBubble=function(){r.Game.addMoveTimes();var e=r.Game.getMatrix();e.moveRow(1),this.BubbleLayer.height+=i.BubbleSize.height+i.BubbleHeightOffset,this.BubbleLayer.runAction(cc.sequence(cc.moveBy(.2,0,-(i.BubbleSize.height+i.BubbleHeightOffset)),cc.callFunc(function(){r.Game.checkOutOfMove(),c.gEventMgr.emit(d.GlobalEvent.CHECK_TREASURE)},this))),this.addBubble(e.index2i(r.Game.startIndex)-1,e.index2i(r.Game.startIndex)-1,l.IndexJStart,l.IndexJEnd,1);for(var t=r.Game.startIndex;t<=r.Game.startIndex+l.UseSize-1;t++){if(!e.data[t]||!e.data[t].bubble)return;e.data[t].bubble.updateActive(t/700+(t-r.Game.startIndex)/50)}},t.prototype.addBubble=function(e,t,o,n,a){void 0===a&&(a=0),console.log(" add bubble , istart:",e,", iend:",t,",jstart:",o,", jend:",n);for(var i=r.Game.getMatrix(),l=e;l<=t;l++)for(var c=o;c<=n;c++){var u=i.ij2index(l,c),h=r.Game.getBubble(i.data[u].type,u,i.data[u].color,this.BubbleAtlas,this.BubbleChange[i.data[u].color],this.BubbleBurst,this.BubbleHorce[i.data[u].color],this.BubbleDrop);h||console.error(" bubble is null");var d=i.getPosOfij(l,c);h.x=d.x,h.y=d.y,this.BubbleLayer.addChild(h),i.data[u].bubble=h.getComponent(s.default),h.getComponent(s.default).updateActive(u/700+(u-r.Game.startIndex)/50*a)}r.Game.updateCollisionIndexes()},t.prototype.onShooterRemoveChild=function(){},t.prototype.newBubbleArray=function(e){var t=r.Game.getCurTarget();t.now<t.target&&this.addNextBubble(1),this.getNewTask(e)},t.prototype.getShooterBubble=function(e){var t=this;if(this.BulletArray.childrenCount<=0&&this.ReadyShooter.childrenCount<=0){if(!this.ChangeCube.active)return void this.newBubbleArray(e);if(this.ChangeShooter.childrenCount<=0)return console.log(" \u4e09\u4e2a\u4f4d\u7f6e\u90fd\u6ca1\u6ce1\u6ce1"),void this.newBubbleArray(e)}if(this.Shooter.childrenCount>0&&console.error(" shooter has bubble! getShooterBubble--"),this.ReadyShooter.childrenCount<=0)if(console.warn(" ready \u6ca1\u6709\u6ce1\u6ce1"),this.ChangeCube.active){if(this.ChangeShooter.childrenCount<=0){if(this.BulletArray.childrenCount<=0)return console.error(" bullet array is 0, cube is active"),void this.newBubbleArray(e);var o=this.BulletArray.children[0];o.setPosition(CMath.ConvertToNodeSpaceAR(o,this.ChangeShooter)),o.setParent(this.ChangeShooter),o.runAction(cc.sequence(cc.moveBy(.1,0,-200),cc.scaleTo(0,0),cc.moveTo(0,0),cc.scaleTo(.1,1),cc.callFunc(function(){if(o.setPosition(CMath.ConvertToNodeSpaceAR(o,t.ReadyShooter)),o.setParent(t.ReadyShooter),o.runAction(cc.sequence(cc.moveTo(.2,0,0),cc.callFunc(function(){t.putNextShooterBubble()}))),t.BulletArray.childrenCount>0){var e=t.BulletArray.children[0];e.setPosition(CMath.ConvertToNodeSpaceAR(e,t.ChangeShooter)),e.setParent(t.ChangeShooter),e.runAction(cc.sequence(cc.moveBy(.1,0,-200),cc.scaleTo(0,0),cc.moveTo(0,0),cc.scaleTo(.1,1)))}else console.log(" bullet array has no bubble 741")})))}}else{if(this.BulletArray.childrenCount<=0)return console.error(" bullet array is 0"),void this.newBubbleArray(e);var n=this.BulletArray.children[0];n.setPosition(CMath.ConvertToNodeSpaceAR(n,this.ReadyShooter)),n.setParent(this.ReadyShooter),c.gEventMgr.emit(d.GlobalEvent.PLAY_LOAD),n.scale=this.BulletArray.scale,n.runAction(cc.sequence(cc.scaleTo(0,0),cc.moveTo(0,0,0))),c.gEventMgr.once(d.GlobalEvent.BUBBLE_LOAD,function(){n.runAction(cc.scaleTo(.1,1))},this)}else this.putNextShooterBubble()},t.prototype.putNextShooterBubble=function(){console.log("putNextShooterBubble, ready:",this.ReadyShooter.childrenCount,", cube:",this.ChangeShooter.childrenCount,", shooter:",this.Shooter.childrenCount);var e=this.ReadyShooter.children[0];if(e.setPosition(CMath.ConvertToNodeSpaceAR(e,this.Shooter)),e.setParent(this.Shooter),e.scale=1,e.runAction(cc.spawn(cc.fadeTo(.2,255),cc.moveTo(.2,0,0),cc.callFunc(function(){e.getComponent(g.default).readyToShoot()}))),this.ChangeCube.active)if(this.ChangeShooter.childrenCount>0){var t=this.ChangeShooter.children[0];if(t.setPosition(CMath.ConvertToNodeSpaceAR(t,this.ReadyShooter)),t.setParent(this.ReadyShooter),c.gEventMgr.emit(d.GlobalEvent.PLAY_LOAD),t.scale=0,c.gEventMgr.once(d.GlobalEvent.BUBBLE_LOAD,function(){t.runAction(cc.scaleTo(.1,1))},this),t.runAction(cc.moveTo(.2,0,0)),this.BulletArray.childrenCount>0){var o=this.BulletArray.children[0];o.setPosition(CMath.ConvertToNodeSpaceAR(o,this.ChangeShooter)),o.setParent(this.ChangeShooter),o.scale=this.BulletArray.scale,o.runAction(cc.sequence(cc.spawn(cc.moveBy(.1,0,-200),cc.scaleTo(.05,0)),cc.scaleTo(0,0),cc.moveTo(0,0,0),cc.scaleTo(.1,1)))}else console.log(" bullet array has no bubble")}else console.log(" change shooter has no bubble");else if(this.BulletArray.childrenCount>0){var n=this.BulletArray.children[0];n.setPosition(CMath.ConvertToNodeSpaceAR(n,this.ReadyShooter)),n.setParent(this.ReadyShooter),c.gEventMgr.emit(d.GlobalEvent.PLAY_LOAD),n.scale=this.BulletArray.scale,n.runAction(cc.sequence(cc.scaleTo(0,0),cc.moveTo(0,0,0))),c.gEventMgr.once(d.GlobalEvent.BUBBLE_LOAD,function(){n.runAction(cc.scaleTo(.1,1))},this)}else console.log(" bullet array is 0")},t.prototype.getNewTask=function(e){var t=this;e||(e=Math.ceil(CMath.getRandom(i.BubbleQueRange.Min,i.BubbleQueRange.Max))),console.log("bubble que\uff1a",e);for(var o=[],n=0;n<e;n++)o.push(n);var u=Math.ceil(CMath.getRandom(i.ShooterDoubleRange.Min,i.ShooterDoubleRange.Max)),h=0,p=i.BubbleColors.concat(),b={};if(r.Game.getTaskLength()%u==0)for(h=Math.ceil(CMath.getRandom(i.ShooterDoubleBubbleRange.Min,i.ShooterDoubleBubbleRange.Max));h-- >0&&o.length>0;){var f=o[n=Math.floor(CMath.getRandom(0,o.length))];o.splice(n,1);var m=p[B=Math.floor(CMath.getRandom(0,p.length))];p.splice(B,1),p.length<=0&&(p=i.BubbleColors.concat()),b[f]=m}var v=Math.ceil(CMath.getRandom(i.ShooterBoomRange.Min,i.ShooterBoomRange.Max)),_=0,C=i.BubbleColors.concat(),S={};if(r.Game.getTaskLength()%v==0)for(_=Math.ceil(CMath.getRandom(i.ShooterBoomBubbleRange.Min,i.ShooterBoomBubbleRange.Max));_-- >0&&o.length>0;){f=o[n=Math.floor(CMath.getRandom(0,o.length))];o.splice(n,1);var B;m=C[B=Math.floor(CMath.getRandom(0,C.length))];C.splice(B,1),C.length<=0&&(C=i.BubbleColors.concat()),S[f]=m}var M=Math.ceil(CMath.getRandom(i.ShooterMagicRange.Min,i.ShooterMagicRange.Max)),E=0,T={};if(r.Game.getTaskLength()%M==0)for(E=Math.ceil(CMath.getRandom(i.ShooterMagicBubbleRange.Min,i.ShooterMagicBubbleRange.Max));E-- >0&&o.length>0;){f=o[n=Math.floor(CMath.getRandom(0,o.length))];o.splice(n,1),T[f]=i.BubbleType.Blank}var x=[];for(n=0;n<e;n++)x.push(i.BubbleColors[Math.floor(CMath.getRandom()*i.BubbleColors.length)]);var A=r.Game.getCurTarget();A.now>=A.target&&A.target>0?(r.Game.addTaskStreak(1),c.gEventMgr.emit(d.GlobalEvent.PLAY_EFFECT,"task_success")):(r.Game.addTaskStreak(-r.Game.getTaskStreak()),A.target>0&&c.gEventMgr.emit(d.GlobalEvent.PLAY_EFFECT,"task_fail"));var R=function(e){var t=x[e],o=l.SpecialType.Normal;b[e]&&(o=l.SpecialType.Double,t=b[e]),S[e]&&(o=l.SpecialType.Boom,t=S[e]),null!=T[e]&&(o=l.SpecialType.Magic,t=T[e]);var n=r.Game.getBubble(o,-1,t,F.BubbleAtlas,F.BubbleChange[t],F.BubbleBurst,F.BubbleHorce[t],F.BubbleDrop);if(n.getComponent(s.default).setActive(!0,!0,e/50),n.scale=0,n.opacity=0,n.y=0,0==e){F.Shooter.childrenCount>0&&console.error(" shooter has bubble!"),n.x=0,F.Shooter.addChild(n);var a=!1;r.Game.getTaskStreak()>=i.TaskStreakAward&&(r.Game.addTaskStreak(-r.Game.getTaskStreak()),a=!0),n.runAction(cc.spawn(cc.scaleTo(.2,1),cc.fadeTo(.2,255),cc.moveTo(.3,0,0),cc.callFunc(function(){a&&(c.gEventMgr.emit(d.GlobalEvent.PLAY_EFFECT,"change_horce"),n.getComponent(s.default).setColor(i.BubbleType.Horce,l.SpecialType.Horce),n.getComponent(s.default).playAnimation(y.default,function(){n.getComponent(s.default).AnimationRoot.runAction(cc.fadeOut(.2))})),n.getComponent(g.default).readyToShoot()})))}else 1==e?(F.ReadyShooter.childrenCount>0&&console.error(" shooter has bubble!"),n.x=0,F.ReadyShooter.addChild(n),c.gEventMgr.once(d.GlobalEvent.BUBBLE_LOAD,function(){n.runAction(cc.scaleTo(.1,1))},F),n.scale=0,c.gEventMgr.emit(d.GlobalEvent.PLAY_LOAD),n.runAction(cc.spawn(cc.fadeTo(.2,255),cc.moveTo(.3,0,0),cc.callFunc(function(){})))):2==e?F.ChangeCube.active&&(F.ChangeShooter.childrenCount>0&&console.error(" shooter has bubble!"),n.x=0,F.ChangeShooter.addChild(n),n.runAction(cc.spawn(cc.scaleTo(.2,1),cc.fadeTo(.2,255),cc.moveTo(.3,0,0),cc.callFunc(function(){})))):(n.x=-200*e,F.BulletArray.addChild(n),n.runAction(cc.spawn(cc.scaleTo(.2,.5),cc.fadeTo(.2,255),cc.moveTo(.4,40-F.BulletArray.childrenCount*i.BubbleSize.width,0))))},F=this;for(n=0;n<x.length;n++)R(n);var P=CMath.getRandom(),G=0;if(G=r.Game.getGameTime()>=120?P<=.6?CMath.Clamp(e-Math.ceil(CMath.getRandom(2,10)),i.ClearTargetRange.Max,i.ClearTargetRange.Min):P<=.3?CMath.Clamp(e-Math.ceil(CMath.getRandom(1,2)),i.ClearTargetRange.Max,i.ClearTargetRange.Min):CMath.Clamp(e,i.ClearTargetRange.Max,i.ClearTargetRange.Min):P<=.6?CMath.Clamp(e-Math.ceil(CMath.getRandom(1,2)),i.ClearTargetRange.Max,i.ClearTargetRange.Min):P<=.2?CMath.Clamp(e-Math.ceil(CMath.getRandom(2,10)),i.ClearTargetRange.Max,i.ClearTargetRange.Min):CMath.Clamp(e,i.ClearTargetRange.Max,i.ClearTargetRange.Min),G=Math.min(e-1,G),console.log("task count\uff1a",G),this.TaskArray.childrenCount>0){var N=function(e){var o=I.TaskArray.children[e],n=o.getChildByName("Complete"),a=o.getChildByName("Fail");A.now>=A.target?o.runAction(cc.sequence(cc.delayTime(e/10),cc.scaleTo(.1,0),cc.callFunc(function(){e==t.TaskArray.childrenCount-1&&c.gEventMgr.emit(d.GlobalEvent.PLAY_EFFECT,"new_task"),n.scale=0,a.scale=0,e<=G-1&&o.runAction(cc.sequence(cc.delayTime(0),cc.scaleTo(.1,1.2),cc.delayTime(.05),cc.scaleTo(.1,1)))}))):(n.stopAllActions(),n.scale=0,a.runAction(cc.sequence(cc.delayTime(e/10),cc.scaleTo(.1,1),cc.delayTime(.2),cc.callFunc(function(){e==t.TaskArray.childrenCount-1&&c.gEventMgr.emit(d.GlobalEvent.PLAY_EFFECT,"new_task"),o.runAction(cc.sequence(cc.delayTime(e/10),cc.scaleTo(.1,0),cc.callFunc(function(){a.scale=0,e<=G-1&&o.runAction(cc.sequence(cc.delayTime(0),cc.scaleTo(.1,1.2),cc.delayTime(.05),cc.scaleTo(.1,1)))})))}))))},I=this;for(n=0;n<this.TaskArray.childrenCount;n++)N(n)}else for(c.gEventMgr.emit(d.GlobalEvent.PLAY_EFFECT,"new_task");this.TaskArray.childrenCount<6;){var L=a.gFactory.getTask();L.y=0,L.x=this.TaskArray.childrenCount*L.width*1.3+30,L.scale=0,this.TaskArray.childrenCount<G&&L.runAction(cc.sequence(cc.delayTime(this.TaskArray.childrenCount/10),cc.scaleTo(.1,1.2),cc.delayTime(.05),cc.scaleTo(.1,1))),this.TaskArray.addChild(L),L.getChildByName("Complete").scale=0,L.getChildByName("Fail").scale=0}r.Game.pushTarget({now:0,target:G}),console.log(" add new task done:",this.Shooter.childrenCount)},t.prototype.onBubbleQueRemoveChild=function(){for(var e=0,t=this.BulletArray.children;e<t.length;e++){t[e].runAction(cc.moveBy(.2,i.BubbleSize.width,0))}},t.prototype.addScore=function(e,t,o){var n=this;void 0===o&&(o=cc.v2(0,0));var i=a.gFactory.getScore();i.scale=0,i.opacity=255,i.getComponent(cc.Label).string="/"+e.toString(),this.TopNode.addChild(i),i.setPosition(o);var l=CMath.Distance(o,this.ScoreLabel.node.position)/1560;i.runAction(cc.sequence(cc.delayTime(.4),cc.fadeTo(l+.3,0))),i.runAction(cc.sequence(cc.scaleTo(.1,1.2*t),cc.delayTime(.2),cc.scaleTo(.1,1*t),cc.moveTo(l,this.ScoreLabel.node.position).easing(cc.easeInOut(1)),cc.scaleTo(.3,0),cc.callFunc(function(){n.score=r.Game.getScore(),n.addScoreStep=(n.score-n.showScore)/20,a.gFactory.putScore(i)})))},t.prototype.updateTimeCount=function(){var e=Math.floor(r.Game.getGameTime());if(!(e>5)){var t=this.TimeLabel.node.getParent().getChildByName("font").getComponent(cc.Sprite),o=this.TimeFont.getSpriteFrame("bg_time"+e);t.spriteFrame!=o&&(c.gEventMgr.emit(d.GlobalEvent.PLAY_EFFECT,"count"),t.spriteFrame=o,t.node.runAction(cc.sequence(cc.fadeTo(.2,255),cc.scaleTo(.1,1.2),cc.delayTime(.5),cc.scaleTo(.1,1),cc.fadeTo(.1,0))))}},t.prototype.update=function(e){if(this.ChangeButton.interactable=this.ReadyShooter.childrenCount>0&&this.Shooter.childrenCount>0&&this.ChangeShooter.childrenCount>0&&Math.abs(this.Shooter.children[0].x)<=.01&&Math.abs(this.Shooter.children[0].y)<=.01&&Math.abs(this.ReadyShooter.children[0].x)<=.01&&Math.abs(this.ReadyShooter.children[0].y)<=.01&&Math.abs(this.ChangeShooter.children[0].x)<=.01&&Math.abs(this.ChangeShooter.children[0].y)<=.01,r.Game.isStart&&(this.FireBar.height=r.Game.getTaskStreak()/i.TaskStreakAward*(i.FireBar.End-i.FireBar.Start)+i.FireBar.Start,this.NowStreak.string=r.Game.getTaskStreak().toString(),this.TreasureBar.progress=this.TreasureProgress[r.Game.treasureCount],!this.Guide.node.active&&!this.node.getChildByName("PauseLayer").active)){r.Game.addGameTime(-e);var t=CMath.TimeFormat(r.Game.getGameTime()).split("-");this.TimeLabel.string=t[0],this.TimeLabel2.string=t[1],30==Math.floor(r.Game.getGameTime())&&this.TimeLabel.node.getParent().getChildByName("noTime").opacity<=0&&(this.TimeLabel.node.getParent().getChildByName("noTime").opacity=255,this.TimeLabel.node.getParent().getComponentInChildren(m.default).play(),c.gEventMgr.emit(d.GlobalEvent.CHANGE_BGM,"bgm_30")),this.updateTimeCount()}this.showScore<this.score&&(this.showScore+=this.addScoreStep,this.showScore=Math.min(this.score,this.showScore),this.ScoreLabel.string=Math.floor(this.showScore).toString())},__decorate([S(cc.Prefab)],t.prototype,"BubblePrefab",void 0),__decorate([S(cc.Prefab)],t.prototype,"PointPrefab",void 0),__decorate([S(cc.Prefab)],t.prototype,"TaskPrefab",void 0),__decorate([S(cc.Prefab)],t.prototype,"AddScorePrefab",void 0),__decorate([S(cc.SpriteAtlas)],t.prototype,"BubbleAtlas",void 0),__decorate([S(cc.SpriteAtlas)],t.prototype,"BubbleChange",void 0),__decorate([S(cc.SpriteAtlas)],t.prototype,"BubbleBurst",void 0),__decorate([S(cc.SpriteAtlas)],t.prototype,"BubbleHorce",void 0),__decorate([S(cc.SpriteAtlas)],t.prototype,"BubbleDrop",void 0),__decorate([S(cc.SpriteFrame)],t.prototype,"SpringBack",void 0),__decorate([S(cc.SpriteFrame)],t.prototype,"SummerBack",void 0),__decorate([S(cc.SpriteFrame)],t.prototype,"AutumnBack",void 0),__decorate([S(cc.SpriteFrame)],t.prototype,"WinterBack",void 0),__decorate([S(cc.Label)],t.prototype,"NowStreak",void 0),__decorate([S(cc.Node)],t.prototype,"FireBar",void 0),__decorate([S(p.default)],t.prototype,"Guide",void 0),__decorate([S(cc.Sprite)],t.prototype,"Background",void 0),__decorate([S(cc.SpriteAtlas)],t.prototype,"FontAtlas",void 0),__decorate([S(cc.SpriteAtlas)],t.prototype,"TimeFont",void 0),__decorate([S(cc.Prefab)],t.prototype,"FontPrefab",void 0),__decorate([S(cc.Node)],t.prototype,"FontRoot",void 0),__decorate([S(cc.Node)],t.prototype,"TreasureRoot",void 0),__decorate([S(cc.Node)],t.prototype,"BigTreasure",void 0),__decorate([S(cc.Node)],t.prototype,"SmallTreasure",void 0),__decorate([S(cc.SpriteAtlas)],t.prototype,"ResultTitle",void 0),__decorate([S(cc.Sprite)],t.prototype,"ResultFont",void 0),__decorate([S(cc.Node)],t.prototype,"BubbleLayer",void 0),__decorate([S(cc.Node)],t.prototype,"Shooter",void 0),__decorate([S(cc.Node)],t.prototype,"TopNode",void 0),__decorate([S(cc.Node)],t.prototype,"BulletArray",void 0),__decorate([S(cc.Node)],t.prototype,"TaskArray",void 0),__decorate([S(cc.Node)],t.prototype,"ShooterLayer",void 0),__decorate([S(cc.Label)],t.prototype,"TimeLabel",void 0),__decorate([S(cc.Label)],t.prototype,"TimeLabel2",void 0),__decorate([S(cc.Label)],t.prototype,"ScoreLabel",void 0),__decorate([S(cc.Node)],t.prototype,"ChangeShooter",void 0),__decorate([S(cc.Node)],t.prototype,"ReadyShooter",void 0),__decorate([S(cc.Node)],t.prototype,"ChangeCube",void 0),__decorate([S(cc.Button)],t.prototype,"ChangeButton",void 0),__decorate([S(cc.Button)],t.prototype,"PauseButton",void 0),__decorate([S(cc.ProgressBar)],t.prototype,"TreasureBar",void 0),t=__decorate([C],t)}(cc.Component);o.default=B,cc._RF.pop()},{"./Bubble":"Bubble","./BubbleAnimation/BubbleHorce":"BubbleHorce","./BubbleMove":"BubbleMove","./Const":"Const","./Controller/AudioController":"AudioController","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Controller/GameFactory":"GameFactory","./Controller/StepController":"StepController","./Data/BubbleMatrix":"BubbleMatrix","./FrameAniBase":"FrameAniBase","./Guide":"Guide","./ResultLayer":"ResultLayer","./Utils/LogHandler":"LogHandler","./Utils/celerx":"celerx"}],Game:[function(e,t,o){"use strict";cc._RF.push(t,"f56074wKGJAf7tmCkTOJ+cK","Game"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../Data/BubbleMatrix"),a=e("../Const"),r=e("./GameFactory"),i=e("../BubbleMove"),l=e("./EventManager"),s=e("./EventName"),c=function(){function e(){this.BubbleLayer=null,this.TopNode=null,this.FontRoot=null,this.moveTimes=0,this.bubbleMatrix=new n.BubbleMatrix,this.score=0,this.streak=0,this.maxStreak=0,this.taskStreak=0,this.maxTaskStreak=0,this.bubbleScore={},this.bubbleClear={},this.bubbleDrop={},this.collisionIndexes=[],this.targets=[],this.clearIndex=[],this.dropIndex=[],this.fixedIndex=[],this.forceIndex=[],this.gameTime=0,this.isStart=!1,this.lastIndex=a.InitStartIndex,this._startIndex=a.InitStartIndex,this.hasReadygo=!1,this.treasureCount=0}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Season",{get:function(){return this.season},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startIndex",{get:function(){return this._startIndex},set:function(e){this._startIndex=e,console.log(" startIndex:",this.startIndex)},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.moveTimes=0,this.score=0,this.collisionIndexes.length=0,this.targets.length=0,this.clearIndex.length=0,this.dropIndex.length=0,this.forceIndex.length=0,this.gameTime=a.GameTime,this.streak=0,this.maxStreak=0,this.taskStreak=0,this.maxTaskStreak=0;for(var e=0,t=a.BubbleColors;e<t.length;e++){var o=t[e];this.bubbleClear[o]=0,this.bubbleDrop[o]=0,this.bubbleScore[o]=0}for(var n=0;n<10;n++)this.season=a.SeasonPool[Math.floor(CMath.getRandom(0,a.SeasonPool.length))];console.log(" Season:",a.Season[this.season])},e.prototype.getBubbleScore=function(){return this.bubbleScore},e.prototype.getTaskLength=function(){return this.targets.length},e.prototype.getCurTarget=function(){return 0==this.targets.length?{target:0,now:0}:this.targets[this.targets.length-1]},e.prototype.addTarget=function(e){0!=this.targets.length&&(this.targets[this.targets.length-1].now+=e,l.gEventMgr.emit(s.GlobalEvent.UPDATE_TASK))},e.prototype.pushTarget=function(e){this.streak=0,this.targets.push(e)},e.prototype.getCollisionIndexes=function(){return this.collisionIndexes},e.prototype.updateCollisionIndexes=function(){this.collisionIndexes.length=0;for(var e=this.bubbleMatrix.data,t=0;t<e.length;t++){if(e[t]&&e[t].bubble)this.bubbleMatrix.getNeiborMatrix(t,1).length<6&&this.collisionIndexes.push(t)}for(t=0;t<e.length;t++)if(e[t]&&e[t].bubble&&!(this.collisionIndexes.indexOf(t)>=0)){for(var o=!0,a=0,r=this.bubbleMatrix.getNeiborMatrix(t,1);a<r.length;a++){var i=r[a];if(this.collisionIndexes.indexOf(i)<0){o=!1;break}}o&&this.collisionIndexes.push(t)}for(t=this.startIndex-n.MatrixSize;t<this.startIndex-n.MatrixSize+n.UseSize;t++);console.log(this.collisionIndexes)},e.prototype.getScore=function(){return this.score},e.prototype.addScore=function(e,t,o,n){void 0===n&&(n=cc.v2(0,0)),this.score+=t,this.score=Math.max(0,this.score),this.addBubbleScore(e,t),l.gEventMgr.emit(s.GlobalEvent.ADD_SCORE,t,o,n)},e.prototype.getMatrix=function(){return this.bubbleMatrix},e.prototype.prepare=function(){this.bubbleMatrix.initBubbleData()},e.prototype.getLastI=function(){return this.bubbleMatrix.index2i(this.lastIndex)},e.prototype.addGameTime=function(e){this.gameTime+=e,this.gameTime<=0&&(this.gameTime=0,this.isStart=!1,l.gEventMgr.emit(s.GlobalEvent.GAME_OVER,a.OverType.TIME_UP))},e.prototype.checkOutOfMove=function(){for(var e=null,t=this.bubbleMatrix.data.length-1;t>=this.startIndex;t--)if(this.bubbleMatrix.data[t]&&this.bubbleMatrix.data[t].bubble&&this.bubbleMatrix.data[t].bubble.node.active){e=this.bubbleMatrix.data[t].bubble;break}if(e){var o=CMath.ConvertToNodeSpaceAR(e.node,e.node.getParent().getParent());console.log(" check out of move:",o.y),o.y<=i.DropBorder&&l.gEventMgr.emit(s.GlobalEvent.GAME_OVER,a.OverType.OUT_OF_MOVE)}},e.prototype.getGameTime=function(){return this.gameTime},e.prototype.addMoveTimes=function(e){void 0===e&&(e=1),this.moveTimes+=e},e.prototype.getMoveTimes=function(){return this.moveTimes},e.prototype.getBubble=function(e,t,o,n,a,i,l,s){return r.gFactory.getBubble(e,t,o,n,a,i,l,s)},e.prototype.checkRecurily=function(e,t){if(!(this.clearIndex.indexOf(e)>=0||e<this.startIndex)){this.clearIndex.push(e);for(var o=0,n=this.bubbleMatrix.getNeiborMatrix(e,1);o<n.length;o++){var a=n[o];if(!(a<this.startIndex)){var r=this.bubbleMatrix.data[a].bubble;r&&r.node.active&&t.Color==r.Color&&this.checkRecurily(a,t)}}}},e.prototype.addBubbleScore=function(e,t){this.bubbleScore[e]||(this.bubbleScore[e]=0),this.bubbleScore[e]+=t},e.prototype.addBubbleDrop=function(e){this.bubbleDrop[e]++},e.prototype.addBubbleClear=function(e){this.bubbleClear[e]++},e.prototype.checkBoomBubble=function(e){for(var t=0,o=e;t<o.length;t++){var a=o[t];if(this.bubbleMatrix.data[a].type==n.SpecialType.Boom){for(var r=[],i=0,l=this.bubbleMatrix.getNeiborMatrix(a,1,!1);i<l.length;i++){var s=l[i];this.clearIndex.indexOf(s)<0&&s>=this.startIndex&&(this.clearIndex.push(s),this.bubbleMatrix.data[s].type==n.SpecialType.Boom&&r.push(s))}this.checkBoomBubble(r)}}},e.prototype.checkClear=function(e,t,o){if(this.clearIndex.length=0,t.Type==n.SpecialType.Horce){console.log("\u5c0f\u9a6c\u7403:",this.startIndex),this.clearIndex.push(e);for(var r=this.startIndex;r<this.bubbleMatrix.data.length;r++)this.bubbleMatrix.data[r]&&this.bubbleMatrix.data[r].bubble&&this.bubbleMatrix.data[r].bubble.node.active&&this.bubbleMatrix.data[r].color==o.Color&&this.clearIndex.push(r)}else this.checkRecurily(e,t);if(this.clearIndex.length<a.ClearCountLimit&&t.Type!=n.SpecialType.Horce)return this.clearIndex.length=0,void(this.streak=0);console.log(" --------------- \u68c0\u6d4b\u6d88\u9664 start---------------:",this.startIndex),console.log(this.clearIndex),console.log(" --------------- \u68c0\u6d4b\u6d88\u9664 end---------------"),this.checkBoomBubble(this.clearIndex),this.streak++,this.streak>=2&&l.gEventMgr.emit(s.GlobalEvent.SHOW_STREAK,!0,this.streak),this.clearIndex.length>=5&&(this.clearIndex.length<=8?l.gEventMgr.emit(s.GlobalEvent.SHOW_STREAK,!1,4):this.clearIndex.length<=12?l.gEventMgr.emit(s.GlobalEvent.SHOW_STREAK,!1,5):l.gEventMgr.emit(s.GlobalEvent.SHOW_STREAK,!1,6)),this.maxStreak=Math.max(this.streak,this.maxStreak);var i=0;for(i=this.bubbleMatrix.data.length-1;i>=this.startIndex;i--){var c=this.bubbleMatrix.data[i];if(c&&c.color&&c.bubble&&c.bubble.node.active)break}this.lastIndex=i;for(var u=!1,h=0;h<this.clearIndex.length;h++){var d=this.clearIndex[h];if((b=this.bubbleMatrix.data[d].bubble)&&b.isDouble){u=!0,l.gEventMgr.emit(s.GlobalEvent.PLAY_EFFECT,"double_score");break}}t.Type==n.SpecialType.Horce&&(l.gEventMgr.emit(s.GlobalEvent.PLAY_EFFECT,"super_clear"),l.gEventMgr.emit(s.GlobalEvent.HORCE_CLEAR));for(var p=0;p<this.clearIndex.length;p++){var b;d=this.clearIndex[p];(b=this.bubbleMatrix.data[d].bubble)&&(u&&(b.DoubleScore=!0),b.onClear(.1*p,e),this.bubbleMatrix.data[d].bubble=null,this.bubbleMatrix.data[d].color=a.BubbleType.Blank,this.bubbleMatrix.data[d].type=n.SpecialType.Normal)}this.clearIndex.length=0,this.checkBubbleDrop(),this.addTarget(1),l.gEventMgr.emit(s.GlobalEvent.CHECK_TREASURE),this.checkAddBubble()},e.prototype.checkAddBubble=function(){for(var e=0,t=this.startIndex;t<=this.startIndex+9;t++)this.bubbleMatrix.data[t]&&this.bubbleMatrix.data[t].bubble&&this.bubbleMatrix.data[t].bubble.node.active&&e++;e<=5&&l.gEventMgr.emit(s.GlobalEvent.ADD_BUBBLE,3)},e.prototype.checkDrop=function(e){for(var t=this.bubbleMatrix.getNeiborMatrix(e,1,!1),o=0,n=t;o<n.length;o++){var a=n[o];if(this.fixedIndex.indexOf(a)>=0){this.fixedIndex=this.fixedIndex.concat(t),this.fixedIndex.push(e);break}}},e.prototype.checkBubbleDrop=function(){this.dropIndex.length=0,this.fixedIndex.length=0;for(var e=this.startIndex;e<this.startIndex+n.UseSize;e++)this.bubbleMatrix.data[e]&&this.bubbleMatrix.data[e].bubble&&this.fixedIndex.push(e);for(e=this.startIndex;e<this.bubbleMatrix.data.length;e++)e>=this.startIndex+n.UseSize&&this.bubbleMatrix.data[e]&&this.bubbleMatrix.data[e].bubble&&this.dropIndex.push(e);if(!(this.dropIndex.length<=0)){for(var t=0,o=this.dropIndex;t<o.length;t++){var r=o[t];this.checkDrop(r)}for(var i=0,l=this.fixedIndex;i<l.length;i++){r=l[i];(e=this.dropIndex.indexOf(r))>=0&&this.dropIndex.splice(e,1)}console.log(" \u68c0\u6d4b\u6389\u843d---------------"),console.log(this.dropIndex);for(var s=0,c=this.dropIndex;s<c.length;s++){r=c[s];if(this.bubbleMatrix.data[r]){var u=this.bubbleMatrix.data[r].bubble;u&&(u.move.drop(),this.bubbleMatrix.data[r].bubble=null,this.bubbleMatrix.data[r].color=a.BubbleType.Blank,this.bubbleMatrix.data[r].type=n.SpecialType.Normal)}}this.dropIndex.length=0}},e.prototype.addTaskStreak=function(e){this.taskStreak+=e,console.log(" 1task streak:",this.taskStreak,e),this.taskStreak=Math.max(0,this.taskStreak),console.log(" task streak:",this.taskStreak,e),this.maxTaskStreak=Math.max(this.maxTaskStreak,this.taskStreak)},e.prototype.getTaskStreak=function(){return this.taskStreak},e}();o.Game=c.inst,cc._RF.pop()},{"../BubbleMove":"BubbleMove","../Const":"Const","../Data/BubbleMatrix":"BubbleMatrix","./EventManager":"EventManager","./EventName":"EventName","./GameFactory":"GameFactory"}],GreenIdle:[function(e,t,o){"use strict";cc._RF.push(t,"4b6acWt//tGdJok24P7E67l","GreenIdle"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../../FrameAniBase"),a=e("../../Controller/EventManager"),r=e("../../Controller/EventName"),i=cc._decorator,l=i.ccclass,s=(i.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),a.gEventMgr.on(r.GlobalEvent.IS_GREEN_IDLE,function(e){e&&0==t.isPlaying?t.playOnLoop():t.stop()})},t.aniName="GreenIdle",t=__decorate([l],t)}(n.default));o.default=s,cc._RF.pop()},{"../../Controller/EventManager":"EventManager","../../Controller/EventName":"EventName","../../FrameAniBase":"FrameAniBase"}],Guide:[function(e,t,o){"use strict";cc._RF.push(t,"4d6d2YvErVK1L2MNAsgprAA","Guide"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Controller/EventManager"),a=e("./Controller/EventName"),r=cc._decorator,i=r.ccclass,l=r.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ButtonAtlas=null,t.Next=null,t.Forward=null,t.Content=null,t.GuideView=null,t.callback=null,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;this.Next.node.on(cc.Node.EventType.TOUCH_END,this.nextPage,this),this.Forward.node.on(cc.Node.EventType.TOUCH_END,this.forwardPage,this);for(var t=0,o=this.Content.children;t<o.length;t++){o[t].getChildByName("Close").on(cc.Node.EventType.TOUCH_END,function(){e.hide(),n.gEventMgr.emit(a.GlobalEvent.PLAY_EFFECT,"button_click")},this)}this.GuideView.node.on("scroll-ended",this.updateButton,this)},t.prototype.start=function(){},t.prototype.hide=function(){var e=this;setTimeout(function(){e.node.active=!1,e.callback&&e.callback(),cc.Node.maxTouchNum=1,cc.Node.touchNum=0},0)},t.prototype.show=function(e){cc.Node.maxTouchNum=10,cc.Node.touchNum=0,this.node.active=!0,this.callback=e,this.GuideView.scrollToPage(0,0),this.Forward.node.active=!1,this.Next.node.getComponent(cc.Sprite).spriteFrame=this.ButtonAtlas.getSpriteFrame("btn_new")},t.prototype.nextPage=function(){if(n.gEventMgr.emit(a.GlobalEvent.PLAY_EFFECT,"button_click"),this.GuideView.getCurrentPageIndex()>=this.GuideView.content.childrenCount-1)this.hide();else{var e=(this.GuideView.getCurrentPageIndex()+1)%this.GuideView.content.childrenCount;this.GuideView.setCurrentPageIndex(e),this.updateButton()}},t.prototype.forwardPage=function(){if(n.gEventMgr.emit(a.GlobalEvent.PLAY_EFFECT,"button_click"),this.GuideView.getCurrentPageIndex()<=0);else{var e=(this.GuideView.getCurrentPageIndex()-1)%this.GuideView.content.childrenCount;this.GuideView.setCurrentPageIndex(e),this.updateButton()}},t.prototype.updateButton=function(){this.GuideView.getCurrentPageIndex()>=this.GuideView.content.childrenCount-1?this.Next.node.getComponent(cc.Sprite).spriteFrame=this.ButtonAtlas.getSpriteFrame("new_close"):this.Next.node.getComponent(cc.Sprite).spriteFrame=this.ButtonAtlas.getSpriteFrame("btn_new"),this.Forward.node.active=0!=this.GuideView.getCurrentPageIndex()},__decorate([l(cc.SpriteAtlas)],t.prototype,"ButtonAtlas",void 0),__decorate([l(cc.Button)],t.prototype,"Next",void 0),__decorate([l(cc.Button)],t.prototype,"Forward",void 0),__decorate([l(cc.Node)],t.prototype,"Content",void 0),__decorate([l(cc.PageView)],t.prototype,"GuideView",void 0),t=__decorate([i],t)}(cc.Component);o.default=s,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName"}],HandUpLeft:[function(e,t,o){"use strict";cc._RF.push(t,"ffe9bP+UqVKj75trtccD5k+","HandUpLeft"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../../FrameAniBase"),a=e("../../Controller/EventManager"),r=e("../../Controller/EventName"),i=cc._decorator,l=i.ccclass,s=(i.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),a.gEventMgr.on(r.GlobalEvent.ON_POINTER_ROTATED,function(e){e?t.playByStep():t.stop()},this)},t.aniName="HandUpLeft",t=__decorate([l],t)}(n.default));o.default=s,cc._RF.pop()},{"../../Controller/EventManager":"EventManager","../../Controller/EventName":"EventName","../../FrameAniBase":"FrameAniBase"}],HandUpRight:[function(e,t,o){"use strict";cc._RF.push(t,"bf0e8y4ZthFO51qKbDIAQoB","HandUpRight"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("../../Controller/EventManager"),a=e("../../Controller/EventName"),r=e("../../FrameAniBase"),i=cc._decorator,l=i.ccclass,s=(i.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),n.gEventMgr.on(a.GlobalEvent.ON_POINTER_ROTATED,function(e){e?t.stop():t.playByStep()},this)},t.aniName="HandUpRight",t=__decorate([l],t)}(r.default));o.default=s,cc._RF.pop()},{"../../Controller/EventManager":"EventManager","../../Controller/EventName":"EventName","../../FrameAniBase":"FrameAniBase"}],HashMap:[function(e,t,o){"use strict";cc._RF.push(t,"834d8P+ikFOAYgMzFmudtRR","HashMap"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){this._list=new Array,this.clear()}return e.prototype.getIndexByKey=function(e){for(var t=this._list.length,o=0;o<t;o++){if(this._list[o].key==e)return o}return-1},e.prototype.keyOf=function(e){for(var t=this._list.length,o=0;o<t;o++){var n=this._list[o];if(n.value==e)return n.key}return null},Object.defineProperty(e.prototype,"keys",{get:function(){for(var e=new Array,t=0,o=this._list;t<o.length;t++){var n=o[t];n&&e.push(n.key)}return e},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){var o={key:e,value:t},n=this.getIndexByKey(e);-1!=n?this._list[n]=o:this._list.push(o)},Object.defineProperty(e.prototype,"values",{get:function(){return this._list},enumerable:!0,configurable:!0}),e.prototype.remove=function(e){var t=this.getIndexByKey(e);if(-1!=t){var o=this._list[t];return this._list.splice(t,1),o}return null},e.prototype.has=function(e){return-1!=this.getIndexByKey(e)},e.prototype.get=function(e){var t=this.getIndexByKey(e);return-1!=t?this._list[t].value:null},Object.defineProperty(e.prototype,"length",{get:function(){return this._list.length},enumerable:!0,configurable:!0}),e.prototype.sort=function(e){this._list.sort(e)},e.prototype.forEachKeyValue=function(e){for(var t=this._list.length,o=0;o<t;o++){e(this._list[o])}},e.prototype.forEach=function(e){for(var t=this._list.length,o=0;o<t;o++){var n=this._list[o];e(n.key,n.value)}},e.prototype.clear=function(){this._list=[]},e}();o.HashMap=n,cc._RF.pop()},{}],LogHandler:[function(e,t,o){"use strict";cc._RF.push(t,"4e3f0ZIKgdJt7KKOAGW0fes","LogHandler"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){if(this.logMsg=null,this.frameTimes=0,this.now=0,this.Frame=20,this.totalFrames=0,this.startTime=0,window.addEventListener)for(var t=0,o=e.LISTENNING_EVENTS;t<o.length;t++){var n=o[t],a="trigger"+n.charAt(0).toLocaleUpperCase()+n.substring(1);this[a]&&"function"==typeof this[a]&&window.addEventListener(n,this[a].bind(this))}}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.dumpFrameInfo=function(){var e=(Date.now()-this.startTime)/1e3,t=e/this.totalFrames;this.addLog(" total frames:",this.totalFrames," ,total cost time:",e+"s"," , per frame cost time ave:"+t+"s"),this.sendLog()},e.prototype.initLog=function(t){var o=this;cc.director.once(cc.Director.EVENT_AFTER_SCENE_LAUNCH,function(){o.frameTimes=0,o.now=Date.now(),o.startTime=Date.now()},this),cc.director.on(cc.Director.EVENT_AFTER_DRAW,function(){o.frameTimes++,o.totalFrames++,o.frameTimes>=o.Frame&&(o.frameTimes=0,o.now=Date.now())},this),this.logFunc=t,console.error=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];e.inst.log("[ERROR]",t)},console.warn=function(){for(var t,o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];(t=e.inst).log.apply(t,["[WARN]"].concat(o))},console.log=function(){for(var t,o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];(t=e.inst).log.apply(t,["[INFO]"].concat(o))}},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.addLog.apply(this,e),this.sendLog()},e.prototype.formatLogArguments=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var o="",n=0;n<arguments.length;n++){var a=typeof arguments[n];"string"==a||"number"==a?o+=" "+arguments[n]:"object"==a?o+=" "+JSON.stringify(arguments[n]):"boolean"==a&&arguments[n].toString&&(o+=arguments[n].toString())}return o},e.prototype.addLog=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];null==this.logMsg&&(this.logMsg={});var n=this.formatLogArguments.apply(this,t),a=this.getFullTime(new Date);this.logMsg[a]=e.VERSION+n},e.prototype.getFullTime=function(e){var t="";t+=e.getFullYear();var o=e.getMonth();t+="-"+(o>=10?o:"0"+o);var n=e.getDate();t+="-"+(n>=10?n:"0"+n);var a=e.getHours();t+="  "+(a>=10?a:"0"+a);var r=e.getMinutes();t+=":"+(r>=10?r:"0"+r);var i=e.getSeconds();return t+=":"+(i>=10?i:"0"+i)},e.prototype.sendLog=function(){this.logFunc&&null!=this.logMsg&&(this.logFunc(JSON.stringify(this.logMsg)),this.logMsg=null)},e.prototype.triggerClose=function(e){this.addLog("triggerClose"),this.sendLog()},e.prototype.triggerLoad=function(e){this.addLog("triggerLoad"),this.sendLog()},e.prototype.triggerUnload=function(e){this.addLog("triggerUnload"),this.sendLog()},e.prototype.triggerOnunload=function(e){this.addLog("triggerUnload"),this.sendLog()},e.prototype.triggerError=function(e){this.addLog("triggerError"),this.addLog(e.message),this.sendLog()},e.prototype.triggerFocus=function(e){this.addLog("triggerFocus"),this.sendLog()},e.prototype.triggerBlur=function(e){this.addLog("triggerBlur"),this.sendLog()},e.prototype.triggerAbort=function(e){this.addLog("triggerAbort"),this.sendLog()},e.prototype.triggerSuspend=function(e){this.addLog("triggerSuspend"),this.sendLog()},e.prototype.beforeunload=function(e){this.addLog("beforeunload"),this.sendLog()},e.VERSION="Bust-A-Move version 19 : ",e.LISTENNING_EVENTS=["error"],e}();o.LogHandler=n,cc._RF.pop()},{}],PauseLayer:[function(e,t,o){"use strict";cc._RF.push(t,"06fb3hXnkNL34EZDW3IRUcG","PauseLayer"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Guide"),a=e("./Controller/EventManager"),r=e("./Controller/EventName"),i=cc._decorator,l=i.ccclass,s=i.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.GuideLayer=null,t}return __extends(t,e),Object.defineProperty(t.prototype,"Resume",{get:function(){return this.node.getChildByName("Resume")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Help",{get:function(){return this.node.getChildByName("Help")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MusicSlider",{get:function(){return this.node.getChildByName("Music").getComponent(cc.Slider)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EffectSlider",{get:function(){return this.node.getChildByName("Effect").getComponent(cc.Slider)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MusicMask",{get:function(){return this.MusicSlider.node.getChildByName("Mask")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EffectMask",{get:function(){return this.EffectSlider.node.getChildByName("Mask")},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){var e=this;this.node.active=!1,a.gEventMgr.on(r.GlobalEvent.OPEN_PAUSE,function(){e.show()},this),this.Help.on(cc.Node.EventType.TOUCH_END,function(){a.gEventMgr.emit(r.GlobalEvent.PLAY_EFFECT,"button_click"),e.GuideLayer.show()},this),this.Resume.on(cc.Node.EventType.TOUCH_END,function(){a.gEventMgr.emit(r.GlobalEvent.PLAY_EFFECT,"button_click"),e.hide()},this),this.EffectSlider.node.on("slide",function(){cc.audioEngine.setEffectsVolume(e.EffectSlider.progress),e.updateVolumeSlider()},this),this.MusicSlider.node.on("slide",function(){cc.audioEngine.setMusicVolume(e.MusicSlider.progress),e.updateVolumeSlider()},this)},t.prototype.updateVolumeSlider=function(){this.MusicSlider.progress=cc.audioEngine.getMusicVolume(),this.EffectSlider.progress=cc.audioEngine.getEffectsVolume(),this.EffectMask.width=507*this.EffectSlider.progress,this.MusicMask.width=507*this.MusicSlider.progress},t.prototype.show=function(){this.node.active=!0,this.updateVolumeSlider()},t.prototype.hide=function(){var e=this;setTimeout(function(){e.node.active=!1},0)},__decorate([s(n.default)],t.prototype,"GuideLayer",void 0),t=__decorate([l],t)}(cc.Component);o.default=c,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Guide":"Guide"}],Pointer:[function(e,t,o){"use strict";cc._RF.push(t,"dfda2iUzjJK2KNyR3Mo4JBL","Pointer"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Controller/EventManager"),a=e("./Controller/EventName"),r=cc._decorator,i=r.ccclass,l=r.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.factor=1,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;n.gEventMgr.on(a.GlobalEvent.UPDATE_POINTER_ROTATION,function(t){Math.floor(t)%5==0&&n.gEventMgr.emit(a.GlobalEvent.ON_POINTER_ROTATED,e.node.rotation<=0),e.node.rotation=t*e.factor},this)},t.prototype.start=function(){},__decorate([l],t.prototype,"factor",void 0),t=__decorate([i],t)}(cc.Component);o.default=s,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName"}],ReadyGoAnimation:[function(e,t,o){"use strict";cc._RF.push(t,"af2caQWsglGhLpOpE7b4hy8","ReadyGoAnimation"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Controller/EventManager"),a=e("./Controller/EventName"),r=e("./Controller/Game"),i=cc._decorator,l=i.ccclass,s=i.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ReadyGo=null,t}return __extends(t,e),Object.defineProperty(t.prototype,"sprite",{get:function(){return this.getComponent(cc.Sprite)},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){var e=this;n.gEventMgr.once(a.GlobalEvent.READY_GO,function(){n.gEventMgr.emit(a.GlobalEvent.PLAY_EFFECT,"readygo"),e.play()},this)},t.prototype.play=function(){var e=this;this.sprite.spriteFrame=this.ReadyGo.getSpriteFrame("bg_font_ready"),this.node.runAction(cc.fadeIn(.2)),this.node.runAction(cc.sequence(cc.scaleTo(2,1.5),cc.callFunc(function(){e.sprite.spriteFrame=e.ReadyGo.getSpriteFrame("bg_font_go")}),cc.scaleTo(.1,1),cc.fadeOut(.5),cc.callFunc(function(){r.Game.hasReadygo=!0,r.Game.isStart=!0})))},__decorate([s(cc.SpriteAtlas)],t.prototype,"ReadyGo",void 0),t=__decorate([l],t)}(cc.Component);o.default=c,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game"}],ResultAnimation:[function(e,t,o){"use strict";cc._RF.push(t,"9c567CEF4pENLRjcHnTQ9NP","ResultAnimation"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./FrameAniBase"),a=cc._decorator,r=a.ccclass,i=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.frames=[],t}return __extends(t,e),t.prototype.nextFrame=function(){this.frames&&this.frames.length>0&&(this.Sprite.spriteFrame=this.frames[this.currentIndex],this.callEventFrame(),this.currentIndex=(this.currentIndex+1)%this.frames.length)},t.aniName="ResultAnimation",__decorate([i(cc.SpriteFrame)],t.prototype,"frames",void 0),t=__decorate([r],t)}(n.default);o.default=l,cc._RF.pop()},{"./FrameAniBase":"FrameAniBase"}],ResultLayer:[function(e,t,o){"use strict";cc._RF.push(t,"6cddevafb1BXoHh5PEsKHRP","ResultLayer"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Controller/Game"),a=e("./Const"),r=e("./Controller/EventManager"),i=e("./Controller/EventName"),l=e("./Utils/LogHandler"),s=cc._decorator,c=s.ccclass,u=s.property,h=e("./Utils/celerx"),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.Result=null,t.Submit=null,t.Title=null,t.FinalScore=null,t.GameScore=null,t.Bonus=null,t.Equip=null,t.BonusScore=null,t.gameScore=0,t.showGameScore=0,t.bonus=0,t.showBonus=0,t.bonusScore=0,t.showBonusScore=0,t.totalScore=0,t.showTotalScore=0,t.scoreStep=0,t.submit=!1,t.show=!1,t.canSubmit=!1,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;l.LogHandler.inst.dumpFrameInfo();var t=n.Game.getBubbleScore();console.log(t);for(var o=0,s=a.TreasurePool;o<s.length;o++){var c=s[o];t[c]&&(this.bonusScore+=t[c],this.bonus+=1,console.log(" bonusCount:",this.bonus))}this.totalScore=n.Game.getScore(),this.gameScore=this.totalScore-this.bonusScore,this.scoreStep=Math.max(Math.floor(Math.min(this.totalScore/100,this.gameScore/100)),10),this.Equip.getChildByName("ok").active=n.Game.treasureCount>=5,this.Equip.getChildByName("fail").active=n.Game.treasureCount<5,this.Submit.scale=0,this.Result.scale=0,this.Result.runAction(cc.sequence(cc.scaleTo(.1,1.2),cc.scaleTo(.1,1),cc.callFunc(this.showScore,this))),this.Submit.on(cc.Node.EventType.TOUCH_END,function(){e.canSubmit&&(r.gEventMgr.emit(i.GlobalEvent.PLAY_EFFECT,"button_click"),e.submit||(console.log(" submit score by click:",n.Game.MatchInfo.matchId,", seed:",n.Game.MatchInfo.sharedRandomSeed),h.submitScore(n.Game.getScore()),e.submit=!0))},this)},t.prototype.setTexture=function(e){this.Title.spriteFrame=e},t.prototype.showScore=function(){r.gEventMgr.emit(i.GlobalEvent.PLAY_EFFECT,"over"),this.show=!0},t.prototype.update=function(){var e=this;this.show&&(this.showGameScore<this.gameScore&&(this.showGameScore+=this.scoreStep,this.showGameScore=Math.min(this.showGameScore,this.gameScore),this.GameScore.string=this.showGameScore.toString()),this.showBonus<this.bonus&&(this.showBonus+=.1,this.showBonus=Math.min(this.showBonus,this.bonus),this.Bonus.string=Math.floor(this.showBonus).toString()),this.showBonusScore<this.bonusScore&&(this.showBonusScore+=this.scoreStep,this.showBonusScore=Math.min(this.showBonusScore,this.bonusScore),this.BonusScore.string=this.showBonusScore.toString()),this.showGameScore==this.gameScore&&this.showTotalScore<this.totalScore&&(this.showTotalScore+=this.scoreStep,this.showTotalScore=Math.min(this.totalScore,this.showTotalScore),this.FinalScore.string=this.showTotalScore.toString()),this.showTotalScore==this.totalScore&&(this.show=!1,this.Submit.runAction(cc.sequence(cc.scaleTo(.1,1.2),cc.scaleTo(.1,1),cc.callFunc(function(){e.canSubmit=!0,setTimeout(function(){e.submit||(console.log(" submit score by timeout:",n.Game.MatchInfo.matchId,", seed:",n.Game.MatchInfo.sharedRandomSeed),h.submitScore(n.Game.getScore()),e.submit=!0)},3e3)},this)))))},__decorate([u(cc.Node)],t.prototype,"Result",void 0),__decorate([u(cc.Node)],t.prototype,"Submit",void 0),__decorate([u(cc.Sprite)],t.prototype,"Title",void 0),__decorate([u(cc.Label)],t.prototype,"FinalScore",void 0),__decorate([u(cc.Label)],t.prototype,"GameScore",void 0),__decorate([u(cc.Label)],t.prototype,"Bonus",void 0),__decorate([u(cc.Node)],t.prototype,"Equip",void 0),__decorate([u(cc.Label)],t.prototype,"BonusScore",void 0),t=__decorate([c],t)}(cc.Component);o.default=d,cc._RF.pop()},{"./Const":"Const","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Utils/LogHandler":"LogHandler","./Utils/celerx":"celerx"}],ShooterLayer:[function(e,t,o){"use strict";cc._RF.push(t,"a86feZkxotMl5W4gIeRr5Ex","ShooterLayer"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Controller/EventManager"),a=e("./Controller/EventName"),r=e("./Bubble"),i=e("./BubbleMove"),l=e("./Controller/GameFactory"),s=e("./Controller/Game"),c=cc._decorator,u=c.ccclass,h=c.property,d=15,p={0:"bg_signrainbow",1:"bg_signblue",2:"bg_signgreen",3:"bg_signorange",4:"bg_signpurple",5:"bg_signred",6:"bg_signyellow",7:"bg_signhorse"},b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ShooterStar=null,t.Shooter=null,t.PointAtlas=null,t.Point=null,t.pointCount=d,t.isStart=!1,t}return __extends(t,e),t.prototype.onLoad=function(){this.ShooterStar.active=!1,this.Point.active=!1,this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},t.prototype.start=function(){},t.prototype.updateStarPosition=function(e){var t=CMath.GetWorldPosition(this.Shooter),o=this.node.getParent().convertToNodeSpaceAR(e),r=CMath.getK(e,t),i=0;if(null===r){var l=t.y<=e.y?1:-1;this.ShooterStar.x=0,this.ShooterStar.y=o.y+150*l,this.updatePoint(r,l)}else{var s=Math.atan(r);l=t.x<=e.x?1:-1;this.ShooterStar.x=o.x+150*Math.cos(s)*l,this.ShooterStar.y=o.y+150*Math.sin(s)*l,this.updatePoint(r,l),s>0?(i=180*(Math.PI/2-s)/Math.PI,l<0&&(i+=180)):(i=180*(-Math.PI/2-s)/Math.PI,l>0&&(i+=180))}return n.gEventMgr.emit(a.GlobalEvent.UPDATE_POINTER_ROTATION,i),e.sub(t)},t.prototype.updatePoint=function(e,t){for(;this.Point.childrenCount>this.pointCount;)l.gFactory.putPoint(this.Point.children[this.Point.childrenCount-1]);for(;this.Point.childrenCount<this.pointCount;)this.Point.addChild(l.gFactory.getPoint());var o=this.Point.childrenCount;if(null===e)for(var n=0;n<o;n++){(r=this.Point.children[n]).x=0,r.y=60*n*t,r.opacity=255-n/o*150,r.getComponent(cc.Sprite).spriteFrame=this.PointAtlas.getSpriteFrames()[n%this.PointAtlas.getSpriteFrames().length]}else{var a=Math.atan(e);for(n=0;n<o;n++){var r;(r=this.Point.children[n]).opacity=255-n/o*150,r.x=60*n*Math.cos(a)*t;for(var s=-1==t?1:2;Math.abs(r.x)>i.BorderX;)r.x-=(Math.abs(r.x)-i.BorderX)*Math.pow(-1,s++)*2;r.y=60*n*Math.sin(a)*t,r.getComponent(cc.Sprite).spriteFrame=this.PointAtlas.getSpriteFrames()[n%this.PointAtlas.getSpriteFrames().length]}}},t.prototype.onTouchStart=function(e){if(this.Shooter.childrenCount<=0)console.log(" shooter has no bubble");else{if(0==s.Game.hasReadygo)return console.log(" has ready go false"),void setTimeout(function(){n.gEventMgr.emit(a.GlobalEvent.READY_GO)},0);s.Game.isStart||this.isStart||(s.Game.isStart=!0,this.isStart=!0),s.Game.isStart?(this.updateStarPosition(e.getLocation()),this.ShooterStar.active=!0,this.Point.active=!0,this.ShooterStar.getComponent(cc.Sprite).spriteFrame=this.PointAtlas.getSpriteFrame(p[this.Shooter.children[0].getComponent(r.default).Color]),n.gEventMgr.emit(a.GlobalEvent.IS_GREEN_IDLE,!1)):console.log(" game not start ")}},t.prototype.onTouchMove=function(e){this.Shooter.childrenCount<=0?console.log(" shooter has no bubble, on touchmove"):s.Game.isStart?(this.ShooterStar.active=!0,this.Point.active=!0,this.ShooterStar.getComponent(cc.Sprite).spriteFrame=this.PointAtlas.getSpriteFrame(p[this.Shooter.children[0].getComponent(r.default).Color]),this.updateStarPosition(e.getLocation()),n.gEventMgr.emit(a.GlobalEvent.IS_GREEN_IDLE,!1)):console.log(" isStart is false, on touchmove")},t.prototype.onTouchEnd=function(e){if(s.Game.isStart)if(this.ShooterStar.active=!1,this.Point.active=!1,this.Shooter.childrenCount<=0)console.log(" shooter has no bubble, on touchend");else{var t=this.updateStarPosition(e.getLocation());this.ShooterStar.y>=-700?(console.log("\u53d1\u9001\u53d1\u5c04\u4e8b\u4ef6"),n.gEventMgr.emit(a.GlobalEvent.SHOOT,t)):console.log(" \u53d1\u5c04\u89d2\u5ea6\u4e0d\u5728\u6709\u6548\u8303\u56f4"),n.gEventMgr.emit(a.GlobalEvent.IS_GREEN_IDLE,!0)}else console.log(" on touch end ,is not start")},__decorate([h(cc.Node)],t.prototype,"ShooterStar",void 0),__decorate([h(cc.Node)],t.prototype,"Shooter",void 0),__decorate([h(cc.SpriteAtlas)],t.prototype,"PointAtlas",void 0),__decorate([h(cc.Node)],t.prototype,"Point",void 0),t=__decorate([u],t)}(cc.Component);o.default=b,cc._RF.pop()},{"./Bubble":"Bubble","./BubbleMove":"BubbleMove","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Controller/GameFactory":"GameFactory"}],StepController:[function(e,t,o){"use strict";cc._RF.push(t,"09ac2ySMaBKF6e+GcvfUxR0","StepController"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){this.totalStep=[],this.curStep=[]}return Object.defineProperty(e,"inst",{get:function(){return this._ins?this._ins:this._ins=new e},enumerable:!0,configurable:!0}),e.prototype.register=function(e,t){this.completeCallback=e,this.totalStep=t},e.prototype.nextStep=function(e){this.totalStep.indexOf(e)<0?console.error(" \u6ca1\u6709\u8fd9\u4e00\u6b65\uff1a",e):this.curStep.indexOf(e)>=0?console.error(" \u6b65\u9aa4\u5df2\u5b8c\u6210\uff1a",e):(this.curStep.push(e),this.curStep.sort(function(e,t){return e>t?-1:1}),this.totalStep.sort(function(e,t){return e>t?-1:1}),console.log(" cur step:",this.curStep.join(",")),console.log(" total step:",this.totalStep.join(",")),this.curStep.join(",")==this.totalStep.join(",")&&(this.totalStep.length=0,this.completeCallback(),this.completeCallback=null))},e}();o.gStep=n.inst,cc._RF.pop()},{}],SuperHorceAni:[function(e,t,o){"use strict";cc._RF.push(t,"1aa15GeVWdLs6SMx7rN7ubY","SuperHorceAni"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./FrameAniBase"),a=e("./Controller/EventManager"),r=e("./Controller/EventName"),i=cc._decorator,l=i.ccclass,s=(i.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),a.gEventMgr.on(r.GlobalEvent.HORCE_CLEAR,function(){t.play(),t.node.opacity=255},this)},t.prototype.onComplete=function(){this.node.runAction(cc.fadeOut(.2))},t.aniName="SuperHorceAni",t=__decorate([l],t)}(n.default));o.default=s,cc._RF.pop()},{"./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./FrameAniBase":"FrameAniBase"}],Treasure:[function(e,t,o){"use strict";cc._RF.push(t,"839c8WNoRJFOZY4LdvRkdlU","Treasure"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Controller/Game"),a=e("./Const"),r=e("./Controller/EventManager"),i=e("./Controller/EventName"),l=cc._decorator,s=l.ccclass,c=(l.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isCollider=!0,t}return __extends(t,e),Object.defineProperty(t.prototype,"Self",{get:function(){return this.node.getChildByName("self")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Alpha",{get:function(){return this.node.getChildByName("alpha")},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){var e=this;this.node.group="default",this.node.opacity=255,this.Alpha.opacity=255,r.gEventMgr.on(i.GlobalEvent.CHECK_TREASURE,function(){n.Game.isStart&&e.checkCollider()},this)},t.prototype.update=function(){},t.prototype.checkCollider=function(){this.isCollider=!1;for(var e=n.Game.getMatrix(),t=n.Game.startIndex;t<e.data.length;t++)if(e.data[t]&&e.data[t].bubble&&e.data[t].bubble.node.active){var o=e.data[t].bubble;if(cc.Intersection.polygonCircle(this.getComponent(cc.PolygonCollider).points,{position:CMath.ConvertToNodeSpaceAR(o.node,this.node.getParent()),radius:o.getComponent(cc.CircleCollider).radius})){this.isCollider=!0;break}}this.isCollider||(r.gEventMgr.targetOff(this),n.Game.treasureCount++,console.log(" treasureCount:",n.Game.treasureCount),n.Game.treasureCount>=5&&r.gEventMgr.emit(i.GlobalEvent.GET_CHANGE_BUTTON),this.getTreasure(n.Game.treasureCount))},t.prototype.getTreasure=function(e){var t=this,o=CMath.ConvertToNodeSpaceAR(n.Game.TopNode.getChildByName("TreasureRoot").getChildByName(n.Game.treasureCount.toString()),this.node.getParent()),l=CMath.Distance(o,this.node.position)/1500;this.enabled=!1,this.node.group="treasure",r.gEventMgr.emit(i.GlobalEvent.PLAY_EFFECT,"get_treasure"),this.Alpha.runAction(cc.sequence(cc.delayTime(.3),cc.spawn(cc.scaleTo(.2,5),cc.fadeOut(.2)))),this.Self.runAction(cc.sequence(cc.delayTime(.1),cc.scaleTo(.1,2),cc.delayTime(.3),cc.callFunc(function(){n.Game.addScore(a.BubbleType["Treasure_"+e],a.BubbleType["Treasure_"+e],a.BubbleType["Treasure_"+e]/200*.1+1,CMath.ConvertToNodeSpaceAR(t.Self,n.Game.TopNode))}),cc.scaleTo(.1,1),cc.moveTo(l,o),cc.fadeTo(.1,0),cc.callFunc(function(){r.gEventMgr.emit(i.GlobalEvent.GET_TREASURE,e),t.node.removeFromParent()})))},t=__decorate([s],t)}(cc.Component));o.default=c,cc._RF.pop()},{"./Const":"Const","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game"}],celerx:[function(e,t,o){"use strict";cc._RF.push(t,"86cd8TXnY5AKqy5mkWiIwvz","celerx");var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a={default:void 0,call:function(e,t,o){var n="";if("function"==typeof t&&(o=t,t={}),t={data:void 0===t?null:t},"function"==typeof o){var a="dscb"+window.dscb++;window[a]=o,t._dscbstub=a}return t=JSON.stringify(t),window._dsbridge?n=_dsbridge.call(e,t):(window._dswk||-1!=navigator.userAgent.indexOf("_dsbridge"))&&(n=prompt("_dsbridge="+e,t)),JSON.parse(n||"{}").data},register:function(e,t,o){o=o?window._dsaf:window._dsf,window._dsInit||(window._dsInit=!0,setTimeout(function(){a.call("_dsb.dsinit")},0)),"object"==(void 0===t?"undefined":n(t))?o._obs[e]=t:o[e]=t},registerAsyn:function(e,t){this.register(e,t,!0)},hasNativeMethod:function(e,t){return this.call("_dsb.hasNativeMethod",{name:e,type:t||"all"})},disableJavascriptDialogBlock:function(e){this.call("_dsb.disableJavascriptDialogBlock",{disable:!1!==e})}};!function(){if(!window._dsf){var e,t={_dsf:{_obs:{}},_dsaf:{_obs:{}},dscb:0,celerx:a,close:function(){a.call("_dsb.closePage")},_handleMessageFromNative:function(e){var t=JSON.parse(e.data),o={id:e.callbackId,complete:!0},n=this._dsf[e.method],r=this._dsaf[e.method],i=function(e,n){o.data=e.apply(n,t),a.call("_dsb.returnValue",o)},l=function(e,n){t.push(function(e,t){o.data=e,o.complete=!1!==t,a.call("_dsb.returnValue",o)}),e.apply(n,t)};if(n)i(n,this._dsf);else if(r)l(r,this._dsaf);else if(n=e.method.split("."),!(2>n.length)){e=n.pop();n=n.join(".");var s=(r=(r=this._dsf._obs)[n]||{})[e];s&&"function"==typeof s?i(s,r):(s=(r=(r=this._dsaf._obs)[n]||{})[e])&&"function"==typeof s&&l(s,r)}}};for(e in t)window[e]=t[e];a.register("_hasJavascriptMethod",function(e,t){return 2>(t=e.split(".")).length?!(!_dsf[t]&&!_dsaf[t]):(e=t.pop(),t=t.join("."),(t=_dsf._obs[t]||_dsaf._obs[t])&&!!t[e])})}}();var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function i(e){for(var t=new Uint8Array(e),o=new Array,n=0,a=0,i=new Array(3),l=new Array(4),s=t.length,c=0;s--;)if(i[n++]=t[c++],3==n){for(l[0]=(252&i[0])>>2,l[1]=((3&i[0])<<4)+((240&i[1])>>4),l[2]=((15&i[1])<<2)+((192&i[2])>>6),l[3]=63&i[2],n=0;n<4;n++)o+=r.charAt(l[n]);n=0}if(n){for(a=n;a<3;a++)i[a]=0;for(l[0]=(252&i[0])>>2,l[1]=((3&i[0])<<4)+((240&i[1])>>4),l[2]=((15&i[1])<<2)+((192&i[2])>>6),l[3]=63&i[2],a=0;a<n+1;a++)o+=r.charAt(l[a]);for(;n++<3;)o+="="}return o}var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function s(e){var t,o,n,a,r,i,s=new Array,c=0;if(e!=(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""))&&alert("Warning! Characters outside Base64 range in input string ignored."),e.length%4)return alert("Error: Input length is not a multiple of 4 bytes."),"";for(var u=0;c<e.length;)t=l.indexOf(e.charAt(c++))<<2|(a=l.indexOf(e.charAt(c++)))>>4,o=(15&a)<<4|(r=l.indexOf(e.charAt(c++)))>>2,n=(3&r)<<6|(i=l.indexOf(e.charAt(c++))),s[u++]=t,64!=r&&(s[u++]=o),64!=i&&(s[u++]=n);return s}var c={callback:function(){return""}},u={callback:function(){return""}};a.register("provideScore",function(){return c.callback()}),a.register("provideCurrentFrameData",function(){return u.callback()}),t.exports=window.celerSDK={onStateReceived:function(e){return a.register("onStateReceived",function(t){var o=s(t);return e(new Uint8Array(o))})},onCourtModeStarted:function(e){return a.register("onCourtModeStarted",e)},getMatch:function(){var e=a.call("getMatch","123");try{e=JSON.parse(e)}catch(e){}return e},showCourtModeDialog:function(){return a.call("showCourtModeDialog")},start:function(){return a.call("start")},sendState:function(e){return a.call("sendState",i(e))},draw:function(e){return a.call("draw",i(e))},win:function(e){return a.call("win",i(e))},lose:function(e){return a.call("lose",i(e))},surrender:function(e){return a.call("surrender",i(e))},applyAction:function(e,t){return a.call("applyAction",i(e),t)},getOnChainState:function(e){return a.call("getOnChainState","123",function(t){var o=s(t);return e(new Uint8Array(o))})},getOnChainActionDeadline:function(e){return a.call("getOnChainActionDeadline","123",e)},getCurrentBlockNumber:function(){return a.call("getCurrentBlockNumber","123")},finalizeOnChainGame:function(e){return a.call("finalizeOnChainGame","123",e)},submitScore:function(e){return a.call("submitScore",e)},ready:function(){if(window.cc){var e=!1,t=document.getElementsByTagName("canvas")[0];cc.director.on(cc.Director.EVENT_AFTER_DRAW,function(){e&&(e=!1,celerSDK.didTakeSnapshot(t.toDataURL("image/jpeg",.1)))}),celerSDK.provideCurrentFrameData(function(){e=!0})}return a.call("ready")},onStart:function(e){return a.register("onStart",e)},provideScore:function(e){return c={callback:e}},provideCurrentFrameData:function(e){return u={callback:e}},didTakeSnapshot:function(e){if(!(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.celerSDK&&window.webkit.messageHandlers.celerSDK.postMessage))return a.call("didTakeSnapshot",e);window.webkit.messageHandlers.celerSDK.postMessage({method:"didTakeSnapshot",args:e})},log:function(e){if(!(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.celerSDK&&window.webkit.messageHandlers.celerSDK.postMessage))return a.call("log",e);window.webkit.messageHandlers.celerSDK.postMessage({method:"log",args:e})},getGameScore:function(){return c&&c.callback&&""!=c.callback()?c.callback():0},switchSnapShotFlag:function(){return u&&u.callback&&""!=u.callback()?u.callback():0}},cc._RF.pop()},{}]},{},["Bubble","BubbleBurst","BubbleChange","BubbleDrop","BubbleHorce","BubbleIdle","BubbleMove","Const","AudioController","EventManager","EventName","Game","GameFactory","StepController","BubbleMatrix","FrameAniBase","GameScene","Guide","PauseLayer","Pointer","ReadyGoAnimation","ResultAnimation","ResultLayer","BlueIdle","BlueLoad","GreenIdle","HandUpLeft","HandUpRight","ShooterLayer","SuperHorceAni","Treasure","HashMap","LogHandler","celerx"]);